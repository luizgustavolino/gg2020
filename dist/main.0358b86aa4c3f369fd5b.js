!function(t){var o={};function e(i){if(o[i])return o[i].exports;var s=o[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,e),s.l=!0,s.exports}e.m=t,e.c=o,e.d=function(t,o,i){e.o(t,o)||Object.defineProperty(t,o,{enumerable:!0,get:i})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,o){if(1&o&&(t=e(t)),8&o)return t;if(4&o&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(e.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&o&&"string"!=typeof t)for(var s in t)e.d(i,s,function(o){return t[o]}.bind(null,s));return i},e.n=function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(o,"a",o),o},e.o=function(t,o){return Object.prototype.hasOwnProperty.call(t,o)},e.p="",e(e.s=1)}([function(t,o,e){!function(t){"use strict";function o(t,o){return void 0!==t?t:o}const e=3.14159265359,i=2/180*e;class s{constructor(t=0,o=0,e=0){this.major=0,this.minor=0,this.revision=0,this.major=t,this.minor=o,this.revision=e}toString(){return this.major+"."+this.minor+"."+this.revision}}const n=new s(2,3,2);function r(t,o){const e=[];for(let i=0;i<t;++i)e.push(o(i));return e}function a(t,o=0){const e=[];for(let i=0;i<t;++i)e.push(o);return e}const m=Math.abs,p=Math.min,l=Math.max;function f(t,o,e){return t<o?o:t>e?e:t}const h=isFinite;function y(t){return t*t}function _(t){return 1/Math.sqrt(t)}const c=Math.sqrt,C=Math.pow,u=Math.cos,d=Math.sin,x=Math.acos,g=Math.asin,B=Math.atan2;class S{constructor(t=0,o=0){this.x=t,this.y=o}Clone(){return new S(this.x,this.y)}SetZero(){return this.x=0,this.y=0,this}Set(t,o){return this.x=t,this.y=o,this}Copy(t){return this.x=t.x,this.y=t.y,this}SelfAdd(t){return this.x+=t.x,this.y+=t.y,this}SelfAddXY(t,o){return this.x+=t,this.y+=o,this}SelfSub(t){return this.x-=t.x,this.y-=t.y,this}SelfSubXY(t,o){return this.x-=t,this.y-=o,this}SelfMul(t){return this.x*=t,this.y*=t,this}SelfMulAdd(t,o){return this.x+=t*o.x,this.y+=t*o.y,this}SelfMulSub(t,o){return this.x-=t*o.x,this.y-=t*o.y,this}Dot(t){return this.x*t.x+this.y*t.y}Cross(t){return this.x*t.y-this.y*t.x}Length(){const t=this.x,o=this.y;return Math.sqrt(t*t+o*o)}LengthSquared(){const t=this.x,o=this.y;return t*t+o*o}Normalize(){const t=this.Length();if(t>=1e-5){const o=1/t;this.x*=o,this.y*=o}return t}SelfNormalize(){const t=this.Length();if(t>=1e-5){const o=1/t;this.x*=o,this.y*=o}return this}SelfRotate(t){const o=Math.cos(t),e=Math.sin(t),i=this.x;return this.x=o*i-e*this.y,this.y=e*i+o*this.y,this}IsValid(){return isFinite(this.x)&&isFinite(this.y)}SelfCrossVS(t){const o=this.x;return this.x=t*this.y,this.y=-t*o,this}SelfCrossSV(t){const o=this.x;return this.x=-t*this.y,this.y=t*o,this}SelfMinV(t){return this.x=p(this.x,t.x),this.y=p(this.y,t.y),this}SelfMaxV(t){return this.x=l(this.x,t.x),this.y=l(this.y,t.y),this}SelfAbs(){return this.x=m(this.x),this.y=m(this.y),this}SelfNeg(){return this.x=-this.x,this.y=-this.y,this}SelfSkew(){const t=this.x;return this.x=-this.y,this.y=t,this}static MakeArray(t){return r(t,t=>new S)}static AbsV(t,o){return o.x=m(t.x),o.y=m(t.y),o}static MinV(t,o,e){return e.x=p(t.x,o.x),e.y=p(t.y,o.y),e}static MaxV(t,o,e){return e.x=l(t.x,o.x),e.y=l(t.y,o.y),e}static ClampV(t,o,e,i){return i.x=f(t.x,o.x,e.x),i.y=f(t.y,o.y,e.y),i}static RotateV(t,o,e){const i=t.x,s=t.y,n=Math.cos(o),r=Math.sin(o);return e.x=n*i-r*s,e.y=r*i+n*s,e}static DotVV(t,o){return t.x*o.x+t.y*o.y}static CrossVV(t,o){return t.x*o.y-t.y*o.x}static CrossVS(t,o,e){const i=t.x;return e.x=o*t.y,e.y=-o*i,e}static CrossVOne(t,o){const e=t.x;return o.x=t.y,o.y=-e,o}static CrossSV(t,o,e){const i=o.x;return e.x=-t*o.y,e.y=t*i,e}static CrossOneV(t,o){const e=t.x;return o.x=-t.y,o.y=e,o}static AddVV(t,o,e){return e.x=t.x+o.x,e.y=t.y+o.y,e}static SubVV(t,o,e){return e.x=t.x-o.x,e.y=t.y-o.y,e}static MulSV(t,o,e){return e.x=o.x*t,e.y=o.y*t,e}static MulVS(t,o,e){return e.x=t.x*o,e.y=t.y*o,e}static AddVMulSV(t,o,e,i){return i.x=t.x+o*e.x,i.y=t.y+o*e.y,i}static SubVMulSV(t,o,e,i){return i.x=t.x-o*e.x,i.y=t.y-o*e.y,i}static AddVCrossSV(t,o,e,i){const s=e.x;return i.x=t.x-o*e.y,i.y=t.y+o*s,i}static MidVV(t,o,e){return e.x=.5*(t.x+o.x),e.y=.5*(t.y+o.y),e}static ExtVV(t,o,e){return e.x=.5*(o.x-t.x),e.y=.5*(o.y-t.y),e}static IsEqualToV(t,o){return t.x===o.x&&t.y===o.y}static DistanceVV(t,o){const e=t.x-o.x,i=t.y-o.y;return Math.sqrt(e*e+i*i)}static DistanceSquaredVV(t,o){const e=t.x-o.x,i=t.y-o.y;return e*e+i*i}static NegV(t,o){return o.x=-t.x,o.y=-t.y,o}}S.ZERO=new S(0,0),S.UNITX=new S(1,0),S.UNITY=new S(0,1),S.s_t0=new S,S.s_t1=new S,S.s_t2=new S,S.s_t3=new S;const b=new S(0,0);class A{constructor(t=0,o=0,e=0){this.x=t,this.y=o,this.z=e}Clone(){return new A(this.x,this.y,this.z)}SetZero(){return this.x=0,this.y=0,this.z=0,this}SetXYZ(t,o,e){return this.x=t,this.y=o,this.z=e,this}Copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}SelfNeg(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}SelfAdd(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}SelfAddXYZ(t,o,e){return this.x+=t,this.y+=o,this.z+=e,this}SelfSub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}SelfSubXYZ(t,o,e){return this.x-=t,this.y-=o,this.z-=e,this}SelfMul(t){return this.x*=t,this.y*=t,this.z*=t,this}static DotV3V3(t,o){return t.x*o.x+t.y*o.y+t.z*o.z}static CrossV3V3(t,o,e){const i=t.x,s=t.y,n=t.z,r=o.x,a=o.y,m=o.z;return e.x=s*m-n*a,e.y=n*r-i*m,e.z=i*a-s*r,e}}A.ZERO=new A(0,0,0),A.s_t0=new A;class v{constructor(){this.ex=new S(1,0),this.ey=new S(0,1)}Clone(){return(new v).Copy(this)}static FromVV(t,o){return(new v).SetVV(t,o)}static FromSSSS(t,o,e,i){return(new v).SetSSSS(t,o,e,i)}static FromAngle(t){return(new v).SetAngle(t)}SetSSSS(t,o,e,i){return this.ex.Set(t,e),this.ey.Set(o,i),this}SetVV(t,o){return this.ex.Copy(t),this.ey.Copy(o),this}SetAngle(t){const o=Math.cos(t),e=Math.sin(t);return this.ex.Set(o,e),this.ey.Set(-e,o),this}Copy(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this}SetIdentity(){return this.ex.Set(1,0),this.ey.Set(0,1),this}SetZero(){return this.ex.SetZero(),this.ey.SetZero(),this}GetAngle(){return Math.atan2(this.ex.y,this.ex.x)}GetInverse(t){const o=this.ex.x,e=this.ey.x,i=this.ex.y,s=this.ey.y;let n=o*s-e*i;return 0!==n&&(n=1/n),t.ex.x=n*s,t.ey.x=-n*e,t.ex.y=-n*i,t.ey.y=n*o,t}Solve(t,o,e){const i=this.ex.x,s=this.ey.x,n=this.ex.y,r=this.ey.y;let a=i*r-s*n;return 0!==a&&(a=1/a),e.x=a*(r*t-s*o),e.y=a*(i*o-n*t),e}SelfAbs(){return this.ex.SelfAbs(),this.ey.SelfAbs(),this}SelfInv(){return this.GetInverse(this),this}SelfAddM(t){return this.ex.SelfAdd(t.ex),this.ey.SelfAdd(t.ey),this}SelfSubM(t){return this.ex.SelfSub(t.ex),this.ey.SelfSub(t.ey),this}static AbsM(t,o){const e=t.ex,i=t.ey;return o.ex.x=m(e.x),o.ex.y=m(e.y),o.ey.x=m(i.x),o.ey.y=m(i.y),o}static MulMV(t,o,e){const i=t.ex,s=t.ey,n=o.x,r=o.y;return e.x=i.x*n+s.x*r,e.y=i.y*n+s.y*r,e}static MulTMV(t,o,e){const i=t.ex,s=t.ey,n=o.x,r=o.y;return e.x=i.x*n+i.y*r,e.y=s.x*n+s.y*r,e}static AddMM(t,o,e){const i=t.ex,s=t.ey,n=o.ex,r=o.ey;return e.ex.x=i.x+n.x,e.ex.y=i.y+n.y,e.ey.x=s.x+r.x,e.ey.y=s.y+r.y,e}static MulMM(t,o,e){const i=t.ex.x,s=t.ex.y,n=t.ey.x,r=t.ey.y,a=o.ex.x,m=o.ex.y,p=o.ey.x,l=o.ey.y;return e.ex.x=i*a+n*m,e.ex.y=s*a+r*m,e.ey.x=i*p+n*l,e.ey.y=s*p+r*l,e}static MulTMM(t,o,e){const i=t.ex.x,s=t.ex.y,n=t.ey.x,r=t.ey.y,a=o.ex.x,m=o.ex.y,p=o.ey.x,l=o.ey.y;return e.ex.x=i*a+s*m,e.ex.y=n*a+r*m,e.ey.x=i*p+s*l,e.ey.y=n*p+r*l,e}}v.IDENTITY=new v;class w{constructor(){this.ex=new A(1,0,0),this.ey=new A(0,1,0),this.ez=new A(0,0,1)}Clone(){return(new w).Copy(this)}SetVVV(t,o,e){return this.ex.Copy(t),this.ey.Copy(o),this.ez.Copy(e),this}Copy(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this.ez.Copy(t.ez),this}SetIdentity(){return this.ex.SetXYZ(1,0,0),this.ey.SetXYZ(0,1,0),this.ez.SetXYZ(0,0,1),this}SetZero(){return this.ex.SetZero(),this.ey.SetZero(),this.ez.SetZero(),this}SelfAddM(t){return this.ex.SelfAdd(t.ex),this.ey.SelfAdd(t.ey),this.ez.SelfAdd(t.ez),this}Solve33(t,o,e,i){const s=this.ex.x,n=this.ex.y,r=this.ex.z,a=this.ey.x,m=this.ey.y,p=this.ey.z,l=this.ez.x,f=this.ez.y,h=this.ez.z;let y=s*(m*h-p*f)+n*(p*l-a*h)+r*(a*f-m*l);return 0!==y&&(y=1/y),i.x=y*(t*(m*h-p*f)+o*(p*l-a*h)+e*(a*f-m*l)),i.y=y*(s*(o*h-e*f)+n*(e*l-t*h)+r*(t*f-o*l)),i.z=y*(s*(m*e-p*o)+n*(p*t-a*e)+r*(a*o-m*t)),i}Solve22(t,o,e){const i=this.ex.x,s=this.ey.x,n=this.ex.y,r=this.ey.y;let a=i*r-s*n;return 0!==a&&(a=1/a),e.x=a*(r*t-s*o),e.y=a*(i*o-n*t),e}GetInverse22(t){const o=this.ex.x,e=this.ey.x,i=this.ex.y,s=this.ey.y;let n=o*s-e*i;0!==n&&(n=1/n),t.ex.x=n*s,t.ey.x=-n*e,t.ex.z=0,t.ex.y=-n*i,t.ey.y=n*o,t.ey.z=0,t.ez.x=0,t.ez.y=0,t.ez.z=0}GetSymInverse33(t){let o=A.DotV3V3(this.ex,A.CrossV3V3(this.ey,this.ez,A.s_t0));0!==o&&(o=1/o);const e=this.ex.x,i=this.ey.x,s=this.ez.x,n=this.ey.y,r=this.ez.y,a=this.ez.z;t.ex.x=o*(n*a-r*r),t.ex.y=o*(s*r-i*a),t.ex.z=o*(i*r-s*n),t.ey.x=t.ex.y,t.ey.y=o*(e*a-s*s),t.ey.z=o*(s*i-e*r),t.ez.x=t.ex.z,t.ez.y=t.ey.z,t.ez.z=o*(e*n-i*i)}static MulM33V3(t,o,e){const i=o.x,s=o.y,n=o.z;return e.x=t.ex.x*i+t.ey.x*s+t.ez.x*n,e.y=t.ex.y*i+t.ey.y*s+t.ez.y*n,e.z=t.ex.z*i+t.ey.z*s+t.ez.z*n,e}static MulM33XYZ(t,o,e,i,s){return s.x=t.ex.x*o+t.ey.x*e+t.ez.x*i,s.y=t.ex.y*o+t.ey.y*e+t.ez.y*i,s.z=t.ex.z*o+t.ey.z*e+t.ez.z*i,s}static MulM33V2(t,o,e){const i=o.x,s=o.y;return e.x=t.ex.x*i+t.ey.x*s,e.y=t.ex.y*i+t.ey.y*s,e}static MulM33XY(t,o,e,i){return i.x=t.ex.x*o+t.ey.x*e,i.y=t.ex.y*o+t.ey.y*e,i}}w.IDENTITY=new w;class V{constructor(t=0){this.s=0,this.c=1,t&&(this.s=Math.sin(t),this.c=Math.cos(t))}Clone(){return(new V).Copy(this)}Copy(t){return this.s=t.s,this.c=t.c,this}SetAngle(t){return this.s=Math.sin(t),this.c=Math.cos(t),this}SetIdentity(){return this.s=0,this.c=1,this}GetAngle(){return Math.atan2(this.s,this.c)}GetXAxis(t){return t.x=this.c,t.y=this.s,t}GetYAxis(t){return t.x=-this.s,t.y=this.c,t}static MulRR(t,o,e){const i=t.c,s=t.s,n=o.c,r=o.s;return e.s=s*n+i*r,e.c=i*n-s*r,e}static MulTRR(t,o,e){const i=t.c,s=t.s,n=o.c,r=o.s;return e.s=i*r-s*n,e.c=i*n+s*r,e}static MulRV(t,o,e){const i=t.c,s=t.s,n=o.x,r=o.y;return e.x=i*n-s*r,e.y=s*n+i*r,e}static MulTRV(t,o,e){const i=t.c,s=t.s,n=o.x,r=o.y;return e.x=i*n+s*r,e.y=-s*n+i*r,e}}V.IDENTITY=new V;class M{constructor(){this.p=new S,this.q=new V}Clone(){return(new M).Copy(this)}Copy(t){return this.p.Copy(t.p),this.q.Copy(t.q),this}SetIdentity(){return this.p.SetZero(),this.q.SetIdentity(),this}SetPositionRotation(t,o){return this.p.Copy(t),this.q.Copy(o),this}SetPositionAngle(t,o){return this.p.Copy(t),this.q.SetAngle(o),this}SetPosition(t){return this.p.Copy(t),this}SetPositionXY(t,o){return this.p.Set(t,o),this}SetRotation(t){return this.q.Copy(t),this}SetRotationAngle(t){return this.q.SetAngle(t),this}GetPosition(){return this.p}GetRotation(){return this.q}GetRotationAngle(){return this.q.GetAngle()}GetAngle(){return this.q.GetAngle()}static MulXV(t,o,e){const i=t.q.c,s=t.q.s,n=o.x,r=o.y;return e.x=i*n-s*r+t.p.x,e.y=s*n+i*r+t.p.y,e}static MulTXV(t,o,e){const i=t.q.c,s=t.q.s,n=o.x-t.p.x,r=o.y-t.p.y;return e.x=i*n+s*r,e.y=-s*n+i*r,e}static MulXX(t,o,e){return V.MulRR(t.q,o.q,e.q),S.AddVV(V.MulRV(t.q,o.p,e.p),t.p,e.p),e}static MulTXX(t,o,e){return V.MulTRR(t.q,o.q,e.q),V.MulTRV(t.q,S.SubVV(o.p,t.p,e.p),e.p),e}}M.IDENTITY=new M;class P{constructor(){this.localCenter=new S,this.c0=new S,this.c=new S,this.a0=0,this.a=0,this.alpha0=0}Clone(){return(new P).Copy(this)}Copy(t){return this.localCenter.Copy(t.localCenter),this.c0.Copy(t.c0),this.c.Copy(t.c),this.a0=t.a0,this.a=t.a,this.alpha0=t.alpha0,this}GetTransform(t,o){const e=1-o;t.p.x=e*this.c0.x+o*this.c.x,t.p.y=e*this.c0.y+o*this.c.y;const i=e*this.a0+o*this.a;return t.q.SetAngle(i),t.p.SelfSub(V.MulRV(t.q,this.localCenter,S.s_t0)),t}Advance(t){const o=(t-this.alpha0)/(1-this.alpha0),e=1-o;this.c0.x=e*this.c0.x+o*this.c.x,this.c0.y=e*this.c0.y+o*this.c.y,this.a0=e*this.a0+o*this.a,this.alpha0=t}Normalize(){const t=6.28318530718*Math.floor(this.a0/6.28318530718);this.a0-=t,this.a-=t}}class I{constructor(t=.5,o=.5,e=.5,i=1){this.r=t,this.g=o,this.b=e,this.a=i}Clone(){return(new I).Copy(this)}Copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}IsEqual(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a}IsZero(){return 0===this.r&&0===this.g&&0===this.b&&0===this.a}Set(t,o,e,i=this.a){this.SetRGBA(t,o,e,i)}SetByteRGB(t,o,e){return this.r=t/255,this.g=o/255,this.b=e/255,this}SetByteRGBA(t,o,e,i){return this.r=t/255,this.g=o/255,this.b=e/255,this.a=i/255,this}SetRGB(t,o,e){return this.r=t,this.g=o,this.b=e,this}SetRGBA(t,o,e,i){return this.r=t,this.g=o,this.b=e,this.a=i,this}SelfAdd(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this}Add(t,o){return o.r=this.r+t.r,o.g=this.g+t.g,o.b=this.b+t.b,o.a=this.a+t.a,o}SelfSub(t){return this.r-=t.r,this.g-=t.g,this.b-=t.b,this.a-=t.a,this}Sub(t,o){return o.r=this.r-t.r,o.g=this.g-t.g,o.b=this.b-t.b,o.a=this.a-t.a,o}SelfMul(t){return this.r*=t,this.g*=t,this.b*=t,this.a*=t,this}Mul(t,o){return o.r=this.r*t,o.g=this.g*t,o.b=this.b*t,o.a=this.a*t,o}Mix(t,o){I.MixColors(this,t,o)}static MixColors(t,o,e){const i=e*(o.r-t.r),s=e*(o.g-t.g),n=e*(o.b-t.b),r=e*(o.a-t.a);t.r+=i,t.g+=s,t.b+=n,t.a+=r,o.r-=i,o.g-=s,o.b-=n,o.a-=r}MakeStyleString(t=this.a){return I.MakeStyleString(this.r,this.g,this.b,t)}static MakeStyleString(t,o,e,i=1){return t*=255,o*=255,e*=255,i<1?`rgba(${t},${o},${e},${i})`:`rgb(${t},${o},${e})`}}var G;I.ZERO=new I(0,0,0,0),I.RED=new I(1,0,0),I.GREEN=new I(0,1,0),I.BLUE=new I(0,0,1),(G=t.b2DrawFlags||(t.b2DrawFlags={}))[G.e_none=0]="e_none",G[G.e_shapeBit=1]="e_shapeBit",G[G.e_jointBit=2]="e_jointBit",G[G.e_aabbBit=4]="e_aabbBit",G[G.e_pairBit=8]="e_pairBit",G[G.e_centerOfMassBit=16]="e_centerOfMassBit",G[G.e_particleBit=32]="e_particleBit",G[G.e_controllerBit=64]="e_controllerBit",G[G.e_all=63]="e_all";class D{constructor(){this.m_start=Date.now()}Reset(){return this.m_start=Date.now(),this}GetMilliseconds(){return Date.now()-this.m_start}}class T{constructor(t){this.m_stack=[],this.m_count=0,this.m_stack=r(t,t=>null),this.m_count=0}Reset(){return this.m_count=0,this}Push(t){this.m_stack[this.m_count]=t,this.m_count++}Pop(){this.m_count--;const t=this.m_stack[this.m_count];if(this.m_stack[this.m_count]=null,null===t)throw new Error;return t}GetCount(){return this.m_count}}class F{constructor(){this.m_buffer=S.MakeArray(2),this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0}Copy(t){return t.m_vertices===t.m_buffer?(this.m_vertices=this.m_buffer,this.m_buffer[0].Copy(t.m_buffer[0]),this.m_buffer[1].Copy(t.m_buffer[1])):this.m_vertices=t.m_vertices,this.m_count=t.m_count,this.m_radius=t.m_radius,this}Reset(){return this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0,this}SetShape(t,o){t.SetupDistanceProxy(this,o)}SetVerticesRadius(t,o,e){this.m_vertices=t,this.m_count=o,this.m_radius=e}GetSupport(t){let o=0,e=S.DotVV(this.m_vertices[0],t);for(let i=1;i<this.m_count;++i){const s=S.DotVV(this.m_vertices[i],t);s>e&&(o=i,e=s)}return o}GetSupportVertex(t){let o=0,e=S.DotVV(this.m_vertices[0],t);for(let i=1;i<this.m_count;++i){const s=S.DotVV(this.m_vertices[i],t);s>e&&(o=i,e=s)}return this.m_vertices[o]}GetVertexCount(){return this.m_count}GetVertex(t){return this.m_vertices[t]}}class L{constructor(){this.metric=0,this.count=0,this.indexA=[0,0,0],this.indexB=[0,0,0]}Reset(){return this.metric=0,this.count=0,this}}class R{constructor(){this.proxyA=new F,this.proxyB=new F,this.transformA=new M,this.transformB=new M,this.useRadii=!1}Reset(){return this.proxyA.Reset(),this.proxyB.Reset(),this.transformA.SetIdentity(),this.transformB.SetIdentity(),this.useRadii=!1,this}}class k{constructor(){this.pointA=new S,this.pointB=new S,this.distance=0,this.iterations=0}Reset(){return this.pointA.SetZero(),this.pointB.SetZero(),this.distance=0,this.iterations=0,this}}t.b2_gjkCalls=0,t.b2_gjkIters=0,t.b2_gjkMaxIters=0;class z{constructor(){this.wA=new S,this.wB=new S,this.w=new S,this.a=0,this.indexA=0,this.indexB=0}Copy(t){return this.wA.Copy(t.wA),this.wB.Copy(t.wB),this.w.Copy(t.w),this.a=t.a,this.indexA=t.indexA,this.indexB=t.indexB,this}}class q{constructor(){this.m_v1=new z,this.m_v2=new z,this.m_v3=new z,this.m_vertices=[],this.m_count=0,this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3}ReadCache(t,o,e,i,s){this.m_count=t.count;const n=this.m_vertices;for(let r=0;r<this.m_count;++r){const a=n[r];a.indexA=t.indexA[r],a.indexB=t.indexB[r];const m=o.GetVertex(a.indexA),p=i.GetVertex(a.indexB);M.MulXV(e,m,a.wA),M.MulXV(s,p,a.wB),S.SubVV(a.wB,a.wA,a.w),a.a=0}if(this.m_count>1){const o=t.metric,e=this.GetMetric();(e<.5*o||2*o<e||e<1e-5)&&(this.m_count=0)}if(0===this.m_count){const t=n[0];t.indexA=0,t.indexB=0;const r=o.GetVertex(0),a=i.GetVertex(0);M.MulXV(e,r,t.wA),M.MulXV(s,a,t.wB),S.SubVV(t.wB,t.wA,t.w),t.a=1,this.m_count=1}}WriteCache(t){t.metric=this.GetMetric(),t.count=this.m_count;const o=this.m_vertices;for(let e=0;e<this.m_count;++e)t.indexA[e]=o[e].indexA,t.indexB[e]=o[e].indexB}GetSearchDirection(t){switch(this.m_count){case 1:return S.NegV(this.m_v1.w,t);case 2:{const o=S.SubVV(this.m_v2.w,this.m_v1.w,t);return S.CrossVV(o,S.NegV(this.m_v1.w,S.s_t0))>0?S.CrossOneV(o,t):S.CrossVOne(o,t)}default:return t.SetZero()}}GetClosestPoint(t){switch(this.m_count){case 0:return t.SetZero();case 1:return t.Copy(this.m_v1.w);case 2:return t.Set(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);case 3:default:return t.SetZero()}}GetWitnessPoints(t,o){switch(this.m_count){case 0:break;case 1:t.Copy(this.m_v1.wA),o.Copy(this.m_v1.wB);break;case 2:t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,o.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,o.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:o.x=t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,o.y=t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y}}GetMetric(){switch(this.m_count){case 0:case 1:return 0;case 2:return S.DistanceVV(this.m_v1.w,this.m_v2.w);case 3:return S.CrossVV(S.SubVV(this.m_v2.w,this.m_v1.w,S.s_t0),S.SubVV(this.m_v3.w,this.m_v1.w,S.s_t1));default:return 0}}Solve2(){const t=this.m_v1.w,o=this.m_v2.w,e=S.SubVV(o,t,q.s_e12),i=-S.DotVV(t,e);if(i<=0)return this.m_v1.a=1,void(this.m_count=1);const s=S.DotVV(o,e);if(s<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);const n=1/(s+i);this.m_v1.a=s*n,this.m_v2.a=i*n,this.m_count=2}Solve3(){const t=this.m_v1.w,o=this.m_v2.w,e=this.m_v3.w,i=S.SubVV(o,t,q.s_e12),s=S.DotVV(t,i),n=S.DotVV(o,i),r=-s,a=S.SubVV(e,t,q.s_e13),m=S.DotVV(t,a),p=S.DotVV(e,a),l=-m,f=S.SubVV(e,o,q.s_e23),h=S.DotVV(o,f),y=S.DotVV(e,f),_=-h,c=S.CrossVV(i,a),C=c*S.CrossVV(o,e),u=c*S.CrossVV(e,t),d=c*S.CrossVV(t,o);if(r<=0&&l<=0)return this.m_v1.a=1,void(this.m_count=1);if(n>0&&r>0&&d<=0){const t=1/(n+r);return this.m_v1.a=n*t,this.m_v2.a=r*t,void(this.m_count=2)}if(p>0&&l>0&&u<=0){const t=1/(p+l);return this.m_v1.a=p*t,this.m_v3.a=l*t,this.m_count=2,void this.m_v2.Copy(this.m_v3)}if(n<=0&&_<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);if(p<=0&&y<=0)return this.m_v3.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v3);if(y>0&&_>0&&C<=0){const t=1/(y+_);return this.m_v2.a=y*t,this.m_v3.a=_*t,this.m_count=2,void this.m_v1.Copy(this.m_v3)}const x=1/(C+u+d);this.m_v1.a=C*x,this.m_v2.a=u*x,this.m_v3.a=d*x,this.m_count=3}}q.s_e12=new S,q.s_e13=new S,q.s_e23=new S;const E=new q,J=[0,0,0],j=[0,0,0],N=new S,O=new S,U=new S,X=new S,W=new S;function Z(o,e,i){++t.b2_gjkCalls;const s=i.proxyA,n=i.proxyB,r=i.transformA,a=i.transformB,m=E;m.ReadCache(e,s,r,n,a);const p=m.m_vertices,f=J,h=j;let y=0,_=0;for(;_<20;){y=m.m_count;for(let t=0;t<y;++t)f[t]=p[t].indexA,h[t]=p[t].indexB;switch(m.m_count){case 1:break;case 2:m.Solve2();break;case 3:m.Solve3()}if(3===m.m_count)break;const o=m.GetSearchDirection(O);if(o.LengthSquared()<1e-5*1e-5)break;const e=p[m.m_count];e.indexA=s.GetSupport(V.MulTRV(r.q,S.NegV(o,S.s_t0),X)),M.MulXV(r,s.GetVertex(e.indexA),e.wA),e.indexB=n.GetSupport(V.MulTRV(a.q,o,W)),M.MulXV(a,n.GetVertex(e.indexB),e.wB),S.SubVV(e.wB,e.wA,e.w),++_,++t.b2_gjkIters;let i=!1;for(let t=0;t<y;++t)if(e.indexA===f[t]&&e.indexB===h[t]){i=!0;break}if(i)break;++m.m_count}if(t.b2_gjkMaxIters=l(t.b2_gjkMaxIters,_),m.GetWitnessPoints(o.pointA,o.pointB),o.distance=S.DistanceVV(o.pointA,o.pointB),o.iterations=_,m.WriteCache(e),i.useRadii){const t=s.m_radius,e=n.m_radius;if(o.distance>t+e&&o.distance>1e-5){o.distance-=t+e;const i=S.SubVV(o.pointB,o.pointA,U);i.Normalize(),o.pointA.SelfMulAdd(t,i),o.pointB.SelfMulSub(e,i)}else{const t=S.MidVV(o.pointA,o.pointB,N);o.pointA.Copy(t),o.pointB.Copy(t),o.distance=0}}}const H=new S,Q=new q,Y=new S,K=new S,$=new S,tt=new S,ot=new S,et=new S;var it,st,nt;(it=t.b2ContactFeatureType||(t.b2ContactFeatureType={}))[it.e_vertex=0]="e_vertex",it[it.e_face=1]="e_face";class rt{constructor(){this._key=0,this._key_invalid=!1,this._indexA=0,this._indexB=0,this._typeA=0,this._typeB=0}get key(){return this._key_invalid&&(this._key_invalid=!1,this._key=this._indexA|this._indexB<<8|this._typeA<<16|this._typeB<<24),this._key}set key(t){this._key=t,this._key_invalid=!1,this._indexA=255&this._key,this._indexB=this._key>>8&255,this._typeA=this._key>>16&255,this._typeB=this._key>>24&255}get indexA(){return this._indexA}set indexA(t){this._indexA=t,this._key_invalid=!0}get indexB(){return this._indexB}set indexB(t){this._indexB=t,this._key_invalid=!0}get typeA(){return this._typeA}set typeA(t){this._typeA=t,this._key_invalid=!0}get typeB(){return this._typeB}set typeB(t){this._typeB=t,this._key_invalid=!0}}class at{constructor(){this.cf=new rt}Copy(t){return this.key=t.key,this}Clone(){return(new at).Copy(this)}get key(){return this.cf.key}set key(t){this.cf.key=t}}class mt{constructor(){this.localPoint=new S,this.normalImpulse=0,this.tangentImpulse=0,this.id=new at}static MakeArray(t){return r(t,t=>new mt)}Reset(){this.localPoint.SetZero(),this.normalImpulse=0,this.tangentImpulse=0,this.id.key=0}Copy(t){return this.localPoint.Copy(t.localPoint),this.normalImpulse=t.normalImpulse,this.tangentImpulse=t.tangentImpulse,this.id.Copy(t.id),this}}(st=t.b2ManifoldType||(t.b2ManifoldType={}))[st.e_unknown=-1]="e_unknown",st[st.e_circles=0]="e_circles",st[st.e_faceA=1]="e_faceA",st[st.e_faceB=2]="e_faceB";class pt{constructor(){this.points=mt.MakeArray(2),this.localNormal=new S,this.localPoint=new S,this.type=t.b2ManifoldType.e_unknown,this.pointCount=0}Reset(){for(let t=0;t<2;++t)this.points[t].Reset();this.localNormal.SetZero(),this.localPoint.SetZero(),this.type=t.b2ManifoldType.e_unknown,this.pointCount=0}Copy(t){this.pointCount=t.pointCount;for(let o=0;o<2;++o)this.points[o].Copy(t.points[o]);return this.localNormal.Copy(t.localNormal),this.localPoint.Copy(t.localPoint),this.type=t.type,this}Clone(){return(new pt).Copy(this)}}class lt{constructor(){this.normal=new S,this.points=S.MakeArray(2),this.separations=a(2)}Initialize(o,e,i,s,n){if(0!==o.pointCount)switch(o.type){case t.b2ManifoldType.e_circles:{this.normal.Set(1,0);const t=M.MulXV(e,o.localPoint,lt.Initialize_s_pointA),r=M.MulXV(s,o.points[0].localPoint,lt.Initialize_s_pointB);S.DistanceSquaredVV(t,r)>1e-5*1e-5&&S.SubVV(r,t,this.normal).SelfNormalize();const a=S.AddVMulSV(t,i,this.normal,lt.Initialize_s_cA),m=S.SubVMulSV(r,n,this.normal,lt.Initialize_s_cB);S.MidVV(a,m,this.points[0]),this.separations[0]=S.DotVV(S.SubVV(m,a,S.s_t0),this.normal);break}case t.b2ManifoldType.e_faceA:{V.MulRV(e.q,o.localNormal,this.normal);const t=M.MulXV(e,o.localPoint,lt.Initialize_s_planePoint);for(let e=0;e<o.pointCount;++e){const r=M.MulXV(s,o.points[e].localPoint,lt.Initialize_s_clipPoint),a=i-S.DotVV(S.SubVV(r,t,S.s_t0),this.normal),m=S.AddVMulSV(r,a,this.normal,lt.Initialize_s_cA),p=S.SubVMulSV(r,n,this.normal,lt.Initialize_s_cB);S.MidVV(m,p,this.points[e]),this.separations[e]=S.DotVV(S.SubVV(p,m,S.s_t0),this.normal)}break}case t.b2ManifoldType.e_faceB:{V.MulRV(s.q,o.localNormal,this.normal);const t=M.MulXV(s,o.localPoint,lt.Initialize_s_planePoint);for(let s=0;s<o.pointCount;++s){const r=M.MulXV(e,o.points[s].localPoint,lt.Initialize_s_clipPoint),a=n-S.DotVV(S.SubVV(r,t,S.s_t0),this.normal),m=S.AddVMulSV(r,a,this.normal,lt.Initialize_s_cB),p=S.SubVMulSV(r,i,this.normal,lt.Initialize_s_cA);S.MidVV(p,m,this.points[s]),this.separations[s]=S.DotVV(S.SubVV(p,m,S.s_t0),this.normal)}this.normal.SelfNeg();break}}}}lt.Initialize_s_pointA=new S,lt.Initialize_s_pointB=new S,lt.Initialize_s_cA=new S,lt.Initialize_s_cB=new S,lt.Initialize_s_planePoint=new S,lt.Initialize_s_clipPoint=new S,(nt=t.b2PointState||(t.b2PointState={}))[nt.b2_nullState=0]="b2_nullState",nt[nt.b2_addState=1]="b2_addState",nt[nt.b2_persistState=2]="b2_persistState",nt[nt.b2_removeState=3]="b2_removeState";class ft{constructor(){this.v=new S,this.id=new at}static MakeArray(t){return r(t,t=>new ft)}Copy(t){return this.v.Copy(t.v),this.id.Copy(t.id),this}}class ht{constructor(){this.p1=new S,this.p2=new S,this.maxFraction=1}Copy(t){return this.p1.Copy(t.p1),this.p2.Copy(t.p2),this.maxFraction=t.maxFraction,this}}class yt{constructor(){this.normal=new S,this.fraction=0}Copy(t){return this.normal.Copy(t.normal),this.fraction=t.fraction,this}}class _t{constructor(){this.lowerBound=new S,this.upperBound=new S,this.m_cache_center=new S,this.m_cache_extent=new S}Copy(t){return this.lowerBound.Copy(t.lowerBound),this.upperBound.Copy(t.upperBound),this}IsValid(){const t=this.upperBound.x-this.lowerBound.x,o=this.upperBound.y-this.lowerBound.y;let e=t>=0&&o>=0;return e=e&&this.lowerBound.IsValid()&&this.upperBound.IsValid(),e}GetCenter(){return S.MidVV(this.lowerBound,this.upperBound,this.m_cache_center)}GetExtents(){return S.ExtVV(this.lowerBound,this.upperBound,this.m_cache_extent)}GetPerimeter(){return 2*(this.upperBound.x-this.lowerBound.x+(this.upperBound.y-this.lowerBound.y))}Combine1(t){return this.lowerBound.x=p(this.lowerBound.x,t.lowerBound.x),this.lowerBound.y=p(this.lowerBound.y,t.lowerBound.y),this.upperBound.x=l(this.upperBound.x,t.upperBound.x),this.upperBound.y=l(this.upperBound.y,t.upperBound.y),this}Combine2(t,o){return this.lowerBound.x=p(t.lowerBound.x,o.lowerBound.x),this.lowerBound.y=p(t.lowerBound.y,o.lowerBound.y),this.upperBound.x=l(t.upperBound.x,o.upperBound.x),this.upperBound.y=l(t.upperBound.y,o.upperBound.y),this}static Combine(t,o,e){return e.Combine2(t,o),e}Contains(t){let o=!0;return o=o&&this.lowerBound.x<=t.lowerBound.x,o=o&&this.lowerBound.y<=t.lowerBound.y,o=o&&t.upperBound.x<=this.upperBound.x,o=o&&t.upperBound.y<=this.upperBound.y,o}RayCast(t,o){let e=-1e37,i=1e37;const s=o.p1.x,n=o.p1.y,r=o.p2.x-o.p1.x,a=o.p2.y-o.p1.y,l=m(r),f=m(a),h=t.normal;if(l<1e-5){if(s<this.lowerBound.x||this.upperBound.x<s)return!1}else{const t=1/r;let o=(this.lowerBound.x-s)*t,n=(this.upperBound.x-s)*t,a=-1;if(o>n){const t=o;o=n,n=t,a=1}if(o>e&&(h.x=a,h.y=0,e=o),i=p(i,n),e>i)return!1}if(f<1e-5){if(n<this.lowerBound.y||this.upperBound.y<n)return!1}else{const t=1/a;let o=(this.lowerBound.y-n)*t,s=(this.upperBound.y-n)*t,r=-1;if(o>s){const t=o;o=s,s=t,r=1}if(o>e&&(h.x=0,h.y=r,e=o),i=p(i,s),e>i)return!1}return!(e<0||o.maxFraction<e||(t.fraction=e,0))}TestContain(t){return!(t.x<this.lowerBound.x||this.upperBound.x<t.x||t.y<this.lowerBound.y||this.upperBound.y<t.y)}TestOverlap(t){const o=t.lowerBound.x-this.upperBound.x,e=t.lowerBound.y-this.upperBound.y,i=this.lowerBound.x-t.upperBound.x,s=this.lowerBound.y-t.upperBound.y;return!(o>0||e>0||i>0||s>0)}}function ct(t,o){const e=o.lowerBound.x-t.upperBound.x,i=o.lowerBound.y-t.upperBound.y,s=t.lowerBound.x-o.upperBound.x,n=t.lowerBound.y-o.upperBound.y;return!(e>0||i>0||s>0||n>0)}function Ct(o,e,i,s,n){let r=0;const a=e[0],m=e[1],p=S.DotVV(i,a.v)-s,l=S.DotVV(i,m.v)-s;if(p<=0&&o[r++].Copy(a),l<=0&&o[r++].Copy(m),p*l<0){const e=p/(p-l),i=o[r].v;i.x=a.v.x+e*(m.v.x-a.v.x),i.y=a.v.y+e*(m.v.y-a.v.y);const s=o[r].id;s.cf.indexA=n,s.cf.indexB=a.id.cf.indexB,s.cf.typeA=t.b2ContactFeatureType.e_vertex,s.cf.typeB=t.b2ContactFeatureType.e_face,++r}return r}const ut=new R,dt=new L,xt=new k;function gt(t,o,e,i,s,n){const r=ut.Reset();r.proxyA.SetShape(t,o),r.proxyB.SetShape(e,i),r.transformA.Copy(s),r.transformB.Copy(n),r.useRadii=!0;const a=dt.Reset();a.count=0;const m=xt.Reset();return Z(m,a,r),m.distance<1e-4}function Bt(t){if(null===t)throw new Error;return t}class St{constructor(t=0){this.m_id=0,this.aabb=new _t,this.parent=null,this.child1=null,this.child2=null,this.height=0,this.m_id=t}IsLeaf(){return null===this.child1}}class bt{constructor(){this.m_root=null,this.m_freeList=null,this.m_path=0,this.m_insertionCount=0,this.m_stack=new T(256)}Query(t,o){if(null===this.m_root)return;const e=this.m_stack.Reset();for(e.Push(this.m_root);e.GetCount()>0;){const i=e.Pop();if(i.aabb.TestOverlap(t))if(i.IsLeaf()){if(!o(i))return}else e.Push(Bt(i.child1)),e.Push(Bt(i.child2))}}QueryPoint(t,o){if(null===this.m_root)return;const e=this.m_stack.Reset();for(e.Push(this.m_root);e.GetCount()>0;){const i=e.Pop();if(i.aabb.TestContain(t))if(i.IsLeaf()){if(!o(i))return}else e.Push(Bt(i.child1)),e.Push(Bt(i.child2))}}RayCast(t,o){if(null===this.m_root)return;const e=t.p1,i=t.p2,s=S.SubVV(i,e,bt.s_r);s.Normalize();const n=S.CrossOneV(s,bt.s_v),r=S.AbsV(n,bt.s_abs_v);let a=t.maxFraction;const f=bt.s_segmentAABB;let h=e.x+a*(i.x-e.x),y=e.y+a*(i.y-e.y);f.lowerBound.x=p(e.x,h),f.lowerBound.y=p(e.y,y),f.upperBound.x=l(e.x,h),f.upperBound.y=l(e.y,y);const _=this.m_stack.Reset();for(_.Push(this.m_root);_.GetCount()>0;){const s=_.Pop();if(!ct(s.aabb,f))continue;const c=s.aabb.GetCenter(),C=s.aabb.GetExtents();if(!(m(S.DotVV(n,S.SubVV(e,c,S.s_t0)))-S.DotVV(r,C)>0))if(s.IsLeaf()){const n=bt.s_subInput;n.p1.Copy(t.p1),n.p2.Copy(t.p2),n.maxFraction=a;const r=o(n,s);if(0===r)return;r>0&&(a=r,h=e.x+a*(i.x-e.x),y=e.y+a*(i.y-e.y),f.lowerBound.x=p(e.x,h),f.lowerBound.y=p(e.y,y),f.upperBound.x=l(e.x,h),f.upperBound.y=l(e.y,y))}else _.Push(Bt(s.child1)),_.Push(Bt(s.child2))}}AllocateNode(){if(this.m_freeList){const t=this.m_freeList;return this.m_freeList=t.parent,t.parent=null,t.child1=null,t.child2=null,t.height=0,delete t.userData,t}return new St(bt.s_node_id++)}FreeNode(t){t.parent=this.m_freeList,t.child1=null,t.child2=null,t.height=-1,delete t.userData,this.m_freeList=t}CreateProxy(t,o){const e=this.AllocateNode();return e.aabb.lowerBound.x=t.lowerBound.x-.1,e.aabb.lowerBound.y=t.lowerBound.y-.1,e.aabb.upperBound.x=t.upperBound.x+.1,e.aabb.upperBound.y=t.upperBound.y+.1,e.userData=o,e.height=0,this.InsertLeaf(e),e}DestroyProxy(t){this.RemoveLeaf(t),this.FreeNode(t)}MoveProxy(t,o,e){if(t.aabb.Contains(o))return!1;this.RemoveLeaf(t);const i=.1+2*(e.x>0?e.x:-e.x),s=.1+2*(e.y>0?e.y:-e.y);return t.aabb.lowerBound.x=o.lowerBound.x-i,t.aabb.lowerBound.y=o.lowerBound.y-s,t.aabb.upperBound.x=o.upperBound.x+i,t.aabb.upperBound.y=o.upperBound.y+s,this.InsertLeaf(t),!0}InsertLeaf(t){if(++this.m_insertionCount,null===this.m_root)return this.m_root=t,void(this.m_root.parent=null);const o=t.aabb;let e=this.m_root;for(;!e.IsLeaf();){const t=Bt(e.child1),i=Bt(e.child2),s=e.aabb.GetPerimeter(),n=bt.s_combinedAABB;n.Combine2(e.aabb,o);const r=n.GetPerimeter(),a=2*r,m=2*(r-s);let p;const l=bt.s_aabb;let f,h,y;if(t.IsLeaf()?(l.Combine2(o,t.aabb),p=l.GetPerimeter()+m):(l.Combine2(o,t.aabb),f=t.aabb.GetPerimeter(),h=l.GetPerimeter(),p=h-f+m),i.IsLeaf()?(l.Combine2(o,i.aabb),y=l.GetPerimeter()+m):(l.Combine2(o,i.aabb),f=i.aabb.GetPerimeter(),h=l.GetPerimeter(),y=h-f+m),a<p&&a<y)break;e=p<y?t:i}const i=e,s=i.parent,n=this.AllocateNode();n.parent=s,delete n.userData,n.aabb.Combine2(o,i.aabb),n.height=i.height+1,s?(s.child1===i?s.child1=n:s.child2=n,n.child1=i,n.child2=t,i.parent=n,t.parent=n):(n.child1=i,n.child2=t,i.parent=n,t.parent=n,this.m_root=n);let r=t.parent;for(;null!==r;){r=this.Balance(r);const t=Bt(r.child1),o=Bt(r.child2);r.height=1+l(t.height,o.height),r.aabb.Combine2(t.aabb,o.aabb),r=r.parent}}RemoveLeaf(t){if(t===this.m_root)return void(this.m_root=null);const o=Bt(t.parent),e=o&&o.parent;let i;if(i=o.child1===t?Bt(o.child2):Bt(o.child1),e){e.child1===o?e.child1=i:e.child2=i,i.parent=e,this.FreeNode(o);let t=e;for(;t;){t=this.Balance(t);const o=Bt(t.child1),e=Bt(t.child2);t.aabb.Combine2(o.aabb,e.aabb),t.height=1+l(o.height,e.height),t=t.parent}}else this.m_root=i,i.parent=null,this.FreeNode(o)}Balance(t){if(t.IsLeaf()||t.height<2)return t;const o=Bt(t.child1),e=Bt(t.child2),i=e.height-o.height;if(i>1){const i=Bt(e.child1),s=Bt(e.child2);return e.child1=t,e.parent=t.parent,t.parent=e,null!==e.parent?e.parent.child1===t?e.parent.child1=e:e.parent.child2=e:this.m_root=e,i.height>s.height?(e.child2=i,t.child2=s,s.parent=t,t.aabb.Combine2(o.aabb,s.aabb),e.aabb.Combine2(t.aabb,i.aabb),t.height=1+l(o.height,s.height),e.height=1+l(t.height,i.height)):(e.child2=s,t.child2=i,i.parent=t,t.aabb.Combine2(o.aabb,i.aabb),e.aabb.Combine2(t.aabb,s.aabb),t.height=1+l(o.height,i.height),e.height=1+l(t.height,s.height)),e}if(i<-1){const i=Bt(o.child1),s=Bt(o.child2);return o.child1=t,o.parent=t.parent,t.parent=o,null!==o.parent?o.parent.child1===t?o.parent.child1=o:o.parent.child2=o:this.m_root=o,i.height>s.height?(o.child2=i,t.child1=s,s.parent=t,t.aabb.Combine2(e.aabb,s.aabb),o.aabb.Combine2(t.aabb,i.aabb),t.height=1+l(e.height,s.height),o.height=1+l(t.height,i.height)):(o.child2=s,t.child1=i,i.parent=t,t.aabb.Combine2(e.aabb,i.aabb),o.aabb.Combine2(t.aabb,s.aabb),t.height=1+l(e.height,i.height),o.height=1+l(t.height,s.height)),o}return t}GetHeight(){return null===this.m_root?0:this.m_root.height}static GetAreaNode(t){if(null===t)return 0;if(t.IsLeaf())return 0;let o=t.aabb.GetPerimeter();return o+=bt.GetAreaNode(t.child1),o+=bt.GetAreaNode(t.child2),o}GetAreaRatio(){if(null===this.m_root)return 0;const t=this.m_root.aabb.GetPerimeter();return bt.GetAreaNode(this.m_root)/t}ComputeHeightNode(t){if(!t||t.IsLeaf())return 0;const o=this.ComputeHeightNode(t.child1),e=this.ComputeHeightNode(t.child2);return 1+l(o,e)}ComputeHeight(){return this.ComputeHeightNode(this.m_root)}ValidateStructure(t){if(null===t)return;this.m_root;const o=t;if(o.IsLeaf())return;const e=Bt(o.child1),i=Bt(o.child2);this.ValidateStructure(e),this.ValidateStructure(i)}ValidateMetrics(t){if(null===t)return;const o=t;if(o.IsLeaf())return;const e=Bt(o.child1),i=Bt(o.child2);bt.s_aabb.Combine2(e.aabb,i.aabb),this.ValidateMetrics(e),this.ValidateMetrics(i)}Validate(){}static GetMaxBalanceNode(t,o){if(null===t)return o;if(t.height<=1)return o;const e=Bt(t.child1),i=Bt(t.child2),s=m(i.height-e.height);return l(o,s)}GetMaxBalance(){return bt.GetMaxBalanceNode(this.m_root,0)}RebuildBottomUp(){this.Validate()}static ShiftOriginNode(t,o){if(null===t)return;if(t.height<=1)return;const e=t.child1,i=t.child2;bt.ShiftOriginNode(e,o),bt.ShiftOriginNode(i,o),t.aabb.lowerBound.SelfSub(o),t.aabb.upperBound.SelfSub(o)}ShiftOrigin(t){bt.ShiftOriginNode(this.m_root,t)}}bt.s_r=new S,bt.s_v=new S,bt.s_abs_v=new S,bt.s_segmentAABB=new _t,bt.s_subInput=new ht,bt.s_combinedAABB=new _t,bt.s_aabb=new _t,bt.s_node_id=0;class At{constructor(t,o){this.proxyA=t,this.proxyB=o}}class vt{constructor(){this.m_tree=new bt,this.m_proxyCount=0,this.m_moveCount=0,this.m_moveBuffer=[],this.m_pairCount=0,this.m_pairBuffer=[]}CreateProxy(t,o){const e=this.m_tree.CreateProxy(t,o);return++this.m_proxyCount,this.BufferMove(e),e}DestroyProxy(t){this.UnBufferMove(t),--this.m_proxyCount,this.m_tree.DestroyProxy(t)}MoveProxy(t,o,e){this.m_tree.MoveProxy(t,o,e)&&this.BufferMove(t)}TouchProxy(t){this.BufferMove(t)}GetProxyCount(){return this.m_proxyCount}UpdatePairs(t){this.m_pairCount=0;for(let t=0;t<this.m_moveCount;++t){const o=this.m_moveBuffer[t];if(null===o)continue;const e=o.aabb;this.m_tree.Query(e,t=>{if(t.m_id===o.m_id)return!0;let e,i;if(t.m_id<o.m_id?(e=t,i=o):(e=o,i=t),this.m_pairCount===this.m_pairBuffer.length)this.m_pairBuffer[this.m_pairCount]=new At(e,i);else{const t=this.m_pairBuffer[this.m_pairCount];t.proxyA=e,t.proxyB=i}return++this.m_pairCount,!0})}this.m_moveCount=0,this.m_pairBuffer.length=this.m_pairCount,this.m_pairBuffer.sort(wt);let o=0;for(;o<this.m_pairCount;){const e=this.m_pairBuffer[o];for(t(e.proxyA.userData,e.proxyB.userData),++o;o<this.m_pairCount;){const t=this.m_pairBuffer[o];if(t.proxyA.m_id!==e.proxyA.m_id||t.proxyB.m_id!==e.proxyB.m_id)break;++o}}}Query(t,o){this.m_tree.Query(t,o)}QueryPoint(t,o){this.m_tree.QueryPoint(t,o)}RayCast(t,o){this.m_tree.RayCast(t,o)}GetTreeHeight(){return this.m_tree.GetHeight()}GetTreeBalance(){return this.m_tree.GetMaxBalance()}GetTreeQuality(){return this.m_tree.GetAreaRatio()}ShiftOrigin(t){this.m_tree.ShiftOrigin(t)}BufferMove(t){this.m_moveBuffer[this.m_moveCount]=t,++this.m_moveCount}UnBufferMove(t){const o=this.m_moveBuffer.indexOf(t);this.m_moveBuffer[o]=null}}function wt(t,o){return t.proxyA.m_id===o.proxyA.m_id?t.proxyB.m_id-o.proxyB.m_id:t.proxyA.m_id-o.proxyA.m_id}t.b2_toiTime=0,t.b2_toiMaxTime=0,t.b2_toiCalls=0,t.b2_toiIters=0,t.b2_toiMaxIters=0,t.b2_toiRootIters=0,t.b2_toiMaxRootIters=0;const Vt=new M,Mt=new M,Pt=new S,It=new S,Gt=new S,Dt=new S,Tt=new S;class Ft{constructor(){this.proxyA=new F,this.proxyB=new F,this.sweepA=new P,this.sweepB=new P,this.tMax=0}}var Lt,Rt;(Lt=t.b2TOIOutputState||(t.b2TOIOutputState={}))[Lt.e_unknown=0]="e_unknown",Lt[Lt.e_failed=1]="e_failed",Lt[Lt.e_overlapped=2]="e_overlapped",Lt[Lt.e_touching=3]="e_touching",Lt[Lt.e_separated=4]="e_separated";class kt{constructor(){this.state=t.b2TOIOutputState.e_unknown,this.t=0}}(Rt=t.b2SeparationFunctionType||(t.b2SeparationFunctionType={}))[Rt.e_unknown=-1]="e_unknown",Rt[Rt.e_points=0]="e_points",Rt[Rt.e_faceA=1]="e_faceA",Rt[Rt.e_faceB=2]="e_faceB";class zt{constructor(){this.m_sweepA=new P,this.m_sweepB=new P,this.m_type=t.b2SeparationFunctionType.e_unknown,this.m_localPoint=new S,this.m_axis=new S}Initialize(o,e,i,s,n,r){this.m_proxyA=e,this.m_proxyB=s;const a=o.count;this.m_sweepA.Copy(i),this.m_sweepB.Copy(n);const m=Vt,p=Mt;if(this.m_sweepA.GetTransform(m,r),this.m_sweepB.GetTransform(p,r),1===a){this.m_type=t.b2SeparationFunctionType.e_points;const e=this.m_proxyA.GetVertex(o.indexA[0]),i=this.m_proxyB.GetVertex(o.indexB[0]),s=M.MulXV(m,e,Pt),n=M.MulXV(p,i,It);S.SubVV(n,s,this.m_axis);const r=this.m_axis.Normalize();return this.m_localPoint.SetZero(),r}if(o.indexA[0]===o.indexA[1]){this.m_type=t.b2SeparationFunctionType.e_faceB;const e=this.m_proxyB.GetVertex(o.indexB[0]),i=this.m_proxyB.GetVertex(o.indexB[1]);S.CrossVOne(S.SubVV(i,e,S.s_t0),this.m_axis).SelfNormalize();const s=V.MulRV(p.q,this.m_axis,Gt);S.MidVV(e,i,this.m_localPoint);const n=M.MulXV(p,this.m_localPoint,It),r=this.m_proxyA.GetVertex(o.indexA[0]),a=M.MulXV(m,r,Pt);let l=S.DotVV(S.SubVV(a,n,S.s_t0),s);return l<0&&(this.m_axis.SelfNeg(),l=-l),l}{this.m_type=t.b2SeparationFunctionType.e_faceA;const e=this.m_proxyA.GetVertex(o.indexA[0]),i=this.m_proxyA.GetVertex(o.indexA[1]);S.CrossVOne(S.SubVV(i,e,S.s_t0),this.m_axis).SelfNormalize();const s=V.MulRV(m.q,this.m_axis,Gt);S.MidVV(e,i,this.m_localPoint);const n=M.MulXV(m,this.m_localPoint,Pt),r=this.m_proxyB.GetVertex(o.indexB[0]),a=M.MulXV(p,r,It);let l=S.DotVV(S.SubVV(a,n,S.s_t0),s);return l<0&&(this.m_axis.SelfNeg(),l=-l),l}}FindMinSeparation(o,e,i){const s=Vt,n=Mt;switch(this.m_sweepA.GetTransform(s,i),this.m_sweepB.GetTransform(n,i),this.m_type){case t.b2SeparationFunctionType.e_points:{const t=V.MulTRV(s.q,this.m_axis,Dt),i=V.MulTRV(n.q,S.NegV(this.m_axis,S.s_t0),Tt);o[0]=this.m_proxyA.GetSupport(t),e[0]=this.m_proxyB.GetSupport(i);const r=this.m_proxyA.GetVertex(o[0]),a=this.m_proxyB.GetVertex(e[0]),m=M.MulXV(s,r,Pt),p=M.MulXV(n,a,It);return S.DotVV(S.SubVV(p,m,S.s_t0),this.m_axis)}case t.b2SeparationFunctionType.e_faceA:{const t=V.MulRV(s.q,this.m_axis,Gt),i=M.MulXV(s,this.m_localPoint,Pt),r=V.MulTRV(n.q,S.NegV(t,S.s_t0),Tt);o[0]=-1,e[0]=this.m_proxyB.GetSupport(r);const a=this.m_proxyB.GetVertex(e[0]),m=M.MulXV(n,a,It);return S.DotVV(S.SubVV(m,i,S.s_t0),t)}case t.b2SeparationFunctionType.e_faceB:{const t=V.MulRV(n.q,this.m_axis,Gt),i=M.MulXV(n,this.m_localPoint,It),r=V.MulTRV(s.q,S.NegV(t,S.s_t0),Dt);e[0]=-1,o[0]=this.m_proxyA.GetSupport(r);const a=this.m_proxyA.GetVertex(o[0]),m=M.MulXV(s,a,Pt);return S.DotVV(S.SubVV(m,i,S.s_t0),t)}default:return o[0]=-1,e[0]=-1,0}}Evaluate(o,e,i){const s=Vt,n=Mt;switch(this.m_sweepA.GetTransform(s,i),this.m_sweepB.GetTransform(n,i),this.m_type){case t.b2SeparationFunctionType.e_points:{const t=this.m_proxyA.GetVertex(o),i=this.m_proxyB.GetVertex(e),r=M.MulXV(s,t,Pt),a=M.MulXV(n,i,It);return S.DotVV(S.SubVV(a,r,S.s_t0),this.m_axis)}case t.b2SeparationFunctionType.e_faceA:{const t=V.MulRV(s.q,this.m_axis,Gt),o=M.MulXV(s,this.m_localPoint,Pt),i=this.m_proxyB.GetVertex(e),r=M.MulXV(n,i,It);return S.DotVV(S.SubVV(r,o,S.s_t0),t)}case t.b2SeparationFunctionType.e_faceB:{const t=V.MulRV(n.q,this.m_axis,Gt),e=M.MulXV(n,this.m_localPoint,It),i=this.m_proxyA.GetVertex(o),r=M.MulXV(s,i,Pt);return S.DotVV(S.SubVV(r,e,S.s_t0),t)}default:return 0}}}const qt=new D,Et=new L,Jt=new R,jt=new k,Nt=new zt,Ot=[0],Ut=[0],Xt=new P,Wt=new P;function Zt(o,e){const i=qt.Reset();++t.b2_toiCalls,o.state=t.b2TOIOutputState.e_unknown,o.t=e.tMax;const s=e.proxyA,n=e.proxyB,r=l(8,s.m_count,n.m_count),a=Xt.Copy(e.sweepA),p=Wt.Copy(e.sweepB);a.Normalize(),p.Normalize();const f=e.tMax,h=s.m_radius+n.m_radius,y=l(.008,h-.024);let _=0,c=0;const C=Et;C.count=0;const u=Jt;for(u.proxyA.Copy(e.proxyA),u.proxyB.Copy(e.proxyB),u.useRadii=!1;;){const e=Vt,i=Mt;a.GetTransform(e,_),p.GetTransform(i,_),u.transformA.Copy(e),u.transformB.Copy(i);const h=jt;if(Z(h,C,u),h.distance<=0){o.state=t.b2TOIOutputState.e_overlapped,o.t=0;break}if(h.distance<y+.002){o.state=t.b2TOIOutputState.e_touching,o.t=_;break}const d=Nt;d.Initialize(C,s,a,n,p,_);let x=!1,g=f,B=0;for(;;){const e=Ot,i=Ut;let s=d.FindMinSeparation(e,i,g);if(s>y+.002){o.state=t.b2TOIOutputState.e_separated,o.t=f,x=!0;break}if(s>y-.002){_=g;break}let n=d.Evaluate(e[0],i[0],_);if(n<y-.002){o.state=t.b2TOIOutputState.e_failed,o.t=_,x=!0;break}if(n<=y+.002){o.state=t.b2TOIOutputState.e_touching,o.t=_,x=!0;break}let a=0,p=_,h=g;for(;;){let o=0;o=1&a?p+(y-n)*(h-p)/(s-n):.5*(p+h),++a,++t.b2_toiRootIters;const r=d.Evaluate(e[0],i[0],o);if(m(r-y)<.002){g=o;break}if(r>y?(p=o,n=r):(h=o,s=r),50===a)break}if(t.b2_toiMaxRootIters=l(t.b2_toiMaxRootIters,a),++B,B===r)break}if(++c,++t.b2_toiIters,x)break;if(20===c){o.state=t.b2TOIOutputState.e_failed,o.t=_;break}}t.b2_toiMaxIters=l(t.b2_toiMaxIters,c);const d=i.GetMilliseconds();t.b2_toiMaxTime=l(t.b2_toiMaxTime,d),t.b2_toiTime+=d}const Ht=new S,Qt=new S;function Yt(o,e,i,s,n){o.pointCount=0;const r=M.MulXV(i,e.m_p,Ht),a=M.MulXV(n,s.m_p,Qt),m=S.DistanceSquaredVV(r,a),p=e.m_radius+s.m_radius;m>p*p||(o.type=t.b2ManifoldType.e_circles,o.localPoint.Copy(e.m_p),o.localNormal.SetZero(),o.pointCount=1,o.points[0].localPoint.Copy(s.m_p),o.points[0].id.key=0)}const Kt=new S,$t=new S,to=new S;function oo(o,e,i,s,n){o.pointCount=0;const r=M.MulXV(n,s.m_p,Kt),a=M.MulTXV(i,r,$t);let m=0,p=-1e37;const l=e.m_radius+s.m_radius,f=e.m_count,h=e.m_vertices,y=e.m_normals;for(let t=0;t<f;++t){const o=S.DotVV(y[t],S.SubVV(a,h[t],S.s_t0));if(o>l)return;o>p&&(p=o,m=t)}const _=m,c=(_+1)%f,C=h[_],u=h[c];if(p<1e-5)return o.pointCount=1,o.type=t.b2ManifoldType.e_faceA,o.localNormal.Copy(y[m]),S.MidVV(C,u,o.localPoint),o.points[0].localPoint.Copy(s.m_p),void(o.points[0].id.key=0);const d=S.DotVV(S.SubVV(a,C,S.s_t0),S.SubVV(u,C,S.s_t1)),x=S.DotVV(S.SubVV(a,u,S.s_t0),S.SubVV(C,u,S.s_t1));if(d<=0){if(S.DistanceSquaredVV(a,C)>l*l)return;o.pointCount=1,o.type=t.b2ManifoldType.e_faceA,S.SubVV(a,C,o.localNormal).SelfNormalize(),o.localPoint.Copy(C),o.points[0].localPoint.Copy(s.m_p),o.points[0].id.key=0}else if(x<=0){if(S.DistanceSquaredVV(a,u)>l*l)return;o.pointCount=1,o.type=t.b2ManifoldType.e_faceA,S.SubVV(a,u,o.localNormal).SelfNormalize(),o.localPoint.Copy(u),o.points[0].localPoint.Copy(s.m_p),o.points[0].id.key=0}else{const e=S.MidVV(C,u,to);if(S.DotVV(S.SubVV(a,e,S.s_t1),y[_])>l)return;o.pointCount=1,o.type=t.b2ManifoldType.e_faceA,o.localNormal.Copy(y[_]).SelfNormalize(),o.localPoint.Copy(e),o.points[0].localPoint.Copy(s.m_p),o.points[0].id.key=0}}const eo=new S,io=new S,so=new S,no=new S;function ro(t,o,e,i,s){const n=t.m_vertices,r=t.m_normals,a=i.m_count,m=i.m_vertices,p=V.MulRV(o.q,r[e],eo),l=V.MulTRV(s.q,p,io);let f=0,h=1e37;for(let t=0;t<a;++t){const o=S.DotVV(m[t],l);o<h&&(h=o,f=t)}const y=M.MulXV(o,n[e],so),_=M.MulXV(s,m[f],no);return S.DotVV(S.SubVV(_,y,S.s_t0),p)}const ao=new S,mo=new S;function po(t,o,e,i,s){const n=o.m_count,r=o.m_normals,a=S.SubVV(M.MulXV(s,i.m_centroid,S.s_t0),M.MulXV(e,o.m_centroid,S.s_t1),ao),m=V.MulTRV(e.q,a,mo);let p=0,l=-1e37;for(let t=0;t<n;++t){const o=S.DotVV(r[t],m);o>l&&(l=o,p=t)}let f=ro(o,e,p,i,s);const h=(p+n-1)%n,y=ro(o,e,h,i,s),_=(p+1)%n,c=ro(o,e,_,i,s);let C=0,u=0,d=0;if(y>f&&y>c)d=-1,C=h,u=y;else{if(!(c>f))return t[0]=p,f;d=1,C=_,u=c}for(;p=-1===d?(C+n-1)%n:(C+1)%n,f=ro(o,e,p,i,s),f>u;)C=p,u=f;return t[0]=C,u}const lo=new S,fo=ft.MakeArray(2),ho=ft.MakeArray(2),yo=ft.MakeArray(2),_o=[0],co=[0],Co=new S,uo=new S,xo=new S,go=new S,Bo=new S,So=new S,bo=new S,Ao=new S;function vo(o,e,i,s,n){o.pointCount=0;const r=e.m_radius+s.m_radius,a=_o;a[0]=0;const m=po(a,e,i,s,n);if(m>r)return;const p=co;p[0]=0;const l=po(p,s,n,e,i);if(l>r)return;let f,h,y,_,c=0,C=0;l>.98*m+.001?(f=s,h=e,y=n,_=i,c=p[0],o.type=t.b2ManifoldType.e_faceB,C=1):(f=e,h=s,y=i,_=n,c=a[0],o.type=t.b2ManifoldType.e_faceA,C=0);const u=fo;!function(o,e,i,s,n,r){const a=e.m_normals,m=n.m_count,p=n.m_vertices,l=n.m_normals,f=V.MulTRV(r.q,V.MulRV(i.q,a[s],S.s_t0),lo);let h=0,y=1e37;for(let t=0;t<m;++t){const o=S.DotVV(f,l[t]);o<y&&(y=o,h=t)}const _=h,c=(_+1)%m,C=o[0];M.MulXV(r,p[_],C.v);const u=C.id.cf;u.indexA=s,u.indexB=_,u.typeA=t.b2ContactFeatureType.e_face,u.typeB=t.b2ContactFeatureType.e_vertex;const d=o[1];M.MulXV(r,p[c],d.v);const x=d.id.cf;x.indexA=s,x.indexB=c,x.typeA=t.b2ContactFeatureType.e_face,x.typeB=t.b2ContactFeatureType.e_vertex}(u,f,y,c,h,_);const d=f.m_count,x=f.m_vertices,g=c,B=(c+1)%d,b=x[g],A=x[B],v=S.SubVV(A,b,Co);v.Normalize();const w=S.CrossVOne(v,uo),P=S.MidVV(b,A,xo),I=V.MulRV(y.q,v,Bo),G=S.CrossVOne(I,go),D=M.MulXV(y,b,bo),T=M.MulXV(y,A,Ao),F=S.DotVV(G,D),L=-S.DotVV(I,D)+r,R=S.DotVV(I,T)+r,k=ho,z=yo;let q;if(q=Ct(k,u,S.NegV(I,So),L,g),q<2)return;if(q=Ct(z,k,I,R,B),q<2)return;o.localNormal.Copy(w),o.localPoint.Copy(P);let E=0;for(let t=0;t<2;++t){const e=z[t];if(S.DotVV(G,e.v)-F<=r){const t=o.points[E];if(M.MulTXV(_,e.v,t.localPoint),t.id.Copy(e.id),C){const o=t.id.cf;t.id.cf.indexA=o.indexB,t.id.cf.indexB=o.indexA,t.id.cf.typeA=o.typeB,t.id.cf.typeB=o.typeA}++E}}o.pointCount=E}const wo=new S,Vo=new S,Mo=new S,Po=new S,Io=new S,Go=new S,Do=new S,To=new at;function Fo(o,e,i,s,n){o.pointCount=0;const r=M.MulTXV(i,M.MulXV(n,s.m_p,S.s_t0),wo),a=e.m_vertex1,m=e.m_vertex2,p=S.SubVV(m,a,Vo),l=S.DotVV(p,S.SubVV(m,r,S.s_t0)),f=S.DotVV(p,S.SubVV(r,a,S.s_t0)),h=e.m_radius+s.m_radius,y=To;if(y.cf.indexB=0,y.cf.typeB=t.b2ContactFeatureType.e_vertex,f<=0){const i=a,n=S.SubVV(r,i,Mo);if(S.DotVV(n,n)>h*h)return;if(e.m_hasVertex0){const t=e.m_vertex0,o=a,i=S.SubVV(o,t,Po);if(S.DotVV(i,S.SubVV(o,r,S.s_t0))>0)return}return y.cf.indexA=0,y.cf.typeA=t.b2ContactFeatureType.e_vertex,o.pointCount=1,o.type=t.b2ManifoldType.e_circles,o.localNormal.SetZero(),o.localPoint.Copy(i),o.points[0].id.Copy(y),void o.points[0].localPoint.Copy(s.m_p)}if(l<=0){const i=m,n=S.SubVV(r,i,Mo);if(S.DotVV(n,n)>h*h)return;if(e.m_hasVertex3){const t=e.m_vertex3,o=m,i=S.SubVV(t,o,Io);if(S.DotVV(i,S.SubVV(r,o,S.s_t0))>0)return}return y.cf.indexA=1,y.cf.typeA=t.b2ContactFeatureType.e_vertex,o.pointCount=1,o.type=t.b2ManifoldType.e_circles,o.localNormal.SetZero(),o.localPoint.Copy(i),o.points[0].id.Copy(y),void o.points[0].localPoint.Copy(s.m_p)}const _=S.DotVV(p,p),c=Go;c.x=1/_*(l*a.x+f*m.x),c.y=1/_*(l*a.y+f*m.y);const C=S.SubVV(r,c,Mo);if(S.DotVV(C,C)>h*h)return;const u=Do.Set(-p.y,p.x);S.DotVV(u,S.SubVV(r,a,S.s_t0))<0&&u.Set(-u.x,-u.y),u.Normalize(),y.cf.indexA=0,y.cf.typeA=t.b2ContactFeatureType.e_face,o.pointCount=1,o.type=t.b2ManifoldType.e_faceA,o.localNormal.Copy(u),o.localPoint.Copy(a),o.points[0].id.Copy(y),o.points[0].localPoint.Copy(s.m_p)}class Lo{constructor(){this.type=0,this.index=0,this.separation=0}}class Ro{constructor(){this.vertices=[],this.normals=[],this.count=0}}class ko{constructor(){this.m_polygonB=new Ro,this.m_xf=new M,this.m_centroidB=new S,this.m_v0=new S,this.m_v1=new S,this.m_v2=new S,this.m_v3=new S,this.m_normal0=new S,this.m_normal1=new S,this.m_normal2=new S,this.m_normal=new S,this.m_type1=0,this.m_type2=0,this.m_lowerLimit=new S,this.m_upperLimit=new S,this.m_radius=0,this.m_front=!1}Collide(o,e,i,s,n){M.MulTXX(i,n,this.m_xf),M.MulXV(this.m_xf,s.m_centroid,this.m_centroidB),this.m_v0.Copy(e.m_vertex0),this.m_v1.Copy(e.m_vertex1),this.m_v2.Copy(e.m_vertex2),this.m_v3.Copy(e.m_vertex3);const r=e.m_hasVertex0,a=e.m_hasVertex3,m=S.SubVV(this.m_v2,this.m_v1,ko.s_edge1);m.Normalize(),this.m_normal1.Set(m.y,-m.x);const p=S.DotVV(this.m_normal1,S.SubVV(this.m_centroidB,this.m_v1,S.s_t0));let l=0,f=0,h=!1,y=!1;if(r){const t=S.SubVV(this.m_v1,this.m_v0,ko.s_edge0);t.Normalize(),this.m_normal0.Set(t.y,-t.x),h=S.CrossVV(t,m)>=0,l=S.DotVV(this.m_normal0,S.SubVV(this.m_centroidB,this.m_v0,S.s_t0))}if(a){const t=S.SubVV(this.m_v3,this.m_v2,ko.s_edge2);t.Normalize(),this.m_normal2.Set(t.y,-t.x),y=S.CrossVV(m,t)>0,f=S.DotVV(this.m_normal2,S.SubVV(this.m_centroidB,this.m_v2,S.s_t0))}r&&a?h&&y?(this.m_front=l>=0||p>=0||f>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):h?(this.m_front=l>=0||p>=0&&f>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):y?(this.m_front=f>=0||l>=0&&p>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):(this.m_front=l>=0&&p>=0&&f>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):r?h?(this.m_front=l>=0||p>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):(this.m_front=l>=0&&p>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):a?y?(this.m_front=p>=0||f>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1))):(this.m_front=p>=0&&f>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1))):(this.m_front=p>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1))),this.m_polygonB.count=s.m_count;for(let t=0;t<s.m_count;++t)this.m_polygonB.vertices.length<=t&&this.m_polygonB.vertices.push(new S),this.m_polygonB.normals.length<=t&&this.m_polygonB.normals.push(new S),M.MulXV(this.m_xf,s.m_vertices[t],this.m_polygonB.vertices[t]),V.MulRV(this.m_xf.q,s.m_normals[t],this.m_polygonB.normals[t]);this.m_radius=s.m_radius+e.m_radius,o.pointCount=0;const _=this.ComputeEdgeSeparation(ko.s_edgeAxis);if(0===_.type)return;if(_.separation>this.m_radius)return;const c=this.ComputePolygonSeparation(ko.s_polygonAxis);if(0!==c.type&&c.separation>this.m_radius)return;let C;C=0===c.type?_:c.separation>.98*_.separation+.001?c:_;const u=ko.s_ie,d=ko.s_rf;if(1===C.type){o.type=t.b2ManifoldType.e_faceA;let e=0,i=S.DotVV(this.m_normal,this.m_polygonB.normals[0]);for(let t=1;t<this.m_polygonB.count;++t){const o=S.DotVV(this.m_normal,this.m_polygonB.normals[t]);o<i&&(i=o,e=t)}const s=e,n=(s+1)%this.m_polygonB.count,r=u[0];r.v.Copy(this.m_polygonB.vertices[s]),r.id.cf.indexA=0,r.id.cf.indexB=s,r.id.cf.typeA=t.b2ContactFeatureType.e_face,r.id.cf.typeB=t.b2ContactFeatureType.e_vertex;const a=u[1];a.v.Copy(this.m_polygonB.vertices[n]),a.id.cf.indexA=0,a.id.cf.indexB=n,a.id.cf.typeA=t.b2ContactFeatureType.e_face,a.id.cf.typeB=t.b2ContactFeatureType.e_vertex,this.m_front?(d.i1=0,d.i2=1,d.v1.Copy(this.m_v1),d.v2.Copy(this.m_v2),d.normal.Copy(this.m_normal1)):(d.i1=1,d.i2=0,d.v1.Copy(this.m_v2),d.v2.Copy(this.m_v1),d.normal.Copy(this.m_normal1).SelfNeg())}else{o.type=t.b2ManifoldType.e_faceB;const e=u[0];e.v.Copy(this.m_v1),e.id.cf.indexA=0,e.id.cf.indexB=C.index,e.id.cf.typeA=t.b2ContactFeatureType.e_vertex,e.id.cf.typeB=t.b2ContactFeatureType.e_face;const i=u[1];i.v.Copy(this.m_v2),i.id.cf.indexA=0,i.id.cf.indexB=C.index,i.id.cf.typeA=t.b2ContactFeatureType.e_vertex,i.id.cf.typeB=t.b2ContactFeatureType.e_face,d.i1=C.index,d.i2=(d.i1+1)%this.m_polygonB.count,d.v1.Copy(this.m_polygonB.vertices[d.i1]),d.v2.Copy(this.m_polygonB.vertices[d.i2]),d.normal.Copy(this.m_polygonB.normals[d.i1])}d.sideNormal1.Set(d.normal.y,-d.normal.x),d.sideNormal2.Copy(d.sideNormal1).SelfNeg(),d.sideOffset1=S.DotVV(d.sideNormal1,d.v1),d.sideOffset2=S.DotVV(d.sideNormal2,d.v2);const x=ko.s_clipPoints1,g=ko.s_clipPoints2;let B=0;if(B=Ct(x,u,d.sideNormal1,d.sideOffset1,d.i1),B<2)return;if(B=Ct(g,x,d.sideNormal2,d.sideOffset2,d.i2),B<2)return;1===C.type?(o.localNormal.Copy(d.normal),o.localPoint.Copy(d.v1)):(o.localNormal.Copy(s.m_normals[d.i1]),o.localPoint.Copy(s.m_vertices[d.i1]));let b=0;for(let t=0;t<2;++t){let e;if(e=S.DotVV(d.normal,S.SubVV(g[t].v,d.v1,S.s_t0)),e<=this.m_radius){const e=o.points[b];1===C.type?(M.MulTXV(this.m_xf,g[t].v,e.localPoint),e.id=g[t].id):(e.localPoint.Copy(g[t].v),e.id.cf.typeA=g[t].id.cf.typeB,e.id.cf.typeB=g[t].id.cf.typeA,e.id.cf.indexA=g[t].id.cf.indexB,e.id.cf.indexB=g[t].id.cf.indexA),++b}}o.pointCount=b}ComputeEdgeSeparation(t){const o=t;o.type=1,o.index=this.m_front?0:1,o.separation=1e37;for(let t=0;t<this.m_polygonB.count;++t){const e=S.DotVV(this.m_normal,S.SubVV(this.m_polygonB.vertices[t],this.m_v1,S.s_t0));e<o.separation&&(o.separation=e)}return o}ComputePolygonSeparation(t){const o=t;o.type=0,o.index=-1,o.separation=-1e37;const e=ko.s_perp.Set(-this.m_normal.y,this.m_normal.x);for(let t=0;t<this.m_polygonB.count;++t){const s=S.NegV(this.m_polygonB.normals[t],ko.s_n),n=S.DotVV(s,S.SubVV(this.m_polygonB.vertices[t],this.m_v1,S.s_t0)),r=S.DotVV(s,S.SubVV(this.m_polygonB.vertices[t],this.m_v2,S.s_t0)),a=p(n,r);if(a>this.m_radius)return o.type=2,o.index=t,o.separation=a,o;if(S.DotVV(s,e)>=0){if(S.DotVV(S.SubVV(s,this.m_upperLimit,S.s_t0),this.m_normal)<-i)continue}else if(S.DotVV(S.SubVV(s,this.m_lowerLimit,S.s_t0),this.m_normal)<-i)continue;a>o.separation&&(o.type=2,o.index=t,o.separation=a)}return o}}ko.s_edge1=new S,ko.s_edge0=new S,ko.s_edge2=new S,ko.s_ie=ft.MakeArray(2),ko.s_rf=new class{constructor(){this.i1=0,this.i2=0,this.v1=new S,this.v2=new S,this.normal=new S,this.sideNormal1=new S,this.sideOffset1=0,this.sideNormal2=new S,this.sideOffset2=0}},ko.s_clipPoints1=ft.MakeArray(2),ko.s_clipPoints2=ft.MakeArray(2),ko.s_edgeAxis=new Lo,ko.s_polygonAxis=new Lo,ko.s_n=new S,ko.s_perp=new S;const zo=new ko;function qo(t,o,e,i,s){zo.Collide(t,o,e,i,s)}class Eo{constructor(){this.mass=0,this.center=new S(0,0),this.I=0}}var Jo,jo,No,Oo,Uo,Xo;(Jo=t.b2ShapeType||(t.b2ShapeType={}))[Jo.e_unknown=-1]="e_unknown",Jo[Jo.e_circleShape=0]="e_circleShape",Jo[Jo.e_edgeShape=1]="e_edgeShape",Jo[Jo.e_polygonShape=2]="e_polygonShape",Jo[Jo.e_chainShape=3]="e_chainShape",Jo[Jo.e_shapeTypeCount=4]="e_shapeTypeCount";class Wo{constructor(o,e){this.m_type=t.b2ShapeType.e_unknown,this.m_radius=0,this.m_type=o,this.m_radius=e}Copy(t){return this.m_radius=t.m_radius,this}GetType(){return this.m_type}}class Zo extends Wo{constructor(o=0){super(t.b2ShapeType.e_circleShape,o),this.m_p=new S}Set(t,o=this.m_radius){return this.m_p.Copy(t),this.m_radius=o,this}Clone(){return(new Zo).Copy(this)}Copy(t){return super.Copy(t),this.m_p.Copy(t.m_p),this}GetChildCount(){return 1}TestPoint(t,o){const e=M.MulXV(t,this.m_p,Zo.TestPoint_s_center),i=S.SubVV(o,e,Zo.TestPoint_s_d);return S.DotVV(i,i)<=y(this.m_radius)}ComputeDistance(t,o,e,i){const s=M.MulXV(t,this.m_p,Zo.ComputeDistance_s_center);return S.SubVV(o,s,e),e.Normalize()-this.m_radius}RayCast(t,o,e,i){const s=M.MulXV(e,this.m_p,Zo.RayCast_s_position),n=S.SubVV(o.p1,s,Zo.RayCast_s_s),r=S.DotVV(n,n)-y(this.m_radius),a=S.SubVV(o.p2,o.p1,Zo.RayCast_s_r),m=S.DotVV(n,a),p=S.DotVV(a,a),l=m*m-p*r;if(l<0||p<1e-5)return!1;let f=-(m+c(l));return 0<=f&&f<=o.maxFraction*p&&(f/=p,t.fraction=f,S.AddVMulSV(n,f,a,t.normal).SelfNormalize(),!0)}ComputeAABB(t,o,e){const i=M.MulXV(o,this.m_p,Zo.ComputeAABB_s_p);t.lowerBound.Set(i.x-this.m_radius,i.y-this.m_radius),t.upperBound.Set(i.x+this.m_radius,i.y+this.m_radius)}ComputeMass(t,o){const i=y(this.m_radius);t.mass=o*e*i,t.center.Copy(this.m_p),t.I=t.mass*(.5*i+S.DotVV(this.m_p,this.m_p))}SetupDistanceProxy(t,o){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_p),t.m_count=1,t.m_radius=this.m_radius}ComputeSubmergedArea(t,o,i,s){const n=M.MulXV(i,this.m_p,new S),r=-(S.DotVV(t,n)-o);if(r<1e-5-this.m_radius)return 0;if(r>this.m_radius)return s.Copy(n),e*this.m_radius*this.m_radius;const a=this.m_radius*this.m_radius,m=r*r,p=a*(g(r/this.m_radius)+e/2)+r*c(a-m),l=-2/3*C(a-m,1.5)/p;return s.x=n.x+t.x*l,s.y=n.y+t.y*l,p}Dump(t){t("    const shape: b2CircleShape = new b2CircleShape();\n"),t("    shape.m_radius = %.15f;\n",this.m_radius),t("    shape.m_p.Set(%.15f, %.15f);\n",this.m_p.x,this.m_p.y)}}Zo.TestPoint_s_center=new S,Zo.TestPoint_s_d=new S,Zo.ComputeDistance_s_center=new S,Zo.RayCast_s_position=new S,Zo.RayCast_s_s=new S,Zo.RayCast_s_r=new S,Zo.ComputeAABB_s_p=new S;class Ho extends Wo{constructor(){super(t.b2ShapeType.e_polygonShape,.016),this.m_centroid=new S(0,0),this.m_vertices=[],this.m_normals=[],this.m_count=0}Clone(){return(new Ho).Copy(this)}Copy(t){super.Copy(t),this.m_centroid.Copy(t.m_centroid),this.m_count=t.m_count,this.m_vertices=S.MakeArray(this.m_count),this.m_normals=S.MakeArray(this.m_count);for(let o=0;o<this.m_count;++o)this.m_vertices[o].Copy(t.m_vertices[o]),this.m_normals[o].Copy(t.m_normals[o]);return this}GetChildCount(){return 1}Set(t,o=t.length,e=0){if(o<3)return this.SetAsBox(1,1);let i=o;const s=[];for(let o=0;o<i;++o){const i=t[e+o];let n=!0;for(let t=0;t<s.length;++t)if(S.DistanceSquaredVV(i,s[t])<16e-6){n=!1;break}n&&s.push(i)}if(i=s.length,i<3)return this.SetAsBox(1,1);let n=0,r=s[0].x;for(let t=1;t<i;++t){const o=s[t].x;(o>r||o===r&&s[t].y<s[n].y)&&(n=t,r=o)}const a=[];let m=0,p=n;for(;;){a[m]=p;let t=0;for(let o=1;o<i;++o){if(t===p){t=o;continue}const e=S.SubVV(s[t],s[a[m]],Ho.Set_s_r),i=S.SubVV(s[o],s[a[m]],Ho.Set_s_v),n=S.CrossVV(e,i);n<0&&(t=o),0===n&&i.LengthSquared()>e.LengthSquared()&&(t=o)}if(++m,p=t,t===n)break}this.m_count=m,this.m_vertices=S.MakeArray(this.m_count),this.m_normals=S.MakeArray(this.m_count);for(let t=0;t<m;++t)this.m_vertices[t].Copy(s[a[t]]);for(let t=0;t<m;++t){const o=this.m_vertices[t],e=this.m_vertices[(t+1)%m],i=S.SubVV(e,o,S.s_t0);S.CrossVOne(i,this.m_normals[t]).SelfNormalize()}return Ho.ComputeCentroid(this.m_vertices,m,this.m_centroid),this}SetAsArray(t,o=t.length){return this.Set(t,o)}SetAsBox(t,o,e,i=0){if(this.m_count=4,this.m_vertices=S.MakeArray(this.m_count),this.m_normals=S.MakeArray(this.m_count),this.m_vertices[0].Set(-t,-o),this.m_vertices[1].Set(t,-o),this.m_vertices[2].Set(t,o),this.m_vertices[3].Set(-t,o),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero(),e){this.m_centroid.Copy(e);const t=new M;t.SetPosition(e),t.SetRotationAngle(i);for(let o=0;o<this.m_count;++o)M.MulXV(t,this.m_vertices[o],this.m_vertices[o]),V.MulRV(t.q,this.m_normals[o],this.m_normals[o])}return this}TestPoint(t,o){const e=M.MulTXV(t,o,Ho.TestPoint_s_pLocal);for(let t=0;t<this.m_count;++t)if(S.DotVV(this.m_normals[t],S.SubVV(e,this.m_vertices[t],S.s_t0))>0)return!1;return!0}ComputeDistance(t,o,e,i){const s=M.MulTXV(t,o,Ho.ComputeDistance_s_pLocal);let n=-1e37;const r=Ho.ComputeDistance_s_normalForMaxDistance.Copy(s);for(let t=0;t<this.m_count;++t){const o=S.DotVV(this.m_normals[t],S.SubVV(s,this.m_vertices[t],S.s_t0));o>n&&(n=o,r.Copy(this.m_normals[t]))}if(n>0){const o=Ho.ComputeDistance_s_minDistance.Copy(r);let i=n*n;for(let t=0;t<this.m_count;++t){const e=S.SubVV(s,this.m_vertices[t],Ho.ComputeDistance_s_distance),n=e.LengthSquared();i>n&&(o.Copy(e),i=n)}return V.MulRV(t.q,o,e),e.Normalize(),Math.sqrt(i)}return V.MulRV(t.q,r,e),n}RayCast(t,o,e,i){const s=M.MulTXV(e,o.p1,Ho.RayCast_s_p1),n=M.MulTXV(e,o.p2,Ho.RayCast_s_p2),r=S.SubVV(n,s,Ho.RayCast_s_d);let a=0,m=o.maxFraction,p=-1;for(let t=0;t<this.m_count;++t){const o=S.DotVV(this.m_normals[t],S.SubVV(this.m_vertices[t],s,S.s_t0)),e=S.DotVV(this.m_normals[t],r);if(0===e){if(o<0)return!1}else e<0&&o<a*e?(a=o/e,p=t):e>0&&o<m*e&&(m=o/e);if(m<a)return!1}return p>=0&&(t.fraction=a,V.MulRV(e.q,this.m_normals[p],t.normal),!0)}ComputeAABB(t,o,e){const i=M.MulXV(o,this.m_vertices[0],t.lowerBound),s=t.upperBound.Copy(i);for(let t=0;t<this.m_count;++t){const e=M.MulXV(o,this.m_vertices[t],Ho.ComputeAABB_s_v);S.MinV(e,i,i),S.MaxV(e,s,s)}const n=this.m_radius;i.SelfSubXY(n,n),s.SelfAddXY(n,n)}ComputeMass(t,o){const e=Ho.ComputeMass_s_center.SetZero();let i=0,s=0;const n=Ho.ComputeMass_s_s.SetZero();for(let t=0;t<this.m_count;++t)n.SelfAdd(this.m_vertices[t]);n.SelfMul(1/this.m_count);for(let t=0;t<this.m_count;++t){const o=S.SubVV(this.m_vertices[t],n,Ho.ComputeMass_s_e1),r=S.SubVV(this.m_vertices[(t+1)%this.m_count],n,Ho.ComputeMass_s_e2),a=S.CrossVV(o,r),m=.5*a;i+=m,e.SelfAdd(S.MulSV(m*(1/3),S.AddVV(o,r,S.s_t0),S.s_t1));const p=o.x,l=o.y,f=r.x,h=r.y;s+=1/3*.25*a*(p*p+f*p+f*f+(l*l+h*l+h*h))}t.mass=o*i,e.SelfMul(1/i),S.AddVV(e,n,t.center),t.I=o*s,t.I+=t.mass*(S.DotVV(t.center,t.center)-S.DotVV(e,e))}Validate(){for(let t=0;t<this.m_count;++t){const o=t,e=(t+1)%this.m_count,i=this.m_vertices[o],s=S.SubVV(this.m_vertices[e],i,Ho.Validate_s_e);for(let t=0;t<this.m_count;++t){if(t===o||t===e)continue;const n=S.SubVV(this.m_vertices[t],i,Ho.Validate_s_v);if(S.CrossVV(s,n)<0)return!1}}return!0}SetupDistanceProxy(t,o){t.m_vertices=this.m_vertices,t.m_count=this.m_count,t.m_radius=this.m_radius}ComputeSubmergedArea(t,o,e,i){const s=V.MulTRV(e.q,t,Ho.ComputeSubmergedArea_s_normalL),n=o-S.DotVV(t,e.p),r=[];let a=0,m=-1,p=-1,l=!1;for(let t=0;t<this.m_count;++t){r[t]=S.DotVV(s,this.m_vertices[t])-n;const o=r[t]<-1e-5;t>0&&(o?l||(m=t-1,a++):l&&(p=t-1,a++)),l=o}switch(a){case 0:if(l){const t=Ho.ComputeSubmergedArea_s_md;return this.ComputeMass(t,1),M.MulXV(e,t.center,i),t.mass}return 0;case 1:-1===m?m=this.m_count-1:p=this.m_count-1}const f=(m+1)%this.m_count,h=(p+1)%this.m_count,y=(0-r[m])/(r[f]-r[m]),_=(0-r[p])/(r[h]-r[p]),c=Ho.ComputeSubmergedArea_s_intoVec.Set(this.m_vertices[m].x*(1-y)+this.m_vertices[f].x*y,this.m_vertices[m].y*(1-y)+this.m_vertices[f].y*y),C=Ho.ComputeSubmergedArea_s_outoVec.Set(this.m_vertices[p].x*(1-_)+this.m_vertices[h].x*_,this.m_vertices[p].y*(1-_)+this.m_vertices[h].y*_);let u=0;const d=Ho.ComputeSubmergedArea_s_center.SetZero();let x,g=this.m_vertices[f],B=f;for(;B!==h;){B=(B+1)%this.m_count,x=B===h?C:this.m_vertices[B];const t=.5*((g.x-c.x)*(x.y-c.y)-(g.y-c.y)*(x.x-c.x));u+=t,d.x+=t*(c.x+g.x+x.x)/3,d.y+=t*(c.y+g.y+x.y)/3,g=x}return d.SelfMul(1/u),M.MulXV(e,d,i),u}Dump(t){t("    const shape: b2PolygonShape = new b2PolygonShape();\n"),t("    const vs: b2Vec2[] = [];\n");for(let o=0;o<this.m_count;++o)t("    vs[%d] = new b2Vec2(%.15f, %.15f);\n",o,this.m_vertices[o].x,this.m_vertices[o].y);t("    shape.Set(vs, %d);\n",this.m_count)}static ComputeCentroid(t,o,e){const i=e;i.SetZero();let s=0;const n=Ho.ComputeCentroid_s_pRef.SetZero();for(let e=0;e<o;++e){const r=n,a=t[e],m=t[(e+1)%o],p=S.SubVV(a,r,Ho.ComputeCentroid_s_e1),l=S.SubVV(m,r,Ho.ComputeCentroid_s_e2),f=.5*S.CrossVV(p,l);s+=f,i.x+=f*(1/3)*(r.x+a.x+m.x),i.y+=f*(1/3)*(r.y+a.y+m.y)}return i.SelfMul(1/s),i}}Ho.Set_s_r=new S,Ho.Set_s_v=new S,Ho.TestPoint_s_pLocal=new S,Ho.ComputeDistance_s_pLocal=new S,Ho.ComputeDistance_s_normalForMaxDistance=new S,Ho.ComputeDistance_s_minDistance=new S,Ho.ComputeDistance_s_distance=new S,Ho.RayCast_s_p1=new S,Ho.RayCast_s_p2=new S,Ho.RayCast_s_d=new S,Ho.ComputeAABB_s_v=new S,Ho.ComputeMass_s_center=new S,Ho.ComputeMass_s_s=new S,Ho.ComputeMass_s_e1=new S,Ho.ComputeMass_s_e2=new S,Ho.Validate_s_e=new S,Ho.Validate_s_v=new S,Ho.ComputeSubmergedArea_s_normalL=new S,Ho.ComputeSubmergedArea_s_md=new Eo,Ho.ComputeSubmergedArea_s_intoVec=new S,Ho.ComputeSubmergedArea_s_outoVec=new S,Ho.ComputeSubmergedArea_s_center=new S,Ho.ComputeCentroid_s_pRef=new S,Ho.ComputeCentroid_s_e1=new S,Ho.ComputeCentroid_s_e2=new S;class Qo extends Wo{constructor(){super(t.b2ShapeType.e_edgeShape,.016),this.m_vertex1=new S,this.m_vertex2=new S,this.m_vertex0=new S,this.m_vertex3=new S,this.m_hasVertex0=!1,this.m_hasVertex3=!1}Set(t,o){return this.m_vertex1.Copy(t),this.m_vertex2.Copy(o),this.m_hasVertex0=!1,this.m_hasVertex3=!1,this}Clone(){return(new Qo).Copy(this)}Copy(t){return super.Copy(t),this.m_vertex1.Copy(t.m_vertex1),this.m_vertex2.Copy(t.m_vertex2),this.m_vertex0.Copy(t.m_vertex0),this.m_vertex3.Copy(t.m_vertex3),this.m_hasVertex0=t.m_hasVertex0,this.m_hasVertex3=t.m_hasVertex3,this}GetChildCount(){return 1}TestPoint(t,o){return!1}ComputeDistance(t,o,e,i){const s=M.MulXV(t,this.m_vertex1,Qo.ComputeDistance_s_v1),n=M.MulXV(t,this.m_vertex2,Qo.ComputeDistance_s_v2),r=S.SubVV(o,s,Qo.ComputeDistance_s_d),a=S.SubVV(n,s,Qo.ComputeDistance_s_s),m=S.DotVV(r,a);if(m>0){const t=S.DotVV(a,a);m>t?S.SubVV(o,n,r):r.SelfMulSub(m/t,a)}return e.Copy(r),e.Normalize()}RayCast(t,o,e,i){const s=M.MulTXV(e,o.p1,Qo.RayCast_s_p1),n=M.MulTXV(e,o.p2,Qo.RayCast_s_p2),r=S.SubVV(n,s,Qo.RayCast_s_d),a=this.m_vertex1,m=this.m_vertex2,p=S.SubVV(m,a,Qo.RayCast_s_e),l=t.normal.Set(p.y,-p.x).SelfNormalize(),f=S.DotVV(l,S.SubVV(a,s,S.s_t0)),h=S.DotVV(l,r);if(0===h)return!1;const y=f/h;if(y<0||o.maxFraction<y)return!1;const _=S.AddVMulSV(s,y,r,Qo.RayCast_s_q),c=S.SubVV(m,a,Qo.RayCast_s_r),C=S.DotVV(c,c);if(0===C)return!1;const u=S.DotVV(S.SubVV(_,a,S.s_t0),c)/C;return!(u<0||1<u||(t.fraction=y,V.MulRV(e.q,t.normal,t.normal),f>0&&t.normal.SelfNeg(),0))}ComputeAABB(t,o,e){const i=M.MulXV(o,this.m_vertex1,Qo.ComputeAABB_s_v1),s=M.MulXV(o,this.m_vertex2,Qo.ComputeAABB_s_v2);S.MinV(i,s,t.lowerBound),S.MaxV(i,s,t.upperBound);const n=this.m_radius;t.lowerBound.SelfSubXY(n,n),t.upperBound.SelfAddXY(n,n)}ComputeMass(t,o){t.mass=0,S.MidVV(this.m_vertex1,this.m_vertex2,t.center),t.I=0}SetupDistanceProxy(t,o){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_vertex1),t.m_vertices[1].Copy(this.m_vertex2),t.m_count=2,t.m_radius=this.m_radius}ComputeSubmergedArea(t,o,e,i){return i.SetZero(),0}Dump(t){t("    const shape: b2EdgeShape = new b2EdgeShape();\n"),t("    shape.m_radius = %.15f;\n",this.m_radius),t("    shape.m_vertex0.Set(%.15f, %.15f);\n",this.m_vertex0.x,this.m_vertex0.y),t("    shape.m_vertex1.Set(%.15f, %.15f);\n",this.m_vertex1.x,this.m_vertex1.y),t("    shape.m_vertex2.Set(%.15f, %.15f);\n",this.m_vertex2.x,this.m_vertex2.y),t("    shape.m_vertex3.Set(%.15f, %.15f);\n",this.m_vertex3.x,this.m_vertex3.y),t("    shape.m_hasVertex0 = %s;\n",this.m_hasVertex0),t("    shape.m_hasVertex3 = %s;\n",this.m_hasVertex3)}}Qo.ComputeDistance_s_v1=new S,Qo.ComputeDistance_s_v2=new S,Qo.ComputeDistance_s_d=new S,Qo.ComputeDistance_s_s=new S,Qo.RayCast_s_p1=new S,Qo.RayCast_s_p2=new S,Qo.RayCast_s_d=new S,Qo.RayCast_s_e=new S,Qo.RayCast_s_q=new S,Qo.RayCast_s_r=new S,Qo.ComputeAABB_s_v1=new S,Qo.ComputeAABB_s_v2=new S;class Yo extends Wo{constructor(){super(t.b2ShapeType.e_chainShape,.016),this.m_vertices=[],this.m_count=0,this.m_prevVertex=new S,this.m_nextVertex=new S,this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1}CreateLoop(t,o=t.length,e=0){if(o<3)return this;this.m_count=o+1,this.m_vertices=S.MakeArray(this.m_count);for(let i=0;i<o;++i)this.m_vertices[i].Copy(t[e+i]);return this.m_vertices[o].Copy(this.m_vertices[0]),this.m_prevVertex.Copy(this.m_vertices[this.m_count-2]),this.m_nextVertex.Copy(this.m_vertices[1]),this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0,this}CreateChain(t,o=t.length,e=0){this.m_count=o,this.m_vertices=S.MakeArray(o);for(let i=0;i<o;++i)this.m_vertices[i].Copy(t[e+i]);return this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_prevVertex.SetZero(),this.m_nextVertex.SetZero(),this}SetPrevVertex(t){return this.m_prevVertex.Copy(t),this.m_hasPrevVertex=!0,this}SetNextVertex(t){return this.m_nextVertex.Copy(t),this.m_hasNextVertex=!0,this}Clone(){return(new Yo).Copy(this)}Copy(t){return super.Copy(t),this.CreateChain(t.m_vertices,t.m_count),this.m_prevVertex.Copy(t.m_prevVertex),this.m_nextVertex.Copy(t.m_nextVertex),this.m_hasPrevVertex=t.m_hasPrevVertex,this.m_hasNextVertex=t.m_hasNextVertex,this}GetChildCount(){return this.m_count-1}GetChildEdge(o,e){o.m_type=t.b2ShapeType.e_edgeShape,o.m_radius=this.m_radius,o.m_vertex1.Copy(this.m_vertices[e]),o.m_vertex2.Copy(this.m_vertices[e+1]),e>0?(o.m_vertex0.Copy(this.m_vertices[e-1]),o.m_hasVertex0=!0):(o.m_vertex0.Copy(this.m_prevVertex),o.m_hasVertex0=this.m_hasPrevVertex),e<this.m_count-2?(o.m_vertex3.Copy(this.m_vertices[e+2]),o.m_hasVertex3=!0):(o.m_vertex3.Copy(this.m_nextVertex),o.m_hasVertex3=this.m_hasNextVertex)}TestPoint(t,o){return!1}ComputeDistance(t,o,e,i){const s=Yo.ComputeDistance_s_edgeShape;return this.GetChildEdge(s,i),s.ComputeDistance(t,o,e,0)}RayCast(t,o,e,i){const s=Yo.RayCast_s_edgeShape;return s.m_vertex1.Copy(this.m_vertices[i]),s.m_vertex2.Copy(this.m_vertices[(i+1)%this.m_count]),s.RayCast(t,o,e,0)}ComputeAABB(t,o,e){const i=this.m_vertices[e],s=this.m_vertices[(e+1)%this.m_count],n=M.MulXV(o,i,Yo.ComputeAABB_s_v1),r=M.MulXV(o,s,Yo.ComputeAABB_s_v2);S.MinV(n,r,t.lowerBound),S.MaxV(n,r,t.upperBound)}ComputeMass(t,o){t.mass=0,t.center.SetZero(),t.I=0}SetupDistanceProxy(t,o){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_vertices[o]),o+1<this.m_count?t.m_vertices[1].Copy(this.m_vertices[o+1]):t.m_vertices[1].Copy(this.m_vertices[0]),t.m_count=2,t.m_radius=this.m_radius}ComputeSubmergedArea(t,o,e,i){return i.SetZero(),0}Dump(t){t("    const shape: b2ChainShape = new b2ChainShape();\n"),t("    const vs: b2Vec2[] = [];\n");for(let o=0;o<this.m_count;++o)t("    vs[%d] = new bVec2(%.15f, %.15f);\n",o,this.m_vertices[o].x,this.m_vertices[o].y);t("    shape.CreateChain(vs, %d);\n",this.m_count),t("    shape.m_prevVertex.Set(%.15f, %.15f);\n",this.m_prevVertex.x,this.m_prevVertex.y),t("    shape.m_nextVertex.Set(%.15f, %.15f);\n",this.m_nextVertex.x,this.m_nextVertex.y),t("    shape.m_hasPrevVertex = %s;\n",this.m_hasPrevVertex?"true":"false"),t("    shape.m_hasNextVertex = %s;\n",this.m_hasNextVertex?"true":"false")}}Yo.ComputeDistance_s_edgeShape=new Qo,Yo.RayCast_s_edgeShape=new Qo,Yo.ComputeAABB_s_v1=new S,Yo.ComputeAABB_s_v2=new S;class Ko{constructor(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0}Clone(){return(new Ko).Copy(this)}Copy(t){return this.categoryBits=t.categoryBits,this.maskBits=t.maskBits,this.groupIndex=t.groupIndex||0,this}}Ko.DEFAULT=new Ko;class $o{constructor(){this.userData=null,this.friction=.2,this.restitution=0,this.density=0,this.isSensor=!1,this.filter=new Ko}}class te{constructor(t){this.aabb=new _t,this.childIndex=0,this.fixture=t}}class oe{constructor(t,o){this.m_density=0,this.m_next=null,this.m_friction=0,this.m_restitution=0,this.m_proxies=[],this.m_proxyCount=0,this.m_filter=new Ko,this.m_isSensor=!1,this.m_userData=null,this.m_body=o,this.m_shape=t.shape.Clone()}GetType(){return this.m_shape.GetType()}GetShape(){return this.m_shape}SetSensor(t){t!==this.m_isSensor&&(this.m_body.SetAwake(!0),this.m_isSensor=t)}IsSensor(){return this.m_isSensor}SetFilterData(t){this.m_filter.Copy(t),this.Refilter()}GetFilterData(){return this.m_filter}Refilter(){let t=this.m_body.GetContactList();for(;t;){const o=t.contact,e=o.GetFixtureA(),i=o.GetFixtureB();e!==this&&i!==this||o.FlagForFiltering(),t=t.next}const o=this.m_body.GetWorld();if(null===o)return;const e=o.m_contactManager.m_broadPhase;for(let t=0;t<this.m_proxyCount;++t)e.TouchProxy(this.m_proxies[t].treeNode)}GetBody(){return this.m_body}GetNext(){return this.m_next}GetUserData(){return this.m_userData}SetUserData(t){this.m_userData=t}TestPoint(t){return this.m_shape.TestPoint(this.m_body.GetTransform(),t)}ComputeDistance(t,o,e){return this.m_shape.ComputeDistance(this.m_body.GetTransform(),t,o,e)}RayCast(t,o,e){return this.m_shape.RayCast(t,o,this.m_body.GetTransform(),e)}GetMassData(t=new Eo){return this.m_shape.ComputeMass(t,this.m_density),t}SetDensity(t){this.m_density=t}GetDensity(){return this.m_density}GetFriction(){return this.m_friction}SetFriction(t){this.m_friction=t}GetRestitution(){return this.m_restitution}SetRestitution(t){this.m_restitution=t}GetAABB(t){return this.m_proxies[t].aabb}Dump(t,o){t("    const fd: b2FixtureDef = new b2FixtureDef();\n"),t("    fd.friction = %.15f;\n",this.m_friction),t("    fd.restitution = %.15f;\n",this.m_restitution),t("    fd.density = %.15f;\n",this.m_density),t("    fd.isSensor = %s;\n",this.m_isSensor?"true":"false"),t("    fd.filter.categoryBits = %d;\n",this.m_filter.categoryBits),t("    fd.filter.maskBits = %d;\n",this.m_filter.maskBits),t("    fd.filter.groupIndex = %d;\n",this.m_filter.groupIndex),this.m_shape.Dump(t),t("\n"),t("    fd.shape = shape;\n"),t("\n"),t("    bodies[%d].CreateFixture(fd);\n",o)}Create(t){this.m_userData=t.userData,this.m_friction=o(t.friction,.2),this.m_restitution=o(t.restitution,0),this.m_next=null,this.m_filter.Copy(o(t.filter,Ko.DEFAULT)),this.m_isSensor=o(t.isSensor,!1),this.m_proxies=r(this.m_shape.GetChildCount(),t=>new te(this)),this.m_proxyCount=0,this.m_density=o(t.density,0)}Destroy(){}CreateProxies(t){const o=this.m_body.m_world.m_contactManager.m_broadPhase;this.m_proxyCount=this.m_shape.GetChildCount();for(let e=0;e<this.m_proxyCount;++e){const i=this.m_proxies[e]=new te(this);this.m_shape.ComputeAABB(i.aabb,t,e),i.treeNode=o.CreateProxy(i.aabb,i),i.childIndex=e}}DestroyProxies(){const t=this.m_body.m_world.m_contactManager.m_broadPhase;for(let o=0;o<this.m_proxyCount;++o){const e=this.m_proxies[o];delete e.treeNode.userData,t.DestroyProxy(e.treeNode),delete e.treeNode}this.m_proxyCount=0}TouchProxies(){const t=this.m_body.m_world.m_contactManager.m_broadPhase,o=this.m_proxyCount;for(let e=0;e<o;++e)t.TouchProxy(this.m_proxies[e].treeNode)}Synchronize(t,o){if(0===this.m_proxyCount)return;const e=this.m_body.m_world.m_contactManager.m_broadPhase;for(let i=0;i<this.m_proxyCount;++i){const s=this.m_proxies[i],n=oe.Synchronize_s_aabb1,r=oe.Synchronize_s_aabb2;this.m_shape.ComputeAABB(n,t,i),this.m_shape.ComputeAABB(r,o,i),s.aabb.Combine2(n,r);const a=S.SubVV(o.p,t.p,oe.Synchronize_s_displacement);e.MoveProxy(s.treeNode,s.aabb,a)}}}oe.Synchronize_s_aabb1=new _t,oe.Synchronize_s_aabb2=new _t,oe.Synchronize_s_displacement=new S,(jo=t.b2BodyType||(t.b2BodyType={}))[jo.b2_unknown=-1]="b2_unknown",jo[jo.b2_staticBody=0]="b2_staticBody",jo[jo.b2_kinematicBody=1]="b2_kinematicBody",jo[jo.b2_dynamicBody=2]="b2_dynamicBody";class ee{constructor(e,i){this.m_type=t.b2BodyType.b2_staticBody,this.m_islandFlag=!1,this.m_awakeFlag=!1,this.m_autoSleepFlag=!1,this.m_bulletFlag=!1,this.m_fixedRotationFlag=!1,this.m_activeFlag=!1,this.m_toiFlag=!1,this.m_islandIndex=0,this.m_xf=new M,this.m_xf0=new M,this.m_sweep=new P,this.m_linearVelocity=new S,this.m_angularVelocity=0,this.m_force=new S,this.m_torque=0,this.m_prev=null,this.m_next=null,this.m_fixtureList=null,this.m_fixtureCount=0,this.m_jointList=null,this.m_contactList=null,this.m_mass=1,this.m_invMass=1,this.m_I=0,this.m_invI=0,this.m_linearDamping=0,this.m_angularDamping=0,this.m_gravityScale=1,this.m_sleepTime=0,this.m_userData=null,this.m_controllerList=null,this.m_controllerCount=0,this.m_bulletFlag=o(e.bullet,!1),this.m_fixedRotationFlag=o(e.fixedRotation,!1),this.m_autoSleepFlag=o(e.allowSleep,!0),this.m_awakeFlag=o(e.awake,!0),this.m_activeFlag=o(e.active,!0),this.m_world=i,this.m_xf.p.Copy(o(e.position,S.ZERO)),this.m_xf.q.SetAngle(o(e.angle,0)),this.m_xf0.Copy(this.m_xf),this.m_sweep.localCenter.SetZero(),this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),this.m_sweep.a0=this.m_sweep.a=this.m_xf.q.GetAngle(),this.m_sweep.alpha0=0,this.m_linearVelocity.Copy(o(e.linearVelocity,S.ZERO)),this.m_angularVelocity=o(e.angularVelocity,0),this.m_linearDamping=o(e.linearDamping,0),this.m_angularDamping=o(e.angularDamping,0),this.m_gravityScale=o(e.gravityScale,1),this.m_force.SetZero(),this.m_torque=0,this.m_sleepTime=0,this.m_type=o(e.type,t.b2BodyType.b2_staticBody),e.type===t.b2BodyType.b2_dynamicBody?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_userData=e.userData,this.m_fixtureList=null,this.m_fixtureCount=0,this.m_controllerList=null,this.m_controllerCount=0}CreateFixture(t,o=0){return t instanceof Wo?this.CreateFixtureShapeDensity(t,o):this.CreateFixtureDef(t)}CreateFixtureDef(t){if(this.m_world.IsLocked())throw new Error;const o=new oe(t,this);return o.Create(t),this.m_activeFlag&&o.CreateProxies(this.m_xf),o.m_next=this.m_fixtureList,this.m_fixtureList=o,++this.m_fixtureCount,o.m_density>0&&this.ResetMassData(),this.m_world.m_newFixture=!0,o}CreateFixtureShapeDensity(t,o=0){const e=ee.CreateFixtureShapeDensity_s_def;return e.shape=t,e.density=o,this.CreateFixtureDef(e)}DestroyFixture(t){if(this.m_world.IsLocked())throw new Error;let o=this.m_fixtureList,e=null;for(;null!==o;){if(o===t){e?e.m_next=t.m_next:this.m_fixtureList=t.m_next;break}e=o,o=o.m_next}let i=this.m_contactList;for(;i;){const o=i.contact;i=i.next;const e=o.GetFixtureA(),s=o.GetFixtureB();t!==e&&t!==s||this.m_world.m_contactManager.Destroy(o)}this.m_activeFlag&&t.DestroyProxies(),t.m_next=null,t.Destroy(),--this.m_fixtureCount,this.ResetMassData()}SetTransformVec(t,o){this.SetTransformXY(t.x,t.y,o)}SetTransformXY(t,o,e){if(this.m_world.IsLocked())throw new Error;this.m_xf.q.SetAngle(e),this.m_xf.p.Set(t,o),this.m_xf0.Copy(this.m_xf),M.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.a=e,this.m_sweep.c0.Copy(this.m_sweep.c),this.m_sweep.a0=e;for(let t=this.m_fixtureList;t;t=t.m_next)t.Synchronize(this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()}SetTransform(t){this.SetTransformVec(t.p,t.GetAngle())}GetTransform(){return this.m_xf}GetPosition(){return this.m_xf.p}SetPosition(t){this.SetTransformVec(t,this.GetAngle())}SetPositionXY(t,o){this.SetTransformXY(t,o,this.GetAngle())}GetAngle(){return this.m_sweep.a}SetAngle(t){this.SetTransformVec(this.GetPosition(),t)}GetWorldCenter(){return this.m_sweep.c}GetLocalCenter(){return this.m_sweep.localCenter}SetLinearVelocity(o){this.m_type!==t.b2BodyType.b2_staticBody&&(S.DotVV(o,o)>0&&this.SetAwake(!0),this.m_linearVelocity.Copy(o))}GetLinearVelocity(){return this.m_linearVelocity}SetAngularVelocity(o){this.m_type!==t.b2BodyType.b2_staticBody&&(o*o>0&&this.SetAwake(!0),this.m_angularVelocity=o)}GetAngularVelocity(){return this.m_angularVelocity}GetDefinition(t){return t.type=this.GetType(),t.allowSleep=this.m_autoSleepFlag,t.angle=this.GetAngle(),t.angularDamping=this.m_angularDamping,t.gravityScale=this.m_gravityScale,t.angularVelocity=this.m_angularVelocity,t.fixedRotation=this.m_fixedRotationFlag,t.bullet=this.m_bulletFlag,t.awake=this.m_awakeFlag,t.linearDamping=this.m_linearDamping,t.linearVelocity.Copy(this.GetLinearVelocity()),t.position.Copy(this.GetPosition()),t.userData=this.GetUserData(),t}ApplyForce(o,e,i=!0){this.m_type===t.b2BodyType.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=o.x,this.m_force.y+=o.y,this.m_torque+=(e.x-this.m_sweep.c.x)*o.y-(e.y-this.m_sweep.c.y)*o.x))}ApplyForceToCenter(o,e=!0){this.m_type===t.b2BodyType.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=o.x,this.m_force.y+=o.y))}ApplyTorque(o,e=!0){this.m_type===t.b2BodyType.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_torque+=o))}ApplyLinearImpulse(o,e,i=!0){this.m_type===t.b2BodyType.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*o.x,this.m_linearVelocity.y+=this.m_invMass*o.y,this.m_angularVelocity+=this.m_invI*((e.x-this.m_sweep.c.x)*o.y-(e.y-this.m_sweep.c.y)*o.x)))}ApplyLinearImpulseToCenter(o,e=!0){this.m_type===t.b2BodyType.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*o.x,this.m_linearVelocity.y+=this.m_invMass*o.y))}ApplyAngularImpulse(o,e=!0){this.m_type===t.b2BodyType.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*o))}GetMass(){return this.m_mass}GetInertia(){return this.m_I+this.m_mass*S.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter)}GetMassData(t){return t.mass=this.m_mass,t.I=this.m_I+this.m_mass*S.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter),t.center.Copy(this.m_sweep.localCenter),t}SetMassData(o){if(this.m_world.IsLocked())throw new Error;if(this.m_type!==t.b2BodyType.b2_dynamicBody)return;this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=o.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,o.I>0&&!this.m_fixedRotationFlag&&(this.m_I=o.I-this.m_mass*S.DotVV(o.center,o.center),this.m_invI=1/this.m_I);const e=ee.SetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(o.center),M.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),S.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,S.SubVV(this.m_sweep.c,e,S.s_t0),this.m_linearVelocity)}ResetMassData(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type===t.b2BodyType.b2_staticBody||this.m_type===t.b2BodyType.b2_kinematicBody)return this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),void(this.m_sweep.a0=this.m_sweep.a);const o=ee.ResetMassData_s_localCenter.SetZero();for(let t=this.m_fixtureList;t;t=t.m_next){if(0===t.m_density)continue;const e=t.GetMassData(ee.ResetMassData_s_massData);this.m_mass+=e.mass,o.x+=e.center.x*e.mass,o.y+=e.center.y*e.mass,this.m_I+=e.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,o.x*=this.m_invMass,o.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&!this.m_fixedRotationFlag?(this.m_I-=this.m_mass*S.DotVV(o,o),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);const e=ee.ResetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(o),M.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),S.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,S.SubVV(this.m_sweep.c,e,S.s_t0),this.m_linearVelocity)}GetWorldPoint(t,o){return M.MulXV(this.m_xf,t,o)}GetWorldVector(t,o){return V.MulRV(this.m_xf.q,t,o)}GetLocalPoint(t,o){return M.MulTXV(this.m_xf,t,o)}GetLocalVector(t,o){return V.MulTRV(this.m_xf.q,t,o)}GetLinearVelocityFromWorldPoint(t,o){return S.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,S.SubVV(t,this.m_sweep.c,S.s_t0),o)}GetLinearVelocityFromLocalPoint(t,o){return this.GetLinearVelocityFromWorldPoint(this.GetWorldPoint(t,o),o)}GetLinearDamping(){return this.m_linearDamping}SetLinearDamping(t){this.m_linearDamping=t}GetAngularDamping(){return this.m_angularDamping}SetAngularDamping(t){this.m_angularDamping=t}GetGravityScale(){return this.m_gravityScale}SetGravityScale(t){this.m_gravityScale=t}SetType(o){if(this.m_world.IsLocked())throw new Error;if(this.m_type===o)return;this.m_type=o,this.ResetMassData(),this.m_type===t.b2BodyType.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_sweep.a0=this.m_sweep.a,this.m_sweep.c0.Copy(this.m_sweep.c),this.SynchronizeFixtures()),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;let e=this.m_contactList;for(;e;){const t=e;e=e.next,this.m_world.m_contactManager.Destroy(t.contact)}this.m_contactList=null;for(let t=this.m_fixtureList;t;t=t.m_next)t.TouchProxies()}GetType(){return this.m_type}SetBullet(t){this.m_bulletFlag=t}IsBullet(){return this.m_bulletFlag}SetSleepingAllowed(t){this.m_autoSleepFlag=t,t||this.SetAwake(!0)}IsSleepingAllowed(){return this.m_autoSleepFlag}SetAwake(t){t?(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)}IsAwake(){return this.m_awakeFlag}SetActive(t){if(this.m_world.IsLocked())throw new Error;if(t!==this.IsActive())if(this.m_activeFlag=t,t)for(let t=this.m_fixtureList;t;t=t.m_next)t.CreateProxies(this.m_xf);else{for(let t=this.m_fixtureList;t;t=t.m_next)t.DestroyProxies();let t=this.m_contactList;for(;t;){const o=t;t=t.next,this.m_world.m_contactManager.Destroy(o.contact)}this.m_contactList=null}}IsActive(){return this.m_activeFlag}SetFixedRotation(t){this.m_fixedRotationFlag!==t&&(this.m_fixedRotationFlag=t,this.m_angularVelocity=0,this.ResetMassData())}IsFixedRotation(){return this.m_fixedRotationFlag}GetFixtureList(){return this.m_fixtureList}GetJointList(){return this.m_jointList}GetContactList(){return this.m_contactList}GetNext(){return this.m_next}GetUserData(){return this.m_userData}SetUserData(t){this.m_userData=t}GetWorld(){return this.m_world}Dump(o){const e=this.m_islandIndex;o("{\n"),o("  const bd: b2BodyDef = new b2BodyDef();\n");let i="";switch(this.m_type){case t.b2BodyType.b2_staticBody:i="b2BodyType.b2_staticBody";break;case t.b2BodyType.b2_kinematicBody:i="b2BodyType.b2_kinematicBody";break;case t.b2BodyType.b2_dynamicBody:i="b2BodyType.b2_dynamicBody"}o("  bd.type = %s;\n",i),o("  bd.position.Set(%.15f, %.15f);\n",this.m_xf.p.x,this.m_xf.p.y),o("  bd.angle = %.15f;\n",this.m_sweep.a),o("  bd.linearVelocity.Set(%.15f, %.15f);\n",this.m_linearVelocity.x,this.m_linearVelocity.y),o("  bd.angularVelocity = %.15f;\n",this.m_angularVelocity),o("  bd.linearDamping = %.15f;\n",this.m_linearDamping),o("  bd.angularDamping = %.15f;\n",this.m_angularDamping),o("  bd.allowSleep = %s;\n",this.m_autoSleepFlag?"true":"false"),o("  bd.awake = %s;\n",this.m_awakeFlag?"true":"false"),o("  bd.fixedRotation = %s;\n",this.m_fixedRotationFlag?"true":"false"),o("  bd.bullet = %s;\n",this.m_bulletFlag?"true":"false"),o("  bd.active = %s;\n",this.m_activeFlag?"true":"false"),o("  bd.gravityScale = %.15f;\n",this.m_gravityScale),o("\n"),o("  bodies[%d] = this.m_world.CreateBody(bd);\n",this.m_islandIndex),o("\n");for(let t=this.m_fixtureList;t;t=t.m_next)o("  {\n"),t.Dump(o,e),o("  }\n");o("}\n")}SynchronizeFixtures(){const t=ee.SynchronizeFixtures_s_xf1;t.q.SetAngle(this.m_sweep.a0),V.MulRV(t.q,this.m_sweep.localCenter,t.p),S.SubVV(this.m_sweep.c0,t.p,t.p);for(let o=this.m_fixtureList;o;o=o.m_next)o.Synchronize(t,this.m_xf)}SynchronizeTransform(){this.m_xf.q.SetAngle(this.m_sweep.a),V.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),S.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)}ShouldCollide(o){return(this.m_type!==t.b2BodyType.b2_staticBody||o.m_type!==t.b2BodyType.b2_staticBody)&&this.ShouldCollideConnected(o)}ShouldCollideConnected(t){for(let o=this.m_jointList;o;o=o.next)if(o.other===t&&!o.joint.m_collideConnected)return!1;return!0}Advance(t){this.m_sweep.Advance(t),this.m_sweep.c.Copy(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_xf.q.SetAngle(this.m_sweep.a),V.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),S.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)}GetControllerList(){return this.m_controllerList}GetControllerCount(){return this.m_controllerCount}}ee.CreateFixtureShapeDensity_s_def=new $o,ee.SetMassData_s_oldCenter=new S,ee.ResetMassData_s_localCenter=new S,ee.ResetMassData_s_oldCenter=new S,ee.ResetMassData_s_massData=new Eo,ee.SynchronizeFixtures_s_xf1=new M,(Oo=t.b2JointType||(t.b2JointType={}))[Oo.e_unknownJoint=0]="e_unknownJoint",Oo[Oo.e_revoluteJoint=1]="e_revoluteJoint",Oo[Oo.e_prismaticJoint=2]="e_prismaticJoint",Oo[Oo.e_distanceJoint=3]="e_distanceJoint",Oo[Oo.e_pulleyJoint=4]="e_pulleyJoint",Oo[Oo.e_mouseJoint=5]="e_mouseJoint",Oo[Oo.e_gearJoint=6]="e_gearJoint",Oo[Oo.e_wheelJoint=7]="e_wheelJoint",Oo[Oo.e_weldJoint=8]="e_weldJoint",Oo[Oo.e_frictionJoint=9]="e_frictionJoint",Oo[Oo.e_ropeJoint=10]="e_ropeJoint",Oo[Oo.e_motorJoint=11]="e_motorJoint",Oo[Oo.e_areaJoint=12]="e_areaJoint",(No=t.b2LimitState||(t.b2LimitState={}))[No.e_inactiveLimit=0]="e_inactiveLimit",No[No.e_atLowerLimit=1]="e_atLowerLimit",No[No.e_atUpperLimit=2]="e_atUpperLimit",No[No.e_equalLimits=3]="e_equalLimits";class ie{constructor(t,o){this.prev=null,this.next=null,this.joint=t,this.other=o}}class se{constructor(o){this.type=t.b2JointType.e_unknownJoint,this.userData=null,this.collideConnected=!1,this.type=o}}class ne{constructor(e){this.m_type=t.b2JointType.e_unknownJoint,this.m_prev=null,this.m_next=null,this.m_index=0,this.m_islandFlag=!1,this.m_collideConnected=!1,this.m_userData=null,this.m_type=e.type,this.m_edgeA=new ie(this,e.bodyB),this.m_edgeB=new ie(this,e.bodyA),this.m_bodyA=e.bodyA,this.m_bodyB=e.bodyB,this.m_collideConnected=o(e.collideConnected,!1),this.m_userData=e.userData}GetType(){return this.m_type}GetBodyA(){return this.m_bodyA}GetBodyB(){return this.m_bodyB}GetNext(){return this.m_next}GetUserData(){return this.m_userData}SetUserData(t){this.m_userData=t}IsActive(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()}GetCollideConnected(){return this.m_collideConnected}Dump(t){t("// Dump is not supported for this joint type.\n")}ShiftOrigin(t){}}class re extends se{constructor(){super(t.b2JointType.e_distanceJoint),this.localAnchorA=new S,this.localAnchorB=new S,this.length=1,this.frequencyHz=0,this.dampingRatio=0}Initialize(t,o,e,i){this.bodyA=t,this.bodyB=o,this.bodyA.GetLocalPoint(e,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.length=S.DistanceVV(e,i),this.frequencyHz=0,this.dampingRatio=0}}class ae extends ne{constructor(t){super(t),this.m_frequencyHz=0,this.m_dampingRatio=0,this.m_bias=0,this.m_localAnchorA=new S,this.m_localAnchorB=new S,this.m_gamma=0,this.m_impulse=0,this.m_length=0,this.m_indexA=0,this.m_indexB=0,this.m_u=new S,this.m_rA=new S,this.m_rB=new S,this.m_localCenterA=new S,this.m_localCenterB=new S,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_mass=0,this.m_qA=new V,this.m_qB=new V,this.m_lalcA=new S,this.m_lalcB=new S,this.m_frequencyHz=o(t.frequencyHz,0),this.m_dampingRatio=o(t.dampingRatio,0),this.m_localAnchorA.Copy(t.localAnchorA),this.m_localAnchorB.Copy(t.localAnchorB),this.m_length=t.length}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,o){return o.x=t*this.m_impulse*this.m_u.x,o.y=t*this.m_impulse*this.m_u.y,o}GetReactionTorque(t){return 0}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}SetLength(t){this.m_length=t}Length(){return this.m_length}SetFrequency(t){this.m_frequencyHz=t}GetFrequency(){return this.m_frequencyHz}SetDampingRatio(t){this.m_dampingRatio=t}GetDampingRatio(){return this.m_dampingRatio}Dump(t){const o=this.m_bodyA.m_islandIndex,e=this.m_bodyB.m_islandIndex;t("  const jd: b2DistanceJointDef = new b2DistanceJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",o),t("  jd.bodyB = bodies[%d];\n",e),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.length = %.15f;\n",this.m_length),t("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),t("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const o=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,s=t.velocities[this.m_indexA].v;let n=t.velocities[this.m_indexA].w;const r=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,m=t.velocities[this.m_indexB].v;let p=t.velocities[this.m_indexB].w;const l=this.m_qA.SetAngle(i),f=this.m_qB.SetAngle(a);S.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),V.MulRV(l,this.m_lalcA,this.m_rA),S.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),V.MulRV(f,this.m_lalcB,this.m_rB),this.m_u.x=r.x+this.m_rB.x-o.x-this.m_rA.x,this.m_u.y=r.y+this.m_rB.y-o.y-this.m_rA.y;const h=this.m_u.Length();h>.008?this.m_u.SelfMul(1/h):this.m_u.SetZero();const y=S.CrossVV(this.m_rA,this.m_u),_=S.CrossVV(this.m_rB,this.m_u);let c=this.m_invMassA+this.m_invIA*y*y+this.m_invMassB+this.m_invIB*_*_;if(this.m_mass=0!==c?1/c:0,this.m_frequencyHz>0){const o=h-this.m_length,i=2*e*this.m_frequencyHz,s=2*this.m_mass*this.m_dampingRatio*i,n=this.m_mass*i*i,r=t.step.dt;this.m_gamma=r*(s+r*n),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=o*r*n*this.m_gamma,c+=this.m_gamma,this.m_mass=0!==c?1/c:0}else this.m_gamma=0,this.m_bias=0;if(t.step.warmStarting){this.m_impulse*=t.step.dtRatio;const o=S.MulSV(this.m_impulse,this.m_u,ae.InitVelocityConstraints_s_P);s.SelfMulSub(this.m_invMassA,o),n-=this.m_invIA*S.CrossVV(this.m_rA,o),m.SelfMulAdd(this.m_invMassB,o),p+=this.m_invIB*S.CrossVV(this.m_rB,o)}else this.m_impulse=0;t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=p}SolveVelocityConstraints(t){const o=t.velocities[this.m_indexA].v;let e=t.velocities[this.m_indexA].w;const i=t.velocities[this.m_indexB].v;let s=t.velocities[this.m_indexB].w;const n=S.AddVCrossSV(o,e,this.m_rA,ae.SolveVelocityConstraints_s_vpA),r=S.AddVCrossSV(i,s,this.m_rB,ae.SolveVelocityConstraints_s_vpB),a=S.DotVV(this.m_u,S.SubVV(r,n,S.s_t0)),m=-this.m_mass*(a+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=m;const p=S.MulSV(m,this.m_u,ae.SolveVelocityConstraints_s_P);o.SelfMulSub(this.m_invMassA,p),e-=this.m_invIA*S.CrossVV(this.m_rA,p),i.SelfMulAdd(this.m_invMassB,p),s+=this.m_invIB*S.CrossVV(this.m_rB,p),t.velocities[this.m_indexA].w=e,t.velocities[this.m_indexB].w=s}SolvePositionConstraints(t){if(this.m_frequencyHz>0)return!0;const o=t.positions[this.m_indexA].c;let e=t.positions[this.m_indexA].a;const i=t.positions[this.m_indexB].c;let s=t.positions[this.m_indexB].a;const n=this.m_qA.SetAngle(e),r=this.m_qB.SetAngle(s),a=V.MulRV(n,this.m_lalcA,this.m_rA),p=V.MulRV(r,this.m_lalcB,this.m_rB),l=this.m_u;l.x=i.x+p.x-o.x-a.x,l.y=i.y+p.y-o.y-a.y;let h=this.m_u.Normalize()-this.m_length;h=f(h,-.2,.2);const y=-this.m_mass*h,_=S.MulSV(y,l,ae.SolvePositionConstraints_s_P);return o.SelfMulSub(this.m_invMassA,_),e-=this.m_invIA*S.CrossVV(a,_),i.SelfMulAdd(this.m_invMassB,_),s+=this.m_invIB*S.CrossVV(p,_),t.positions[this.m_indexA].a=e,t.positions[this.m_indexB].a=s,m(h)<.008}}ae.InitVelocityConstraints_s_P=new S,ae.SolveVelocityConstraints_s_vpA=new S,ae.SolveVelocityConstraints_s_vpB=new S,ae.SolveVelocityConstraints_s_P=new S,ae.SolvePositionConstraints_s_P=new S;class me extends ne{constructor(t){super(t),this.m_frequencyHz=0,this.m_dampingRatio=0,this.m_impulse=0,this.m_targetArea=0,this.m_bodies=t.bodies,this.m_frequencyHz=o(t.frequencyHz,0),this.m_dampingRatio=o(t.dampingRatio,0),this.m_targetLengths=a(t.bodies.length),this.m_normals=S.MakeArray(t.bodies.length),this.m_joints=[],this.m_deltas=S.MakeArray(t.bodies.length),this.m_delta=new S;const e=new re;e.frequencyHz=this.m_frequencyHz,e.dampingRatio=this.m_dampingRatio,this.m_targetArea=0;for(let t=0;t<this.m_bodies.length;++t){const o=this.m_bodies[t],i=this.m_bodies[(t+1)%this.m_bodies.length],s=o.GetWorldCenter(),n=i.GetWorldCenter();this.m_targetLengths[t]=S.DistanceVV(s,n),this.m_targetArea+=S.CrossVV(s,n),e.Initialize(o,i,s,n),this.m_joints[t]=o.GetWorld().CreateJoint(e)}this.m_targetArea*=.5}GetAnchorA(t){return t}GetAnchorB(t){return t}GetReactionForce(t,o){return o}GetReactionTorque(t){return 0}SetFrequency(t){this.m_frequencyHz=t;for(let o=0;o<this.m_joints.length;++o)this.m_joints[o].SetFrequency(t)}GetFrequency(){return this.m_frequencyHz}SetDampingRatio(t){this.m_dampingRatio=t;for(let o=0;o<this.m_joints.length;++o)this.m_joints[o].SetDampingRatio(t)}GetDampingRatio(){return this.m_dampingRatio}Dump(t){t("Area joint dumping is not supported.\n")}InitVelocityConstraints(t){for(let o=0;o<this.m_bodies.length;++o){const e=this.m_bodies[(o+this.m_bodies.length-1)%this.m_bodies.length],i=this.m_bodies[(o+1)%this.m_bodies.length],s=t.positions[e.m_islandIndex].c,n=t.positions[i.m_islandIndex].c,r=this.m_deltas[o];S.SubVV(n,s,r)}if(t.step.warmStarting){this.m_impulse*=t.step.dtRatio;for(let o=0;o<this.m_bodies.length;++o){const e=this.m_bodies[o],i=t.velocities[e.m_islandIndex].v,s=this.m_deltas[o];i.x+=e.m_invMass*s.y*.5*this.m_impulse,i.y+=e.m_invMass*-s.x*.5*this.m_impulse}}else this.m_impulse=0}SolveVelocityConstraints(t){let o=0,e=0;for(let i=0;i<this.m_bodies.length;++i){const s=this.m_bodies[i],n=t.velocities[s.m_islandIndex].v,r=this.m_deltas[i];o+=r.LengthSquared()/s.GetMass(),e+=S.CrossVV(n,r)}const i=-2*e/o;this.m_impulse+=i;for(let o=0;o<this.m_bodies.length;++o){const e=this.m_bodies[o],s=t.velocities[e.m_islandIndex].v,n=this.m_deltas[o];s.x+=e.m_invMass*n.y*.5*i,s.y+=e.m_invMass*-n.x*.5*i}}SolvePositionConstraints(t){let o=0,e=0;for(let i=0;i<this.m_bodies.length;++i){const s=this.m_bodies[i],n=this.m_bodies[(i+1)%this.m_bodies.length],r=t.positions[s.m_islandIndex].c,a=t.positions[n.m_islandIndex].c,m=S.SubVV(a,r,this.m_delta);let p=m.Length();p<1e-5&&(p=1),this.m_normals[i].x=m.y/p,this.m_normals[i].y=-m.x/p,o+=p,e+=S.CrossVV(r,a)}e*=.5;const i=.5*(this.m_targetArea-e)/o;let s=!0;for(let o=0;o<this.m_bodies.length;++o){const e=this.m_bodies[o],n=t.positions[e.m_islandIndex].c,r=(o+1)%this.m_bodies.length,a=S.AddVV(this.m_normals[o],this.m_normals[r],this.m_delta);a.SelfMul(i);const m=a.LengthSquared();m>y(.2)&&a.SelfMul(.2/c(m)),m>y(.008)&&(s=!1),n.x+=a.x,n.y+=a.y}return s}}class pe extends ne{constructor(t){super(t),this.m_localAnchorA=new S,this.m_localAnchorB=new S,this.m_linearImpulse=new S,this.m_angularImpulse=0,this.m_maxForce=0,this.m_maxTorque=0,this.m_indexA=0,this.m_indexB=0,this.m_rA=new S,this.m_rB=new S,this.m_localCenterA=new S,this.m_localCenterB=new S,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_linearMass=new v,this.m_angularMass=0,this.m_qA=new V,this.m_qB=new V,this.m_lalcA=new S,this.m_lalcB=new S,this.m_K=new v,this.m_localAnchorA.Copy(t.localAnchorA),this.m_localAnchorB.Copy(t.localAnchorB),this.m_linearImpulse.SetZero(),this.m_maxForce=o(t.maxForce,0),this.m_maxTorque=o(t.maxTorque,0),this.m_linearMass.SetZero()}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const o=t.positions[this.m_indexA].a,e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const s=t.positions[this.m_indexB].a,n=t.velocities[this.m_indexB].v;let r=t.velocities[this.m_indexB].w;const a=this.m_qA.SetAngle(o),m=this.m_qB.SetAngle(s);S.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);const p=V.MulRV(a,this.m_lalcA,this.m_rA);S.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);const l=V.MulRV(m,this.m_lalcB,this.m_rB),f=this.m_invMassA,h=this.m_invMassB,y=this.m_invIA,_=this.m_invIB,c=this.m_K;if(c.ex.x=f+h+y*p.y*p.y+_*l.y*l.y,c.ex.y=-y*p.x*p.y-_*l.x*l.y,c.ey.x=c.ex.y,c.ey.y=f+h+y*p.x*p.x+_*l.x*l.x,c.GetInverse(this.m_linearMass),this.m_angularMass=y+_,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),t.step.warmStarting){this.m_linearImpulse.SelfMul(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;const o=this.m_linearImpulse;e.SelfMulSub(f,o),i-=y*(S.CrossVV(this.m_rA,o)+this.m_angularImpulse),n.SelfMulAdd(h,o),r+=_*(S.CrossVV(this.m_rB,o)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=r}SolveVelocityConstraints(t){const o=t.velocities[this.m_indexA].v;let e=t.velocities[this.m_indexA].w;const i=t.velocities[this.m_indexB].v;let s=t.velocities[this.m_indexB].w;const n=this.m_invMassA,r=this.m_invMassB,a=this.m_invIA,m=this.m_invIB,p=t.step.dt;{const t=s-e;let o=-this.m_angularMass*t;const i=this.m_angularImpulse,n=p*this.m_maxTorque;this.m_angularImpulse=f(this.m_angularImpulse+o,-n,n),o=this.m_angularImpulse-i,e-=a*o,s+=m*o}{const t=S.SubVV(S.AddVCrossSV(i,s,this.m_rB,S.s_t0),S.AddVCrossSV(o,e,this.m_rA,S.s_t1),pe.SolveVelocityConstraints_s_Cdot_v2),l=v.MulMV(this.m_linearMass,t,pe.SolveVelocityConstraints_s_impulseV).SelfNeg(),f=pe.SolveVelocityConstraints_s_oldImpulseV.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(l);const h=p*this.m_maxForce;this.m_linearImpulse.LengthSquared()>h*h&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(h)),S.SubVV(this.m_linearImpulse,f,l),o.SelfMulSub(n,l),e-=a*S.CrossVV(this.m_rA,l),i.SelfMulAdd(r,l),s+=m*S.CrossVV(this.m_rB,l)}t.velocities[this.m_indexA].w=e,t.velocities[this.m_indexB].w=s}SolvePositionConstraints(t){return!0}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,o){return o.x=t*this.m_linearImpulse.x,o.y=t*this.m_linearImpulse.y,o}GetReactionTorque(t){return t*this.m_angularImpulse}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}SetMaxForce(t){this.m_maxForce=t}GetMaxForce(){return this.m_maxForce}SetMaxTorque(t){this.m_maxTorque=t}GetMaxTorque(){return this.m_maxTorque}Dump(t){const o=this.m_bodyA.m_islandIndex,e=this.m_bodyB.m_islandIndex;t("  const jd: b2FrictionJointDef = new b2FrictionJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",o),t("  jd.bodyB = bodies[%d];\n",e),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.maxForce = %.15f;\n",this.m_maxForce),t("  jd.maxTorque = %.15f;\n",this.m_maxTorque),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}pe.SolveVelocityConstraints_s_Cdot_v2=new S,pe.SolveVelocityConstraints_s_impulseV=new S,pe.SolveVelocityConstraints_s_oldImpulseV=new S;class le extends ne{constructor(e){let i,s;super(e),this.m_typeA=t.b2JointType.e_unknownJoint,this.m_typeB=t.b2JointType.e_unknownJoint,this.m_localAnchorA=new S,this.m_localAnchorB=new S,this.m_localAnchorC=new S,this.m_localAnchorD=new S,this.m_localAxisC=new S,this.m_localAxisD=new S,this.m_referenceAngleA=0,this.m_referenceAngleB=0,this.m_constant=0,this.m_ratio=0,this.m_impulse=0,this.m_indexA=0,this.m_indexB=0,this.m_indexC=0,this.m_indexD=0,this.m_lcA=new S,this.m_lcB=new S,this.m_lcC=new S,this.m_lcD=new S,this.m_mA=0,this.m_mB=0,this.m_mC=0,this.m_mD=0,this.m_iA=0,this.m_iB=0,this.m_iC=0,this.m_iD=0,this.m_JvAC=new S,this.m_JvBD=new S,this.m_JwA=0,this.m_JwB=0,this.m_JwC=0,this.m_JwD=0,this.m_mass=0,this.m_qA=new V,this.m_qB=new V,this.m_qC=new V,this.m_qD=new V,this.m_lalcA=new S,this.m_lalcB=new S,this.m_lalcC=new S,this.m_lalcD=new S,this.m_joint1=e.joint1,this.m_joint2=e.joint2,this.m_typeA=this.m_joint1.GetType(),this.m_typeB=this.m_joint2.GetType(),this.m_bodyC=this.m_joint1.GetBodyA(),this.m_bodyA=this.m_joint1.GetBodyB();const n=this.m_bodyA.m_xf,r=this.m_bodyA.m_sweep.a,a=this.m_bodyC.m_xf,m=this.m_bodyC.m_sweep.a;if(this.m_typeA===t.b2JointType.e_revoluteJoint){const t=e.joint1;this.m_localAnchorC.Copy(t.m_localAnchorA),this.m_localAnchorA.Copy(t.m_localAnchorB),this.m_referenceAngleA=t.m_referenceAngle,this.m_localAxisC.SetZero(),i=r-m-this.m_referenceAngleA}else{const t=e.joint1;this.m_localAnchorC.Copy(t.m_localAnchorA),this.m_localAnchorA.Copy(t.m_localAnchorB),this.m_referenceAngleA=t.m_referenceAngle,this.m_localAxisC.Copy(t.m_localXAxisA);const o=this.m_localAnchorC,s=V.MulTRV(a.q,S.AddVV(V.MulRV(n.q,this.m_localAnchorA,S.s_t0),S.SubVV(n.p,a.p,S.s_t1),S.s_t0),S.s_t0);i=S.DotVV(S.SubVV(s,o,S.s_t0),this.m_localAxisC)}this.m_bodyD=this.m_joint2.GetBodyA(),this.m_bodyB=this.m_joint2.GetBodyB();const p=this.m_bodyB.m_xf,l=this.m_bodyB.m_sweep.a,f=this.m_bodyD.m_xf,h=this.m_bodyD.m_sweep.a;if(this.m_typeB===t.b2JointType.e_revoluteJoint){const t=e.joint2;this.m_localAnchorD.Copy(t.m_localAnchorA),this.m_localAnchorB.Copy(t.m_localAnchorB),this.m_referenceAngleB=t.m_referenceAngle,this.m_localAxisD.SetZero(),s=l-h-this.m_referenceAngleB}else{const t=e.joint2;this.m_localAnchorD.Copy(t.m_localAnchorA),this.m_localAnchorB.Copy(t.m_localAnchorB),this.m_referenceAngleB=t.m_referenceAngle,this.m_localAxisD.Copy(t.m_localXAxisA);const o=this.m_localAnchorD,i=V.MulTRV(f.q,S.AddVV(V.MulRV(p.q,this.m_localAnchorB,S.s_t0),S.SubVV(p.p,f.p,S.s_t1),S.s_t0),S.s_t0);s=S.DotVV(S.SubVV(i,o,S.s_t0),this.m_localAxisD)}this.m_ratio=o(e.ratio,1),this.m_constant=i+this.m_ratio*s,this.m_impulse=0}InitVelocityConstraints(o){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_indexC=this.m_bodyC.m_islandIndex,this.m_indexD=this.m_bodyD.m_islandIndex,this.m_lcA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_lcB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_lcC.Copy(this.m_bodyC.m_sweep.localCenter),this.m_lcD.Copy(this.m_bodyD.m_sweep.localCenter),this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;const e=o.positions[this.m_indexA].a,i=o.velocities[this.m_indexA].v;let s=o.velocities[this.m_indexA].w;const n=o.positions[this.m_indexB].a,r=o.velocities[this.m_indexB].v;let a=o.velocities[this.m_indexB].w;const m=o.positions[this.m_indexC].a,p=o.velocities[this.m_indexC].v;let l=o.velocities[this.m_indexC].w;const f=o.positions[this.m_indexD].a,h=o.velocities[this.m_indexD].v;let y=o.velocities[this.m_indexD].w;const _=this.m_qA.SetAngle(e),c=this.m_qB.SetAngle(n),C=this.m_qC.SetAngle(m),u=this.m_qD.SetAngle(f);if(this.m_mass=0,this.m_typeA===t.b2JointType.e_revoluteJoint)this.m_JvAC.SetZero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{const t=V.MulRV(C,this.m_localAxisC,le.InitVelocityConstraints_s_u);S.SubVV(this.m_localAnchorC,this.m_lcC,this.m_lalcC);const o=V.MulRV(C,this.m_lalcC,le.InitVelocityConstraints_s_rC);S.SubVV(this.m_localAnchorA,this.m_lcA,this.m_lalcA);const e=V.MulRV(_,this.m_lalcA,le.InitVelocityConstraints_s_rA);this.m_JvAC.Copy(t),this.m_JwC=S.CrossVV(o,t),this.m_JwA=S.CrossVV(e,t),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_typeB===t.b2JointType.e_revoluteJoint)this.m_JvBD.SetZero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{const t=V.MulRV(u,this.m_localAxisD,le.InitVelocityConstraints_s_u);S.SubVV(this.m_localAnchorD,this.m_lcD,this.m_lalcD);const o=V.MulRV(u,this.m_lalcD,le.InitVelocityConstraints_s_rD);S.SubVV(this.m_localAnchorB,this.m_lcB,this.m_lalcB);const e=V.MulRV(c,this.m_lalcB,le.InitVelocityConstraints_s_rB);S.MulSV(this.m_ratio,t,this.m_JvBD),this.m_JwD=this.m_ratio*S.CrossVV(o,t),this.m_JwB=this.m_ratio*S.CrossVV(e,t),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,o.step.warmStarting?(i.SelfMulAdd(this.m_mA*this.m_impulse,this.m_JvAC),s+=this.m_iA*this.m_impulse*this.m_JwA,r.SelfMulAdd(this.m_mB*this.m_impulse,this.m_JvBD),a+=this.m_iB*this.m_impulse*this.m_JwB,p.SelfMulSub(this.m_mC*this.m_impulse,this.m_JvAC),l-=this.m_iC*this.m_impulse*this.m_JwC,h.SelfMulSub(this.m_mD*this.m_impulse,this.m_JvBD),y-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,o.velocities[this.m_indexA].w=s,o.velocities[this.m_indexB].w=a,o.velocities[this.m_indexC].w=l,o.velocities[this.m_indexD].w=y}SolveVelocityConstraints(t){const o=t.velocities[this.m_indexA].v;let e=t.velocities[this.m_indexA].w;const i=t.velocities[this.m_indexB].v;let s=t.velocities[this.m_indexB].w;const n=t.velocities[this.m_indexC].v;let r=t.velocities[this.m_indexC].w;const a=t.velocities[this.m_indexD].v;let m=t.velocities[this.m_indexD].w,p=S.DotVV(this.m_JvAC,S.SubVV(o,n,S.s_t0))+S.DotVV(this.m_JvBD,S.SubVV(i,a,S.s_t0));p+=this.m_JwA*e-this.m_JwC*r+(this.m_JwB*s-this.m_JwD*m);const l=-this.m_mass*p;this.m_impulse+=l,o.SelfMulAdd(this.m_mA*l,this.m_JvAC),e+=this.m_iA*l*this.m_JwA,i.SelfMulAdd(this.m_mB*l,this.m_JvBD),s+=this.m_iB*l*this.m_JwB,n.SelfMulSub(this.m_mC*l,this.m_JvAC),r-=this.m_iC*l*this.m_JwC,a.SelfMulSub(this.m_mD*l,this.m_JvBD),m-=this.m_iD*l*this.m_JwD,t.velocities[this.m_indexA].w=e,t.velocities[this.m_indexB].w=s,t.velocities[this.m_indexC].w=r,t.velocities[this.m_indexD].w=m}SolvePositionConstraints(o){const e=o.positions[this.m_indexA].c;let i=o.positions[this.m_indexA].a;const s=o.positions[this.m_indexB].c;let n=o.positions[this.m_indexB].a;const r=o.positions[this.m_indexC].c;let a=o.positions[this.m_indexC].a;const m=o.positions[this.m_indexD].c;let p=o.positions[this.m_indexD].a;const l=this.m_qA.SetAngle(i),f=this.m_qB.SetAngle(n),h=this.m_qC.SetAngle(a),y=this.m_qD.SetAngle(p);let _,c;const C=this.m_JvAC,u=this.m_JvBD;let d,x,g,B,b=0;if(this.m_typeA===t.b2JointType.e_revoluteJoint)C.SetZero(),d=1,g=1,b+=this.m_iA+this.m_iC,_=i-a-this.m_referenceAngleA;else{const t=V.MulRV(h,this.m_localAxisC,le.SolvePositionConstraints_s_u),o=V.MulRV(h,this.m_lalcC,le.SolvePositionConstraints_s_rC),i=V.MulRV(l,this.m_lalcA,le.SolvePositionConstraints_s_rA);C.Copy(t),g=S.CrossVV(o,t),d=S.CrossVV(i,t),b+=this.m_mC+this.m_mA+this.m_iC*g*g+this.m_iA*d*d;const s=this.m_lalcC,n=V.MulTRV(h,S.AddVV(i,S.SubVV(e,r,S.s_t0),S.s_t0),S.s_t0);_=S.DotVV(S.SubVV(n,s,S.s_t0),this.m_localAxisC)}if(this.m_typeB===t.b2JointType.e_revoluteJoint)u.SetZero(),x=this.m_ratio,B=this.m_ratio,b+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),c=n-p-this.m_referenceAngleB;else{const t=V.MulRV(y,this.m_localAxisD,le.SolvePositionConstraints_s_u),o=V.MulRV(y,this.m_lalcD,le.SolvePositionConstraints_s_rD),e=V.MulRV(f,this.m_lalcB,le.SolvePositionConstraints_s_rB);S.MulSV(this.m_ratio,t,u),B=this.m_ratio*S.CrossVV(o,t),x=this.m_ratio*S.CrossVV(e,t),b+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*B*B+this.m_iB*x*x;const i=this.m_lalcD,n=V.MulTRV(y,S.AddVV(e,S.SubVV(s,m,S.s_t0),S.s_t0),S.s_t0);c=S.DotVV(S.SubVV(n,i,S.s_t0),this.m_localAxisD)}const A=_+this.m_ratio*c-this.m_constant;let v=0;return b>0&&(v=-A/b),e.SelfMulAdd(this.m_mA*v,C),i+=this.m_iA*v*d,s.SelfMulAdd(this.m_mB*v,u),n+=this.m_iB*v*x,r.SelfMulSub(this.m_mC*v,C),a-=this.m_iC*v*g,m.SelfMulSub(this.m_mD*v,u),p-=this.m_iD*v*B,o.positions[this.m_indexA].a=i,o.positions[this.m_indexB].a=n,o.positions[this.m_indexC].a=a,o.positions[this.m_indexD].a=p,!0}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,o){return S.MulSV(t*this.m_impulse,this.m_JvAC,o)}GetReactionTorque(t){return t*this.m_impulse*this.m_JwA}GetJoint1(){return this.m_joint1}GetJoint2(){return this.m_joint2}GetRatio(){return this.m_ratio}SetRatio(t){this.m_ratio=t}Dump(t){const o=this.m_bodyA.m_islandIndex,e=this.m_bodyB.m_islandIndex,i=this.m_joint1.m_index,s=this.m_joint2.m_index;t("  const jd: b2GearJointDef = new b2GearJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",o),t("  jd.bodyB = bodies[%d];\n",e),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.joint1 = joints[%d];\n",i),t("  jd.joint2 = joints[%d];\n",s),t("  jd.ratio = %.15f;\n",this.m_ratio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}le.InitVelocityConstraints_s_u=new S,le.InitVelocityConstraints_s_rA=new S,le.InitVelocityConstraints_s_rB=new S,le.InitVelocityConstraints_s_rC=new S,le.InitVelocityConstraints_s_rD=new S,le.SolvePositionConstraints_s_u=new S,le.SolvePositionConstraints_s_rA=new S,le.SolvePositionConstraints_s_rB=new S,le.SolvePositionConstraints_s_rC=new S,le.SolvePositionConstraints_s_rD=new S;class fe extends ne{constructor(t){super(t),this.m_linearOffset=new S,this.m_angularOffset=0,this.m_linearImpulse=new S,this.m_angularImpulse=0,this.m_maxForce=0,this.m_maxTorque=0,this.m_correctionFactor=.3,this.m_indexA=0,this.m_indexB=0,this.m_rA=new S,this.m_rB=new S,this.m_localCenterA=new S,this.m_localCenterB=new S,this.m_linearError=new S,this.m_angularError=0,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_linearMass=new v,this.m_angularMass=0,this.m_qA=new V,this.m_qB=new V,this.m_K=new v,this.m_linearOffset.Copy(o(t.linearOffset,S.ZERO)),this.m_linearImpulse.SetZero(),this.m_maxForce=o(t.maxForce,0),this.m_maxTorque=o(t.maxTorque,0),this.m_correctionFactor=o(t.correctionFactor,.3)}GetAnchorA(t){const o=this.m_bodyA.GetPosition();return t.x=o.x,t.y=o.y,t}GetAnchorB(t){const o=this.m_bodyB.GetPosition();return t.x=o.x,t.y=o.y,t}GetReactionForce(t,o){return S.MulSV(t,this.m_linearImpulse,o)}GetReactionTorque(t){return t*this.m_angularImpulse}SetLinearOffset(t){S.IsEqualToV(t,this.m_linearOffset)||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_linearOffset.Copy(t))}GetLinearOffset(){return this.m_linearOffset}SetAngularOffset(t){t!==this.m_angularOffset&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_angularOffset=t)}GetAngularOffset(){return this.m_angularOffset}SetMaxForce(t){this.m_maxForce=t}GetMaxForce(){return this.m_maxForce}SetMaxTorque(t){this.m_maxTorque=t}GetMaxTorque(){return this.m_maxTorque}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const o=t.positions[this.m_indexA].c,e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v;let s=t.velocities[this.m_indexA].w;const n=t.positions[this.m_indexB].c,r=t.positions[this.m_indexB].a,a=t.velocities[this.m_indexB].v;let m=t.velocities[this.m_indexB].w;const p=this.m_qA.SetAngle(e),l=this.m_qB.SetAngle(r),f=V.MulRV(p,S.SubVV(this.m_linearOffset,this.m_localCenterA,S.s_t0),this.m_rA),h=V.MulRV(l,S.NegV(this.m_localCenterB,S.s_t0),this.m_rB),y=this.m_invMassA,_=this.m_invMassB,c=this.m_invIA,C=this.m_invIB,u=this.m_K;if(u.ex.x=y+_+c*f.y*f.y+C*h.y*h.y,u.ex.y=-c*f.x*f.y-C*h.x*h.y,u.ey.x=u.ex.y,u.ey.y=y+_+c*f.x*f.x+C*h.x*h.x,u.GetInverse(this.m_linearMass),this.m_angularMass=c+C,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),S.SubVV(S.AddVV(n,h,S.s_t0),S.AddVV(o,f,S.s_t1),this.m_linearError),this.m_angularError=r-e-this.m_angularOffset,t.step.warmStarting){this.m_linearImpulse.SelfMul(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;const o=this.m_linearImpulse;i.SelfMulSub(y,o),s-=c*(S.CrossVV(f,o)+this.m_angularImpulse),a.SelfMulAdd(_,o),m+=C*(S.CrossVV(h,o)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=m}SolveVelocityConstraints(t){const o=t.velocities[this.m_indexA].v;let e=t.velocities[this.m_indexA].w;const i=t.velocities[this.m_indexB].v;let s=t.velocities[this.m_indexB].w;const n=this.m_invMassA,r=this.m_invMassB,a=this.m_invIA,m=this.m_invIB,p=t.step.dt,l=t.step.inv_dt;{const t=s-e+l*this.m_correctionFactor*this.m_angularError;let o=-this.m_angularMass*t;const i=this.m_angularImpulse,n=p*this.m_maxTorque;this.m_angularImpulse=f(this.m_angularImpulse+o,-n,n),o=this.m_angularImpulse-i,e-=a*o,s+=m*o}{const t=this.m_rA,f=this.m_rB,h=S.AddVV(S.SubVV(S.AddVV(i,S.CrossSV(s,f,S.s_t0),S.s_t0),S.AddVV(o,S.CrossSV(e,t,S.s_t1),S.s_t1),S.s_t2),S.MulSV(l*this.m_correctionFactor,this.m_linearError,S.s_t3),fe.SolveVelocityConstraints_s_Cdot_v2),y=v.MulMV(this.m_linearMass,h,fe.SolveVelocityConstraints_s_impulse_v2).SelfNeg(),_=fe.SolveVelocityConstraints_s_oldImpulse_v2.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(y);const c=p*this.m_maxForce;this.m_linearImpulse.LengthSquared()>c*c&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(c)),S.SubVV(this.m_linearImpulse,_,y),o.SelfMulSub(n,y),e-=a*S.CrossVV(t,y),i.SelfMulAdd(r,y),s+=m*S.CrossVV(f,y)}t.velocities[this.m_indexA].w=e,t.velocities[this.m_indexB].w=s}SolvePositionConstraints(t){return!0}Dump(t){const o=this.m_bodyA.m_islandIndex,e=this.m_bodyB.m_islandIndex;t("  const jd: b2MotorJointDef = new b2MotorJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",o),t("  jd.bodyB = bodies[%d];\n",e),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.linearOffset.Set(%.15f, %.15f);\n",this.m_linearOffset.x,this.m_linearOffset.y),t("  jd.angularOffset = %.15f;\n",this.m_angularOffset),t("  jd.maxForce = %.15f;\n",this.m_maxForce),t("  jd.maxTorque = %.15f;\n",this.m_maxTorque),t("  jd.correctionFactor = %.15f;\n",this.m_correctionFactor),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}fe.SolveVelocityConstraints_s_Cdot_v2=new S,fe.SolveVelocityConstraints_s_impulse_v2=new S,fe.SolveVelocityConstraints_s_oldImpulse_v2=new S;class he extends ne{constructor(t){super(t),this.m_localAnchorB=new S,this.m_targetA=new S,this.m_frequencyHz=0,this.m_dampingRatio=0,this.m_beta=0,this.m_impulse=new S,this.m_maxForce=0,this.m_gamma=0,this.m_indexA=0,this.m_indexB=0,this.m_rB=new S,this.m_localCenterB=new S,this.m_invMassB=0,this.m_invIB=0,this.m_mass=new v,this.m_C=new S,this.m_qB=new V,this.m_lalcB=new S,this.m_K=new v,this.m_targetA.Copy(o(t.target,S.ZERO)),M.MulTXV(this.m_bodyB.GetTransform(),this.m_targetA,this.m_localAnchorB),this.m_maxForce=o(t.maxForce,0),this.m_impulse.SetZero(),this.m_frequencyHz=o(t.frequencyHz,0),this.m_dampingRatio=o(t.dampingRatio,0),this.m_beta=0,this.m_gamma=0}SetTarget(t){this.m_bodyB.IsAwake()||this.m_bodyB.SetAwake(!0),this.m_targetA.Copy(t)}GetTarget(){return this.m_targetA}SetMaxForce(t){this.m_maxForce=t}GetMaxForce(){return this.m_maxForce}SetFrequency(t){this.m_frequencyHz=t}GetFrequency(){return this.m_frequencyHz}SetDampingRatio(t){this.m_dampingRatio=t}GetDampingRatio(){return this.m_dampingRatio}InitVelocityConstraints(t){this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;const o=t.positions[this.m_indexB].c,i=t.positions[this.m_indexB].a,s=t.velocities[this.m_indexB].v;let n=t.velocities[this.m_indexB].w;const r=this.m_qB.SetAngle(i),a=this.m_bodyB.GetMass(),m=2*e*this.m_frequencyHz,p=2*a*this.m_dampingRatio*m,l=a*(m*m),f=t.step.dt;this.m_gamma=f*(p+f*l),0!==this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_beta=f*l*this.m_gamma,S.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),V.MulRV(r,this.m_lalcB,this.m_rB);const h=this.m_K;h.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,h.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,h.ey.x=h.ex.y,h.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,h.GetInverse(this.m_mass),this.m_C.x=o.x+this.m_rB.x-this.m_targetA.x,this.m_C.y=o.y+this.m_rB.y-this.m_targetA.y,this.m_C.SelfMul(this.m_beta),n*=.98,t.step.warmStarting?(this.m_impulse.SelfMul(t.step.dtRatio),s.x+=this.m_invMassB*this.m_impulse.x,s.y+=this.m_invMassB*this.m_impulse.y,n+=this.m_invIB*S.CrossVV(this.m_rB,this.m_impulse)):this.m_impulse.SetZero(),t.velocities[this.m_indexB].w=n}SolveVelocityConstraints(t){const o=t.velocities[this.m_indexB].v;let e=t.velocities[this.m_indexB].w;const i=S.AddVCrossSV(o,e,this.m_rB,he.SolveVelocityConstraints_s_Cdot),s=v.MulMV(this.m_mass,S.AddVV(i,S.AddVV(this.m_C,S.MulSV(this.m_gamma,this.m_impulse,S.s_t0),S.s_t0),S.s_t0).SelfNeg(),he.SolveVelocityConstraints_s_impulse),n=he.SolveVelocityConstraints_s_oldImpulse.Copy(this.m_impulse);this.m_impulse.SelfAdd(s);const r=t.step.dt*this.m_maxForce;this.m_impulse.LengthSquared()>r*r&&this.m_impulse.SelfMul(r/this.m_impulse.Length()),S.SubVV(this.m_impulse,n,s),o.SelfMulAdd(this.m_invMassB,s),e+=this.m_invIB*S.CrossVV(this.m_rB,s),t.velocities[this.m_indexB].w=e}SolvePositionConstraints(t){return!0}GetAnchorA(t){return t.x=this.m_targetA.x,t.y=this.m_targetA.y,t}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,o){return S.MulSV(t,this.m_impulse,o)}GetReactionTorque(t){return 0}Dump(t){t("Mouse joint dumping is not supported.\n")}ShiftOrigin(t){this.m_targetA.SelfSub(t)}}he.SolveVelocityConstraints_s_Cdot=new S,he.SolveVelocityConstraints_s_impulse=new S,he.SolveVelocityConstraints_s_oldImpulse=new S;class ye extends ne{constructor(e){super(e),this.m_localAnchorA=new S,this.m_localAnchorB=new S,this.m_localXAxisA=new S,this.m_localYAxisA=new S,this.m_referenceAngle=0,this.m_impulse=new A(0,0,0),this.m_motorImpulse=0,this.m_lowerTranslation=0,this.m_upperTranslation=0,this.m_maxMotorForce=0,this.m_motorSpeed=0,this.m_enableLimit=!1,this.m_enableMotor=!1,this.m_limitState=t.b2LimitState.e_inactiveLimit,this.m_indexA=0,this.m_indexB=0,this.m_localCenterA=new S,this.m_localCenterB=new S,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_axis=new S(0,0),this.m_perp=new S(0,0),this.m_s1=0,this.m_s2=0,this.m_a1=0,this.m_a2=0,this.m_K=new w,this.m_K3=new w,this.m_K2=new v,this.m_motorMass=0,this.m_qA=new V,this.m_qB=new V,this.m_lalcA=new S,this.m_lalcB=new S,this.m_rA=new S,this.m_rB=new S,this.m_localAnchorA.Copy(o(e.localAnchorA,S.ZERO)),this.m_localAnchorB.Copy(o(e.localAnchorB,S.ZERO)),this.m_localXAxisA.Copy(o(e.localAxisA,new S(1,0))).SelfNormalize(),S.CrossOneV(this.m_localXAxisA,this.m_localYAxisA),this.m_referenceAngle=o(e.referenceAngle,0),this.m_lowerTranslation=o(e.lowerTranslation,0),this.m_upperTranslation=o(e.upperTranslation,0),this.m_maxMotorForce=o(e.maxMotorForce,0),this.m_motorSpeed=o(e.motorSpeed,0),this.m_enableLimit=o(e.enableLimit,!1),this.m_enableMotor=o(e.enableMotor,!1)}InitVelocityConstraints(o){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=o.positions[this.m_indexA].c,i=o.positions[this.m_indexA].a,s=o.velocities[this.m_indexA].v;let n=o.velocities[this.m_indexA].w;const r=o.positions[this.m_indexB].c,a=o.positions[this.m_indexB].a,p=o.velocities[this.m_indexB].v;let l=o.velocities[this.m_indexB].w;const f=this.m_qA.SetAngle(i),h=this.m_qB.SetAngle(a);S.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);const y=V.MulRV(f,this.m_lalcA,this.m_rA);S.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);const _=V.MulRV(h,this.m_lalcB,this.m_rB),c=S.AddVV(S.SubVV(r,e,S.s_t0),S.SubVV(_,y,S.s_t1),ye.InitVelocityConstraints_s_d),C=this.m_invMassA,u=this.m_invMassB,d=this.m_invIA,x=this.m_invIB;if(V.MulRV(f,this.m_localXAxisA,this.m_axis),this.m_a1=S.CrossVV(S.AddVV(c,y,S.s_t0),this.m_axis),this.m_a2=S.CrossVV(_,this.m_axis),this.m_motorMass=C+u+d*this.m_a1*this.m_a1+x*this.m_a2*this.m_a2,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),V.MulRV(f,this.m_localYAxisA,this.m_perp),this.m_s1=S.CrossVV(S.AddVV(c,y,S.s_t0),this.m_perp),this.m_s2=S.CrossVV(_,this.m_perp),this.m_K.ex.x=C+u+d*this.m_s1*this.m_s1+x*this.m_s2*this.m_s2,this.m_K.ex.y=d*this.m_s1+x*this.m_s2,this.m_K.ex.z=d*this.m_s1*this.m_a1+x*this.m_s2*this.m_a2,this.m_K.ey.x=this.m_K.ex.y,this.m_K.ey.y=d+x,0===this.m_K.ey.y&&(this.m_K.ey.y=1),this.m_K.ey.z=d*this.m_a1+x*this.m_a2,this.m_K.ez.x=this.m_K.ex.z,this.m_K.ez.y=this.m_K.ey.z,this.m_K.ez.z=C+u+d*this.m_a1*this.m_a1+x*this.m_a2*this.m_a2,this.m_enableLimit){const o=S.DotVV(this.m_axis,c);m(this.m_upperTranslation-this.m_lowerTranslation)<.016?this.m_limitState=t.b2LimitState.e_equalLimits:o<=this.m_lowerTranslation?this.m_limitState!==t.b2LimitState.e_atLowerLimit&&(this.m_limitState=t.b2LimitState.e_atLowerLimit,this.m_impulse.z=0):o>=this.m_upperTranslation?this.m_limitState!==t.b2LimitState.e_atUpperLimit&&(this.m_limitState=t.b2LimitState.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=t.b2LimitState.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=t.b2LimitState.e_inactiveLimit,this.m_impulse.z=0;if(this.m_enableMotor||(this.m_motorImpulse=0),o.step.warmStarting){this.m_impulse.SelfMul(o.step.dtRatio),this.m_motorImpulse*=o.step.dtRatio;const t=S.AddVV(S.MulSV(this.m_impulse.x,this.m_perp,S.s_t0),S.MulSV(this.m_motorImpulse+this.m_impulse.z,this.m_axis,S.s_t1),ye.InitVelocityConstraints_s_P),e=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,i=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;s.SelfMulSub(C,t),n-=d*e,p.SelfMulAdd(u,t),l+=x*i}else this.m_impulse.SetZero(),this.m_motorImpulse=0;o.velocities[this.m_indexA].w=n,o.velocities[this.m_indexB].w=l}SolveVelocityConstraints(o){const e=o.velocities[this.m_indexA].v;let i=o.velocities[this.m_indexA].w;const s=o.velocities[this.m_indexB].v;let n=o.velocities[this.m_indexB].w;const r=this.m_invMassA,a=this.m_invMassB,m=this.m_invIA,h=this.m_invIB;if(this.m_enableMotor&&this.m_limitState!==t.b2LimitState.e_equalLimits){const t=S.DotVV(this.m_axis,S.SubVV(s,e,S.s_t0))+this.m_a2*n-this.m_a1*i;let p=this.m_motorMass*(this.m_motorSpeed-t);const l=this.m_motorImpulse,y=o.step.dt*this.m_maxMotorForce;this.m_motorImpulse=f(this.m_motorImpulse+p,-y,y),p=this.m_motorImpulse-l;const _=S.MulSV(p,this.m_axis,ye.SolveVelocityConstraints_s_P),c=p*this.m_a1,C=p*this.m_a2;e.SelfMulSub(r,_),i-=m*c,s.SelfMulAdd(a,_),n+=h*C}const y=S.DotVV(this.m_perp,S.SubVV(s,e,S.s_t0))+this.m_s2*n-this.m_s1*i,_=n-i;if(this.m_enableLimit&&this.m_limitState!==t.b2LimitState.e_inactiveLimit){const o=S.DotVV(this.m_axis,S.SubVV(s,e,S.s_t0))+this.m_a2*n-this.m_a1*i,f=ye.SolveVelocityConstraints_s_f1.Copy(this.m_impulse),c=this.m_K.Solve33(-y,-_,-o,ye.SolveVelocityConstraints_s_df3);this.m_impulse.SelfAdd(c),this.m_limitState===t.b2LimitState.e_atLowerLimit?this.m_impulse.z=l(this.m_impulse.z,0):this.m_limitState===t.b2LimitState.e_atUpperLimit&&(this.m_impulse.z=p(this.m_impulse.z,0));const C=-y-(this.m_impulse.z-f.z)*this.m_K.ez.x,u=-_-(this.m_impulse.z-f.z)*this.m_K.ez.y,d=this.m_K.Solve22(C,u,ye.SolveVelocityConstraints_s_f2r);d.x+=f.x,d.y+=f.y,this.m_impulse.x=d.x,this.m_impulse.y=d.y,c.x=this.m_impulse.x-f.x,c.y=this.m_impulse.y-f.y,c.z=this.m_impulse.z-f.z;const x=S.AddVV(S.MulSV(c.x,this.m_perp,S.s_t0),S.MulSV(c.z,this.m_axis,S.s_t1),ye.SolveVelocityConstraints_s_P),g=c.x*this.m_s1+c.y+c.z*this.m_a1,B=c.x*this.m_s2+c.y+c.z*this.m_a2;e.SelfMulSub(r,x),i-=m*g,s.SelfMulAdd(a,x),n+=h*B}else{const t=this.m_K.Solve22(-y,-_,ye.SolveVelocityConstraints_s_df2);this.m_impulse.x+=t.x,this.m_impulse.y+=t.y;const o=S.MulSV(t.x,this.m_perp,ye.SolveVelocityConstraints_s_P),p=t.x*this.m_s1+t.y,l=t.x*this.m_s2+t.y;e.SelfMulSub(r,o),i-=m*p,s.SelfMulAdd(a,o),n+=h*l}o.velocities[this.m_indexA].w=i,o.velocities[this.m_indexB].w=n}SolvePositionConstraints(t){const o=t.positions[this.m_indexA].c;let e=t.positions[this.m_indexA].a;const s=t.positions[this.m_indexB].c;let n=t.positions[this.m_indexB].a;const r=this.m_qA.SetAngle(e),a=this.m_qB.SetAngle(n),p=this.m_invMassA,h=this.m_invMassB,y=this.m_invIA,_=this.m_invIB,c=V.MulRV(r,this.m_lalcA,this.m_rA),C=V.MulRV(a,this.m_lalcB,this.m_rB),u=S.SubVV(S.AddVV(s,C,S.s_t0),S.AddVV(o,c,S.s_t1),ye.SolvePositionConstraints_s_d),d=V.MulRV(r,this.m_localXAxisA,this.m_axis),x=S.CrossVV(S.AddVV(u,c,S.s_t0),d),g=S.CrossVV(C,d),B=V.MulRV(r,this.m_localYAxisA,this.m_perp),b=S.CrossVV(S.AddVV(u,c,S.s_t0),B),A=S.CrossVV(C,B);let v=ye.SolvePositionConstraints_s_impulse;const w=S.DotVV(B,u),M=n-e-this.m_referenceAngle;let P=m(w);const I=m(M);let G=!1,D=0;if(this.m_enableLimit){const t=S.DotVV(d,u);m(this.m_upperTranslation-this.m_lowerTranslation)<.016?(D=f(t,-.2,.2),P=l(P,m(t)),G=!0):t<=this.m_lowerTranslation?(D=f(t-this.m_lowerTranslation+.008,-.2,0),P=l(P,this.m_lowerTranslation-t),G=!0):t>=this.m_upperTranslation&&(D=f(t-this.m_upperTranslation-.008,0,.2),P=l(P,t-this.m_upperTranslation),G=!0)}if(G){const t=p+h+y*b*b+_*A*A,o=y*b+_*A,e=y*b*x+_*A*g;let i=y+_;0===i&&(i=1);const s=y*x+_*g,n=p+h+y*x*x+_*g*g,r=this.m_K3;r.ex.SetXYZ(t,o,e),r.ey.SetXYZ(o,i,s),r.ez.SetXYZ(e,s,n),v=r.Solve33(-w,-M,-D,v)}else{const t=p+h+y*b*b+_*A*A,o=y*b+_*A;let e=y+_;0===e&&(e=1);const i=this.m_K2;i.ex.Set(t,o),i.ey.Set(o,e);const s=i.Solve(-w,-M,ye.SolvePositionConstraints_s_impulse1);v.x=s.x,v.y=s.y,v.z=0}const T=S.AddVV(S.MulSV(v.x,B,S.s_t0),S.MulSV(v.z,d,S.s_t1),ye.SolvePositionConstraints_s_P),F=v.x*b+v.y+v.z*x,L=v.x*A+v.y+v.z*g;return o.SelfMulSub(p,T),e-=y*F,s.SelfMulAdd(h,T),n+=_*L,t.positions[this.m_indexA].a=e,t.positions[this.m_indexB].a=n,P<=.008&&I<=i}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,o){return o.x=t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),o.y=t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y),o}GetReactionTorque(t){return t*this.m_impulse.y}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}GetLocalAxisA(){return this.m_localXAxisA}GetReferenceAngle(){return this.m_referenceAngle}GetJointTranslation(){const t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,ye.GetJointTranslation_s_pA),o=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,ye.GetJointTranslation_s_pB),e=S.SubVV(o,t,ye.GetJointTranslation_s_d),i=this.m_bodyA.GetWorldVector(this.m_localXAxisA,ye.GetJointTranslation_s_axis);return S.DotVV(e,i)}GetJointSpeed(){const t=this.m_bodyA,o=this.m_bodyB;S.SubVV(this.m_localAnchorA,t.m_sweep.localCenter,this.m_lalcA);const e=V.MulRV(t.m_xf.q,this.m_lalcA,this.m_rA);S.SubVV(this.m_localAnchorB,o.m_sweep.localCenter,this.m_lalcB);const i=V.MulRV(o.m_xf.q,this.m_lalcB,this.m_rB),s=S.AddVV(t.m_sweep.c,e,S.s_t0),n=S.AddVV(o.m_sweep.c,i,S.s_t1),r=S.SubVV(n,s,S.s_t2),a=t.GetWorldVector(this.m_localXAxisA,this.m_axis),m=t.m_linearVelocity,p=o.m_linearVelocity,l=t.m_angularVelocity,f=o.m_angularVelocity;return S.DotVV(r,S.CrossSV(l,a,S.s_t0))+S.DotVV(a,S.SubVV(S.AddVCrossSV(p,f,i,S.s_t0),S.AddVCrossSV(m,l,e,S.s_t1),S.s_t0))}IsLimitEnabled(){return this.m_enableLimit}EnableLimit(t){t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)}GetLowerLimit(){return this.m_lowerTranslation}GetUpperLimit(){return this.m_upperTranslation}SetLimits(t,o){t===this.m_lowerTranslation&&o===this.m_upperTranslation||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=o,this.m_impulse.z=0)}IsMotorEnabled(){return this.m_enableMotor}EnableMotor(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)}SetMotorSpeed(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)}GetMotorSpeed(){return this.m_motorSpeed}SetMaxMotorForce(t){t!==this.m_maxMotorForce&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t)}GetMaxMotorForce(){return this.m_maxMotorForce}GetMotorForce(t){return t*this.m_motorImpulse}Dump(t){const o=this.m_bodyA.m_islandIndex,e=this.m_bodyB.m_islandIndex;t("  const jd: b2PrismaticJointDef = new b2PrismaticJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",o),t("  jd.bodyB = bodies[%d];\n",e),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.localAxisA.Set(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false"),t("  jd.lowerTranslation = %.15f;\n",this.m_lowerTranslation),t("  jd.upperTranslation = %.15f;\n",this.m_upperTranslation),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorForce = %.15f;\n",this.m_maxMotorForce),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}ye.InitVelocityConstraints_s_d=new S,ye.InitVelocityConstraints_s_P=new S,ye.SolveVelocityConstraints_s_P=new S,ye.SolveVelocityConstraints_s_f2r=new S,ye.SolveVelocityConstraints_s_f1=new A,ye.SolveVelocityConstraints_s_df3=new A,ye.SolveVelocityConstraints_s_df2=new S,ye.SolvePositionConstraints_s_d=new S,ye.SolvePositionConstraints_s_impulse=new A,ye.SolvePositionConstraints_s_impulse1=new S,ye.SolvePositionConstraints_s_P=new S,ye.GetJointTranslation_s_pA=new S,ye.GetJointTranslation_s_pB=new S,ye.GetJointTranslation_s_d=new S,ye.GetJointTranslation_s_axis=new S;class _e extends ne{constructor(t){super(t),this.m_groundAnchorA=new S,this.m_groundAnchorB=new S,this.m_lengthA=0,this.m_lengthB=0,this.m_localAnchorA=new S,this.m_localAnchorB=new S,this.m_constant=0,this.m_ratio=0,this.m_impulse=0,this.m_indexA=0,this.m_indexB=0,this.m_uA=new S,this.m_uB=new S,this.m_rA=new S,this.m_rB=new S,this.m_localCenterA=new S,this.m_localCenterB=new S,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_mass=0,this.m_qA=new V,this.m_qB=new V,this.m_lalcA=new S,this.m_lalcB=new S,this.m_groundAnchorA.Copy(o(t.groundAnchorA,new S(-1,1))),this.m_groundAnchorB.Copy(o(t.groundAnchorB,new S(1,0))),this.m_localAnchorA.Copy(o(t.localAnchorA,new S(-1,0))),this.m_localAnchorB.Copy(o(t.localAnchorB,new S(1,0))),this.m_lengthA=o(t.lengthA,0),this.m_lengthB=o(t.lengthB,0),this.m_ratio=o(t.ratio,1),this.m_constant=o(t.lengthA,0)+this.m_ratio*o(t.lengthB,0),this.m_impulse=0}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const o=t.positions[this.m_indexA].c,e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v;let s=t.velocities[this.m_indexA].w;const n=t.positions[this.m_indexB].c,r=t.positions[this.m_indexB].a,a=t.velocities[this.m_indexB].v;let m=t.velocities[this.m_indexB].w;const p=this.m_qA.SetAngle(e),l=this.m_qB.SetAngle(r);S.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),V.MulRV(p,this.m_lalcA,this.m_rA),S.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),V.MulRV(l,this.m_lalcB,this.m_rB),this.m_uA.Copy(o).SelfAdd(this.m_rA).SelfSub(this.m_groundAnchorA),this.m_uB.Copy(n).SelfAdd(this.m_rB).SelfSub(this.m_groundAnchorB);const f=this.m_uA.Length(),h=this.m_uB.Length();f>.08?this.m_uA.SelfMul(1/f):this.m_uA.SetZero(),h>.08?this.m_uB.SelfMul(1/h):this.m_uB.SetZero();const y=S.CrossVV(this.m_rA,this.m_uA),_=S.CrossVV(this.m_rB,this.m_uB),c=this.m_invMassA+this.m_invIA*y*y,C=this.m_invMassB+this.m_invIB*_*_;if(this.m_mass=c+this.m_ratio*this.m_ratio*C,this.m_mass>0&&(this.m_mass=1/this.m_mass),t.step.warmStarting){this.m_impulse*=t.step.dtRatio;const o=S.MulSV(-this.m_impulse,this.m_uA,_e.InitVelocityConstraints_s_PA),e=S.MulSV(-this.m_ratio*this.m_impulse,this.m_uB,_e.InitVelocityConstraints_s_PB);i.SelfMulAdd(this.m_invMassA,o),s+=this.m_invIA*S.CrossVV(this.m_rA,o),a.SelfMulAdd(this.m_invMassB,e),m+=this.m_invIB*S.CrossVV(this.m_rB,e)}else this.m_impulse=0;t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=m}SolveVelocityConstraints(t){const o=t.velocities[this.m_indexA].v;let e=t.velocities[this.m_indexA].w;const i=t.velocities[this.m_indexB].v;let s=t.velocities[this.m_indexB].w;const n=S.AddVCrossSV(o,e,this.m_rA,_e.SolveVelocityConstraints_s_vpA),r=S.AddVCrossSV(i,s,this.m_rB,_e.SolveVelocityConstraints_s_vpB),a=-S.DotVV(this.m_uA,n)-this.m_ratio*S.DotVV(this.m_uB,r),m=-this.m_mass*a;this.m_impulse+=m;const p=S.MulSV(-m,this.m_uA,_e.SolveVelocityConstraints_s_PA),l=S.MulSV(-this.m_ratio*m,this.m_uB,_e.SolveVelocityConstraints_s_PB);o.SelfMulAdd(this.m_invMassA,p),e+=this.m_invIA*S.CrossVV(this.m_rA,p),i.SelfMulAdd(this.m_invMassB,l),s+=this.m_invIB*S.CrossVV(this.m_rB,l),t.velocities[this.m_indexA].w=e,t.velocities[this.m_indexB].w=s}SolvePositionConstraints(t){const o=t.positions[this.m_indexA].c;let e=t.positions[this.m_indexA].a;const i=t.positions[this.m_indexB].c;let s=t.positions[this.m_indexB].a;const n=this.m_qA.SetAngle(e),r=this.m_qB.SetAngle(s);S.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);const a=V.MulRV(n,this.m_lalcA,this.m_rA);S.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);const p=V.MulRV(r,this.m_lalcB,this.m_rB),l=this.m_uA.Copy(o).SelfAdd(a).SelfSub(this.m_groundAnchorA),f=this.m_uB.Copy(i).SelfAdd(p).SelfSub(this.m_groundAnchorB),h=l.Length(),y=f.Length();h>.08?l.SelfMul(1/h):l.SetZero(),y>.08?f.SelfMul(1/y):f.SetZero();const _=S.CrossVV(a,l),c=S.CrossVV(p,f),C=this.m_invMassA+this.m_invIA*_*_,u=this.m_invMassB+this.m_invIB*c*c;let d=C+this.m_ratio*this.m_ratio*u;d>0&&(d=1/d);const x=this.m_constant-h-this.m_ratio*y,g=m(x),B=-d*x,b=S.MulSV(-B,l,_e.SolvePositionConstraints_s_PA),A=S.MulSV(-this.m_ratio*B,f,_e.SolvePositionConstraints_s_PB);return o.SelfMulAdd(this.m_invMassA,b),e+=this.m_invIA*S.CrossVV(a,b),i.SelfMulAdd(this.m_invMassB,A),s+=this.m_invIB*S.CrossVV(p,A),t.positions[this.m_indexA].a=e,t.positions[this.m_indexB].a=s,g<.008}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,o){return o.x=t*this.m_impulse*this.m_uB.x,o.y=t*this.m_impulse*this.m_uB.y,o}GetReactionTorque(t){return 0}GetGroundAnchorA(){return this.m_groundAnchorA}GetGroundAnchorB(){return this.m_groundAnchorB}GetLengthA(){return this.m_lengthA}GetLengthB(){return this.m_lengthB}GetRatio(){return this.m_ratio}GetCurrentLengthA(){const t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,_e.GetCurrentLengthA_s_p),o=this.m_groundAnchorA;return S.DistanceVV(t,o)}GetCurrentLengthB(){const t=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,_e.GetCurrentLengthB_s_p),o=this.m_groundAnchorB;return S.DistanceVV(t,o)}Dump(t){const o=this.m_bodyA.m_islandIndex,e=this.m_bodyB.m_islandIndex;t("  const jd: b2PulleyJointDef = new b2PulleyJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",o),t("  jd.bodyB = bodies[%d];\n",e),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.groundAnchorA.Set(%.15f, %.15f);\n",this.m_groundAnchorA.x,this.m_groundAnchorA.y),t("  jd.groundAnchorB.Set(%.15f, %.15f);\n",this.m_groundAnchorB.x,this.m_groundAnchorB.y),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.lengthA = %.15f;\n",this.m_lengthA),t("  jd.lengthB = %.15f;\n",this.m_lengthB),t("  jd.ratio = %.15f;\n",this.m_ratio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}ShiftOrigin(t){this.m_groundAnchorA.SelfSub(t),this.m_groundAnchorB.SelfSub(t)}}_e.InitVelocityConstraints_s_PA=new S,_e.InitVelocityConstraints_s_PB=new S,_e.SolveVelocityConstraints_s_vpA=new S,_e.SolveVelocityConstraints_s_vpB=new S,_e.SolveVelocityConstraints_s_PA=new S,_e.SolveVelocityConstraints_s_PB=new S,_e.SolvePositionConstraints_s_PA=new S,_e.SolvePositionConstraints_s_PB=new S,_e.GetCurrentLengthA_s_p=new S,_e.GetCurrentLengthB_s_p=new S;class ce extends ne{constructor(e){super(e),this.m_localAnchorA=new S,this.m_localAnchorB=new S,this.m_impulse=new A,this.m_motorImpulse=0,this.m_enableMotor=!1,this.m_maxMotorTorque=0,this.m_motorSpeed=0,this.m_enableLimit=!1,this.m_referenceAngle=0,this.m_lowerAngle=0,this.m_upperAngle=0,this.m_indexA=0,this.m_indexB=0,this.m_rA=new S,this.m_rB=new S,this.m_localCenterA=new S,this.m_localCenterB=new S,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_mass=new w,this.m_motorMass=0,this.m_limitState=t.b2LimitState.e_inactiveLimit,this.m_qA=new V,this.m_qB=new V,this.m_lalcA=new S,this.m_lalcB=new S,this.m_K=new v,this.m_localAnchorA.Copy(o(e.localAnchorA,S.ZERO)),this.m_localAnchorB.Copy(o(e.localAnchorB,S.ZERO)),this.m_referenceAngle=o(e.referenceAngle,0),this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerAngle=o(e.lowerAngle,0),this.m_upperAngle=o(e.upperAngle,0),this.m_maxMotorTorque=o(e.maxMotorTorque,0),this.m_motorSpeed=o(e.motorSpeed,0),this.m_enableLimit=o(e.enableLimit,!1),this.m_enableMotor=o(e.enableMotor,!1),this.m_limitState=t.b2LimitState.e_inactiveLimit}InitVelocityConstraints(o){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=o.positions[this.m_indexA].a,s=o.velocities[this.m_indexA].v;let n=o.velocities[this.m_indexA].w;const r=o.positions[this.m_indexB].a,a=o.velocities[this.m_indexB].v;let p=o.velocities[this.m_indexB].w;const l=this.m_qA.SetAngle(e),f=this.m_qB.SetAngle(r);S.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),V.MulRV(l,this.m_lalcA,this.m_rA),S.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),V.MulRV(f,this.m_lalcB,this.m_rB);const h=this.m_invMassA,y=this.m_invMassB,_=this.m_invIA,c=this.m_invIB,C=_+c===0;if(this.m_mass.ex.x=h+y+this.m_rA.y*this.m_rA.y*_+this.m_rB.y*this.m_rB.y*c,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*_-this.m_rB.y*this.m_rB.x*c,this.m_mass.ez.x=-this.m_rA.y*_-this.m_rB.y*c,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=h+y+this.m_rA.x*this.m_rA.x*_+this.m_rB.x*this.m_rB.x*c,this.m_mass.ez.y=this.m_rA.x*_+this.m_rB.x*c,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=_+c,this.m_motorMass=_+c,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),this.m_enableMotor&&!C||(this.m_motorImpulse=0),this.m_enableLimit&&!C){const o=r-e-this.m_referenceAngle;m(this.m_upperAngle-this.m_lowerAngle)<2*i?this.m_limitState=t.b2LimitState.e_equalLimits:o<=this.m_lowerAngle?(this.m_limitState!==t.b2LimitState.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=t.b2LimitState.e_atLowerLimit):o>=this.m_upperAngle?(this.m_limitState!==t.b2LimitState.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=t.b2LimitState.e_atUpperLimit):(this.m_limitState=t.b2LimitState.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=t.b2LimitState.e_inactiveLimit;if(o.step.warmStarting){this.m_impulse.SelfMul(o.step.dtRatio),this.m_motorImpulse*=o.step.dtRatio;const t=ce.InitVelocityConstraints_s_P.Set(this.m_impulse.x,this.m_impulse.y);s.SelfMulSub(h,t),n-=_*(S.CrossVV(this.m_rA,t)+this.m_motorImpulse+this.m_impulse.z),a.SelfMulAdd(y,t),p+=c*(S.CrossVV(this.m_rB,t)+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.SetZero(),this.m_motorImpulse=0;o.velocities[this.m_indexA].w=n,o.velocities[this.m_indexB].w=p}SolveVelocityConstraints(o){const e=o.velocities[this.m_indexA].v;let i=o.velocities[this.m_indexA].w;const s=o.velocities[this.m_indexB].v;let n=o.velocities[this.m_indexB].w;const r=this.m_invMassA,a=this.m_invMassB,m=this.m_invIA,p=this.m_invIB,l=m+p===0;if(this.m_enableMotor&&this.m_limitState!==t.b2LimitState.e_equalLimits&&!l){const t=n-i-this.m_motorSpeed;let e=-this.m_motorMass*t;const s=this.m_motorImpulse,r=o.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=f(this.m_motorImpulse+e,-r,r),e=this.m_motorImpulse-s,i-=m*e,n+=p*e}if(this.m_enableLimit&&this.m_limitState!==t.b2LimitState.e_inactiveLimit&&!l){const o=S.SubVV(S.AddVCrossSV(s,n,this.m_rB,S.s_t0),S.AddVCrossSV(e,i,this.m_rA,S.s_t1),ce.SolveVelocityConstraints_s_Cdot1),l=n-i,f=this.m_mass.Solve33(o.x,o.y,l,ce.SolveVelocityConstraints_s_impulse_v3).SelfNeg();if(this.m_limitState===t.b2LimitState.e_equalLimits)this.m_impulse.SelfAdd(f);else if(this.m_limitState===t.b2LimitState.e_atLowerLimit)if(this.m_impulse.z+f.z<0){const t=-o.x+this.m_impulse.z*this.m_mass.ez.x,e=-o.y+this.m_impulse.z*this.m_mass.ez.y,i=this.m_mass.Solve22(t,e,ce.SolveVelocityConstraints_s_reduced_v2);f.x=i.x,f.y=i.y,f.z=-this.m_impulse.z,this.m_impulse.x+=i.x,this.m_impulse.y+=i.y,this.m_impulse.z=0}else this.m_impulse.SelfAdd(f);else if(this.m_limitState===t.b2LimitState.e_atUpperLimit)if(this.m_impulse.z+f.z>0){const t=-o.x+this.m_impulse.z*this.m_mass.ez.x,e=-o.y+this.m_impulse.z*this.m_mass.ez.y,i=this.m_mass.Solve22(t,e,ce.SolveVelocityConstraints_s_reduced_v2);f.x=i.x,f.y=i.y,f.z=-this.m_impulse.z,this.m_impulse.x+=i.x,this.m_impulse.y+=i.y,this.m_impulse.z=0}else this.m_impulse.SelfAdd(f);const h=ce.SolveVelocityConstraints_s_P.Set(f.x,f.y);e.SelfMulSub(r,h),i-=m*(S.CrossVV(this.m_rA,h)+f.z),s.SelfMulAdd(a,h),n+=p*(S.CrossVV(this.m_rB,h)+f.z)}else{const t=S.SubVV(S.AddVCrossSV(s,n,this.m_rB,S.s_t0),S.AddVCrossSV(e,i,this.m_rA,S.s_t1),ce.SolveVelocityConstraints_s_Cdot_v2),o=this.m_mass.Solve22(-t.x,-t.y,ce.SolveVelocityConstraints_s_impulse_v2);this.m_impulse.x+=o.x,this.m_impulse.y+=o.y,e.SelfMulSub(r,o),i-=m*S.CrossVV(this.m_rA,o),s.SelfMulAdd(a,o),n+=p*S.CrossVV(this.m_rB,o)}o.velocities[this.m_indexA].w=i,o.velocities[this.m_indexB].w=n}SolvePositionConstraints(o){const e=o.positions[this.m_indexA].c;let s=o.positions[this.m_indexA].a;const n=o.positions[this.m_indexB].c;let r=o.positions[this.m_indexB].a;const a=this.m_qA.SetAngle(s),p=this.m_qB.SetAngle(r);let l=0,h=0;const y=this.m_invIA+this.m_invIB===0;if(this.m_enableLimit&&this.m_limitState!==t.b2LimitState.e_inactiveLimit&&!y){const o=r-s-this.m_referenceAngle;let e=0;if(this.m_limitState===t.b2LimitState.e_equalLimits){const t=f(o-this.m_lowerAngle,-.13962634015955555,.13962634015955555);e=-this.m_motorMass*t,l=m(t)}else if(this.m_limitState===t.b2LimitState.e_atLowerLimit){let t=o-this.m_lowerAngle;l=-t,t=f(t+i,-.13962634015955555,0),e=-this.m_motorMass*t}else if(this.m_limitState===t.b2LimitState.e_atUpperLimit){let t=o-this.m_upperAngle;l=t,t=f(t-i,0,.13962634015955555),e=-this.m_motorMass*t}s-=this.m_invIA*e,r+=this.m_invIB*e}{a.SetAngle(s),p.SetAngle(r),S.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);const t=V.MulRV(a,this.m_lalcA,this.m_rA);S.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);const o=V.MulRV(p,this.m_lalcB,this.m_rB),i=S.SubVV(S.AddVV(n,o,S.s_t0),S.AddVV(e,t,S.s_t1),ce.SolvePositionConstraints_s_C_v2);h=i.Length();const m=this.m_invMassA,l=this.m_invMassB,f=this.m_invIA,y=this.m_invIB,_=this.m_K;_.ex.x=m+l+f*t.y*t.y+y*o.y*o.y,_.ex.y=-f*t.x*t.y-y*o.x*o.y,_.ey.x=_.ex.y,_.ey.y=m+l+f*t.x*t.x+y*o.x*o.x;const c=_.Solve(i.x,i.y,ce.SolvePositionConstraints_s_impulse).SelfNeg();e.SelfMulSub(m,c),s-=f*S.CrossVV(t,c),n.SelfMulAdd(l,c),r+=y*S.CrossVV(o,c)}return o.positions[this.m_indexA].a=s,o.positions[this.m_indexB].a=r,h<=.008&&l<=i}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,o){return o.x=t*this.m_impulse.x,o.y=t*this.m_impulse.y,o}GetReactionTorque(t){return t*this.m_impulse.z}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}GetReferenceAngle(){return this.m_referenceAngle}GetJointAngle(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle}GetJointSpeed(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity}IsMotorEnabled(){return this.m_enableMotor}EnableMotor(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)}GetMotorTorque(t){return t*this.m_motorImpulse}GetMotorSpeed(){return this.m_motorSpeed}SetMaxMotorTorque(t){t!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t)}GetMaxMotorTorque(){return this.m_maxMotorTorque}IsLimitEnabled(){return this.m_enableLimit}EnableLimit(t){t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)}GetLowerLimit(){return this.m_lowerAngle}GetUpperLimit(){return this.m_upperAngle}SetLimits(t,o){t===this.m_lowerAngle&&o===this.m_upperAngle||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=t,this.m_upperAngle=o)}SetMotorSpeed(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)}Dump(t){const o=this.m_bodyA.m_islandIndex,e=this.m_bodyB.m_islandIndex;t("  const jd: b2RevoluteJointDef = new b2RevoluteJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",o),t("  jd.bodyB = bodies[%d];\n",e),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false"),t("  jd.lowerAngle = %.15f;\n",this.m_lowerAngle),t("  jd.upperAngle = %.15f;\n",this.m_upperAngle),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}ce.InitVelocityConstraints_s_P=new S,ce.SolveVelocityConstraints_s_P=new S,ce.SolveVelocityConstraints_s_Cdot_v2=new S,ce.SolveVelocityConstraints_s_Cdot1=new S,ce.SolveVelocityConstraints_s_impulse_v3=new A,ce.SolveVelocityConstraints_s_reduced_v2=new S,ce.SolveVelocityConstraints_s_impulse_v2=new S,ce.SolvePositionConstraints_s_C_v2=new S,ce.SolvePositionConstraints_s_impulse=new S;class Ce extends ne{constructor(e){super(e),this.m_localAnchorA=new S,this.m_localAnchorB=new S,this.m_maxLength=0,this.m_length=0,this.m_impulse=0,this.m_indexA=0,this.m_indexB=0,this.m_u=new S,this.m_rA=new S,this.m_rB=new S,this.m_localCenterA=new S,this.m_localCenterB=new S,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_mass=0,this.m_state=t.b2LimitState.e_inactiveLimit,this.m_qA=new V,this.m_qB=new V,this.m_lalcA=new S,this.m_lalcB=new S,this.m_localAnchorA.Copy(o(e.localAnchorA,new S(-1,0))),this.m_localAnchorB.Copy(o(e.localAnchorB,new S(1,0))),this.m_maxLength=o(e.maxLength,0)}InitVelocityConstraints(o){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=o.positions[this.m_indexA].c,i=o.positions[this.m_indexA].a,s=o.velocities[this.m_indexA].v;let n=o.velocities[this.m_indexA].w;const r=o.positions[this.m_indexB].c,a=o.positions[this.m_indexB].a,m=o.velocities[this.m_indexB].v;let p=o.velocities[this.m_indexB].w;const l=this.m_qA.SetAngle(i),f=this.m_qB.SetAngle(a);S.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),V.MulRV(l,this.m_lalcA,this.m_rA),S.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),V.MulRV(f,this.m_lalcB,this.m_rB),this.m_u.Copy(r).SelfAdd(this.m_rB).SelfSub(e).SelfSub(this.m_rA),this.m_length=this.m_u.Length();const h=this.m_length-this.m_maxLength;if(this.m_state=h>0?t.b2LimitState.e_atUpperLimit:t.b2LimitState.e_inactiveLimit,!(this.m_length>.008))return this.m_u.SetZero(),this.m_mass=0,void(this.m_impulse=0);this.m_u.SelfMul(1/this.m_length);const y=S.CrossVV(this.m_rA,this.m_u),_=S.CrossVV(this.m_rB,this.m_u),c=this.m_invMassA+this.m_invIA*y*y+this.m_invMassB+this.m_invIB*_*_;if(this.m_mass=0!==c?1/c:0,o.step.warmStarting){this.m_impulse*=o.step.dtRatio;const t=S.MulSV(this.m_impulse,this.m_u,Ce.InitVelocityConstraints_s_P);s.SelfMulSub(this.m_invMassA,t),n-=this.m_invIA*S.CrossVV(this.m_rA,t),m.SelfMulAdd(this.m_invMassB,t),p+=this.m_invIB*S.CrossVV(this.m_rB,t)}else this.m_impulse=0;o.velocities[this.m_indexA].w=n,o.velocities[this.m_indexB].w=p}SolveVelocityConstraints(t){const o=t.velocities[this.m_indexA].v;let e=t.velocities[this.m_indexA].w;const i=t.velocities[this.m_indexB].v;let s=t.velocities[this.m_indexB].w;const n=S.AddVCrossSV(o,e,this.m_rA,Ce.SolveVelocityConstraints_s_vpA),r=S.AddVCrossSV(i,s,this.m_rB,Ce.SolveVelocityConstraints_s_vpB),a=this.m_length-this.m_maxLength;let m=S.DotVV(this.m_u,S.SubVV(r,n,S.s_t0));a<0&&(m+=t.step.inv_dt*a);let l=-this.m_mass*m;const f=this.m_impulse;this.m_impulse=p(0,this.m_impulse+l),l=this.m_impulse-f;const h=S.MulSV(l,this.m_u,Ce.SolveVelocityConstraints_s_P);o.SelfMulSub(this.m_invMassA,h),e-=this.m_invIA*S.CrossVV(this.m_rA,h),i.SelfMulAdd(this.m_invMassB,h),s+=this.m_invIB*S.CrossVV(this.m_rB,h),t.velocities[this.m_indexA].w=e,t.velocities[this.m_indexB].w=s}SolvePositionConstraints(t){const o=t.positions[this.m_indexA].c;let e=t.positions[this.m_indexA].a;const i=t.positions[this.m_indexB].c;let s=t.positions[this.m_indexB].a;const n=this.m_qA.SetAngle(e),r=this.m_qB.SetAngle(s);S.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);const a=V.MulRV(n,this.m_lalcA,this.m_rA);S.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);const m=V.MulRV(r,this.m_lalcB,this.m_rB),p=this.m_u.Copy(i).SelfAdd(m).SelfSub(o).SelfSub(a),l=p.Normalize();let h=l-this.m_maxLength;h=f(h,0,.2);const y=-this.m_mass*h,_=S.MulSV(y,p,Ce.SolvePositionConstraints_s_P);return o.SelfMulSub(this.m_invMassA,_),e-=this.m_invIA*S.CrossVV(a,_),i.SelfMulAdd(this.m_invMassB,_),s+=this.m_invIB*S.CrossVV(m,_),t.positions[this.m_indexA].a=e,t.positions[this.m_indexB].a=s,l-this.m_maxLength<.008}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,o){return S.MulSV(t*this.m_impulse,this.m_u,o)}GetReactionTorque(t){return 0}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}SetMaxLength(t){this.m_maxLength=t}GetMaxLength(){return this.m_maxLength}GetLimitState(){return this.m_state}Dump(t){const o=this.m_bodyA.m_islandIndex,e=this.m_bodyB.m_islandIndex;t("  const jd: b2RopeJointDef = new b2RopeJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",o),t("  jd.bodyB = bodies[%d];\n",e),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.maxLength = %.15f;\n",this.m_maxLength),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}Ce.InitVelocityConstraints_s_P=new S,Ce.SolveVelocityConstraints_s_vpA=new S,Ce.SolveVelocityConstraints_s_vpB=new S,Ce.SolveVelocityConstraints_s_P=new S,Ce.SolvePositionConstraints_s_P=new S;class ue extends ne{constructor(t){super(t),this.m_frequencyHz=0,this.m_dampingRatio=0,this.m_bias=0,this.m_localAnchorA=new S,this.m_localAnchorB=new S,this.m_referenceAngle=0,this.m_gamma=0,this.m_impulse=new A(0,0,0),this.m_indexA=0,this.m_indexB=0,this.m_rA=new S,this.m_rB=new S,this.m_localCenterA=new S,this.m_localCenterB=new S,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_mass=new w,this.m_qA=new V,this.m_qB=new V,this.m_lalcA=new S,this.m_lalcB=new S,this.m_K=new w,this.m_frequencyHz=o(t.frequencyHz,0),this.m_dampingRatio=o(t.dampingRatio,0),this.m_localAnchorA.Copy(o(t.localAnchorA,S.ZERO)),this.m_localAnchorB.Copy(o(t.localAnchorB,S.ZERO)),this.m_referenceAngle=o(t.referenceAngle,0),this.m_impulse.SetZero()}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const o=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v;let s=t.velocities[this.m_indexA].w;const n=t.positions[this.m_indexB].a,r=t.velocities[this.m_indexB].v;let a=t.velocities[this.m_indexB].w;const m=this.m_qA.SetAngle(o),p=this.m_qB.SetAngle(n);S.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),V.MulRV(m,this.m_lalcA,this.m_rA),S.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),V.MulRV(p,this.m_lalcB,this.m_rB);const l=this.m_invMassA,f=this.m_invMassB,h=this.m_invIA,y=this.m_invIB,_=this.m_K;if(_.ex.x=l+f+this.m_rA.y*this.m_rA.y*h+this.m_rB.y*this.m_rB.y*y,_.ey.x=-this.m_rA.y*this.m_rA.x*h-this.m_rB.y*this.m_rB.x*y,_.ez.x=-this.m_rA.y*h-this.m_rB.y*y,_.ex.y=_.ey.x,_.ey.y=l+f+this.m_rA.x*this.m_rA.x*h+this.m_rB.x*this.m_rB.x*y,_.ez.y=this.m_rA.x*h+this.m_rB.x*y,_.ex.z=_.ez.x,_.ey.z=_.ez.y,_.ez.z=h+y,this.m_frequencyHz>0){_.GetInverse22(this.m_mass);let i=h+y;const s=i>0?1/i:0,r=n-o-this.m_referenceAngle,a=2*e*this.m_frequencyHz,m=2*s*this.m_dampingRatio*a,p=s*a*a,l=t.step.dt;this.m_gamma=l*(m+l*p),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=r*l*p*this.m_gamma,i+=this.m_gamma,this.m_mass.ez.z=0!==i?1/i:0}else _.GetSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0;if(t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio);const o=ue.InitVelocityConstraints_s_P.Set(this.m_impulse.x,this.m_impulse.y);i.SelfMulSub(l,o),s-=h*(S.CrossVV(this.m_rA,o)+this.m_impulse.z),r.SelfMulAdd(f,o),a+=y*(S.CrossVV(this.m_rB,o)+this.m_impulse.z)}else this.m_impulse.SetZero();t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=a}SolveVelocityConstraints(t){const o=t.velocities[this.m_indexA].v;let e=t.velocities[this.m_indexA].w;const i=t.velocities[this.m_indexB].v;let s=t.velocities[this.m_indexB].w;const n=this.m_invMassA,r=this.m_invMassB,a=this.m_invIA,m=this.m_invIB;if(this.m_frequencyHz>0){const t=s-e,p=-this.m_mass.ez.z*(t+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=p,e-=a*p,s+=m*p;const l=S.SubVV(S.AddVCrossSV(i,s,this.m_rB,S.s_t0),S.AddVCrossSV(o,e,this.m_rA,S.s_t1),ue.SolveVelocityConstraints_s_Cdot1),f=w.MulM33XY(this.m_mass,l.x,l.y,ue.SolveVelocityConstraints_s_impulse1).SelfNeg();this.m_impulse.x+=f.x,this.m_impulse.y+=f.y;const h=f;o.SelfMulSub(n,h),e-=a*S.CrossVV(this.m_rA,h),i.SelfMulAdd(r,h),s+=m*S.CrossVV(this.m_rB,h)}else{const t=S.SubVV(S.AddVCrossSV(i,s,this.m_rB,S.s_t0),S.AddVCrossSV(o,e,this.m_rA,S.s_t1),ue.SolveVelocityConstraints_s_Cdot1),p=s-e,l=w.MulM33XYZ(this.m_mass,t.x,t.y,p,ue.SolveVelocityConstraints_s_impulse).SelfNeg();this.m_impulse.SelfAdd(l);const f=ue.SolveVelocityConstraints_s_P.Set(l.x,l.y);o.SelfMulSub(n,f),e-=a*(S.CrossVV(this.m_rA,f)+l.z),i.SelfMulAdd(r,f),s+=m*(S.CrossVV(this.m_rB,f)+l.z)}t.velocities[this.m_indexA].w=e,t.velocities[this.m_indexB].w=s}SolvePositionConstraints(t){const o=t.positions[this.m_indexA].c;let e=t.positions[this.m_indexA].a;const s=t.positions[this.m_indexB].c;let n=t.positions[this.m_indexB].a;const r=this.m_qA.SetAngle(e),a=this.m_qB.SetAngle(n),p=this.m_invMassA,l=this.m_invMassB,f=this.m_invIA,h=this.m_invIB;S.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);const y=V.MulRV(r,this.m_lalcA,this.m_rA);S.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);const _=V.MulRV(a,this.m_lalcB,this.m_rB);let c,C;const u=this.m_K;if(u.ex.x=p+l+y.y*y.y*f+_.y*_.y*h,u.ey.x=-y.y*y.x*f-_.y*_.x*h,u.ez.x=-y.y*f-_.y*h,u.ex.y=u.ey.x,u.ey.y=p+l+y.x*y.x*f+_.x*_.x*h,u.ez.y=y.x*f+_.x*h,u.ex.z=u.ez.x,u.ey.z=u.ez.y,u.ez.z=f+h,this.m_frequencyHz>0){const t=S.SubVV(S.AddVV(s,_,S.s_t0),S.AddVV(o,y,S.s_t1),ue.SolvePositionConstraints_s_C1);c=t.Length(),C=0;const i=u.Solve22(t.x,t.y,ue.SolvePositionConstraints_s_P).SelfNeg();o.SelfMulSub(p,i),e-=f*S.CrossVV(y,i),s.SelfMulAdd(l,i),n+=h*S.CrossVV(_,i)}else{const t=S.SubVV(S.AddVV(s,_,S.s_t0),S.AddVV(o,y,S.s_t1),ue.SolvePositionConstraints_s_C1),i=n-e-this.m_referenceAngle;c=t.Length(),C=m(i);const r=u.Solve33(t.x,t.y,i,ue.SolvePositionConstraints_s_impulse).SelfNeg(),a=ue.SolvePositionConstraints_s_P.Set(r.x,r.y);o.SelfMulSub(p,a),e-=f*(S.CrossVV(this.m_rA,a)+r.z),s.SelfMulAdd(l,a),n+=h*(S.CrossVV(this.m_rB,a)+r.z)}return t.positions[this.m_indexA].a=e,t.positions[this.m_indexB].a=n,c<=.008&&C<=i}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,o){return o.x=t*this.m_impulse.x,o.y=t*this.m_impulse.y,o}GetReactionTorque(t){return t*this.m_impulse.z}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}GetReferenceAngle(){return this.m_referenceAngle}SetFrequency(t){this.m_frequencyHz=t}GetFrequency(){return this.m_frequencyHz}SetDampingRatio(t){this.m_dampingRatio=t}GetDampingRatio(){return this.m_dampingRatio}Dump(t){const o=this.m_bodyA.m_islandIndex,e=this.m_bodyB.m_islandIndex;t("  const jd: b2WeldJointDef = new b2WeldJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",o),t("  jd.bodyB = bodies[%d];\n",e),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),t("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}ue.InitVelocityConstraints_s_P=new S,ue.SolveVelocityConstraints_s_Cdot1=new S,ue.SolveVelocityConstraints_s_impulse1=new S,ue.SolveVelocityConstraints_s_impulse=new A,ue.SolveVelocityConstraints_s_P=new S,ue.SolvePositionConstraints_s_C1=new S,ue.SolvePositionConstraints_s_P=new S,ue.SolvePositionConstraints_s_impulse=new A;class de extends ne{constructor(t){super(t),this.m_frequencyHz=0,this.m_dampingRatio=0,this.m_localAnchorA=new S,this.m_localAnchorB=new S,this.m_localXAxisA=new S,this.m_localYAxisA=new S,this.m_impulse=0,this.m_motorImpulse=0,this.m_springImpulse=0,this.m_maxMotorTorque=0,this.m_motorSpeed=0,this.m_enableMotor=!1,this.m_indexA=0,this.m_indexB=0,this.m_localCenterA=new S,this.m_localCenterB=new S,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_ax=new S,this.m_ay=new S,this.m_sAx=0,this.m_sBx=0,this.m_sAy=0,this.m_sBy=0,this.m_mass=0,this.m_motorMass=0,this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_qA=new V,this.m_qB=new V,this.m_lalcA=new S,this.m_lalcB=new S,this.m_rA=new S,this.m_rB=new S,this.m_frequencyHz=o(t.frequencyHz,2),this.m_dampingRatio=o(t.dampingRatio,.7),this.m_localAnchorA.Copy(o(t.localAnchorA,S.ZERO)),this.m_localAnchorB.Copy(o(t.localAnchorB,S.ZERO)),this.m_localXAxisA.Copy(o(t.localAxisA,S.UNITX)),S.CrossOneV(this.m_localXAxisA,this.m_localYAxisA),this.m_maxMotorTorque=o(t.maxMotorTorque,0),this.m_motorSpeed=o(t.motorSpeed,0),this.m_enableMotor=o(t.enableMotor,!1),this.m_ax.SetZero(),this.m_ay.SetZero()}GetMotorSpeed(){return this.m_motorSpeed}GetMaxMotorTorque(){return this.m_maxMotorTorque}SetSpringFrequencyHz(t){this.m_frequencyHz=t}GetSpringFrequencyHz(){return this.m_frequencyHz}SetSpringDampingRatio(t){this.m_dampingRatio=t}GetSpringDampingRatio(){return this.m_dampingRatio}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const o=this.m_invMassA,i=this.m_invMassB,s=this.m_invIA,n=this.m_invIB,r=t.positions[this.m_indexA].c,a=t.positions[this.m_indexA].a,m=t.velocities[this.m_indexA].v;let p=t.velocities[this.m_indexA].w;const l=t.positions[this.m_indexB].c,f=t.positions[this.m_indexB].a,h=t.velocities[this.m_indexB].v;let y=t.velocities[this.m_indexB].w;const _=this.m_qA.SetAngle(a),c=this.m_qB.SetAngle(f);S.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);const C=V.MulRV(_,this.m_lalcA,this.m_rA);S.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);const u=V.MulRV(c,this.m_lalcB,this.m_rB),d=S.SubVV(S.AddVV(l,u,S.s_t0),S.AddVV(r,C,S.s_t1),de.InitVelocityConstraints_s_d);if(V.MulRV(_,this.m_localYAxisA,this.m_ay),this.m_sAy=S.CrossVV(S.AddVV(d,C,S.s_t0),this.m_ay),this.m_sBy=S.CrossVV(u,this.m_ay),this.m_mass=o+i+s*this.m_sAy*this.m_sAy+n*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_frequencyHz>0){V.MulRV(_,this.m_localXAxisA,this.m_ax),this.m_sAx=S.CrossVV(S.AddVV(d,C,S.s_t0),this.m_ax),this.m_sBx=S.CrossVV(u,this.m_ax);const r=o+i+s*this.m_sAx*this.m_sAx+n*this.m_sBx*this.m_sBx;if(r>0){this.m_springMass=1/r;const o=S.DotVV(d,this.m_ax),i=2*e*this.m_frequencyHz,s=2*this.m_springMass*this.m_dampingRatio*i,n=this.m_springMass*i*i,a=t.step.dt;this.m_gamma=a*(s+a*n),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=o*a*n*this.m_gamma,this.m_springMass=r+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}}else this.m_springImpulse=0;if(this.m_enableMotor?(this.m_motorMass=s+n,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse*=t.step.dtRatio,this.m_springImpulse*=t.step.dtRatio,this.m_motorImpulse*=t.step.dtRatio;const o=S.AddVV(S.MulSV(this.m_impulse,this.m_ay,S.s_t0),S.MulSV(this.m_springImpulse,this.m_ax,S.s_t1),de.InitVelocityConstraints_s_P),e=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,i=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse;m.SelfMulSub(this.m_invMassA,o),p-=this.m_invIA*e,h.SelfMulAdd(this.m_invMassB,o),y+=this.m_invIB*i}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0;t.velocities[this.m_indexA].w=p,t.velocities[this.m_indexB].w=y}SolveVelocityConstraints(t){const o=this.m_invMassA,e=this.m_invMassB,i=this.m_invIA,s=this.m_invIB,n=t.velocities[this.m_indexA].v;let r=t.velocities[this.m_indexA].w;const a=t.velocities[this.m_indexB].v;let m=t.velocities[this.m_indexB].w;{const t=S.DotVV(this.m_ax,S.SubVV(a,n,S.s_t0))+this.m_sBx*m-this.m_sAx*r,p=-this.m_springMass*(t+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=p;const l=S.MulSV(p,this.m_ax,de.SolveVelocityConstraints_s_P),f=p*this.m_sAx,h=p*this.m_sBx;n.SelfMulSub(o,l),r-=i*f,a.SelfMulAdd(e,l),m+=s*h}{const o=m-r-this.m_motorSpeed;let e=-this.m_motorMass*o;const n=this.m_motorImpulse,a=t.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=f(this.m_motorImpulse+e,-a,a),e=this.m_motorImpulse-n,r-=i*e,m+=s*e}{const t=S.DotVV(this.m_ay,S.SubVV(a,n,S.s_t0))+this.m_sBy*m-this.m_sAy*r,p=-this.m_mass*t;this.m_impulse+=p;const l=S.MulSV(p,this.m_ay,de.SolveVelocityConstraints_s_P),f=p*this.m_sAy,h=p*this.m_sBy;n.SelfMulSub(o,l),r-=i*f,a.SelfMulAdd(e,l),m+=s*h}t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=m}SolvePositionConstraints(t){const o=t.positions[this.m_indexA].c;let e=t.positions[this.m_indexA].a;const i=t.positions[this.m_indexB].c;let s=t.positions[this.m_indexB].a;const n=this.m_qA.SetAngle(e),r=this.m_qB.SetAngle(s);S.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);const a=V.MulRV(n,this.m_lalcA,this.m_rA);S.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);const p=V.MulRV(r,this.m_lalcB,this.m_rB),l=S.AddVV(S.SubVV(i,o,S.s_t0),S.SubVV(p,a,S.s_t1),de.SolvePositionConstraints_s_d),f=V.MulRV(n,this.m_localYAxisA,this.m_ay),h=S.CrossVV(S.AddVV(l,a,S.s_t0),f),y=S.CrossVV(p,f),_=S.DotVV(l,this.m_ay),c=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy;let C;C=0!==c?-_/c:0;const u=S.MulSV(C,f,de.SolvePositionConstraints_s_P),d=C*h,x=C*y;return o.SelfMulSub(this.m_invMassA,u),e-=this.m_invIA*d,i.SelfMulAdd(this.m_invMassB,u),s+=this.m_invIB*x,t.positions[this.m_indexA].a=e,t.positions[this.m_indexB].a=s,m(_)<=.008}GetDefinition(t){return t}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,o){return o.x=t*(this.m_impulse*this.m_ay.x+this.m_springImpulse*this.m_ax.x),o.y=t*(this.m_impulse*this.m_ay.y+this.m_springImpulse*this.m_ax.y),o}GetReactionTorque(t){return t*this.m_motorImpulse}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}GetLocalAxisA(){return this.m_localXAxisA}GetJointTranslation(){return this.GetPrismaticJointTranslation()}GetJointLinearSpeed(){return this.GetPrismaticJointSpeed()}GetJointAngle(){return this.GetRevoluteJointAngle()}GetJointAngularSpeed(){return this.GetRevoluteJointSpeed()}GetPrismaticJointTranslation(){const t=this.m_bodyA,o=this.m_bodyB,e=t.GetWorldPoint(this.m_localAnchorA,new S),i=o.GetWorldPoint(this.m_localAnchorB,new S),s=S.SubVV(i,e,new S),n=t.GetWorldVector(this.m_localXAxisA,new S);return S.DotVV(s,n)}GetPrismaticJointSpeed(){const t=this.m_bodyA,o=this.m_bodyB;S.SubVV(this.m_localAnchorA,t.m_sweep.localCenter,this.m_lalcA);const e=V.MulRV(t.m_xf.q,this.m_lalcA,this.m_rA);S.SubVV(this.m_localAnchorB,o.m_sweep.localCenter,this.m_lalcB);const i=V.MulRV(o.m_xf.q,this.m_lalcB,this.m_rB),s=S.AddVV(t.m_sweep.c,e,S.s_t0),n=S.AddVV(o.m_sweep.c,i,S.s_t1),r=S.SubVV(n,s,S.s_t2),a=t.GetWorldVector(this.m_localXAxisA,new S),m=t.m_linearVelocity,p=o.m_linearVelocity,l=t.m_angularVelocity,f=o.m_angularVelocity;return S.DotVV(r,S.CrossSV(l,a,S.s_t0))+S.DotVV(a,S.SubVV(S.AddVCrossSV(p,f,i,S.s_t0),S.AddVCrossSV(m,l,e,S.s_t1),S.s_t0))}GetRevoluteJointAngle(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a}GetRevoluteJointSpeed(){const t=this.m_bodyA.m_angularVelocity;return this.m_bodyB.m_angularVelocity-t}IsMotorEnabled(){return this.m_enableMotor}EnableMotor(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)}SetMotorSpeed(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)}SetMaxMotorTorque(t){t!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t)}GetMotorTorque(t){return t*this.m_motorImpulse}Dump(t){const o=this.m_bodyA.m_islandIndex,e=this.m_bodyB.m_islandIndex;t("  const jd: b2WheelJointDef = new b2WheelJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",o),t("  jd.bodyB = bodies[%d];\n",e),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.localAxisA.Set(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque),t("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),t("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}function xe(t,o){return c(t*o)}function ge(t,o){return t>o?t:o}de.InitVelocityConstraints_s_d=new S,de.InitVelocityConstraints_s_P=new S,de.SolveVelocityConstraints_s_P=new S,de.SolvePositionConstraints_s_d=new S,de.SolvePositionConstraints_s_P=new S;class Be{constructor(t){this.prev=null,this.next=null,this.contact=t}}class Se{constructor(){this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_prev=null,this.m_next=null,this.m_indexA=0,this.m_indexB=0,this.m_manifold=new pt,this.m_toiCount=0,this.m_toi=0,this.m_friction=0,this.m_restitution=0,this.m_tangentSpeed=0,this.m_oldManifold=new pt,this.m_nodeA=new Be(this),this.m_nodeB=new Be(this)}GetManifold(){return this.m_manifold}GetWorldManifold(t){const o=this.m_fixtureA.GetBody(),e=this.m_fixtureB.GetBody(),i=this.m_fixtureA.GetShape(),s=this.m_fixtureB.GetShape();t.Initialize(this.m_manifold,o.GetTransform(),i.m_radius,e.GetTransform(),s.m_radius)}IsTouching(){return this.m_touchingFlag}SetEnabled(t){this.m_enabledFlag=t}IsEnabled(){return this.m_enabledFlag}GetNext(){return this.m_next}GetFixtureA(){return this.m_fixtureA}GetChildIndexA(){return this.m_indexA}GetFixtureB(){return this.m_fixtureB}GetChildIndexB(){return this.m_indexB}FlagForFiltering(){this.m_filterFlag=!0}SetFriction(t){this.m_friction=t}GetFriction(){return this.m_friction}ResetFriction(){this.m_friction=xe(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction)}SetRestitution(t){this.m_restitution=t}GetRestitution(){return this.m_restitution}ResetRestitution(){this.m_restitution=ge(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)}SetTangentSpeed(t){this.m_tangentSpeed=t}GetTangentSpeed(){return this.m_tangentSpeed}Reset(t,o,e,i){this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!0,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_fixtureA=t,this.m_fixtureB=e,this.m_indexA=o,this.m_indexB=i,this.m_manifold.pointCount=0,this.m_prev=null,this.m_next=null,delete this.m_nodeA.contact,this.m_nodeA.prev=null,this.m_nodeA.next=null,delete this.m_nodeA.other,delete this.m_nodeB.contact,this.m_nodeB.prev=null,this.m_nodeB.next=null,delete this.m_nodeB.other,this.m_toiCount=0,this.m_friction=xe(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=ge(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)}Update(t){const o=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=o,this.m_enabledFlag=!0;let e=!1;const i=this.m_touchingFlag,s=this.m_fixtureA.IsSensor(),n=this.m_fixtureB.IsSensor(),r=s||n,a=this.m_fixtureA.GetBody(),m=this.m_fixtureB.GetBody(),p=a.GetTransform(),l=m.GetTransform();if(r){const t=this.m_fixtureA.GetShape(),o=this.m_fixtureB.GetShape();e=gt(t,this.m_indexA,o,this.m_indexB,p,l),this.m_manifold.pointCount=0}else{this.Evaluate(this.m_manifold,p,l),e=this.m_manifold.pointCount>0;for(let t=0;t<this.m_manifold.pointCount;++t){const o=this.m_manifold.points[t];o.normalImpulse=0,o.tangentImpulse=0;const e=o.id;for(let t=0;t<this.m_oldManifold.pointCount;++t){const i=this.m_oldManifold.points[t];if(i.id.key===e.key){o.normalImpulse=i.normalImpulse,o.tangentImpulse=i.tangentImpulse;break}}}e!==i&&(a.SetAwake(!0),m.SetAwake(!0))}this.m_touchingFlag=e,!i&&e&&t&&t.BeginContact(this),i&&!e&&t&&t.EndContact(this),!r&&e&&t&&t.PreSolve(this,this.m_oldManifold)}ComputeTOI(t,o){const e=Se.ComputeTOI_s_input;e.proxyA.SetShape(this.m_fixtureA.GetShape(),this.m_indexA),e.proxyB.SetShape(this.m_fixtureB.GetShape(),this.m_indexB),e.sweepA.Copy(t),e.sweepB.Copy(o),e.tMax=.008;const i=Se.ComputeTOI_s_output;return Zt(i,e),i.t}}Se.ComputeTOI_s_input=new Ft,Se.ComputeTOI_s_output=new kt;class be extends Se{constructor(){super()}static Create(t){return new be}static Destroy(t,o){}Reset(t,o,e,i){super.Reset(t,o,e,i)}Evaluate(t,o,e){Yt(t,this.m_fixtureA.GetShape(),o,this.m_fixtureB.GetShape(),e)}}class Ae extends Se{constructor(){super()}static Create(t){return new Ae}static Destroy(t,o){}Reset(t,o,e,i){super.Reset(t,o,e,i)}Evaluate(t,o,e){vo(t,this.m_fixtureA.GetShape(),o,this.m_fixtureB.GetShape(),e)}}class ve extends Se{constructor(){super()}static Create(t){return new ve}static Destroy(t,o){}Reset(t,o,e,i){super.Reset(t,o,e,i)}Evaluate(t,o,e){oo(t,this.m_fixtureA.GetShape(),o,this.m_fixtureB.GetShape(),e)}}class we extends Se{constructor(){super()}static Create(t){return new we}static Destroy(t,o){}Reset(t,o,e,i){super.Reset(t,o,e,i)}Evaluate(t,o,e){Fo(t,this.m_fixtureA.GetShape(),o,this.m_fixtureB.GetShape(),e)}}class Ve extends Se{constructor(){super()}static Create(t){return new Ve}static Destroy(t,o){}Reset(t,o,e,i){super.Reset(t,o,e,i)}Evaluate(t,o,e){qo(t,this.m_fixtureA.GetShape(),o,this.m_fixtureB.GetShape(),e)}}class Me extends Se{constructor(){super()}static Create(t){return new Me}static Destroy(t,o){}Reset(t,o,e,i){super.Reset(t,o,e,i)}Evaluate(t,o,e){const i=this.m_fixtureA.GetShape(),s=this.m_fixtureB.GetShape(),n=i,r=Me.Evaluate_s_edge;n.GetChildEdge(r,this.m_indexA),Fo(t,r,o,s,e)}}Me.Evaluate_s_edge=new Qo;class Pe extends Se{constructor(){super()}static Create(t){return new Pe}static Destroy(t,o){}Reset(t,o,e,i){super.Reset(t,o,e,i)}Evaluate(t,o,e){const i=this.m_fixtureA.GetShape(),s=this.m_fixtureB.GetShape(),n=i,r=Pe.Evaluate_s_edge;n.GetChildEdge(r,this.m_indexA),qo(t,r,o,s,e)}}Pe.Evaluate_s_edge=new Qo;class Ie{constructor(){this.createFcn=null,this.destroyFcn=null,this.primary=!1}}class Ge{constructor(t){this.m_allocator=null,this.m_allocator=t,this.InitializeRegisters()}AddType(t,o,e,i){const s=r(256,o=>t(this.m_allocator));function n(o){return s.pop()||t(o)}function a(t,o){s.push(t)}this.m_registers[e][i].createFcn=n,this.m_registers[e][i].destroyFcn=a,this.m_registers[e][i].primary=!0,e!==i&&(this.m_registers[i][e].createFcn=n,this.m_registers[i][e].destroyFcn=a,this.m_registers[i][e].primary=!1)}InitializeRegisters(){this.m_registers=[];for(let o=0;o<t.b2ShapeType.e_shapeTypeCount;o++){this.m_registers[o]=[];for(let e=0;e<t.b2ShapeType.e_shapeTypeCount;e++)this.m_registers[o][e]=new Ie}this.AddType(be.Create,be.Destroy,t.b2ShapeType.e_circleShape,t.b2ShapeType.e_circleShape),this.AddType(ve.Create,ve.Destroy,t.b2ShapeType.e_polygonShape,t.b2ShapeType.e_circleShape),this.AddType(Ae.Create,Ae.Destroy,t.b2ShapeType.e_polygonShape,t.b2ShapeType.e_polygonShape),this.AddType(we.Create,we.Destroy,t.b2ShapeType.e_edgeShape,t.b2ShapeType.e_circleShape),this.AddType(Ve.Create,Ve.Destroy,t.b2ShapeType.e_edgeShape,t.b2ShapeType.e_polygonShape),this.AddType(Me.Create,Me.Destroy,t.b2ShapeType.e_chainShape,t.b2ShapeType.e_circleShape),this.AddType(Pe.Create,Pe.Destroy,t.b2ShapeType.e_chainShape,t.b2ShapeType.e_polygonShape)}Create(t,o,e,i){const s=t.GetType(),n=e.GetType(),r=this.m_registers[s][n];if(r.createFcn){const s=r.createFcn(this.m_allocator);return r.primary?s.Reset(t,o,e,i):s.Reset(e,i,t,o),s}return null}Destroy(t){const o=t.m_fixtureA,e=t.m_fixtureB;t.m_manifold.pointCount>0&&!o.IsSensor()&&!e.IsSensor()&&(o.GetBody().SetAwake(!0),e.GetBody().SetAwake(!0));const i=o.GetType(),s=e.GetType(),n=this.m_registers[i][s];n.destroyFcn&&n.destroyFcn(t,this.m_allocator)}}class De{ShouldCollide(o,e){const i=o.GetBody(),s=e.GetBody();if(s.GetType()===t.b2BodyType.b2_staticBody&&i.GetType()===t.b2BodyType.b2_staticBody)return!1;if(!s.ShouldCollideConnected(i))return!1;const n=o.GetFilterData(),r=e.GetFilterData();return n.groupIndex===r.groupIndex&&0!==n.groupIndex?n.groupIndex>0:0!=(n.maskBits&r.categoryBits)&&0!=(n.categoryBits&r.maskBits)}ShouldCollideFixtureParticle(t,o,e){return!0}ShouldCollideParticleParticle(t,o,e){return!0}}De.b2_defaultFilter=new De;class Te{constructor(){this.normalImpulses=a(2),this.tangentImpulses=a(2),this.count=0}}class Fe{BeginContact(t){}EndContact(t){}BeginContactFixtureParticle(t,o){}EndContactFixtureParticle(t,o){}BeginContactParticleParticle(t,o){}EndContactParticleParticle(t,o){}PreSolve(t,o){}PostSolve(t,o){}}Fe.b2_defaultListener=new Fe;class Le{ReportFixture(t){return!0}ReportParticle(t,o){return!1}ShouldQueryParticleSystem(t){return!0}}class Re{constructor(){this.m_broadPhase=new vt,this.m_contactList=null,this.m_contactCount=0,this.m_contactFilter=De.b2_defaultFilter,this.m_contactListener=Fe.b2_defaultListener,this.m_allocator=null,this.m_contactFactory=new Ge(this.m_allocator)}AddPair(t,o){let e=t.fixture,i=o.fixture,s=t.childIndex,n=o.childIndex,r=e.GetBody(),a=i.GetBody();if(r===a)return;let m=a.GetContactList();for(;m;){if(m.other===r){const t=m.contact.GetFixtureA(),o=m.contact.GetFixtureB(),r=m.contact.GetChildIndexA(),a=m.contact.GetChildIndexB();if(t===e&&o===i&&r===s&&a===n)return;if(t===i&&o===e&&r===n&&a===s)return}m=m.next}if(this.m_contactFilter&&!this.m_contactFilter.ShouldCollide(e,i))return;const p=this.m_contactFactory.Create(e,s,i,n);null!==p&&(e=p.GetFixtureA(),i=p.GetFixtureB(),s=p.GetChildIndexA(),n=p.GetChildIndexB(),r=e.m_body,a=i.m_body,p.m_prev=null,p.m_next=this.m_contactList,null!==this.m_contactList&&(this.m_contactList.m_prev=p),this.m_contactList=p,p.m_nodeA.contact=p,p.m_nodeA.other=a,p.m_nodeA.prev=null,p.m_nodeA.next=r.m_contactList,null!==r.m_contactList&&(r.m_contactList.prev=p.m_nodeA),r.m_contactList=p.m_nodeA,p.m_nodeB.contact=p,p.m_nodeB.other=r,p.m_nodeB.prev=null,p.m_nodeB.next=a.m_contactList,null!==a.m_contactList&&(a.m_contactList.prev=p.m_nodeB),a.m_contactList=p.m_nodeB,e.IsSensor()||i.IsSensor()||(r.SetAwake(!0),a.SetAwake(!0)),++this.m_contactCount)}FindNewContacts(){this.m_broadPhase.UpdatePairs((t,o)=>{this.AddPair(t,o)})}Destroy(t){const o=t.GetFixtureA(),e=t.GetFixtureB(),i=o.GetBody(),s=e.GetBody();this.m_contactListener&&t.IsTouching()&&this.m_contactListener.EndContact(t),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_contactList&&(this.m_contactList=t.m_next),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA===i.m_contactList&&(i.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB===s.m_contactList&&(s.m_contactList=t.m_nodeB.next),this.m_contactFactory.Destroy(t),--this.m_contactCount}Collide(){let o=this.m_contactList;for(;o;){const e=o.GetFixtureA(),i=o.GetFixtureB(),s=o.GetChildIndexA(),n=o.GetChildIndexB(),r=e.GetBody(),a=i.GetBody();if(o.m_filterFlag){if(this.m_contactFilter&&!this.m_contactFilter.ShouldCollide(e,i)){const t=o;o=t.m_next,this.Destroy(t);continue}o.m_filterFlag=!1}const m=r.IsAwake()&&r.m_type!==t.b2BodyType.b2_staticBody,p=a.IsAwake()&&a.m_type!==t.b2BodyType.b2_staticBody;if(!m&&!p){o=o.m_next;continue}const l=e.m_proxies[s].treeNode,f=i.m_proxies[n].treeNode;if(ct(l.aabb,f.aabb))o.Update(this.m_contactListener),o=o.m_next;else{const t=o;o=t.m_next,this.Destroy(t)}}}}class ke{constructor(){this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0}Reset(){return this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0,this}}class ze{constructor(){this.dt=0,this.inv_dt=0,this.dtRatio=0,this.velocityIterations=0,this.positionIterations=0,this.particleIterations=0,this.warmStarting=!1}Copy(t){return this.dt=t.dt,this.inv_dt=t.inv_dt,this.dtRatio=t.dtRatio,this.positionIterations=t.positionIterations,this.velocityIterations=t.velocityIterations,this.particleIterations=t.particleIterations,this.warmStarting=t.warmStarting,this}}class qe{constructor(){this.c=new S,this.a=0}static MakeArray(t){return r(t,t=>new qe)}}class Ee{constructor(){this.v=new S,this.w=0}static MakeArray(t){return r(t,t=>new Ee)}}class Je{constructor(){this.step=new ze}}class je{constructor(){this.rA=new S,this.rB=new S,this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0}static MakeArray(t){return r(t,t=>new je)}}class Ne{constructor(){this.points=je.MakeArray(2),this.normal=new S,this.tangent=new S,this.normalMass=new v,this.K=new v,this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.invIA=0,this.invIB=0,this.friction=0,this.restitution=0,this.tangentSpeed=0,this.pointCount=0,this.contactIndex=0}static MakeArray(t){return r(t,t=>new Ne)}}class Oe{constructor(){this.localPoints=S.MakeArray(2),this.localNormal=new S,this.localPoint=new S,this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.localCenterA=new S,this.localCenterB=new S,this.invIA=0,this.invIB=0,this.type=t.b2ManifoldType.e_unknown,this.radiusA=0,this.radiusB=0,this.pointCount=0}static MakeArray(t){return r(t,t=>new Oe)}}class Ue{constructor(){this.step=new ze,this.count=0,this.allocator=null}}class Xe{constructor(){this.normal=new S,this.point=new S,this.separation=0}Initialize(o,e,i,s){const n=Xe.Initialize_s_pointA,r=Xe.Initialize_s_pointB,a=Xe.Initialize_s_planePoint,m=Xe.Initialize_s_clipPoint;switch(o.type){case t.b2ManifoldType.e_circles:M.MulXV(e,o.localPoint,n),M.MulXV(i,o.localPoints[0],r),S.SubVV(r,n,this.normal).SelfNormalize(),S.MidVV(n,r,this.point),this.separation=S.DotVV(S.SubVV(r,n,S.s_t0),this.normal)-o.radiusA-o.radiusB;break;case t.b2ManifoldType.e_faceA:V.MulRV(e.q,o.localNormal,this.normal),M.MulXV(e,o.localPoint,a),M.MulXV(i,o.localPoints[s],m),this.separation=S.DotVV(S.SubVV(m,a,S.s_t0),this.normal)-o.radiusA-o.radiusB,this.point.Copy(m);break;case t.b2ManifoldType.e_faceB:V.MulRV(i.q,o.localNormal,this.normal),M.MulXV(i,o.localPoint,a),M.MulXV(e,o.localPoints[s],m),this.separation=S.DotVV(S.SubVV(m,a,S.s_t0),this.normal)-o.radiusA-o.radiusB,this.point.Copy(m),this.normal.SelfNeg()}}}Xe.Initialize_s_pointA=new S,Xe.Initialize_s_pointB=new S,Xe.Initialize_s_planePoint=new S,Xe.Initialize_s_clipPoint=new S;class We{constructor(){this.m_step=new ze,this.m_allocator=null,this.m_positionConstraints=Oe.MakeArray(1024),this.m_velocityConstraints=Ne.MakeArray(1024),this.m_count=0}Initialize(t){if(this.m_step.Copy(t.step),this.m_allocator=t.allocator,this.m_count=t.count,this.m_positionConstraints.length<this.m_count){const t=l(2*this.m_positionConstraints.length,this.m_count);for(;this.m_positionConstraints.length<t;)this.m_positionConstraints[this.m_positionConstraints.length]=new Oe}if(this.m_velocityConstraints.length<this.m_count){const t=l(2*this.m_velocityConstraints.length,this.m_count);for(;this.m_velocityConstraints.length<t;)this.m_velocityConstraints[this.m_velocityConstraints.length]=new Ne}this.m_positions=t.positions,this.m_velocities=t.velocities,this.m_contacts=t.contacts;for(let t=0;t<this.m_count;++t){const o=this.m_contacts[t],e=o.m_fixtureA,i=o.m_fixtureB,s=e.GetShape(),n=i.GetShape(),r=s.m_radius,a=n.m_radius,m=e.GetBody(),p=i.GetBody(),l=o.GetManifold(),f=l.pointCount,h=this.m_velocityConstraints[t];h.friction=o.m_friction,h.restitution=o.m_restitution,h.tangentSpeed=o.m_tangentSpeed,h.indexA=m.m_islandIndex,h.indexB=p.m_islandIndex,h.invMassA=m.m_invMass,h.invMassB=p.m_invMass,h.invIA=m.m_invI,h.invIB=p.m_invI,h.contactIndex=t,h.pointCount=f,h.K.SetZero(),h.normalMass.SetZero();const y=this.m_positionConstraints[t];y.indexA=m.m_islandIndex,y.indexB=p.m_islandIndex,y.invMassA=m.m_invMass,y.invMassB=p.m_invMass,y.localCenterA.Copy(m.m_sweep.localCenter),y.localCenterB.Copy(p.m_sweep.localCenter),y.invIA=m.m_invI,y.invIB=p.m_invI,y.localNormal.Copy(l.localNormal),y.localPoint.Copy(l.localPoint),y.pointCount=f,y.radiusA=r,y.radiusB=a,y.type=l.type;for(let t=0;t<f;++t){const o=l.points[t],e=h.points[t];this.m_step.warmStarting?(e.normalImpulse=this.m_step.dtRatio*o.normalImpulse,e.tangentImpulse=this.m_step.dtRatio*o.tangentImpulse):(e.normalImpulse=0,e.tangentImpulse=0),e.rA.SetZero(),e.rB.SetZero(),e.normalMass=0,e.tangentMass=0,e.velocityBias=0,y.localPoints[t].Copy(o.localPoint)}}return this}InitializeVelocityConstraints(){const t=We.InitializeVelocityConstraints_s_xfA,o=We.InitializeVelocityConstraints_s_xfB,e=We.InitializeVelocityConstraints_s_worldManifold;for(let i=0;i<this.m_count;++i){const s=this.m_velocityConstraints[i],n=this.m_positionConstraints[i],r=n.radiusA,a=n.radiusB,m=this.m_contacts[s.contactIndex].GetManifold(),p=s.indexA,l=s.indexB,f=s.invMassA,h=s.invMassB,y=s.invIA,_=s.invIB,c=n.localCenterA,C=n.localCenterB,u=this.m_positions[p].c,d=this.m_positions[p].a,x=this.m_velocities[p].v,g=this.m_velocities[p].w,B=this.m_positions[l].c,b=this.m_positions[l].a,A=this.m_velocities[l].v,v=this.m_velocities[l].w;t.q.SetAngle(d),o.q.SetAngle(b),S.SubVV(u,V.MulRV(t.q,c,S.s_t0),t.p),S.SubVV(B,V.MulRV(o.q,C,S.s_t0),o.p),e.Initialize(m,t,r,o,a),s.normal.Copy(e.normal),S.CrossVOne(s.normal,s.tangent);const w=s.pointCount;for(let t=0;t<w;++t){const o=s.points[t];S.SubVV(e.points[t],u,o.rA),S.SubVV(e.points[t],B,o.rB);const i=S.CrossVV(o.rA,s.normal),n=S.CrossVV(o.rB,s.normal),r=f+h+y*i*i+_*n*n;o.normalMass=r>0?1/r:0;const a=s.tangent,m=S.CrossVV(o.rA,a),p=S.CrossVV(o.rB,a),l=f+h+y*m*m+_*p*p;o.tangentMass=l>0?1/l:0,o.velocityBias=0;const c=S.DotVV(s.normal,S.SubVV(S.AddVCrossSV(A,v,o.rB,S.s_t0),S.AddVCrossSV(x,g,o.rA,S.s_t1),S.s_t0));c<-1&&(o.velocityBias+=-s.restitution*c)}s.pointCount}}WarmStart(){const t=We.WarmStart_s_P;for(let o=0;o<this.m_count;++o){const e=this.m_velocityConstraints[o],i=e.indexA,s=e.indexB,n=e.invMassA,r=e.invIA,a=e.invMassB,m=e.invIB,p=e.pointCount,l=this.m_velocities[i].v;let f=this.m_velocities[i].w;const h=this.m_velocities[s].v;let y=this.m_velocities[s].w;const _=e.normal,c=e.tangent;for(let o=0;o<p;++o){const i=e.points[o];S.AddVV(S.MulSV(i.normalImpulse,_,S.s_t0),S.MulSV(i.tangentImpulse,c,S.s_t1),t),f-=r*S.CrossVV(i.rA,t),l.SelfMulSub(n,t),y+=m*S.CrossVV(i.rB,t),h.SelfMulAdd(a,t)}this.m_velocities[i].w=f,this.m_velocities[s].w=y}}SolveVelocityConstraints(){const t=We.SolveVelocityConstraints_s_dv,o=(We.SolveVelocityConstraints_s_dv1,We.SolveVelocityConstraints_s_dv2,We.SolveVelocityConstraints_s_P);We.SolveVelocityConstraints_s_a,We.SolveVelocityConstraints_s_b,We.SolveVelocityConstraints_s_x,We.SolveVelocityConstraints_s_d,We.SolveVelocityConstraints_s_P1,We.SolveVelocityConstraints_s_P2,We.SolveVelocityConstraints_s_P1P2;for(let e=0;e<this.m_count;++e){const i=this.m_velocityConstraints[e],s=i.indexA,n=i.indexB,r=i.invMassA,a=i.invIA,m=i.invMassB,p=i.invIB,h=i.pointCount,y=this.m_velocities[s].v;let _=this.m_velocities[s].w;const c=this.m_velocities[n].v;let C=this.m_velocities[n].w;const u=i.normal,d=i.tangent,x=i.friction;for(let e=0;e<h;++e){const s=i.points[e];S.SubVV(S.AddVCrossSV(c,C,s.rB,S.s_t0),S.AddVCrossSV(y,_,s.rA,S.s_t1),t);const n=S.DotVV(t,d)-i.tangentSpeed;let l=s.tangentMass*-n;const h=x*s.normalImpulse,u=f(s.tangentImpulse+l,-h,h);l=u-s.tangentImpulse,s.tangentImpulse=u,S.MulSV(l,d,o),y.SelfMulSub(r,o),_-=a*S.CrossVV(s.rA,o),c.SelfMulAdd(m,o),C+=p*S.CrossVV(s.rB,o)}i.pointCount;for(let e=0;e<h;++e){const s=i.points[e];S.SubVV(S.AddVCrossSV(c,C,s.rB,S.s_t0),S.AddVCrossSV(y,_,s.rA,S.s_t1),t);const n=S.DotVV(t,u);let f=-s.normalMass*(n-s.velocityBias);const h=l(s.normalImpulse+f,0);f=h-s.normalImpulse,s.normalImpulse=h,S.MulSV(f,u,o),y.SelfMulSub(r,o),_-=a*S.CrossVV(s.rA,o),c.SelfMulAdd(m,o),C+=p*S.CrossVV(s.rB,o)}this.m_velocities[s].w=_,this.m_velocities[n].w=C}}StoreImpulses(){for(let t=0;t<this.m_count;++t){const o=this.m_velocityConstraints[t],e=this.m_contacts[o.contactIndex].GetManifold();for(let t=0;t<o.pointCount;++t)e.points[t].normalImpulse=o.points[t].normalImpulse,e.points[t].tangentImpulse=o.points[t].tangentImpulse}}SolvePositionConstraints(){const t=We.SolvePositionConstraints_s_xfA,o=We.SolvePositionConstraints_s_xfB,e=We.SolvePositionConstraints_s_psm,i=We.SolvePositionConstraints_s_rA,s=We.SolvePositionConstraints_s_rB,n=We.SolvePositionConstraints_s_P;let r=0;for(let a=0;a<this.m_count;++a){const m=this.m_positionConstraints[a],l=m.indexA,h=m.indexB,y=m.localCenterA,_=m.invMassA,c=m.invIA,C=m.localCenterB,u=m.invMassB,d=m.invIB,x=m.pointCount,g=this.m_positions[l].c;let B=this.m_positions[l].a;const b=this.m_positions[h].c;let A=this.m_positions[h].a;for(let a=0;a<x;++a){t.q.SetAngle(B),o.q.SetAngle(A),S.SubVV(g,V.MulRV(t.q,y,S.s_t0),t.p),S.SubVV(b,V.MulRV(o.q,C,S.s_t0),o.p),e.Initialize(m,t,o,a);const l=e.normal,h=e.point,x=e.separation;S.SubVV(h,g,i),S.SubVV(h,b,s),r=p(r,x);const v=f(.2*(x+.008),-.2,0),w=S.CrossVV(i,l),M=S.CrossVV(s,l),P=_+u+c*w*w+d*M*M,I=P>0?-v/P:0;S.MulSV(I,l,n),g.SelfMulSub(_,n),B-=c*S.CrossVV(i,n),b.SelfMulAdd(u,n),A+=d*S.CrossVV(s,n)}this.m_positions[l].a=B,this.m_positions[h].a=A}return r>-.024}SolveTOIPositionConstraints(t,o){const e=We.SolveTOIPositionConstraints_s_xfA,i=We.SolveTOIPositionConstraints_s_xfB,s=We.SolveTOIPositionConstraints_s_psm,n=We.SolveTOIPositionConstraints_s_rA,r=We.SolveTOIPositionConstraints_s_rB,a=We.SolveTOIPositionConstraints_s_P;let m=0;for(let l=0;l<this.m_count;++l){const h=this.m_positionConstraints[l],y=h.indexA,_=h.indexB,c=h.localCenterA,C=h.localCenterB,u=h.pointCount;let d=0,x=0;y!==t&&y!==o||(d=h.invMassA,x=h.invIA);let g=0,B=0;_!==t&&_!==o||(g=h.invMassB,B=h.invIB);const b=this.m_positions[y].c;let A=this.m_positions[y].a;const v=this.m_positions[_].c;let w=this.m_positions[_].a;for(let t=0;t<u;++t){e.q.SetAngle(A),i.q.SetAngle(w),S.SubVV(b,V.MulRV(e.q,c,S.s_t0),e.p),S.SubVV(v,V.MulRV(i.q,C,S.s_t0),i.p),s.Initialize(h,e,i,t);const o=s.normal,l=s.point,y=s.separation;S.SubVV(l,b,n),S.SubVV(l,v,r),m=p(m,y);const _=f(.75*(y+.008),-.2,0),u=S.CrossVV(n,o),M=S.CrossVV(r,o),P=d+g+x*u*u+B*M*M,I=P>0?-_/P:0;S.MulSV(I,o,a),b.SelfMulSub(d,a),A-=x*S.CrossVV(n,a),v.SelfMulAdd(g,a),w+=B*S.CrossVV(r,a)}this.m_positions[y].a=A,this.m_positions[_].a=w}return m>=-.012}}We.InitializeVelocityConstraints_s_xfA=new M,We.InitializeVelocityConstraints_s_xfB=new M,We.InitializeVelocityConstraints_s_worldManifold=new lt,We.WarmStart_s_P=new S,We.SolveVelocityConstraints_s_dv=new S,We.SolveVelocityConstraints_s_dv1=new S,We.SolveVelocityConstraints_s_dv2=new S,We.SolveVelocityConstraints_s_P=new S,We.SolveVelocityConstraints_s_a=new S,We.SolveVelocityConstraints_s_b=new S,We.SolveVelocityConstraints_s_x=new S,We.SolveVelocityConstraints_s_d=new S,We.SolveVelocityConstraints_s_P1=new S,We.SolveVelocityConstraints_s_P2=new S,We.SolveVelocityConstraints_s_P1P2=new S,We.SolvePositionConstraints_s_xfA=new M,We.SolvePositionConstraints_s_xfB=new M,We.SolvePositionConstraints_s_psm=new Xe,We.SolvePositionConstraints_s_rA=new S,We.SolvePositionConstraints_s_rB=new S,We.SolvePositionConstraints_s_P=new S,We.SolveTOIPositionConstraints_s_xfA=new M,We.SolveTOIPositionConstraints_s_xfB=new M,We.SolveTOIPositionConstraints_s_psm=new Xe,We.SolveTOIPositionConstraints_s_rA=new S,We.SolveTOIPositionConstraints_s_rB=new S,We.SolveTOIPositionConstraints_s_P=new S;class Ze{constructor(){this.m_allocator=null,this.m_bodies=[],this.m_contacts=[],this.m_joints=[],this.m_positions=qe.MakeArray(1024),this.m_velocities=Ee.MakeArray(1024),this.m_bodyCount=0,this.m_jointCount=0,this.m_contactCount=0,this.m_bodyCapacity=0,this.m_contactCapacity=0,this.m_jointCapacity=0}Initialize(t,o,e,i,s){if(this.m_bodyCapacity=t,this.m_contactCapacity=o,this.m_jointCapacity=e,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_allocator=i,this.m_listener=s,this.m_positions.length<t){const o=l(2*this.m_positions.length,t);for(;this.m_positions.length<o;)this.m_positions[this.m_positions.length]=new qe}if(this.m_velocities.length<t){const o=l(2*this.m_velocities.length,t);for(;this.m_velocities.length<o;)this.m_velocities[this.m_velocities.length]=new Ee}}Clear(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0}AddBody(t){t.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=t}AddContact(t){this.m_contacts[this.m_contactCount++]=t}AddJoint(t){this.m_joints[this.m_jointCount++]=t}Solve(o,e,i,s){const n=Ze.s_timer.Reset(),r=e.dt;for(let o=0;o<this.m_bodyCount;++o){const e=this.m_bodies[o];this.m_positions[o].c.Copy(e.m_sweep.c);const s=e.m_sweep.a,n=this.m_velocities[o].v.Copy(e.m_linearVelocity);let a=e.m_angularVelocity;e.m_sweep.c0.Copy(e.m_sweep.c),e.m_sweep.a0=e.m_sweep.a,e.m_type===t.b2BodyType.b2_dynamicBody&&(n.x+=r*(e.m_gravityScale*i.x+e.m_invMass*e.m_force.x),n.y+=r*(e.m_gravityScale*i.y+e.m_invMass*e.m_force.y),a+=r*e.m_invI*e.m_torque,n.SelfMul(1/(1+r*e.m_linearDamping)),a*=1/(1+r*e.m_angularDamping)),this.m_positions[o].a=s,this.m_velocities[o].w=a}n.Reset();const a=Ze.s_solverData;a.step.Copy(e),a.positions=this.m_positions,a.velocities=this.m_velocities;const l=Ze.s_contactSolverDef;l.step.Copy(e),l.contacts=this.m_contacts,l.count=this.m_contactCount,l.positions=this.m_positions,l.velocities=this.m_velocities,l.allocator=this.m_allocator;const f=Ze.s_contactSolver.Initialize(l);f.InitializeVelocityConstraints(),e.warmStarting&&f.WarmStart();for(let t=0;t<this.m_jointCount;++t)this.m_joints[t].InitVelocityConstraints(a);o.solveInit=n.GetMilliseconds(),n.Reset();for(let t=0;t<e.velocityIterations;++t){for(let t=0;t<this.m_jointCount;++t)this.m_joints[t].SolveVelocityConstraints(a);f.SolveVelocityConstraints()}f.StoreImpulses(),o.solveVelocity=n.GetMilliseconds();for(let t=0;t<this.m_bodyCount;++t){const o=this.m_positions[t].c;let e=this.m_positions[t].a;const i=this.m_velocities[t].v;let s=this.m_velocities[t].w;const n=S.MulSV(r,i,Ze.s_translation);if(S.DotVV(n,n)>4){const t=2/n.Length();i.SelfMul(t)}const a=r*s;a*a>2.4674011002726646&&(s*=1.570796326795/m(a)),o.x+=r*i.x,o.y+=r*i.y,e+=r*s,this.m_positions[t].a=e,this.m_velocities[t].w=s}n.Reset();let h=!1;for(let t=0;t<e.positionIterations;++t){const t=f.SolvePositionConstraints();let o=!0;for(let t=0;t<this.m_jointCount;++t){const e=this.m_joints[t].SolvePositionConstraints(a);o=o&&e}if(t&&o){h=!0;break}}for(let t=0;t<this.m_bodyCount;++t){const o=this.m_bodies[t];o.m_sweep.c.Copy(this.m_positions[t].c),o.m_sweep.a=this.m_positions[t].a,o.m_linearVelocity.Copy(this.m_velocities[t].v),o.m_angularVelocity=this.m_velocities[t].w,o.SynchronizeTransform()}if(o.solvePosition=n.GetMilliseconds(),this.Report(f.m_velocityConstraints),s){let o=1e37;const e=1e-4,i=.0012184696791469947;for(let s=0;s<this.m_bodyCount;++s){const n=this.m_bodies[s];n.GetType()!==t.b2BodyType.b2_staticBody&&(!n.m_autoSleepFlag||n.m_angularVelocity*n.m_angularVelocity>i||S.DotVV(n.m_linearVelocity,n.m_linearVelocity)>e?(n.m_sleepTime=0,o=0):(n.m_sleepTime+=r,o=p(o,n.m_sleepTime)))}if(o>=.5&&h)for(let t=0;t<this.m_bodyCount;++t)this.m_bodies[t].SetAwake(!1)}}SolveTOI(t,o,e){for(let t=0;t<this.m_bodyCount;++t){const o=this.m_bodies[t];this.m_positions[t].c.Copy(o.m_sweep.c),this.m_positions[t].a=o.m_sweep.a,this.m_velocities[t].v.Copy(o.m_linearVelocity),this.m_velocities[t].w=o.m_angularVelocity}const i=Ze.s_contactSolverDef;i.contacts=this.m_contacts,i.count=this.m_contactCount,i.allocator=this.m_allocator,i.step.Copy(t),i.positions=this.m_positions,i.velocities=this.m_velocities;const s=Ze.s_contactSolver.Initialize(i);for(let i=0;i<t.positionIterations&&!s.SolveTOIPositionConstraints(o,e);++i);this.m_bodies[o].m_sweep.c0.Copy(this.m_positions[o].c),this.m_bodies[o].m_sweep.a0=this.m_positions[o].a,this.m_bodies[e].m_sweep.c0.Copy(this.m_positions[e].c),this.m_bodies[e].m_sweep.a0=this.m_positions[e].a,s.InitializeVelocityConstraints();for(let o=0;o<t.velocityIterations;++o)s.SolveVelocityConstraints();const n=t.dt;for(let t=0;t<this.m_bodyCount;++t){const o=this.m_positions[t].c;let e=this.m_positions[t].a;const i=this.m_velocities[t].v;let s=this.m_velocities[t].w;const r=S.MulSV(n,i,Ze.s_translation);if(S.DotVV(r,r)>4){const t=2/r.Length();i.SelfMul(t)}const a=n*s;a*a>2.4674011002726646&&(s*=1.570796326795/m(a)),o.SelfMulAdd(n,i),e+=n*s,this.m_positions[t].a=e,this.m_velocities[t].w=s;const p=this.m_bodies[t];p.m_sweep.c.Copy(o),p.m_sweep.a=e,p.m_linearVelocity.Copy(i),p.m_angularVelocity=s,p.SynchronizeTransform()}this.Report(s.m_velocityConstraints)}Report(t){if(null!==this.m_listener)for(let o=0;o<this.m_contactCount;++o){const e=this.m_contacts[o];if(!e)continue;const i=t[o],s=Ze.s_impulse;s.count=i.pointCount;for(let t=0;t<i.pointCount;++t)s.normalImpulses[t]=i.points[t].normalImpulse,s.tangentImpulses[t]=i.points[t].tangentImpulse;this.m_listener.PostSolve(e,s)}}}Ze.s_timer=new D,Ze.s_solverData=new Je,Ze.s_contactSolverDef=new Ue,Ze.s_contactSolver=new We,Ze.s_translation=new S,Ze.s_impulse=new Te,(Uo=t.b2ParticleFlag||(t.b2ParticleFlag={}))[Uo.b2_waterParticle=0]="b2_waterParticle",Uo[Uo.b2_zombieParticle=2]="b2_zombieParticle",Uo[Uo.b2_wallParticle=4]="b2_wallParticle",Uo[Uo.b2_springParticle=8]="b2_springParticle",Uo[Uo.b2_elasticParticle=16]="b2_elasticParticle",Uo[Uo.b2_viscousParticle=32]="b2_viscousParticle",Uo[Uo.b2_powderParticle=64]="b2_powderParticle",Uo[Uo.b2_tensileParticle=128]="b2_tensileParticle",Uo[Uo.b2_colorMixingParticle=256]="b2_colorMixingParticle",Uo[Uo.b2_destructionListenerParticle=512]="b2_destructionListenerParticle",Uo[Uo.b2_barrierParticle=1024]="b2_barrierParticle",Uo[Uo.b2_staticPressureParticle=2048]="b2_staticPressureParticle",Uo[Uo.b2_reactiveParticle=4096]="b2_reactiveParticle",Uo[Uo.b2_repulsiveParticle=8192]="b2_repulsiveParticle",Uo[Uo.b2_fixtureContactListenerParticle=16384]="b2_fixtureContactListenerParticle",Uo[Uo.b2_particleContactListenerParticle=32768]="b2_particleContactListenerParticle",Uo[Uo.b2_fixtureContactFilterParticle=65536]="b2_fixtureContactFilterParticle",Uo[Uo.b2_particleContactFilterParticle=131072]="b2_particleContactFilterParticle";class He{constructor(){this.flags=0,this.position=new S,this.velocity=new S,this.color=new I(0,0,0,0),this.lifetime=0,this.userData=null,this.group=null}}function Qe(t,o,e){return f(Math.ceil(Math.sqrt(t/(.01*o))*e),1,8)}class Ye{constructor(){this.m_index=-1}GetIndex(){return this.m_index}SetIndex(t){this.m_index=t}}(Xo=t.b2ParticleGroupFlag||(t.b2ParticleGroupFlag={}))[Xo.b2_solidParticleGroup=1]="b2_solidParticleGroup",Xo[Xo.b2_rigidParticleGroup=2]="b2_rigidParticleGroup",Xo[Xo.b2_particleGroupCanBeEmpty=4]="b2_particleGroupCanBeEmpty",Xo[Xo.b2_particleGroupWillBeDestroyed=8]="b2_particleGroupWillBeDestroyed",Xo[Xo.b2_particleGroupNeedsUpdateDepth=16]="b2_particleGroupNeedsUpdateDepth",Xo[Xo.b2_particleGroupInternalMask=24]="b2_particleGroupInternalMask";class Ke{constructor(){this.flags=0,this.groupFlags=0,this.position=new S,this.angle=0,this.linearVelocity=new S,this.angularVelocity=0,this.color=new I,this.strength=1,this.shapeCount=0,this.stride=0,this.particleCount=0,this.lifetime=0,this.userData=null,this.group=null}}class $e{constructor(t){this.m_firstIndex=0,this.m_lastIndex=0,this.m_groupFlags=0,this.m_strength=1,this.m_prev=null,this.m_next=null,this.m_timestamp=-1,this.m_mass=0,this.m_inertia=0,this.m_center=new S,this.m_linearVelocity=new S,this.m_angularVelocity=0,this.m_transform=new M,this.m_userData=null,this.m_system=t}GetNext(){return this.m_next}GetParticleSystem(){return this.m_system}GetParticleCount(){return this.m_lastIndex-this.m_firstIndex}GetBufferIndex(){return this.m_firstIndex}ContainsParticle(t){return this.m_firstIndex<=t&&t<this.m_lastIndex}GetAllParticleFlags(){if(!this.m_system.m_flagsBuffer.data)throw new Error;let t=0;for(let o=this.m_firstIndex;o<this.m_lastIndex;o++)t|=this.m_system.m_flagsBuffer.data[o];return t}GetGroupFlags(){return this.m_groupFlags}SetGroupFlags(o){o|=this.m_groupFlags&t.b2ParticleGroupFlag.b2_particleGroupInternalMask,this.m_system.SetGroupFlags(this,o)}GetMass(){return this.UpdateStatistics(),this.m_mass}GetInertia(){return this.UpdateStatistics(),this.m_inertia}GetCenter(){return this.UpdateStatistics(),this.m_center}GetLinearVelocity(){return this.UpdateStatistics(),this.m_linearVelocity}GetAngularVelocity(){return this.UpdateStatistics(),this.m_angularVelocity}GetTransform(){return this.m_transform}GetPosition(){return this.m_transform.p}GetAngle(){return this.m_transform.q.GetAngle()}GetLinearVelocityFromWorldPoint(t,o){const e=$e.GetLinearVelocityFromWorldPoint_s_t0;return this.UpdateStatistics(),S.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,S.SubVV(t,this.m_center,e),o)}GetUserData(){return this.m_userData}SetUserData(t){this.m_userData=t}ApplyForce(t){this.m_system.ApplyForce(this.m_firstIndex,this.m_lastIndex,t)}ApplyLinearImpulse(t){this.m_system.ApplyLinearImpulse(this.m_firstIndex,this.m_lastIndex,t)}DestroyParticles(t){if(this.m_system.m_world.IsLocked())throw new Error;for(let o=this.m_firstIndex;o<this.m_lastIndex;o++)this.m_system.DestroyParticle(o,t)}UpdateStatistics(){if(!this.m_system.m_positionBuffer.data)throw new Error;if(!this.m_system.m_velocityBuffer.data)throw new Error;const t=new S,o=new S;if(this.m_timestamp!==this.m_system.m_timestamp){const e=this.m_system.GetParticleMass();this.m_mass=e*(this.m_lastIndex-this.m_firstIndex),this.m_center.SetZero(),this.m_linearVelocity.SetZero();for(let t=this.m_firstIndex;t<this.m_lastIndex;t++)this.m_center.SelfMulAdd(e,this.m_system.m_positionBuffer.data[t]),this.m_linearVelocity.SelfMulAdd(e,this.m_system.m_velocityBuffer.data[t]);if(this.m_mass>0){const t=1/this.m_mass;this.m_center.SelfMul(t),this.m_linearVelocity.SelfMul(t)}this.m_inertia=0,this.m_angularVelocity=0;for(let i=this.m_firstIndex;i<this.m_lastIndex;i++)S.SubVV(this.m_system.m_positionBuffer.data[i],this.m_center,t),S.SubVV(this.m_system.m_velocityBuffer.data[i],this.m_linearVelocity,o),this.m_inertia+=e*S.DotVV(t,t),this.m_angularVelocity+=e*S.CrossVV(t,o);this.m_inertia>0&&(this.m_angularVelocity*=1/this.m_inertia),this.m_timestamp=this.m_system.m_timestamp}}}$e.GetLinearVelocityFromWorldPoint_s_t0=new S;class ti{constructor(t){this.m_front=0,this.m_back=0,this.m_capacity=0,this.m_buffer=r(t,t=>null),this.m_capacity=t}Push(t){if(this.m_back>=this.m_capacity){for(let t=this.m_front;t<this.m_back;t++)this.m_buffer[t-this.m_front]=this.m_buffer[t];this.m_back-=this.m_front,this.m_front=0,this.m_back>=this.m_capacity&&(this.m_capacity>0?(this.m_buffer.concat(r(this.m_capacity,t=>null)),this.m_capacity*=2):(this.m_buffer.concat(r(1,t=>null)),this.m_capacity=1))}this.m_buffer[this.m_back]=t,this.m_back++}Pop(){this.m_buffer[this.m_front]=null,this.m_front++}Empty(){return this.m_front===this.m_back}Front(){const t=this.m_buffer[this.m_front];if(!t)throw new Error;return t}}class oi{constructor(t){this.m_generatorCapacity=0,this.m_generatorCount=0,this.m_countX=0,this.m_countY=0,this.m_diagram=[],this.m_generatorBuffer=r(t,t=>new oi.Generator),this.m_generatorCapacity=t}AddGenerator(t,o,e){const i=this.m_generatorBuffer[this.m_generatorCount++];i.center.Copy(t),i.tag=o,i.necessary=e}Generate(t,o){const e=1/t,i=new S(1e37,1e37),s=new S(-1e37,-1e37);let n=0;for(let t=0;t<this.m_generatorCount;t++){const o=this.m_generatorBuffer[t];o.necessary&&(S.MinV(i,o.center,i),S.MaxV(s,o.center,s),++n)}if(0===n)return this.m_countX=0,void(this.m_countY=0);i.x-=o,i.y-=o,s.x+=o,s.y+=o,this.m_countX=1+Math.floor(e*(s.x-i.x)),this.m_countY=1+Math.floor(e*(s.y-i.y)),this.m_diagram=[];const r=new ti(4*this.m_countX*this.m_countY);for(let t=0;t<this.m_generatorCount;t++){const o=this.m_generatorBuffer[t];o.center.SelfSub(i).SelfMul(e);const s=Math.floor(o.center.x),n=Math.floor(o.center.y);s>=0&&n>=0&&s<this.m_countX&&n<this.m_countY&&r.Push(new oi.Task(s,n,s+n*this.m_countX,o))}for(;!r.Empty();){const t=r.Front(),o=t.m_x,e=t.m_y,i=t.m_i,s=t.m_generator;r.Pop(),this.m_diagram[i]||(this.m_diagram[i]=s,o>0&&r.Push(new oi.Task(o-1,e,i-1,s)),e>0&&r.Push(new oi.Task(o,e-1,i-this.m_countX,s)),o<this.m_countX-1&&r.Push(new oi.Task(o+1,e,i+1,s)),e<this.m_countY-1&&r.Push(new oi.Task(o,e+1,i+this.m_countX,s)))}for(let t=0;t<this.m_countY;t++)for(let o=0;o<this.m_countX-1;o++){const e=o+t*this.m_countX,i=this.m_diagram[e],s=this.m_diagram[e+1];i!==s&&(r.Push(new oi.Task(o,t,e,s)),r.Push(new oi.Task(o+1,t,e+1,i)))}for(let t=0;t<this.m_countY-1;t++)for(let o=0;o<this.m_countX;o++){const e=o+t*this.m_countX,i=this.m_diagram[e],s=this.m_diagram[e+this.m_countX];i!==s&&(r.Push(new oi.Task(o,t,e,s)),r.Push(new oi.Task(o,t+1,e+this.m_countX,i)))}for(;!r.Empty();){const t=r.Front(),o=t.m_x,e=t.m_y,i=t.m_i,s=t.m_generator;r.Pop();const n=this.m_diagram[i],a=s;if(n!==a){const t=n.center.x-o,s=n.center.y-e,m=a.center.x-o,p=a.center.y-e;t*t+s*s>m*m+p*p&&(this.m_diagram[i]=a,o>0&&r.Push(new oi.Task(o-1,e,i-1,a)),e>0&&r.Push(new oi.Task(o,e-1,i-this.m_countX,a)),o<this.m_countX-1&&r.Push(new oi.Task(o+1,e,i+1,a)),e<this.m_countY-1&&r.Push(new oi.Task(o,e+1,i+this.m_countX,a)))}}}GetNodes(t){for(let o=0;o<this.m_countY-1;o++)for(let e=0;e<this.m_countX-1;e++){const i=e+o*this.m_countX,s=this.m_diagram[i],n=this.m_diagram[i+1],r=this.m_diagram[i+this.m_countX],a=this.m_diagram[i+1+this.m_countX];n!==r&&(s!==n&&s!==r&&(s.necessary||n.necessary||r.necessary)&&t(s.tag,n.tag,r.tag),a!==n&&a!==r&&(s.necessary||n.necessary||r.necessary)&&t(n.tag,a.tag,r.tag))}}}function ei(t,o,e){const i=t[o];t[o]=t[e],t[e]=i}function ii(t,o){return t<o}function si(t,o=0,e=t.length-o,i=ii){let s=o;const n=[];let r=0;for(;;){for(;s+1<e;e++){const o=t[s+Math.floor(Math.random()*(e-s))];n[r++]=e;for(let n=s-1;;){for(;i(t[++n],o););for(;i(o,t[--e]););if(n>=e)break;ei(t,n,e)}}if(0===r)break;s=e,e=n[--r]}return t}function ni(t,o=0,e=t.length-o,i=ii){return si(t,o,e,i)}function ri(t,o,e=t.length){let i=0;for(let s=0;s<e;++s)o(t[s])||(s!==i?ei(t,i++,s):++i);return i}function ai(t,o,e,i,s=ii){let n=e-o;for(;n>0;){const e=Math.floor(n/2);let r=o+e;s(t[r],i)?(o=++r,n-=e+1):n=e}return o}function mi(t,o,e,i,s=ii){let n=e-o;for(;n>0;){const e=Math.floor(n/2);let r=o+e;s(i,t[r])?n=e:(o=++r,n-=e+1)}return o}function pi(t,o,e,i){let s=e;for(;o!==s;)ei(t,o++,s++),s===i?s=e:o===e&&(e=s)}!function(t){t.Generator=class{constructor(){this.center=new S,this.tag=0,this.necessary=!1}},t.Task=class{constructor(t,o,e,i){this.m_x=t,this.m_y=o,this.m_i=e,this.m_generator=i}}}(oi||(oi={}));class li{constructor(t){this.data=[],this.count=0,this.capacity=0,this.allocator=t}Append(){return this.count>=this.capacity&&this.Grow(),this.count++}Reserve(t){if(!(this.capacity>=t)){for(let o=this.capacity;o<t;++o)this.data[o]=this.allocator();this.capacity=t}}Grow(){const t=this.capacity?2*this.capacity:256;this.Reserve(t)}Free(){0!==this.data.length&&(this.data=[],this.capacity=0,this.count=0)}Shorten(t){}Data(){return this.data}GetCount(){return this.count}SetCount(t){this.count=t}GetCapacity(){return this.capacity}RemoveIf(t){this.count=ri(this.data,t,this.count)}Unique(t){this.count=function(t,o,e,i){if(o===e)return e;let s=o;for(;++o!==e;)i(t[s],t[o])||ei(t,++s,o);return++s}(this.data,0,this.count,t)}}class fi extends Le{constructor(t){super(),this.m_system=t}ShouldQueryParticleSystem(t){return!1}ReportFixture(t){if(t.IsSensor())return!0;const o=t.GetShape().GetChildCount();for(let e=0;e<o;e++){const o=t.GetAABB(e),i=this.m_system.GetInsideBoundsEnumerator(o);let s;for(;(s=i.GetNext())>=0;)this.ReportFixtureAndParticle(t,e,s)}return!0}ReportParticle(t,o){return!1}ReportFixtureAndParticle(t,o,e){}}class hi{constructor(){this.indexA=0,this.indexB=0,this.weight=0,this.normal=new S,this.flags=0}SetIndices(t,o){this.indexA=t,this.indexB=o}SetWeight(t){this.weight=t}SetNormal(t){this.normal.Copy(t)}SetFlags(t){this.flags=t}GetIndexA(){return this.indexA}GetIndexB(){return this.indexB}GetWeight(){return this.weight}GetNormal(){return this.normal}GetFlags(){return this.flags}IsEqual(t){return this.indexA===t.indexA&&this.indexB===t.indexB&&this.flags===t.flags&&this.weight===t.weight&&this.normal.x===t.normal.x&&this.normal.y===t.normal.y}IsNotEqual(t){return!this.IsEqual(t)}ApproximatelyEqual(t){return this.indexA===t.indexA&&this.indexB===t.indexB&&this.flags===t.flags&&m(this.weight-t.weight)<.01&&S.DistanceSquaredVV(this.normal,t.normal)<1e-4}}class yi{constructor(){this.index=0,this.weight=0,this.normal=new S,this.mass=0}}class _i{constructor(){this.indexA=0,this.indexB=0,this.flags=0,this.strength=0,this.distance=0}}class ci{constructor(){this.indexA=0,this.indexB=0,this.indexC=0,this.flags=0,this.strength=0,this.pa=new S(0,0),this.pb=new S(0,0),this.pc=new S(0,0),this.ka=0,this.kb=0,this.kc=0,this.s=0}}class Ci{constructor(){this.strictContactCheck=!1,this.density=1,this.gravityScale=1,this.radius=1,this.maxCount=0,this.pressureStrength=.005,this.dampingStrength=1,this.elasticStrength=.25,this.springStrength=.25,this.viscousStrength=.25,this.surfaceTensionPressureStrength=.2,this.surfaceTensionNormalStrength=.2,this.repulsiveStrength=1,this.powderStrength=.5,this.ejectionStrength=.5,this.staticPressureStrength=.2,this.staticPressureRelaxation=.2,this.staticPressureIterations=8,this.colorMixingStrength=.5,this.destroyByAge=!0,this.lifetimeGranularity=1/60}Copy(t){return this.strictContactCheck=t.strictContactCheck,this.density=t.density,this.gravityScale=t.gravityScale,this.radius=t.radius,this.maxCount=t.maxCount,this.pressureStrength=t.pressureStrength,this.dampingStrength=t.dampingStrength,this.elasticStrength=t.elasticStrength,this.springStrength=t.springStrength,this.viscousStrength=t.viscousStrength,this.surfaceTensionPressureStrength=t.surfaceTensionPressureStrength,this.surfaceTensionNormalStrength=t.surfaceTensionNormalStrength,this.repulsiveStrength=t.repulsiveStrength,this.powderStrength=t.powderStrength,this.ejectionStrength=t.ejectionStrength,this.staticPressureStrength=t.staticPressureStrength,this.staticPressureRelaxation=t.staticPressureRelaxation,this.staticPressureIterations=t.staticPressureIterations,this.colorMixingStrength=t.colorMixingStrength,this.destroyByAge=t.destroyByAge,this.lifetimeGranularity=t.lifetimeGranularity,this}Clone(){return(new Ci).Copy(this)}}class ui{constructor(t,o){this.m_paused=!1,this.m_timestamp=0,this.m_allParticleFlags=0,this.m_needsUpdateAllParticleFlags=!1,this.m_allGroupFlags=0,this.m_needsUpdateAllGroupFlags=!1,this.m_hasForce=!1,this.m_iterationIndex=0,this.m_inverseDensity=0,this.m_particleDiameter=0,this.m_inverseDiameter=0,this.m_squaredDiameter=0,this.m_count=0,this.m_internalAllocatedCapacity=0,this.m_handleIndexBuffer=new ui.UserOverridableBuffer,this.m_flagsBuffer=new ui.UserOverridableBuffer,this.m_positionBuffer=new ui.UserOverridableBuffer,this.m_velocityBuffer=new ui.UserOverridableBuffer,this.m_forceBuffer=[],this.m_weightBuffer=[],this.m_staticPressureBuffer=[],this.m_accumulationBuffer=[],this.m_accumulation2Buffer=[],this.m_depthBuffer=[],this.m_colorBuffer=new ui.UserOverridableBuffer,this.m_groupBuffer=[],this.m_userDataBuffer=new ui.UserOverridableBuffer,this.m_stuckThreshold=0,this.m_lastBodyContactStepBuffer=new ui.UserOverridableBuffer,this.m_bodyContactCountBuffer=new ui.UserOverridableBuffer,this.m_consecutiveContactStepsBuffer=new ui.UserOverridableBuffer,this.m_stuckParticleBuffer=new li(()=>0),this.m_proxyBuffer=new li(()=>new ui.Proxy),this.m_contactBuffer=new li(()=>new hi),this.m_bodyContactBuffer=new li(()=>new yi),this.m_pairBuffer=new li(()=>new _i),this.m_triadBuffer=new li(()=>new ci),this.m_expirationTimeBuffer=new ui.UserOverridableBuffer,this.m_indexByExpirationTimeBuffer=new ui.UserOverridableBuffer,this.m_timeElapsed=0,this.m_expirationTimeBufferRequiresSorting=!1,this.m_groupCount=0,this.m_groupList=null,this.m_def=new Ci,this.m_prev=null,this.m_next=null,this.SetStrictContactCheck(t.strictContactCheck),this.SetDensity(t.density),this.SetGravityScale(t.gravityScale),this.SetRadius(t.radius),this.SetMaxParticleCount(t.maxCount),this.m_def=t.Clone(),this.m_world=o,this.SetDestructionByAge(this.m_def.destroyByAge)}static computeTag(t,o){return(o+ui.yOffset>>>0<<ui.yShift)+(ui.xScale*t+ui.xOffset>>>0)>>>0}static computeRelativeTag(t,o,e){return t+(e<<ui.yShift)+(o<<ui.xShift)>>>0}Drop(){for(;this.m_groupList;)this.DestroyParticleGroup(this.m_groupList);this.FreeUserOverridableBuffer(this.m_handleIndexBuffer),this.FreeUserOverridableBuffer(this.m_flagsBuffer),this.FreeUserOverridableBuffer(this.m_lastBodyContactStepBuffer),this.FreeUserOverridableBuffer(this.m_bodyContactCountBuffer),this.FreeUserOverridableBuffer(this.m_consecutiveContactStepsBuffer),this.FreeUserOverridableBuffer(this.m_positionBuffer),this.FreeUserOverridableBuffer(this.m_velocityBuffer),this.FreeUserOverridableBuffer(this.m_colorBuffer),this.FreeUserOverridableBuffer(this.m_userDataBuffer),this.FreeUserOverridableBuffer(this.m_expirationTimeBuffer),this.FreeUserOverridableBuffer(this.m_indexByExpirationTimeBuffer),this.FreeBuffer(this.m_forceBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_weightBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_staticPressureBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_accumulationBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_accumulation2Buffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_depthBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_groupBuffer,this.m_internalAllocatedCapacity)}CreateParticle(t){if(this.m_world.IsLocked())throw new Error;if(this.m_count>=this.m_internalAllocatedCapacity){const t=this.m_count?2*this.m_count:256;this.ReallocateInternalAllocatedBuffers(t)}if(this.m_count>=this.m_internalAllocatedCapacity){if(!this.m_def.destroyByAge)return-1;this.DestroyOldestParticle(0,!1),this.SolveZombie()}const e=this.m_count++;if(!this.m_flagsBuffer.data)throw new Error;if(this.m_flagsBuffer.data[e]=0,this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[e]=0),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[e]=0),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[e]=0),!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;this.m_positionBuffer.data[e]=(this.m_positionBuffer.data[e]||new S).Copy(o(t.position,S.ZERO)),this.m_velocityBuffer.data[e]=(this.m_velocityBuffer.data[e]||new S).Copy(o(t.velocity,S.ZERO)),this.m_weightBuffer[e]=0,this.m_forceBuffer[e]=(this.m_forceBuffer[e]||new S).SetZero(),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[e]=0),this.m_depthBuffer&&(this.m_depthBuffer[e]=0);const i=(new I).Copy(o(t.color,I.ZERO));!this.m_colorBuffer.data&&i.IsZero()||(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data[e]=(this.m_colorBuffer.data[e]||new I).Copy(i)),(this.m_userDataBuffer.data||t.userData)&&(this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data[e]=t.userData),this.m_handleIndexBuffer.data&&(this.m_handleIndexBuffer.data[e]=null);const s=this.m_proxyBuffer.data[this.m_proxyBuffer.Append()],n=o(t.lifetime,0),r=n>0;if(this.m_expirationTimeBuffer.data||r){if(this.SetParticleLifetime(e,r?n:this.ExpirationTimeToLifetime(-this.GetQuantizedTimeElapsed())),!this.m_indexByExpirationTimeBuffer.data)throw new Error;this.m_indexByExpirationTimeBuffer.data[e]=e}s.index=e;const a=o(t.group,null);return this.m_groupBuffer[e]=a,a&&(a.m_firstIndex<a.m_lastIndex?(this.RotateBuffer(a.m_firstIndex,a.m_lastIndex,e),a.m_lastIndex=e+1):(a.m_firstIndex=e,a.m_lastIndex=e+1)),this.SetParticleFlags(e,o(t.flags,0)),e}GetParticleHandleFromIndex(t){this.m_handleIndexBuffer.data=this.RequestBuffer(this.m_handleIndexBuffer.data);let o=this.m_handleIndexBuffer.data[t];return o||(o=new Ye,o.SetIndex(t),this.m_handleIndexBuffer.data[t]=o,o)}DestroyParticle(o,e=!1){if(!this.m_flagsBuffer.data)throw new Error;let i=t.b2ParticleFlag.b2_zombieParticle;e&&(i|=t.b2ParticleFlag.b2_destructionListenerParticle),this.SetParticleFlags(o,this.m_flagsBuffer.data[o]|i)}DestroyOldestParticle(t,o=!1){const e=this.GetParticleCount();if(!this.m_indexByExpirationTimeBuffer.data)throw new Error;if(!this.m_expirationTimeBuffer.data)throw new Error;const i=this.m_indexByExpirationTimeBuffer.data[e-(t+1)],s=this.m_indexByExpirationTimeBuffer.data[t];this.DestroyParticle(this.m_expirationTimeBuffer.data[i]>0?i:s,o)}DestroyParticlesInShape(t,o,e=!1){const i=ui.DestroyParticlesInShape_s_aabb;if(this.m_world.IsLocked())throw new Error;const s=new ui.DestroyParticlesInShapeCallback(this,t,o,e),n=i;return t.ComputeAABB(n,o,0),this.m_world.QueryAABB(s,n),s.Destroyed()}CreateParticleGroup(t){const e=ui.CreateParticleGroup_s_transform;if(this.m_world.IsLocked())throw new Error;const i=e;i.SetPositionAngle(o(t.position,S.ZERO),o(t.angle,0));const s=this.m_count;if(t.shape&&this.CreateParticlesWithShapeForGroup(t.shape,t,i),t.shapes&&this.CreateParticlesWithShapesForGroup(t.shapes,o(t.shapeCount,t.shapes.length),t,i),t.positionData){const e=o(t.particleCount,t.positionData.length);for(let o=0;o<e;o++){const e=t.positionData[o];this.CreateParticleForGroup(t,i,e)}}const n=this.m_count;let r=new $e(this);r.m_firstIndex=s,r.m_lastIndex=n,r.m_strength=o(t.strength,1),r.m_userData=t.userData,r.m_transform.Copy(i),r.m_prev=null,r.m_next=this.m_groupList,this.m_groupList&&(this.m_groupList.m_prev=r),this.m_groupList=r,++this.m_groupCount;for(let t=s;t<n;t++)this.m_groupBuffer[t]=r;this.SetGroupFlags(r,o(t.groupFlags,0));const a=new ui.ConnectionFilter;return this.UpdateContacts(!0),this.UpdatePairsAndTriads(s,n,a),t.group&&(this.JoinParticleGroups(t.group,r),r=t.group),r}JoinParticleGroups(t,o){if(this.m_world.IsLocked())throw new Error;this.RotateBuffer(o.m_firstIndex,o.m_lastIndex,this.m_count),this.RotateBuffer(t.m_firstIndex,t.m_lastIndex,o.m_firstIndex);const e=new ui.JoinParticleGroupsFilter(o.m_firstIndex);this.UpdateContacts(!0),this.UpdatePairsAndTriads(t.m_firstIndex,o.m_lastIndex,e);for(let e=o.m_firstIndex;e<o.m_lastIndex;e++)this.m_groupBuffer[e]=t;const i=t.m_groupFlags|o.m_groupFlags;this.SetGroupFlags(t,i),t.m_lastIndex=o.m_lastIndex,o.m_firstIndex=o.m_lastIndex,this.DestroyParticleGroup(o)}SplitParticleGroup(t){this.UpdateContacts(!0);const o=r(t.GetParticleCount(),t=>new ui.ParticleListNode);ui.InitializeParticleLists(t,o),this.MergeParticleListsInContact(t,o);const e=ui.FindLongestParticleList(t,o);this.MergeZombieParticleListNodes(t,o,e),this.CreateParticleGroupsFromParticleList(t,o,e),this.UpdatePairsAndTriadsWithParticleList(t,o)}GetParticleGroupList(){return this.m_groupList}GetParticleGroupCount(){return this.m_groupCount}GetParticleCount(){return this.m_count}GetMaxParticleCount(){return this.m_def.maxCount}SetMaxParticleCount(t){this.m_def.maxCount=t}GetAllParticleFlags(){return this.m_allParticleFlags}GetAllGroupFlags(){return this.m_allGroupFlags}SetPaused(t){this.m_paused=t}GetPaused(){return this.m_paused}SetDensity(t){this.m_def.density=t,this.m_inverseDensity=1/this.m_def.density}GetDensity(){return this.m_def.density}SetGravityScale(t){this.m_def.gravityScale=t}GetGravityScale(){return this.m_def.gravityScale}SetDamping(t){this.m_def.dampingStrength=t}GetDamping(){return this.m_def.dampingStrength}SetStaticPressureIterations(t){this.m_def.staticPressureIterations=t}GetStaticPressureIterations(){return this.m_def.staticPressureIterations}SetRadius(t){this.m_particleDiameter=2*t,this.m_squaredDiameter=this.m_particleDiameter*this.m_particleDiameter,this.m_inverseDiameter=1/this.m_particleDiameter}GetRadius(){return this.m_particleDiameter/2}GetPositionBuffer(){if(!this.m_positionBuffer.data)throw new Error;return this.m_positionBuffer.data}GetVelocityBuffer(){if(!this.m_velocityBuffer.data)throw new Error;return this.m_velocityBuffer.data}GetColorBuffer(){return this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data}GetGroupBuffer(){return this.m_groupBuffer}GetWeightBuffer(){return this.m_weightBuffer}GetUserDataBuffer(){return this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data}GetFlagsBuffer(){if(!this.m_flagsBuffer.data)throw new Error;return this.m_flagsBuffer.data}SetParticleFlags(o,e){if(!this.m_flagsBuffer.data)throw new Error;this.m_flagsBuffer.data[o]&~e&&(this.m_needsUpdateAllParticleFlags=!0),~this.m_allParticleFlags&e&&(e&t.b2ParticleFlag.b2_tensileParticle&&(this.m_accumulation2Buffer=this.RequestBuffer(this.m_accumulation2Buffer)),e&t.b2ParticleFlag.b2_colorMixingParticle&&(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data)),this.m_allParticleFlags|=e),this.m_flagsBuffer.data[o]=e}GetParticleFlags(t){if(!this.m_flagsBuffer.data)throw new Error;return this.m_flagsBuffer.data[t]}SetFlagsBuffer(t,o){this.SetUserOverridableBuffer(this.m_flagsBuffer,t,o)}SetPositionBuffer(t,o){this.SetUserOverridableBuffer(this.m_positionBuffer,t,o)}SetVelocityBuffer(t,o){this.SetUserOverridableBuffer(this.m_velocityBuffer,t,o)}SetColorBuffer(t,o){this.SetUserOverridableBuffer(this.m_colorBuffer,t,o)}SetUserDataBuffer(t,o){this.SetUserOverridableBuffer(this.m_userDataBuffer,t,o)}GetContacts(){return this.m_contactBuffer.data}GetContactCount(){return this.m_contactBuffer.count}GetBodyContacts(){return this.m_bodyContactBuffer.data}GetBodyContactCount(){return this.m_bodyContactBuffer.count}GetPairs(){return this.m_pairBuffer.data}GetPairCount(){return this.m_pairBuffer.count}GetTriads(){return this.m_triadBuffer.data}GetTriadCount(){return this.m_triadBuffer.count}SetStuckThreshold(t){this.m_stuckThreshold=t,t>0&&(this.m_lastBodyContactStepBuffer.data=this.RequestBuffer(this.m_lastBodyContactStepBuffer.data),this.m_bodyContactCountBuffer.data=this.RequestBuffer(this.m_bodyContactCountBuffer.data),this.m_consecutiveContactStepsBuffer.data=this.RequestBuffer(this.m_consecutiveContactStepsBuffer.data))}GetStuckCandidates(){return this.m_stuckParticleBuffer.Data()}GetStuckCandidateCount(){return this.m_stuckParticleBuffer.GetCount()}ComputeCollisionEnergy(){if(!this.m_velocityBuffer.data)throw new Error;const t=ui.ComputeCollisionEnergy_s_v,o=this.m_velocityBuffer.data;let e=0;for(let i=0;i<this.m_contactBuffer.count;i++){const s=this.m_contactBuffer.data[i],n=s.indexA,r=s.indexB,a=s.normal,m=S.SubVV(o[r],o[n],t),p=S.DotVV(m,a);p<0&&(e+=p*p)}return.5*this.GetParticleMass()*e}SetStrictContactCheck(t){this.m_def.strictContactCheck=t}GetStrictContactCheck(){return this.m_def.strictContactCheck}SetParticleLifetime(t,o){const e=null===this.m_indexByExpirationTimeBuffer.data;if(this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),e){const t=this.GetParticleCount();for(let o=0;o<t;++o)this.m_indexByExpirationTimeBuffer.data[o]=o}const i=o/this.m_def.lifetimeGranularity,s=i>0?this.GetQuantizedTimeElapsed()+i:i;s!==this.m_expirationTimeBuffer.data[t]&&(this.m_expirationTimeBuffer.data[t]=s,this.m_expirationTimeBufferRequiresSorting=!0)}GetParticleLifetime(t){return this.ExpirationTimeToLifetime(this.GetExpirationTimeBuffer()[t])}SetDestructionByAge(t){t&&this.GetExpirationTimeBuffer(),this.m_def.destroyByAge=t}GetDestructionByAge(){return this.m_def.destroyByAge}GetExpirationTimeBuffer(){return this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_expirationTimeBuffer.data}ExpirationTimeToLifetime(t){return(t>0?t-this.GetQuantizedTimeElapsed():t)*this.m_def.lifetimeGranularity}GetIndexByExpirationTimeBuffer(){if(this.GetParticleCount()?this.SetParticleLifetime(0,this.GetParticleLifetime(0)):this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),!this.m_indexByExpirationTimeBuffer.data)throw new Error;return this.m_indexByExpirationTimeBuffer.data}ParticleApplyLinearImpulse(t,o){this.ApplyLinearImpulse(t,t+1,o)}ApplyLinearImpulse(t,o,e){if(!this.m_velocityBuffer.data)throw new Error;const i=this.m_velocityBuffer.data,s=(o-t)*this.GetParticleMass(),n=(new S).Copy(e).SelfMul(1/s);for(let e=t;e<o;e++)i[e].SelfAdd(n)}static IsSignificantForce(t){return 0!==t.x||0!==t.y}ParticleApplyForce(t,o){if(!this.m_flagsBuffer.data)throw new Error;ui.IsSignificantForce(o)&&this.ForceCanBeApplied(this.m_flagsBuffer.data[t])&&(this.PrepareForceBuffer(),this.m_forceBuffer[t].SelfAdd(o))}ApplyForce(t,o,e){const i=(new S).Copy(e).SelfMul(1/(o-t));if(ui.IsSignificantForce(i)){this.PrepareForceBuffer();for(let e=t;e<o;e++)this.m_forceBuffer[e].SelfAdd(i)}}GetNext(){return this.m_next}QueryAABB(t,o){if(0===this.m_proxyBuffer.count)return;const e=this.m_proxyBuffer.count,i=ai(this.m_proxyBuffer.data,0,e,ui.computeTag(this.m_inverseDiameter*o.lowerBound.x,this.m_inverseDiameter*o.lowerBound.y),ui.Proxy.CompareProxyTag),s=mi(this.m_proxyBuffer.data,i,e,ui.computeTag(this.m_inverseDiameter*o.upperBound.x,this.m_inverseDiameter*o.upperBound.y),ui.Proxy.CompareTagProxy);if(!this.m_positionBuffer.data)throw new Error;const n=this.m_positionBuffer.data;for(let e=i;e<s;++e){const i=this.m_proxyBuffer.data[e].index,s=n[i];if(o.lowerBound.x<s.x&&s.x<o.upperBound.x&&o.lowerBound.y<s.y&&s.y<o.upperBound.y&&!t.ReportParticle(this,i))break}}QueryShapeAABB(t,o,e,i=0){const s=ui.QueryShapeAABB_s_aabb;o.ComputeAABB(s,e,i),this.QueryAABB(t,s)}QueryPointAABB(t,o,e=.008){const i=ui.QueryPointAABB_s_aabb;i.lowerBound.Set(o.x-e,o.y-e),i.upperBound.Set(o.x+e,o.y+e),this.QueryAABB(t,i)}RayCast(t,o,e){const i=ui.RayCast_s_aabb,s=ui.RayCast_s_p,n=ui.RayCast_s_v,r=ui.RayCast_s_n,a=ui.RayCast_s_point;if(0===this.m_proxyBuffer.count)return;if(!this.m_positionBuffer.data)throw new Error;const m=this.m_positionBuffer.data,l=i;S.MinV(o,e,l.lowerBound),S.MaxV(o,e,l.upperBound);let f=1;const h=S.SubVV(e,o,n),y=S.DotVV(h,h),_=this.GetInsideBoundsEnumerator(l);let C;for(;(C=_.GetNext())>=0;){const e=S.SubVV(o,m[C],s),i=S.DotVV(e,h),n=i*i-y*(S.DotVV(e,e)-this.m_squaredDiameter);if(n>=0){const s=c(n);let m=(-i-s)/y;if(m>f)continue;if(m<0&&(m=(-i+s)/y,m<0||m>f))continue;const l=S.AddVMulSV(e,m,h,r);l.Normalize();const _=t.ReportParticle(this,C,S.AddVMulSV(o,m,h,a),l,m);if(f=p(f,_),f<=0)break}}}ComputeAABB(t){const o=this.GetParticleCount();if(t.lowerBound.x=1e37,t.lowerBound.y=1e37,t.upperBound.x=-1e37,t.upperBound.y=-1e37,!this.m_positionBuffer.data)throw new Error;const e=this.m_positionBuffer.data;for(let i=0;i<o;i++){const o=e[i];S.MinV(t.lowerBound,o,t.lowerBound),S.MaxV(t.upperBound,o,t.upperBound)}t.lowerBound.x-=this.m_particleDiameter,t.lowerBound.y-=this.m_particleDiameter,t.upperBound.x+=this.m_particleDiameter,t.upperBound.y+=this.m_particleDiameter}FreeBuffer(t,o){null!==t&&(t.length=0)}FreeUserOverridableBuffer(t){0===t.userSuppliedCapacity&&this.FreeBuffer(t.data,this.m_internalAllocatedCapacity)}ReallocateBuffer3(t,o,e){if(e<=o)throw new Error;const i=t?t.slice():[];return i.length=e,i}ReallocateBuffer5(t,o,e,i,s){if(i<=e)throw new Error;if(o&&!(i<=o))throw new Error;return s&&!t||o||(t=this.ReallocateBuffer3(t,e,i)),t}ReallocateBuffer4(t,o,e,i){return this.ReallocateBuffer5(t.data,t.userSuppliedCapacity,o,e,i)}RequestBuffer(t){return t||(0===this.m_internalAllocatedCapacity&&this.ReallocateInternalAllocatedBuffers(256),(t=[]).length=this.m_internalAllocatedCapacity),t}ReallocateHandleBuffers(t){this.m_handleIndexBuffer.data=this.ReallocateBuffer4(this.m_handleIndexBuffer,this.m_internalAllocatedCapacity,t,!0)}ReallocateInternalAllocatedBuffers(t){function o(t,o){return o&&t>o?o:t}if(t=o(t,this.m_def.maxCount),t=o(t,this.m_flagsBuffer.userSuppliedCapacity),t=o(t,this.m_positionBuffer.userSuppliedCapacity),t=o(t,this.m_velocityBuffer.userSuppliedCapacity),t=o(t,this.m_colorBuffer.userSuppliedCapacity),t=o(t,this.m_userDataBuffer.userSuppliedCapacity),this.m_internalAllocatedCapacity<t){this.ReallocateHandleBuffers(t),this.m_flagsBuffer.data=this.ReallocateBuffer4(this.m_flagsBuffer,this.m_internalAllocatedCapacity,t,!1);const o=this.m_stuckThreshold>0;this.m_lastBodyContactStepBuffer.data=this.ReallocateBuffer4(this.m_lastBodyContactStepBuffer,this.m_internalAllocatedCapacity,t,o),this.m_bodyContactCountBuffer.data=this.ReallocateBuffer4(this.m_bodyContactCountBuffer,this.m_internalAllocatedCapacity,t,o),this.m_consecutiveContactStepsBuffer.data=this.ReallocateBuffer4(this.m_consecutiveContactStepsBuffer,this.m_internalAllocatedCapacity,t,o),this.m_positionBuffer.data=this.ReallocateBuffer4(this.m_positionBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_velocityBuffer.data=this.ReallocateBuffer4(this.m_velocityBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_forceBuffer=this.ReallocateBuffer5(this.m_forceBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_weightBuffer=this.ReallocateBuffer5(this.m_weightBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_staticPressureBuffer=this.ReallocateBuffer5(this.m_staticPressureBuffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_accumulationBuffer=this.ReallocateBuffer5(this.m_accumulationBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_accumulation2Buffer=this.ReallocateBuffer5(this.m_accumulation2Buffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_depthBuffer=this.ReallocateBuffer5(this.m_depthBuffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_colorBuffer.data=this.ReallocateBuffer4(this.m_colorBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_groupBuffer=this.ReallocateBuffer5(this.m_groupBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_userDataBuffer.data=this.ReallocateBuffer4(this.m_userDataBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_expirationTimeBuffer.data=this.ReallocateBuffer4(this.m_expirationTimeBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_indexByExpirationTimeBuffer.data=this.ReallocateBuffer4(this.m_indexByExpirationTimeBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_internalAllocatedCapacity=t}}CreateParticleForGroup(t,e,i){const s=new He;s.flags=o(t.flags,0),M.MulXV(e,i,s.position),S.AddVV(o(t.linearVelocity,S.ZERO),S.CrossSV(o(t.angularVelocity,0),S.SubVV(s.position,o(t.position,S.ZERO),S.s_t0),S.s_t0),s.velocity),s.color.Copy(o(t.color,I.ZERO)),s.lifetime=o(t.lifetime,0),s.userData=t.userData,this.CreateParticle(s)}CreateParticlesStrokeShapeForGroup(e,i,s){const n=ui.CreateParticlesStrokeShapeForGroup_s_edge,r=ui.CreateParticlesStrokeShapeForGroup_s_d,a=ui.CreateParticlesStrokeShapeForGroup_s_p;let m=o(i.stride,0);0===m&&(m=this.GetParticleStride());let p=0;const l=e.GetChildCount();for(let o=0;o<l;o++){let l=null;e.GetType()===t.b2ShapeType.e_edgeShape?l=e:(l=n,e.GetChildEdge(l,o));const f=S.SubVV(l.m_vertex2,l.m_vertex1,r),h=f.Length();for(;p<h;){const t=S.AddVMulSV(l.m_vertex1,p/h,f,a);this.CreateParticleForGroup(i,s,t),p+=m}p-=h}}CreateParticlesFillShapeForGroup(t,e,i){const s=ui.CreateParticlesFillShapeForGroup_s_aabb,n=ui.CreateParticlesFillShapeForGroup_s_p;let r=o(e.stride,0);0===r&&(r=this.GetParticleStride());const a=M.IDENTITY,m=s;t.ComputeAABB(m,a,0);for(let o=Math.floor(m.lowerBound.y/r)*r;o<m.upperBound.y;o+=r)for(let s=Math.floor(m.lowerBound.x/r)*r;s<m.upperBound.x;s+=r){const r=n.Set(s,o);t.TestPoint(a,r)&&this.CreateParticleForGroup(e,i,r)}}CreateParticlesWithShapeForGroup(o,e,i){switch(o.GetType()){case t.b2ShapeType.e_edgeShape:case t.b2ShapeType.e_chainShape:this.CreateParticlesStrokeShapeForGroup(o,e,i);break;case t.b2ShapeType.e_polygonShape:case t.b2ShapeType.e_circleShape:this.CreateParticlesFillShapeForGroup(o,e,i)}}CreateParticlesWithShapesForGroup(t,o,e,i){const s=new ui.CompositeShape(t,o);this.CreateParticlesFillShapeForGroup(s,e,i)}CloneParticle(t,o){const e=new He;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;e.flags=this.m_flagsBuffer.data[t],e.position.Copy(this.m_positionBuffer.data[t]),e.velocity.Copy(this.m_velocityBuffer.data[t]),this.m_colorBuffer.data&&e.color.Copy(this.m_colorBuffer.data[t]),this.m_userDataBuffer.data&&(e.userData=this.m_userDataBuffer.data[t]),e.group=o;const i=this.CreateParticle(e);if(this.m_handleIndexBuffer.data){const o=this.m_handleIndexBuffer.data[t];o&&o.SetIndex(i),this.m_handleIndexBuffer.data[i]=o,this.m_handleIndexBuffer.data[t]=null}return this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[i]=this.m_lastBodyContactStepBuffer.data[t]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[i]=this.m_bodyContactCountBuffer.data[t]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[i]=this.m_consecutiveContactStepsBuffer.data[t]),this.m_hasForce&&this.m_forceBuffer[i].Copy(this.m_forceBuffer[t]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[i]=this.m_staticPressureBuffer[t]),this.m_depthBuffer&&(this.m_depthBuffer[i]=this.m_depthBuffer[t]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[i]=this.m_expirationTimeBuffer.data[t]),i}DestroyParticlesInGroup(t,o=!1){for(let e=t.m_firstIndex;e<t.m_lastIndex;e++)this.DestroyParticle(e,o)}DestroyParticleGroup(t){this.m_world.m_destructionListener&&this.m_world.m_destructionListener.SayGoodbyeParticleGroup(t),this.SetGroupFlags(t,0);for(let o=t.m_firstIndex;o<t.m_lastIndex;o++)this.m_groupBuffer[o]=null;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_groupList&&(this.m_groupList=t.m_next),--this.m_groupCount}static ParticleCanBeConnected(o,e){return 0!=(o&(t.b2ParticleFlag.b2_wallParticle|t.b2ParticleFlag.b2_springParticle|t.b2ParticleFlag.b2_elasticParticle))||null!==e&&0!=(e.GetGroupFlags()&t.b2ParticleGroupFlag.b2_rigidParticleGroup)}UpdatePairsAndTriads(o,e,i){const s=ui.UpdatePairsAndTriads_s_dab,n=ui.UpdatePairsAndTriads_s_dbc,r=ui.UpdatePairsAndTriads_s_dca;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;const a=this.m_positionBuffer.data;let m=0;for(let t=o;t<e;t++)m|=this.m_flagsBuffer.data[t];if(m&ui.k_pairFlags)for(let s=0;s<this.m_contactBuffer.count;s++){const n=this.m_contactBuffer.data[s],r=n.indexA,m=n.indexB,l=this.m_flagsBuffer.data[r],f=this.m_flagsBuffer.data[m],h=this.m_groupBuffer[r],y=this.m_groupBuffer[m];if(r>=o&&r<e&&m>=o&&m<e&&!((l|f)&t.b2ParticleFlag.b2_zombieParticle)&&(l|f)&ui.k_pairFlags&&(i.IsNecessary(r)||i.IsNecessary(m))&&ui.ParticleCanBeConnected(l,h)&&ui.ParticleCanBeConnected(f,y)&&i.ShouldCreatePair(r,m)){const t=this.m_pairBuffer.data[this.m_pairBuffer.Append()];t.indexA=r,t.indexB=m,t.flags=n.flags,t.strength=p(h?h.m_strength:1,y?y.m_strength:1),t.distance=S.DistanceVV(a[r],a[m])}ni(this.m_pairBuffer.data,0,this.m_pairBuffer.count,ui.ComparePairIndices),this.m_pairBuffer.Unique(ui.MatchPairIndices)}if(m&ui.k_triadFlags){const m=new oi(e-o);for(let s=o;s<e;s++){const o=this.m_flagsBuffer.data[s],e=this.m_groupBuffer[s];o&t.b2ParticleFlag.b2_zombieParticle||!ui.ParticleCanBeConnected(o,e)||m.AddGenerator(a[s],s,i.IsNecessary(s))}const l=this.GetParticleStride();m.Generate(l/2,2*l);const f=this,h=(t,o,e)=>{if(!f.m_flagsBuffer.data)throw new Error;const m=f.m_flagsBuffer.data[t],l=f.m_flagsBuffer.data[o],h=f.m_flagsBuffer.data[e];if((m|l|h)&ui.k_triadFlags&&i.ShouldCreateTriad(t,o,e)){const i=a[t],y=a[o],_=a[e],c=S.SubVV(i,y,s),C=S.SubVV(y,_,n),u=S.SubVV(_,i,r),d=4*f.m_squaredDiameter;if(S.DotVV(c,c)>d||S.DotVV(C,C)>d||S.DotVV(u,u)>d)return;const x=f.m_groupBuffer[t],g=f.m_groupBuffer[o],B=f.m_groupBuffer[e],b=f.m_triadBuffer.data[f.m_triadBuffer.Append()];b.indexA=t,b.indexB=o,b.indexC=e,b.flags=m|l|h,b.strength=p(p(x?x.m_strength:1,g?g.m_strength:1),B?B.m_strength:1);const A=(i.x+y.x+_.x)/3,v=(i.y+y.y+_.y)/3;b.pa.x=i.x-A,b.pa.y=i.y-v,b.pb.x=y.x-A,b.pb.y=y.y-v,b.pc.x=_.x-A,b.pc.y=_.y-v,b.ka=-S.DotVV(u,c),b.kb=-S.DotVV(c,C),b.kc=-S.DotVV(C,u),b.s=S.CrossVV(i,y)+S.CrossVV(y,_)+S.CrossVV(_,i)}};m.GetNodes(h),ni(this.m_triadBuffer.data,0,this.m_triadBuffer.count,ui.CompareTriadIndices),this.m_triadBuffer.Unique(ui.MatchTriadIndices)}}UpdatePairsAndTriadsWithReactiveParticles(){const o=new ui.ReactiveFilter(this.m_flagsBuffer);if(this.UpdatePairsAndTriads(0,this.m_count,o),!this.m_flagsBuffer.data)throw new Error;for(let o=0;o<this.m_count;o++)this.m_flagsBuffer.data[o]&=~t.b2ParticleFlag.b2_reactiveParticle;this.m_allParticleFlags&=~t.b2ParticleFlag.b2_reactiveParticle}static ComparePairIndices(t,o){const e=t.indexA-o.indexA;return 0!==e?e<0:t.indexB<o.indexB}static MatchPairIndices(t,o){return t.indexA===o.indexA&&t.indexB===o.indexB}static CompareTriadIndices(t,o){const e=t.indexA-o.indexA;if(0!==e)return e<0;const i=t.indexB-o.indexB;return 0!==i?i<0:t.indexC<o.indexC}static MatchTriadIndices(t,o){return t.indexA===o.indexA&&t.indexB===o.indexB&&t.indexC===o.indexC}static InitializeParticleLists(t,o){const e=t.GetBufferIndex(),i=t.GetParticleCount();for(let t=0;t<i;t++){const i=o[t];i.list=i,i.next=null,i.count=1,i.index=t+e}}MergeParticleListsInContact(t,o){const e=t.GetBufferIndex();for(let i=0;i<this.m_contactBuffer.count;i++){const s=this.m_contactBuffer.data[i],n=s.indexA,r=s.indexB;if(!t.ContainsParticle(n)||!t.ContainsParticle(r))continue;let a=o[n-e].list,m=o[r-e].list;if(a!==m){if(a.count<m.count){const t=a;a=m,m=t}ui.MergeParticleLists(a,m)}}}static MergeParticleLists(t,o){for(let e=o;;){e.list=t;const o=e.next;if(!o){e.next=t.next;break}e=o}t.next=o,t.count+=o.count,o.count=0}static FindLongestParticleList(t,o){const e=t.GetParticleCount();let i=o[0];for(let t=0;t<e;t++){const e=o[t];i.count<e.count&&(i=e)}return i}MergeZombieParticleListNodes(o,e,i){if(!this.m_flagsBuffer.data)throw new Error;const s=o.GetParticleCount();for(let o=0;o<s;o++){const s=e[o];s!==i&&this.m_flagsBuffer.data[s.index]&t.b2ParticleFlag.b2_zombieParticle&&ui.MergeParticleListAndNode(i,s)}}static MergeParticleListAndNode(t,o){o.list=t,o.next=t.next,t.next=o,t.count++,o.count=0}CreateParticleGroupsFromParticleList(o,e,i){if(!this.m_flagsBuffer.data)throw new Error;const s=o.GetParticleCount(),n=new Ke;n.groupFlags=o.GetGroupFlags(),n.userData=o.GetUserData();for(let o=0;o<s;o++){const s=e[o];if(!s.count||s===i)continue;const r=this.CreateParticleGroup(n);for(let o=s;o;o=o.next){const e=o.index,i=this.CloneParticle(e,r);this.m_flagsBuffer.data[e]|=t.b2ParticleFlag.b2_zombieParticle,o.index=i}}}UpdatePairsAndTriadsWithParticleList(t,o){const e=t.GetBufferIndex();for(let i=0;i<this.m_pairBuffer.count;i++){const s=this.m_pairBuffer.data[i],n=s.indexA,r=s.indexB;t.ContainsParticle(n)&&(s.indexA=o[n-e].index),t.ContainsParticle(r)&&(s.indexB=o[r-e].index)}for(let i=0;i<this.m_triadBuffer.count;i++){const s=this.m_triadBuffer.data[i],n=s.indexA,r=s.indexB,a=s.indexC;t.ContainsParticle(n)&&(s.indexA=o[n-e].index),t.ContainsParticle(r)&&(s.indexB=o[r-e].index),t.ContainsParticle(a)&&(s.indexC=o[a-e].index)}}ComputeDepth(){const o=[];let e=0;for(let i=0;i<this.m_contactBuffer.count;i++){const s=this.m_contactBuffer.data[i],n=s.indexA,r=s.indexB,a=this.m_groupBuffer[n],m=this.m_groupBuffer[r];a&&a===m&&a.m_groupFlags&t.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth&&(o[e++]=s)}const i=[];let s=0;for(let o=this.m_groupList;o;o=o.GetNext())if(o.m_groupFlags&t.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth){i[s++]=o,this.SetGroupFlags(o,o.m_groupFlags&~t.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth);for(let t=o.m_firstIndex;t<o.m_lastIndex;t++)this.m_accumulationBuffer[t]=0}for(let t=0;t<e;t++){const e=o[t],i=e.indexA,s=e.indexB,n=e.weight;this.m_accumulationBuffer[i]+=n,this.m_accumulationBuffer[s]+=n}for(let t=0;t<s;t++){const o=i[t];for(let t=o.m_firstIndex;t<o.m_lastIndex;t++){const o=this.m_accumulationBuffer[t];this.m_depthBuffer[t]=o<.8?0:1e37}}const n=c(this.m_count)>>0;for(let t=0;t<n;t++){let t=!1;for(let i=0;i<e;i++){const e=o[i],s=e.indexA,n=e.indexB,r=1-e.weight,a=this.m_depthBuffer[s],m=this.m_depthBuffer[n],p=m+r,l=a+r;a>p&&(this.m_depthBuffer[s]=p,t=!0),m>l&&(this.m_depthBuffer[n]=l,t=!0)}if(!t)break}for(let t=0;t<s;t++){const o=i[t];for(let t=o.m_firstIndex;t<o.m_lastIndex;t++)this.m_depthBuffer[t]<1e37?this.m_depthBuffer[t]*=this.m_particleDiameter:this.m_depthBuffer[t]=0}}GetInsideBoundsEnumerator(t){const o=ui.computeTag(this.m_inverseDiameter*t.lowerBound.x-1,this.m_inverseDiameter*t.lowerBound.y-1),e=ui.computeTag(this.m_inverseDiameter*t.upperBound.x+1,this.m_inverseDiameter*t.upperBound.y+1),i=this.m_proxyBuffer.count,s=ai(this.m_proxyBuffer.data,0,i,o,ui.Proxy.CompareProxyTag),n=mi(this.m_proxyBuffer.data,0,i,e,ui.Proxy.CompareTagProxy);return new ui.InsideBoundsEnumerator(this,o,e,s,n)}UpdateAllParticleFlags(){if(!this.m_flagsBuffer.data)throw new Error;this.m_allParticleFlags=0;for(let t=0;t<this.m_count;t++)this.m_allParticleFlags|=this.m_flagsBuffer.data[t];this.m_needsUpdateAllParticleFlags=!1}UpdateAllGroupFlags(){this.m_allGroupFlags=0;for(let t=this.m_groupList;t;t=t.GetNext())this.m_allGroupFlags|=t.m_groupFlags;this.m_needsUpdateAllGroupFlags=!1}AddContact(t,o,e){if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;const i=ui.AddContact_s_d,s=this.m_positionBuffer.data,n=S.SubVV(s[o],s[t],i),r=S.DotVV(n,n);if(r<this.m_squaredDiameter){let e=_(r);isFinite(e)||(e=198177537e11);const i=this.m_contactBuffer.data[this.m_contactBuffer.Append()];i.indexA=t,i.indexB=o,i.flags=this.m_flagsBuffer.data[t]|this.m_flagsBuffer.data[o],i.weight=1-r*e*this.m_inverseDiameter,S.MulSV(e,n,i.normal)}}FindContacts_Reference(t){const o=this.m_proxyBuffer.count;this.m_contactBuffer.count=0;for(let t=0,e=0;t<o;t++){const i=ui.computeRelativeTag(this.m_proxyBuffer.data[t].tag,1,0);for(let e=t+1;e<o&&!(i<this.m_proxyBuffer.data[e].tag);e++)this.AddContact(this.m_proxyBuffer.data[t].index,this.m_proxyBuffer.data[e].index,this.m_contactBuffer);const s=ui.computeRelativeTag(this.m_proxyBuffer.data[t].tag,-1,1);for(;e<o&&!(s<=this.m_proxyBuffer.data[e].tag);e++);const n=ui.computeRelativeTag(this.m_proxyBuffer.data[t].tag,1,1);for(let i=e;i<o&&!(n<this.m_proxyBuffer.data[i].tag);i++)this.AddContact(this.m_proxyBuffer.data[t].index,this.m_proxyBuffer.data[i].index,this.m_contactBuffer)}}FindContacts(t){this.FindContacts_Reference(t)}UpdateProxies_Reference(t){if(!this.m_positionBuffer.data)throw new Error;const o=this.m_positionBuffer.data,e=this.m_inverseDiameter;for(let t=0;t<this.m_proxyBuffer.count;++t){const i=this.m_proxyBuffer.data[t],s=o[i.index];i.tag=ui.computeTag(e*s.x,e*s.y)}}UpdateProxies(t){this.UpdateProxies_Reference(t)}SortProxies(t){si(this.m_proxyBuffer.data,0,this.m_proxyBuffer.count,ui.Proxy.CompareProxyProxy)}FilterContacts(o){const e=this.GetParticleContactFilter();if(null===e)return;const i=this;this.m_contactBuffer.RemoveIf(o=>0!=(o.flags&t.b2ParticleFlag.b2_particleContactFilterParticle)&&!e.ShouldCollideParticleParticle(i,o.indexA,o.indexB))}NotifyContactListenerPreContact(t){if(null!==this.GetParticleContactListener())throw t.Initialize(this.m_contactBuffer,this.m_flagsBuffer),new Error}NotifyContactListenerPostContact(t){const o=this.GetParticleContactListener();if(null!==o){for(let t=0;t<this.m_contactBuffer.count;++t){const e=this.m_contactBuffer.data[t];o.BeginContactParticleParticle(this,e)}throw new Error}}static b2ParticleContactIsZombie(o){return(o.flags&t.b2ParticleFlag.b2_zombieParticle)===t.b2ParticleFlag.b2_zombieParticle}UpdateContacts(t){this.UpdateProxies(this.m_proxyBuffer),this.SortProxies(this.m_proxyBuffer);const o=new ui.b2ParticlePairSet;this.NotifyContactListenerPreContact(o),this.FindContacts(this.m_contactBuffer),this.FilterContacts(this.m_contactBuffer),this.NotifyContactListenerPostContact(o),t&&this.m_contactBuffer.RemoveIf(ui.b2ParticleContactIsZombie)}NotifyBodyContactListenerPreContact(t){if(null!==this.GetFixtureContactListener())throw t.Initialize(this.m_bodyContactBuffer,this.m_flagsBuffer),new Error}NotifyBodyContactListenerPostContact(t){const o=this.GetFixtureContactListener();if(null!==o){for(let t=0;t<this.m_bodyContactBuffer.count;t++){const e=this.m_bodyContactBuffer.data[t];o.BeginContactFixtureParticle(this,e)}throw new Error}}UpdateBodyContacts(){const t=ui.UpdateBodyContacts_s_aabb,o=new ui.FixtureParticleSet;if(this.NotifyBodyContactListenerPreContact(o),this.m_stuckThreshold>0){if(!this.m_bodyContactCountBuffer.data)throw new Error;if(!this.m_lastBodyContactStepBuffer.data)throw new Error;if(!this.m_consecutiveContactStepsBuffer.data)throw new Error;const t=this.GetParticleCount();for(let o=0;o<t;o++)this.m_bodyContactCountBuffer.data[o]=0,this.m_timestamp>this.m_lastBodyContactStepBuffer.data[o]+1&&(this.m_consecutiveContactStepsBuffer.data[o]=0)}this.m_bodyContactBuffer.SetCount(0),this.m_stuckParticleBuffer.SetCount(0);const e=t;this.ComputeAABB(e);const i=new ui.UpdateBodyContactsCallback(this,this.GetFixtureContactFilter());this.m_world.QueryAABB(i,e),this.m_def.strictContactCheck&&this.RemoveSpuriousBodyContacts(),this.NotifyBodyContactListenerPostContact(o)}Solve(o){const e=ui.Solve_s_subStep;if(0!==this.m_count&&(this.m_expirationTimeBuffer.data&&this.SolveLifetimes(o),this.m_allParticleFlags&t.b2ParticleFlag.b2_zombieParticle&&this.SolveZombie(),this.m_needsUpdateAllParticleFlags&&this.UpdateAllParticleFlags(),this.m_needsUpdateAllGroupFlags&&this.UpdateAllGroupFlags(),!this.m_paused))for(this.m_iterationIndex=0;this.m_iterationIndex<o.particleIterations;this.m_iterationIndex++){++this.m_timestamp;const i=e.Copy(o);if(i.dt/=o.particleIterations,i.inv_dt*=o.particleIterations,this.UpdateContacts(!1),this.UpdateBodyContacts(),this.ComputeWeight(),this.m_allGroupFlags&t.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth&&this.ComputeDepth(),this.m_allParticleFlags&t.b2ParticleFlag.b2_reactiveParticle&&this.UpdatePairsAndTriadsWithReactiveParticles(),this.m_hasForce&&this.SolveForce(i),this.m_allParticleFlags&t.b2ParticleFlag.b2_viscousParticle&&this.SolveViscous(),this.m_allParticleFlags&t.b2ParticleFlag.b2_repulsiveParticle&&this.SolveRepulsive(i),this.m_allParticleFlags&t.b2ParticleFlag.b2_powderParticle&&this.SolvePowder(i),this.m_allParticleFlags&t.b2ParticleFlag.b2_tensileParticle&&this.SolveTensile(i),this.m_allGroupFlags&t.b2ParticleGroupFlag.b2_solidParticleGroup&&this.SolveSolid(i),this.m_allParticleFlags&t.b2ParticleFlag.b2_colorMixingParticle&&this.SolveColorMixing(),this.SolveGravity(i),this.m_allParticleFlags&t.b2ParticleFlag.b2_staticPressureParticle&&this.SolveStaticPressure(i),this.SolvePressure(i),this.SolveDamping(i),this.m_allParticleFlags&ui.k_extraDampingFlags&&this.SolveExtraDamping(),this.m_allParticleFlags&t.b2ParticleFlag.b2_elasticParticle&&this.SolveElastic(i),this.m_allParticleFlags&t.b2ParticleFlag.b2_springParticle&&this.SolveSpring(i),this.LimitVelocity(i),this.m_allGroupFlags&t.b2ParticleGroupFlag.b2_rigidParticleGroup&&this.SolveRigidDamping(),this.m_allParticleFlags&t.b2ParticleFlag.b2_barrierParticle&&this.SolveBarrier(i),this.SolveCollision(i),this.m_allGroupFlags&t.b2ParticleGroupFlag.b2_rigidParticleGroup&&this.SolveRigid(i),this.m_allParticleFlags&t.b2ParticleFlag.b2_wallParticle&&this.SolveWall(),!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(let t=0;t<this.m_count;t++)this.m_positionBuffer.data[t].SelfMulAdd(i.dt,this.m_velocityBuffer.data[t])}}SolveCollision(t){const o=ui.SolveCollision_s_aabb;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;const e=this.m_positionBuffer.data,i=this.m_velocityBuffer.data,s=o;s.lowerBound.x=1e37,s.lowerBound.y=1e37,s.upperBound.x=-1e37,s.upperBound.y=-1e37;for(let o=0;o<this.m_count;o++){const n=i[o],r=e[o],a=r.x+t.dt*n.x,m=r.y+t.dt*n.y;s.lowerBound.x=p(s.lowerBound.x,p(r.x,a)),s.lowerBound.y=p(s.lowerBound.y,p(r.y,m)),s.upperBound.x=l(s.upperBound.x,l(r.x,a)),s.upperBound.y=l(s.upperBound.y,l(r.y,m))}const n=new ui.SolveCollisionCallback(this,t);this.m_world.QueryAABB(n,s)}LimitVelocity(t){if(!this.m_velocityBuffer.data)throw new Error;const o=this.m_velocityBuffer.data,e=this.GetCriticalVelocitySquared(t);for(let t=0;t<this.m_count;t++){const i=o[t],s=S.DotVV(i,i);s>e&&i.SelfMul(c(e/s))}}SolveGravity(t){if(!this.m_velocityBuffer.data)throw new Error;const o=ui.SolveGravity_s_gravity,e=this.m_velocityBuffer.data,i=S.MulSV(t.dt*this.m_def.gravityScale,this.m_world.GetGravity(),o);for(let t=0;t<this.m_count;t++)e[t].SelfAdd(i)}SolveBarrier(o){const e=ui.SolveBarrier_s_aabb,i=ui.SolveBarrier_s_va,s=ui.SolveBarrier_s_vb,n=ui.SolveBarrier_s_pba,r=ui.SolveBarrier_s_vba,a=ui.SolveBarrier_s_vc,m=ui.SolveBarrier_s_pca,p=ui.SolveBarrier_s_vca,l=ui.SolveBarrier_s_qba,f=ui.SolveBarrier_s_qca,h=ui.SolveBarrier_s_dv,y=ui.SolveBarrier_s_f;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;const _=this.m_positionBuffer.data,C=this.m_velocityBuffer.data;for(let t=0;t<this.m_count;t++)0!=(this.m_flagsBuffer.data[t]&ui.k_barrierWallFlags)&&C[t].SetZero();const u=2.5*o.dt,d=this.GetParticleMass();for(let x=0;x<this.m_pairBuffer.count;x++){const g=this.m_pairBuffer.data[x];if(g.flags&t.b2ParticleFlag.b2_barrierParticle){const t=g.indexA,x=g.indexB,B=_[t],b=_[x],A=e;S.MinV(B,b,A.lowerBound),S.MaxV(B,b,A.upperBound);const v=this.m_groupBuffer[t],w=this.m_groupBuffer[x],V=this.GetLinearVelocity(v,t,B,i),M=this.GetLinearVelocity(w,x,b,s),P=S.SubVV(b,B,n),I=S.SubVV(M,V,r),G=this.GetInsideBoundsEnumerator(A);let D;for(;(D=G.GetNext())>=0;){const t=_[D],e=this.m_groupBuffer[D];if(v!==e&&w!==e){const i=this.GetLinearVelocity(e,D,t,a),s=S.SubVV(t,B,m),n=S.SubVV(i,V,p),r=S.CrossVV(I,n),_=S.CrossVV(P,n)-S.CrossVV(s,I),x=S.CrossVV(P,s);let g,b;const A=l,v=f;if(0===r){if(0===_)continue;if(b=-x/_,!(b>=0&&b<u))continue;if(S.AddVMulSV(P,b,I,A),S.AddVMulSV(s,b,n,v),g=S.DotVV(A,v)/S.DotVV(A,A),!(g>=0&&g<=1))continue}else{const t=_*_-4*x*r;if(t<0)continue;const o=c(t);let e=(-_-o)/(2*r),i=(-_+o)/(2*r);if(e>i){const t=e;e=i,i=t}if(b=e,S.AddVMulSV(P,b,I,A),S.AddVMulSV(s,b,n,v),g=S.DotVV(A,v)/S.DotVV(A,A),!(b>=0&&b<u&&g>=0&&g<=1)){if(b=i,!(b>=0&&b<u))continue;if(S.AddVMulSV(P,b,I,A),S.AddVMulSV(s,b,n,v),g=S.DotVV(A,v)/S.DotVV(A,A),!(g>=0&&g<=1))continue}}const w=h;w.x=V.x+g*I.x-i.x,w.y=V.y+g*I.y-i.y;const M=S.MulSV(d,w,y);if(e&&this.IsRigidGroup(e)){const o=e.GetMass(),i=e.GetInertia();o>0&&e.m_linearVelocity.SelfMulAdd(1/o,M),i>0&&(e.m_angularVelocity+=S.CrossVV(S.SubVV(t,e.GetCenter(),S.s_t0),M)/i)}else C[D].SelfAdd(w);this.ParticleApplyForce(D,M.SelfMul(-o.inv_dt))}}}}}SolveStaticPressure(o){if(!this.m_flagsBuffer.data)throw new Error;this.m_staticPressureBuffer=this.RequestBuffer(this.m_staticPressureBuffer);const e=this.GetCriticalPressure(o),i=this.m_def.staticPressureStrength*e,s=.25*e,n=this.m_def.staticPressureRelaxation;for(let o=0;o<this.m_def.staticPressureIterations;o++){for(let t=0;t<this.m_count;t++)this.m_accumulationBuffer[t]=0;for(let o=0;o<this.m_contactBuffer.count;o++){const e=this.m_contactBuffer.data[o];if(e.flags&t.b2ParticleFlag.b2_staticPressureParticle){const t=e.indexA,o=e.indexB,i=e.weight;this.m_accumulationBuffer[t]+=i*this.m_staticPressureBuffer[o],this.m_accumulationBuffer[o]+=i*this.m_staticPressureBuffer[t]}}for(let o=0;o<this.m_count;o++){const e=this.m_weightBuffer[o];if(this.m_flagsBuffer.data[o]&t.b2ParticleFlag.b2_staticPressureParticle){const t=(this.m_accumulationBuffer[o]+i*(e-1))/(e+n);this.m_staticPressureBuffer[o]=f(t,0,s)}else this.m_staticPressureBuffer[o]=0}}}ComputeWeight(){for(let t=0;t<this.m_count;t++)this.m_weightBuffer[t]=0;for(let t=0;t<this.m_bodyContactBuffer.count;t++){const o=this.m_bodyContactBuffer.data[t],e=o.index,i=o.weight;this.m_weightBuffer[e]+=i}for(let t=0;t<this.m_contactBuffer.count;t++){const o=this.m_contactBuffer.data[t],e=o.indexA,i=o.indexB,s=o.weight;this.m_weightBuffer[e]+=s,this.m_weightBuffer[i]+=s}}SolvePressure(o){const e=ui.SolvePressure_s_f;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;const i=this.m_positionBuffer.data,s=this.m_velocityBuffer.data,n=this.GetCriticalPressure(o),r=this.m_def.pressureStrength*n,a=.25*n;for(let t=0;t<this.m_count;t++){const o=this.m_weightBuffer[t],e=r*l(0,o-1);this.m_accumulationBuffer[t]=p(e,a)}if(this.m_allParticleFlags&ui.k_noPressureFlags)for(let t=0;t<this.m_count;t++)this.m_flagsBuffer.data[t]&ui.k_noPressureFlags&&(this.m_accumulationBuffer[t]=0);if(this.m_allParticleFlags&t.b2ParticleFlag.b2_staticPressureParticle)for(let o=0;o<this.m_count;o++)this.m_flagsBuffer.data[o]&t.b2ParticleFlag.b2_staticPressureParticle&&(this.m_accumulationBuffer[o]+=this.m_staticPressureBuffer[o]);const m=o.dt/(this.m_def.density*this.m_particleDiameter),f=this.GetParticleInvMass();for(let t=0;t<this.m_bodyContactBuffer.count;t++){const o=this.m_bodyContactBuffer.data[t],n=o.index,a=o.body,p=o.weight,l=o.mass,h=o.normal,y=i[n],_=this.m_accumulationBuffer[n]+r*p,c=S.MulSV(m*p*l*_,h,e);s[n].SelfMulSub(f,c),a.ApplyLinearImpulse(c,y,!0)}for(let t=0;t<this.m_contactBuffer.count;t++){const o=this.m_contactBuffer.data[t],i=o.indexA,n=o.indexB,r=o.weight,a=o.normal,p=this.m_accumulationBuffer[i]+this.m_accumulationBuffer[n],l=S.MulSV(m*r*p,a,e);s[i].SelfSub(l),s[n].SelfAdd(l)}}SolveDamping(t){const o=ui.SolveDamping_s_v,e=ui.SolveDamping_s_f;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;const i=this.m_positionBuffer.data,s=this.m_velocityBuffer.data,n=this.m_def.dampingStrength,r=1/this.GetCriticalVelocity(t),a=this.GetParticleInvMass();for(let t=0;t<this.m_bodyContactBuffer.count;t++){const m=this.m_bodyContactBuffer.data[t],f=m.index,h=m.body,y=m.weight,_=m.mass,c=m.normal,C=i[f],u=S.SubVV(h.GetLinearVelocityFromWorldPoint(C,S.s_t0),s[f],o),d=S.DotVV(u,c);if(d<0){const t=l(n*y,p(-r*d,.5)),o=S.MulSV(t*_*d,c,e);s[f].SelfMulAdd(a,o),h.ApplyLinearImpulse(o.SelfNeg(),C,!0)}}for(let t=0;t<this.m_contactBuffer.count;t++){const i=this.m_contactBuffer.data[t],a=i.indexA,m=i.indexB,f=i.weight,h=i.normal,y=S.SubVV(s[m],s[a],o),_=S.DotVV(y,h);if(_<0){const t=l(n*f,p(-r*_,.5)),o=S.MulSV(t*_,h,e);s[a].SelfAdd(o),s[m].SelfSub(o)}}}SolveRigidDamping(){const t=ui.SolveRigidDamping_s_t0,o=ui.SolveRigidDamping_s_t1,e=ui.SolveRigidDamping_s_p,i=ui.SolveRigidDamping_s_v,s=[0],n=[0],r=[0],a=[0],m=[0],l=[0];if(!this.m_positionBuffer.data)throw new Error;const f=this.m_positionBuffer.data,h=this.m_def.dampingStrength;for(let e=0;e<this.m_bodyContactBuffer.count;e++){const y=this.m_bodyContactBuffer.data[e],_=y.index,c=this.m_groupBuffer[_];if(c&&this.IsRigidGroup(c)){const e=y.body,C=y.normal,u=y.weight,d=f[_],x=S.SubVV(e.GetLinearVelocityFromWorldPoint(d,t),c.GetLinearVelocityFromWorldPoint(d,o),i),g=S.DotVV(x,C);if(g<0){this.InitDampingParameterWithRigidGroupOrParticle(s,n,r,!0,c,_,d,C),this.InitDampingParameter(a,m,l,e.GetMass(),e.GetInertia()-e.GetMass()*e.GetLocalCenter().LengthSquared(),e.GetWorldCenter(),d,C);const t=h*p(u,1)*this.ComputeDampingImpulse(s[0],n[0],r[0],a[0],m[0],l[0],g);this.ApplyDamping(s[0],n[0],r[0],!0,c,_,t,C),e.ApplyLinearImpulse(S.MulSV(-t,C,S.s_t0),d,!0)}}}for(let p=0;p<this.m_contactBuffer.count;p++){const y=this.m_contactBuffer.data[p],_=y.indexA,c=y.indexB,C=y.normal,u=y.weight,d=this.m_groupBuffer[_],x=this.m_groupBuffer[c],g=this.IsRigidGroup(d),B=this.IsRigidGroup(x);if(d!==x&&(g||B)){const p=S.MidVV(f[_],f[c],e),y=S.SubVV(this.GetLinearVelocity(x,c,p,t),this.GetLinearVelocity(d,_,p,o),i),b=S.DotVV(y,C);if(b<0){this.InitDampingParameterWithRigidGroupOrParticle(s,n,r,g,d,_,p,C),this.InitDampingParameterWithRigidGroupOrParticle(a,m,l,B,x,c,p,C);const t=h*u*this.ComputeDampingImpulse(s[0],n[0],r[0],a[0],m[0],l[0],b);this.ApplyDamping(s[0],n[0],r[0],g,d,_,t,C),this.ApplyDamping(a[0],m[0],l[0],B,x,c,-t,C)}}}}SolveExtraDamping(){const t=ui.SolveExtraDamping_s_v,o=ui.SolveExtraDamping_s_f;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;const e=this.m_velocityBuffer.data,i=this.m_positionBuffer.data,s=this.GetParticleInvMass();for(let n=0;n<this.m_bodyContactBuffer.count;n++){const r=this.m_bodyContactBuffer.data[n],a=r.index;if(this.m_flagsBuffer.data[a]&ui.k_extraDampingFlags){const n=r.body,m=r.mass,p=r.normal,l=i[a],f=S.SubVV(n.GetLinearVelocityFromWorldPoint(l,S.s_t0),e[a],t),h=S.DotVV(f,p);if(h<0){const t=S.MulSV(.5*m*h,p,o);e[a].SelfMulAdd(s,t),n.ApplyLinearImpulse(t.SelfNeg(),l,!0)}}}}SolveWall(){if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;const o=this.m_velocityBuffer.data;for(let e=0;e<this.m_count;e++)this.m_flagsBuffer.data[e]&t.b2ParticleFlag.b2_wallParticle&&o[e].SetZero()}SolveRigid(o){const e=ui.SolveRigid_s_position,i=ui.SolveRigid_s_rotation,s=ui.SolveRigid_s_transform,n=ui.SolveRigid_s_velocityTransform;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;const r=this.m_positionBuffer.data,a=this.m_velocityBuffer.data;for(let m=this.m_groupList;m;m=m.GetNext())if(m.m_groupFlags&t.b2ParticleGroupFlag.b2_rigidParticleGroup){m.UpdateStatistics();const t=i;t.SetAngle(o.dt*m.m_angularVelocity);const p=S.AddVV(m.m_center,S.SubVV(S.MulSV(o.dt,m.m_linearVelocity,S.s_t0),V.MulRV(t,m.m_center,S.s_t1),S.s_t0),e),l=s;l.SetPositionRotation(p,t),M.MulXX(l,m.m_transform,m.m_transform);const f=n;f.p.x=o.inv_dt*l.p.x,f.p.y=o.inv_dt*l.p.y,f.q.s=o.inv_dt*l.q.s,f.q.c=o.inv_dt*(l.q.c-1);for(let t=m.m_firstIndex;t<m.m_lastIndex;t++)M.MulXV(f,r[t],a[t])}}SolveElastic(o){const e=ui.SolveElastic_s_pa,i=ui.SolveElastic_s_pb,s=ui.SolveElastic_s_pc,n=ui.SolveElastic_s_r,r=ui.SolveElastic_s_t0;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;const a=this.m_positionBuffer.data,m=this.m_velocityBuffer.data,p=o.inv_dt*this.m_def.elasticStrength;for(let l=0;l<this.m_triadBuffer.count;l++){const f=this.m_triadBuffer.data[l];if(f.flags&t.b2ParticleFlag.b2_elasticParticle){const t=f.indexA,l=f.indexB,h=f.indexC,y=f.pa,c=f.pb,C=f.pc,u=e.Copy(a[t]),d=i.Copy(a[l]),x=s.Copy(a[h]),g=m[t],B=m[l],b=m[h];u.SelfMulAdd(o.dt,g),d.SelfMulAdd(o.dt,B),x.SelfMulAdd(o.dt,b);const A=(u.x+d.x+x.x)/3,v=(u.y+d.y+x.y)/3;u.x-=A,u.y-=v,d.x-=A,d.y-=v,x.x-=A,x.y-=v;const w=n;w.s=S.CrossVV(y,u)+S.CrossVV(c,d)+S.CrossVV(C,x),w.c=S.DotVV(y,u)+S.DotVV(c,d)+S.DotVV(C,x);let M=_(w.s*w.s+w.c*w.c);isFinite(M)||(M=198177537e11),w.s*=M,w.c*=M;const P=p*f.strength;V.MulRV(w,y,r),S.SubVV(r,u,r),S.MulSV(P,r,r),g.SelfAdd(r),V.MulRV(w,c,r),S.SubVV(r,d,r),S.MulSV(P,r,r),B.SelfAdd(r),V.MulRV(w,C,r),S.SubVV(r,x,r),S.MulSV(P,r,r),b.SelfAdd(r)}}}SolveSpring(o){const e=ui.SolveSpring_s_pa,i=ui.SolveSpring_s_pb,s=ui.SolveSpring_s_d,n=ui.SolveSpring_s_f;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;const r=this.m_positionBuffer.data,a=this.m_velocityBuffer.data,m=o.inv_dt*this.m_def.springStrength;for(let p=0;p<this.m_pairBuffer.count;p++){const l=this.m_pairBuffer.data[p];if(l.flags&t.b2ParticleFlag.b2_springParticle){const t=l.indexA,p=l.indexB,f=e.Copy(r[t]),h=i.Copy(r[p]),y=a[t],_=a[p];f.SelfMulAdd(o.dt,y),h.SelfMulAdd(o.dt,_);const c=S.SubVV(h,f,s),C=l.distance,u=c.Length(),d=m*l.strength,x=S.MulSV(d*(C-u)/u,c,n);y.SelfSub(x),_.SelfAdd(x)}}}SolveTensile(o){const e=ui.SolveTensile_s_weightedNormal,i=ui.SolveTensile_s_s,s=ui.SolveTensile_s_f;if(!this.m_velocityBuffer.data)throw new Error;const n=this.m_velocityBuffer.data;for(let t=0;t<this.m_count;t++)this.m_accumulation2Buffer[t]=new S,this.m_accumulation2Buffer[t].SetZero();for(let o=0;o<this.m_contactBuffer.count;o++){const i=this.m_contactBuffer.data[o];if(i.flags&t.b2ParticleFlag.b2_tensileParticle){const t=i.indexA,o=i.indexB,s=i.weight,n=i.normal,r=S.MulSV((1-s)*s,n,e);this.m_accumulation2Buffer[t].SelfSub(r),this.m_accumulation2Buffer[o].SelfAdd(r)}}const r=this.GetCriticalVelocity(o),a=this.m_def.surfaceTensionPressureStrength*r,m=this.m_def.surfaceTensionNormalStrength*r,l=.5*r;for(let o=0;o<this.m_contactBuffer.count;o++){const e=this.m_contactBuffer.data[o];if(e.flags&t.b2ParticleFlag.b2_tensileParticle){const t=e.indexA,o=e.indexB,r=e.weight,f=e.normal,h=this.m_weightBuffer[t]+this.m_weightBuffer[o],y=S.SubVV(this.m_accumulation2Buffer[o],this.m_accumulation2Buffer[t],i),_=p(a*(h-2)+m*S.DotVV(y,f),l)*r,c=S.MulSV(_,f,s);n[t].SelfSub(c),n[o].SelfAdd(c)}}}SolveViscous(){const o=ui.SolveViscous_s_v,e=ui.SolveViscous_s_f;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;const i=this.m_positionBuffer.data,s=this.m_velocityBuffer.data,n=this.m_def.viscousStrength,r=this.GetParticleInvMass();for(let a=0;a<this.m_bodyContactBuffer.count;a++){const m=this.m_bodyContactBuffer.data[a],p=m.index;if(this.m_flagsBuffer.data[p]&t.b2ParticleFlag.b2_viscousParticle){const t=m.body,a=m.weight,l=m.mass,f=i[p],h=S.SubVV(t.GetLinearVelocityFromWorldPoint(f,S.s_t0),s[p],o),y=S.MulSV(n*l*a,h,e);s[p].SelfMulAdd(r,y),t.ApplyLinearImpulse(y.SelfNeg(),f,!0)}}for(let i=0;i<this.m_contactBuffer.count;i++){const r=this.m_contactBuffer.data[i];if(r.flags&t.b2ParticleFlag.b2_viscousParticle){const t=r.indexA,i=r.indexB,a=r.weight,m=S.SubVV(s[i],s[t],o),p=S.MulSV(n*a,m,e);s[t].SelfAdd(p),s[i].SelfSub(p)}}}SolveRepulsive(o){const e=ui.SolveRepulsive_s_f;if(!this.m_velocityBuffer.data)throw new Error;const i=this.m_velocityBuffer.data,s=this.m_def.repulsiveStrength*this.GetCriticalVelocity(o);for(let o=0;o<this.m_contactBuffer.count;o++){const n=this.m_contactBuffer.data[o];if(n.flags&t.b2ParticleFlag.b2_repulsiveParticle){const t=n.indexA,o=n.indexB;if(this.m_groupBuffer[t]!==this.m_groupBuffer[o]){const r=n.weight,a=n.normal,m=S.MulSV(s*r,a,e);i[t].SelfSub(m),i[o].SelfAdd(m)}}}}SolvePowder(o){const e=ui.SolvePowder_s_f;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;const i=this.m_positionBuffer.data,s=this.m_velocityBuffer.data,n=this.m_def.powderStrength*this.GetCriticalVelocity(o),r=this.GetParticleInvMass();for(let o=0;o<this.m_bodyContactBuffer.count;o++){const a=this.m_bodyContactBuffer.data[o],m=a.index;if(this.m_flagsBuffer.data[m]&t.b2ParticleFlag.b2_powderParticle){const t=a.weight;if(t>.25){const o=a.body,p=a.mass,l=i[m],f=a.normal,h=S.MulSV(n*p*(t-.25),f,e);s[m].SelfMulSub(r,h),o.ApplyLinearImpulse(h,l,!0)}}}for(let o=0;o<this.m_contactBuffer.count;o++){const i=this.m_contactBuffer.data[o];if(i.flags&t.b2ParticleFlag.b2_powderParticle){const t=i.weight;if(t>.25){const o=i.indexA,r=i.indexB,a=i.normal,m=S.MulSV(n*(t-.25),a,e);s[o].SelfSub(m),s[r].SelfAdd(m)}}}}SolveSolid(t){const o=ui.SolveSolid_s_f;if(!this.m_velocityBuffer.data)throw new Error;const e=this.m_velocityBuffer.data;this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer);const i=t.inv_dt*this.m_def.ejectionStrength;for(let t=0;t<this.m_contactBuffer.count;t++){const s=this.m_contactBuffer.data[t],n=s.indexA,r=s.indexB;if(this.m_groupBuffer[n]!==this.m_groupBuffer[r]){const t=s.weight,a=s.normal,m=this.m_depthBuffer[n]+this.m_depthBuffer[r],p=S.MulSV(i*m*t,a,o);e[n].SelfSub(p),e[r].SelfAdd(p)}}}SolveForce(t){if(!this.m_velocityBuffer.data)throw new Error;const o=this.m_velocityBuffer.data,e=t.dt*this.GetParticleInvMass();for(let t=0;t<this.m_count;t++)o[t].SelfMulAdd(e,this.m_forceBuffer[t]);this.m_hasForce=!1}SolveColorMixing(){if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_colorBuffer.data)throw new Error;const o=.5*this.m_def.colorMixingStrength;if(o)for(let e=0;e<this.m_contactBuffer.count;e++){const i=this.m_contactBuffer.data[e],s=i.indexA,n=i.indexB;if(this.m_flagsBuffer.data[s]&this.m_flagsBuffer.data[n]&t.b2ParticleFlag.b2_colorMixingParticle){const t=this.m_colorBuffer.data[s],e=this.m_colorBuffer.data[n];I.MixColors(t,e,o)}}}SolveZombie(){if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;let o=0;const e=[];for(let t=0;t<this.m_count;t++)e[t]=-1;let i=0;for(let s=0;s<this.m_count;s++){const n=this.m_flagsBuffer.data[s];if(n&t.b2ParticleFlag.b2_zombieParticle){const o=this.m_world.m_destructionListener;if(n&t.b2ParticleFlag.b2_destructionListenerParticle&&o&&o.SayGoodbyeParticle(this,s),this.m_handleIndexBuffer.data){const t=this.m_handleIndexBuffer.data[s];t&&(t.SetIndex(-1),this.m_handleIndexBuffer.data[s]=null)}e[s]=-1}else{if(e[s]=o,s!==o){if(this.m_handleIndexBuffer.data){const t=this.m_handleIndexBuffer.data[s];t&&t.SetIndex(o),this.m_handleIndexBuffer.data[o]=t}this.m_flagsBuffer.data[o]=this.m_flagsBuffer.data[s],this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[o]=this.m_lastBodyContactStepBuffer.data[s]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[o]=this.m_bodyContactCountBuffer.data[s]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[o]=this.m_consecutiveContactStepsBuffer.data[s]),this.m_positionBuffer.data[o].Copy(this.m_positionBuffer.data[s]),this.m_velocityBuffer.data[o].Copy(this.m_velocityBuffer.data[s]),this.m_groupBuffer[o]=this.m_groupBuffer[s],this.m_hasForce&&this.m_forceBuffer[o].Copy(this.m_forceBuffer[s]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[o]=this.m_staticPressureBuffer[s]),this.m_depthBuffer&&(this.m_depthBuffer[o]=this.m_depthBuffer[s]),this.m_colorBuffer.data&&this.m_colorBuffer.data[o].Copy(this.m_colorBuffer.data[s]),this.m_userDataBuffer.data&&(this.m_userDataBuffer.data[o]=this.m_userDataBuffer.data[s]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[o]=this.m_expirationTimeBuffer.data[s])}o++,i|=n}}const s=t=>t.index<0,n=t=>t.indexA<0||t.indexB<0,r=t=>t.index<0,a=t=>t.indexA<0||t.indexB<0,m=t=>t.indexA<0||t.indexB<0||t.indexC<0;for(let t=0;t<this.m_proxyBuffer.count;t++){const o=this.m_proxyBuffer.data[t];o.index=e[o.index]}this.m_proxyBuffer.RemoveIf(s);for(let t=0;t<this.m_contactBuffer.count;t++){const o=this.m_contactBuffer.data[t];o.indexA=e[o.indexA],o.indexB=e[o.indexB]}this.m_contactBuffer.RemoveIf(n);for(let t=0;t<this.m_bodyContactBuffer.count;t++){const o=this.m_bodyContactBuffer.data[t];o.index=e[o.index]}this.m_bodyContactBuffer.RemoveIf(r);for(let t=0;t<this.m_pairBuffer.count;t++){const o=this.m_pairBuffer.data[t];o.indexA=e[o.indexA],o.indexB=e[o.indexB]}this.m_pairBuffer.RemoveIf(a);for(let t=0;t<this.m_triadBuffer.count;t++){const o=this.m_triadBuffer.data[t];o.indexA=e[o.indexA],o.indexB=e[o.indexB],o.indexC=e[o.indexC]}if(this.m_triadBuffer.RemoveIf(m),this.m_indexByExpirationTimeBuffer.data){let t=0;for(let o=0;o<this.m_count;o++){const i=e[this.m_indexByExpirationTimeBuffer.data[o]];-1!==i&&(this.m_indexByExpirationTimeBuffer.data[t++]=i)}}for(let i=this.m_groupList;i;i=i.GetNext()){let s=o,n=0,r=!1;for(let t=i.m_firstIndex;t<i.m_lastIndex;t++){const o=e[t];o>=0?(s=p(s,o),n=l(n,o+1)):r=!0}s<n?(i.m_firstIndex=s,i.m_lastIndex=n,r&&i.m_groupFlags&t.b2ParticleGroupFlag.b2_solidParticleGroup&&this.SetGroupFlags(i,i.m_groupFlags|t.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth)):(i.m_firstIndex=0,i.m_lastIndex=0,i.m_groupFlags&t.b2ParticleGroupFlag.b2_particleGroupCanBeEmpty||this.SetGroupFlags(i,i.m_groupFlags|t.b2ParticleGroupFlag.b2_particleGroupWillBeDestroyed))}this.m_count=o,this.m_allParticleFlags=i,this.m_needsUpdateAllParticleFlags=!1;for(let o=this.m_groupList;o;){const e=o.GetNext();o.m_groupFlags&t.b2ParticleGroupFlag.b2_particleGroupWillBeDestroyed&&this.DestroyParticleGroup(o),o=e}}SolveLifetimes(t){if(!this.m_expirationTimeBuffer.data)throw new Error;if(!this.m_indexByExpirationTimeBuffer.data)throw new Error;this.m_timeElapsed=this.LifetimeToExpirationTime(t.dt);const o=this.GetQuantizedTimeElapsed(),e=this.m_expirationTimeBuffer.data,i=this.m_indexByExpirationTimeBuffer.data,s=this.GetParticleCount();this.m_expirationTimeBufferRequiresSorting&&(si(i,0,s,(t,o)=>{const i=e[t],s=e[o],n=i<=0;return n===s<=0?i>s:n}),this.m_expirationTimeBufferRequiresSorting=!1);for(let t=s-1;t>=0;--t){const s=i[t],n=e[s];if(o<n||n<=0)break;this.DestroyParticle(s)}}RotateBuffer(t,o,e){if(t!==o&&o!==e){if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;if(pi(this.m_flagsBuffer.data,t,o,e),this.m_lastBodyContactStepBuffer.data&&pi(this.m_lastBodyContactStepBuffer.data,t,o,e),this.m_bodyContactCountBuffer.data&&pi(this.m_bodyContactCountBuffer.data,t,o,e),this.m_consecutiveContactStepsBuffer.data&&pi(this.m_consecutiveContactStepsBuffer.data,t,o,e),pi(this.m_positionBuffer.data,t,o,e),pi(this.m_velocityBuffer.data,t,o,e),pi(this.m_groupBuffer,t,o,e),this.m_hasForce&&pi(this.m_forceBuffer,t,o,e),this.m_staticPressureBuffer&&pi(this.m_staticPressureBuffer,t,o,e),this.m_depthBuffer&&pi(this.m_depthBuffer,t,o,e),this.m_colorBuffer.data&&pi(this.m_colorBuffer.data,t,o,e),this.m_userDataBuffer.data&&pi(this.m_userDataBuffer.data,t,o,e),this.m_handleIndexBuffer.data){pi(this.m_handleIndexBuffer.data,t,o,e);for(let o=t;o<e;++o){const t=this.m_handleIndexBuffer.data[o];t&&t.SetIndex(i(t.GetIndex()))}}if(this.m_expirationTimeBuffer.data){pi(this.m_expirationTimeBuffer.data,t,o,e);const s=this.GetParticleCount();if(!this.m_indexByExpirationTimeBuffer.data)throw new Error;const n=this.m_indexByExpirationTimeBuffer.data;for(let t=0;t<s;++t)n[t]=i(n[t])}for(let t=0;t<this.m_proxyBuffer.count;t++){const o=this.m_proxyBuffer.data[t];o.index=i(o.index)}for(let t=0;t<this.m_contactBuffer.count;t++){const o=this.m_contactBuffer.data[t];o.indexA=i(o.indexA),o.indexB=i(o.indexB)}for(let t=0;t<this.m_bodyContactBuffer.count;t++){const o=this.m_bodyContactBuffer.data[t];o.index=i(o.index)}for(let t=0;t<this.m_pairBuffer.count;t++){const o=this.m_pairBuffer.data[t];o.indexA=i(o.indexA),o.indexB=i(o.indexB)}for(let t=0;t<this.m_triadBuffer.count;t++){const o=this.m_triadBuffer.data[t];o.indexA=i(o.indexA),o.indexB=i(o.indexB),o.indexC=i(o.indexC)}for(let t=this.m_groupList;t;t=t.GetNext())t.m_firstIndex=i(t.m_firstIndex),t.m_lastIndex=i(t.m_lastIndex-1)+1}function i(i){return i<t?i:i<o?i+e-o:i<e?i+t-o:i}}GetCriticalVelocity(t){return this.m_particleDiameter*t.inv_dt}GetCriticalVelocitySquared(t){const o=this.GetCriticalVelocity(t);return o*o}GetCriticalPressure(t){return this.m_def.density*this.GetCriticalVelocitySquared(t)}GetParticleStride(){return.75*this.m_particleDiameter}GetParticleMass(){const t=this.GetParticleStride();return this.m_def.density*t*t}GetParticleInvMass(){const t=this.m_inverseDiameter*(1/.75);return this.m_inverseDensity*t*t}GetFixtureContactFilter(){return this.m_allParticleFlags&t.b2ParticleFlag.b2_fixtureContactFilterParticle?this.m_world.m_contactManager.m_contactFilter:null}GetParticleContactFilter(){return this.m_allParticleFlags&t.b2ParticleFlag.b2_particleContactFilterParticle?this.m_world.m_contactManager.m_contactFilter:null}GetFixtureContactListener(){return this.m_allParticleFlags&t.b2ParticleFlag.b2_fixtureContactListenerParticle?this.m_world.m_contactManager.m_contactListener:null}GetParticleContactListener(){return this.m_allParticleFlags&t.b2ParticleFlag.b2_particleContactListenerParticle?this.m_world.m_contactManager.m_contactListener:null}SetUserOverridableBuffer(t,o,e){t.data=o,t.userSuppliedCapacity=e}SetGroupFlags(o,e){const i=o.m_groupFlags;(i^e)&t.b2ParticleGroupFlag.b2_solidParticleGroup&&(e|=t.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth),i&~e&&(this.m_needsUpdateAllGroupFlags=!0),~this.m_allGroupFlags&e&&(e&t.b2ParticleGroupFlag.b2_solidParticleGroup&&(this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer)),this.m_allGroupFlags|=e),o.m_groupFlags=e}static BodyContactCompare(t,o){return t.index===o.index?t.weight>o.weight:t.index<o.index}RemoveSpuriousBodyContacts(){si(this.m_bodyContactBuffer.data,0,this.m_bodyContactBuffer.count,ui.BodyContactCompare);const t=ui.RemoveSpuriousBodyContacts_s_n,o=ui.RemoveSpuriousBodyContacts_s_pos,e=ui.RemoveSpuriousBodyContacts_s_normal,i=this;let s=-1,n=0;this.m_bodyContactBuffer.count=ri(this.m_bodyContactBuffer.data,r=>{if(r.index!==s&&(n=0,s=r.index),n++>3)return!0;const a=t.Copy(r.normal);if(a.SelfMul(i.m_particleDiameter*(1-r.weight)),!i.m_positionBuffer.data)throw new Error;const m=S.AddVV(i.m_positionBuffer.data[r.index],a,o);if(!r.fixture.TestPoint(m)){const t=r.fixture.GetShape().GetChildCount();for(let o=0;o<t;o++){const t=e;if(r.fixture.ComputeDistance(m,t,o)<.008)return!1}return!0}return!1},this.m_bodyContactBuffer.count)}DetectStuckParticle(t){if(!(this.m_stuckThreshold<=0)){if(!this.m_bodyContactCountBuffer.data)throw new Error;if(!this.m_consecutiveContactStepsBuffer.data)throw new Error;if(!this.m_lastBodyContactStepBuffer.data)throw new Error;++this.m_bodyContactCountBuffer.data[t],2===this.m_bodyContactCountBuffer.data[t]&&(++this.m_consecutiveContactStepsBuffer.data[t],this.m_consecutiveContactStepsBuffer.data[t]>this.m_stuckThreshold&&(this.m_stuckParticleBuffer.data[this.m_stuckParticleBuffer.Append()]=t)),this.m_lastBodyContactStepBuffer.data[t]=this.m_timestamp}}ValidateParticleIndex(t){return t>=0&&t<this.GetParticleCount()&&-1!==t}GetQuantizedTimeElapsed(){return Math.floor(this.m_timeElapsed/4294967296)}LifetimeToExpirationTime(t){return this.m_timeElapsed+Math.floor(t/this.m_def.lifetimeGranularity*4294967296)}ForceCanBeApplied(o){return!(o&t.b2ParticleFlag.b2_wallParticle)}PrepareForceBuffer(){if(!this.m_hasForce){for(let t=0;t<this.m_count;t++)this.m_forceBuffer[t].SetZero();this.m_hasForce=!0}}IsRigidGroup(o){return null!==o&&0!=(o.m_groupFlags&t.b2ParticleGroupFlag.b2_rigidParticleGroup)}GetLinearVelocity(t,o,e,i){if(t&&this.IsRigidGroup(t))return t.GetLinearVelocityFromWorldPoint(e,i);if(!this.m_velocityBuffer.data)throw new Error;return i.Copy(this.m_velocityBuffer.data[o])}InitDampingParameter(t,o,e,i,s,n,r,a){t[0]=i>0?1/i:0,o[0]=s>0?1/s:0,e[0]=S.CrossVV(S.SubVV(r,n,S.s_t0),a)}InitDampingParameterWithRigidGroupOrParticle(o,e,i,s,n,r,a,m){if(n&&s)this.InitDampingParameter(o,e,i,n.GetMass(),n.GetInertia(),n.GetCenter(),a,m);else{if(!this.m_flagsBuffer.data)throw new Error;const s=this.m_flagsBuffer.data[r];this.InitDampingParameter(o,e,i,s&t.b2ParticleFlag.b2_wallParticle?0:this.GetParticleMass(),0,a,a,m)}}ComputeDampingImpulse(t,o,e,i,s,n,r){const a=t+o*e*e+i+s*n*n;return a>0?r/a:0}ApplyDamping(t,o,e,i,s,n,r,a){if(s&&i)s.m_linearVelocity.SelfMulAdd(r*t,a),s.m_angularVelocity+=r*e*o;else{if(!this.m_velocityBuffer.data)throw new Error;this.m_velocityBuffer.data[n].SelfMulAdd(r*t,a)}}}ui.xTruncBits=12,ui.yTruncBits=12,ui.tagBits=32,ui.yOffset=1<<ui.yTruncBits-1,ui.yShift=ui.tagBits-ui.yTruncBits,ui.xShift=ui.tagBits-ui.yTruncBits-ui.xTruncBits,ui.xScale=1<<ui.xShift,ui.xOffset=ui.xScale*(1<<ui.xTruncBits-1),ui.yMask=(1<<ui.yTruncBits)-1<<ui.yShift,ui.xMask=~ui.yMask,ui.DestroyParticlesInShape_s_aabb=new _t,ui.CreateParticleGroup_s_transform=new M,ui.ComputeCollisionEnergy_s_v=new S,ui.QueryShapeAABB_s_aabb=new _t,ui.QueryPointAABB_s_aabb=new _t,ui.RayCast_s_aabb=new _t,ui.RayCast_s_p=new S,ui.RayCast_s_v=new S,ui.RayCast_s_n=new S,ui.RayCast_s_point=new S,ui.k_pairFlags=t.b2ParticleFlag.b2_springParticle,ui.k_triadFlags=t.b2ParticleFlag.b2_elasticParticle,ui.k_noPressureFlags=t.b2ParticleFlag.b2_powderParticle|t.b2ParticleFlag.b2_tensileParticle,ui.k_extraDampingFlags=t.b2ParticleFlag.b2_staticPressureParticle,ui.k_barrierWallFlags=t.b2ParticleFlag.b2_barrierParticle|t.b2ParticleFlag.b2_wallParticle,ui.CreateParticlesStrokeShapeForGroup_s_edge=new Qo,ui.CreateParticlesStrokeShapeForGroup_s_d=new S,ui.CreateParticlesStrokeShapeForGroup_s_p=new S,ui.CreateParticlesFillShapeForGroup_s_aabb=new _t,ui.CreateParticlesFillShapeForGroup_s_p=new S,ui.UpdatePairsAndTriads_s_dab=new S,ui.UpdatePairsAndTriads_s_dbc=new S,ui.UpdatePairsAndTriads_s_dca=new S,ui.AddContact_s_d=new S,ui.UpdateBodyContacts_s_aabb=new _t,ui.Solve_s_subStep=new ze,ui.SolveCollision_s_aabb=new _t,ui.SolveGravity_s_gravity=new S,ui.SolveBarrier_s_aabb=new _t,ui.SolveBarrier_s_va=new S,ui.SolveBarrier_s_vb=new S,ui.SolveBarrier_s_pba=new S,ui.SolveBarrier_s_vba=new S,ui.SolveBarrier_s_vc=new S,ui.SolveBarrier_s_pca=new S,ui.SolveBarrier_s_vca=new S,ui.SolveBarrier_s_qba=new S,ui.SolveBarrier_s_qca=new S,ui.SolveBarrier_s_dv=new S,ui.SolveBarrier_s_f=new S,ui.SolvePressure_s_f=new S,ui.SolveDamping_s_v=new S,ui.SolveDamping_s_f=new S,ui.SolveRigidDamping_s_t0=new S,ui.SolveRigidDamping_s_t1=new S,ui.SolveRigidDamping_s_p=new S,ui.SolveRigidDamping_s_v=new S,ui.SolveExtraDamping_s_v=new S,ui.SolveExtraDamping_s_f=new S,ui.SolveRigid_s_position=new S,ui.SolveRigid_s_rotation=new V,ui.SolveRigid_s_transform=new M,ui.SolveRigid_s_velocityTransform=new M,ui.SolveElastic_s_pa=new S,ui.SolveElastic_s_pb=new S,ui.SolveElastic_s_pc=new S,ui.SolveElastic_s_r=new V,ui.SolveElastic_s_t0=new S,ui.SolveSpring_s_pa=new S,ui.SolveSpring_s_pb=new S,ui.SolveSpring_s_d=new S,ui.SolveSpring_s_f=new S,ui.SolveTensile_s_weightedNormal=new S,ui.SolveTensile_s_s=new S,ui.SolveTensile_s_f=new S,ui.SolveViscous_s_v=new S,ui.SolveViscous_s_f=new S,ui.SolveRepulsive_s_f=new S,ui.SolvePowder_s_f=new S,ui.SolveSolid_s_f=new S,ui.RemoveSpuriousBodyContacts_s_n=new S,ui.RemoveSpuriousBodyContacts_s_pos=new S,ui.RemoveSpuriousBodyContacts_s_normal=new S,function(o){o.UserOverridableBuffer=class{constructor(){this.data=null,this.userSuppliedCapacity=0}},o.Proxy=class{constructor(){this.index=-1,this.tag=0}static CompareProxyProxy(t,o){return t.tag<o.tag}static CompareTagProxy(t,o){return t<o.tag}static CompareProxyTag(t,o){return t.tag<o}},o.InsideBoundsEnumerator=class{constructor(t,e,i,s,n){this.m_system=t,this.m_xLower=(e&o.xMask)>>>0,this.m_xUpper=(i&o.xMask)>>>0,this.m_yLower=(e&o.yMask)>>>0,this.m_yUpper=(i&o.yMask)>>>0,this.m_first=s,this.m_last=n}GetNext(){for(;this.m_first<this.m_last;){const t=(this.m_system.m_proxyBuffer.data[this.m_first].tag&o.xMask)>>>0;if(t>=this.m_xLower&&t<=this.m_xUpper)return this.m_system.m_proxyBuffer.data[this.m_first++].index;this.m_first++}return-1}},o.ParticleListNode=class{constructor(){this.next=null,this.count=0,this.index=0}},o.FixedSetAllocator=class{Allocate(t,o){return o}Clear(){}GetCount(){return 0}Invalidate(t){}GetValidBuffer(){return[]}GetBuffer(){return[]}SetCount(t){}},o.FixtureParticle=class{constructor(t,o){this.second=-1,this.first=t,this.second=o}};class e extends o.FixedSetAllocator{Initialize(t,o){}Find(t){return-1}}o.FixtureParticleSet=e,o.ParticlePair=class{constructor(t,o){this.first=-1,this.second=-1,this.first=t,this.second=o}};class i extends o.FixedSetAllocator{Initialize(t,o){}Find(t){return-1}}o.b2ParticlePairSet=i,o.ConnectionFilter=class{IsNecessary(t){return!0}ShouldCreatePair(t,o){return!0}ShouldCreateTriad(t,o,e){return!0}},o.DestroyParticlesInShapeCallback=class extends Le{constructor(t,o,e,i){super(),this.m_callDestructionListener=!1,this.m_destroyed=0,this.m_system=t,this.m_shape=o,this.m_xf=e,this.m_callDestructionListener=i,this.m_destroyed=0}ReportFixture(t){return!1}ReportParticle(t,o){if(t!==this.m_system)return!1;if(!this.m_system.m_positionBuffer.data)throw new Error;return this.m_shape.TestPoint(this.m_xf,this.m_system.m_positionBuffer.data[o])&&(this.m_system.DestroyParticle(o,this.m_callDestructionListener),this.m_destroyed++),!0}Destroyed(){return this.m_destroyed}};class s extends o.ConnectionFilter{constructor(t){super(),this.m_threshold=0,this.m_threshold=t}ShouldCreatePair(t,o){return t<this.m_threshold&&this.m_threshold<=o||o<this.m_threshold&&this.m_threshold<=t}ShouldCreateTriad(t,o,e){return(t<this.m_threshold||o<this.m_threshold||e<this.m_threshold)&&(this.m_threshold<=t||this.m_threshold<=o||this.m_threshold<=e)}}o.JoinParticleGroupsFilter=s,o.CompositeShape=class extends Wo{constructor(o,e=o.length){super(t.b2ShapeType.e_unknown,0),this.m_shapeCount=0,this.m_shapes=o,this.m_shapeCount=e}Clone(){throw new Error}GetChildCount(){return 1}TestPoint(t,o){for(let e=0;e<this.m_shapeCount;e++)if(this.m_shapes[e].TestPoint(t,o))return!0;return!1}ComputeDistance(t,o,e,i){return 0}RayCast(t,o,e,i){return!1}ComputeAABB(t,o,e){const i=new _t;t.lowerBound.x=1e37,t.lowerBound.y=1e37,t.upperBound.x=-1e37,t.upperBound.y=-1e37;for(let e=0;e<this.m_shapeCount;e++){const s=this.m_shapes[e].GetChildCount();for(let n=0;n<s;n++){const s=i;this.m_shapes[e].ComputeAABB(s,o,n),t.Combine1(s)}}}ComputeMass(t,o){}SetupDistanceProxy(t,o){}ComputeSubmergedArea(t,o,e,i){return 0}Dump(t){}};class n extends o.ConnectionFilter{constructor(t){super(),this.m_flagsBuffer=t}IsNecessary(o){if(!this.m_flagsBuffer.data)throw new Error;return 0!=(this.m_flagsBuffer.data[o]&t.b2ParticleFlag.b2_reactiveParticle)}}o.ReactiveFilter=n;class r extends fi{constructor(t,o){super(t),this.m_contactFilter=o}ShouldCollideFixtureParticle(o,e,i){return!(this.m_contactFilter&&this.m_system.GetFlagsBuffer()[i]&t.b2ParticleFlag.b2_fixtureContactFilterParticle)||this.m_contactFilter.ShouldCollideFixtureParticle(o,this.m_system,i)}ReportFixtureAndParticle(e,i,s){const n=o.UpdateBodyContactsCallback.ReportFixtureAndParticle_s_n,r=o.UpdateBodyContactsCallback.ReportFixtureAndParticle_s_rp;if(!this.m_system.m_flagsBuffer.data)throw new Error;if(!this.m_system.m_positionBuffer.data)throw new Error;const a=this.m_system.m_positionBuffer.data[s],m=n,p=e.ComputeDistance(a,m,i);if(p<this.m_system.m_particleDiameter&&this.ShouldCollideFixtureParticle(e,this.m_system,s)){const o=e.GetBody(),i=o.GetWorldCenter(),n=o.GetMass(),l=o.GetInertia()-n*o.GetLocalCenter().LengthSquared(),f=n>0?1/n:0,h=l>0?1/l:0,y=this.m_system.m_flagsBuffer.data[s]&t.b2ParticleFlag.b2_wallParticle?0:this.m_system.GetParticleInvMass(),_=S.SubVV(a,i,r),c=S.CrossVV(_,m),C=y+f+h*c*c,u=this.m_system.m_bodyContactBuffer.data[this.m_system.m_bodyContactBuffer.Append()];u.index=s,u.body=o,u.fixture=e,u.weight=1-p*this.m_system.m_inverseDiameter,u.normal.Copy(m.SelfNeg()),u.mass=C>0?1/C:0,this.m_system.DetectStuckParticle(s)}}}r.ReportFixtureAndParticle_s_n=new S,r.ReportFixtureAndParticle_s_rp=new S,o.UpdateBodyContactsCallback=r;class a extends fi{constructor(t,o){super(t),this.m_step=o}ReportFixtureAndParticle(e,i,s){const n=o.SolveCollisionCallback.ReportFixtureAndParticle_s_p1,r=o.SolveCollisionCallback.ReportFixtureAndParticle_s_output,a=o.SolveCollisionCallback.ReportFixtureAndParticle_s_input,m=o.SolveCollisionCallback.ReportFixtureAndParticle_s_p,p=o.SolveCollisionCallback.ReportFixtureAndParticle_s_v,l=o.SolveCollisionCallback.ReportFixtureAndParticle_s_f,f=e.GetBody();if(!this.m_system.m_positionBuffer.data)throw new Error;if(!this.m_system.m_velocityBuffer.data)throw new Error;const h=this.m_system.m_positionBuffer.data[s],y=this.m_system.m_velocityBuffer.data[s],_=r,c=a;if(0===this.m_system.m_iterationIndex){const o=M.MulTXV(f.m_xf0,h,n);e.GetShape().GetType()===t.b2ShapeType.e_circleShape&&(o.SelfSub(f.GetLocalCenter()),V.MulRV(f.m_xf0.q,o,o),V.MulTRV(f.m_xf.q,o,o),o.SelfAdd(f.GetLocalCenter())),M.MulXV(f.m_xf,o,c.p1)}else c.p1.Copy(h);if(S.AddVMulSV(h,this.m_step.dt,y,c.p2),c.maxFraction=1,e.RayCast(_,c,i)){const t=_.normal,o=m;o.x=(1-_.fraction)*c.p1.x+_.fraction*c.p2.x+.008*t.x,o.y=(1-_.fraction)*c.p1.y+_.fraction*c.p2.y+.008*t.y;const e=p;e.x=this.m_step.inv_dt*(o.x-h.x),e.y=this.m_step.inv_dt*(o.y-h.y),this.m_system.m_velocityBuffer.data[s].Copy(e);const i=l;i.x=this.m_step.inv_dt*this.m_system.GetParticleMass()*(y.x-e.x),i.y=this.m_step.inv_dt*this.m_system.GetParticleMass()*(y.y-e.y),this.m_system.ParticleApplyForce(s,i)}}ReportParticle(t,o){return!1}}a.ReportFixtureAndParticle_s_p1=new S,a.ReportFixtureAndParticle_s_output=new yt,a.ReportFixtureAndParticle_s_input=new ht,a.ReportFixtureAndParticle_s_p=new S,a.ReportFixtureAndParticle_s_v=new S,a.ReportFixtureAndParticle_s_f=new S,o.SolveCollisionCallback=a}(ui||(ui={}));class di{constructor(t){this.m_newFixture=!1,this.m_locked=!1,this.m_clearForces=!0,this.m_contactManager=new Re,this.m_bodyList=null,this.m_jointList=null,this.m_particleSystemList=null,this.m_bodyCount=0,this.m_jointCount=0,this.m_gravity=new S,this.m_allowSleep=!0,this.m_destructionListener=null,this.m_debugDraw=null,this.m_inv_dt0=0,this.m_warmStarting=!0,this.m_continuousPhysics=!0,this.m_subStepping=!1,this.m_stepComplete=!0,this.m_profile=new ke,this.m_island=new Ze,this.s_stack=[],this.m_controllerList=null,this.m_controllerCount=0,this.m_gravity.Copy(t)}SetDestructionListener(t){this.m_destructionListener=t}SetContactFilter(t){this.m_contactManager.m_contactFilter=t}SetContactListener(t){this.m_contactManager.m_contactListener=t}SetDebugDraw(t){this.m_debugDraw=t}CreateBody(t={}){if(this.IsLocked())throw new Error;const o=new ee(t,this);return o.m_prev=null,o.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=o),this.m_bodyList=o,++this.m_bodyCount,o}DestroyBody(t){if(this.IsLocked())throw new Error;let o=t.m_jointList;for(;o;){const e=o;o=o.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(e.joint),this.DestroyJoint(e.joint),t.m_jointList=o}t.m_jointList=null;let e=t.m_controllerList;for(;e;){const o=e;e=e.nextController,o.controller.RemoveBody(t)}let i=t.m_contactList;for(;i;){const t=i;i=i.next,this.m_contactManager.Destroy(t.contact)}t.m_contactList=null;let s=t.m_fixtureList;for(;s;){const o=s;s=s.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(o),o.DestroyProxies(),o.Destroy(),t.m_fixtureList=s,t.m_fixtureCount-=1}t.m_fixtureList=null,t.m_fixtureCount=0,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_bodyList&&(this.m_bodyList=t.m_next),--this.m_bodyCount}static _Joint_Create(o,e){switch(o.type){case t.b2JointType.e_distanceJoint:return new ae(o);case t.b2JointType.e_mouseJoint:return new he(o);case t.b2JointType.e_prismaticJoint:return new ye(o);case t.b2JointType.e_revoluteJoint:return new ce(o);case t.b2JointType.e_pulleyJoint:return new _e(o);case t.b2JointType.e_gearJoint:return new le(o);case t.b2JointType.e_wheelJoint:return new de(o);case t.b2JointType.e_weldJoint:return new ue(o);case t.b2JointType.e_frictionJoint:return new pe(o);case t.b2JointType.e_ropeJoint:return new Ce(o);case t.b2JointType.e_motorJoint:return new fe(o);case t.b2JointType.e_areaJoint:return new me(o)}throw new Error}static _Joint_Destroy(t,o){}CreateJoint(t){if(this.IsLocked())throw new Error;const o=di._Joint_Create(t,null);o.m_prev=null,o.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=o),this.m_jointList=o,++this.m_jointCount,o.m_edgeA.prev=null,o.m_edgeA.next=o.m_bodyA.m_jointList,o.m_bodyA.m_jointList&&(o.m_bodyA.m_jointList.prev=o.m_edgeA),o.m_bodyA.m_jointList=o.m_edgeA,o.m_edgeB.prev=null,o.m_edgeB.next=o.m_bodyB.m_jointList,o.m_bodyB.m_jointList&&(o.m_bodyB.m_jointList.prev=o.m_edgeB),o.m_bodyB.m_jointList=o.m_edgeB;const e=t.bodyA,i=t.bodyB;if(!t.collideConnected){let t=i.GetContactList();for(;t;)t.other===e&&t.contact.FlagForFiltering(),t=t.next}return o}DestroyJoint(t){if(this.IsLocked())throw new Error;const o=t.m_collideConnected;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_jointList&&(this.m_jointList=t.m_next);const e=t.m_bodyA,i=t.m_bodyB;if(e.SetAwake(!0),i.SetAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA===e.m_jointList&&(e.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB===i.m_jointList&&(i.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,di._Joint_Destroy(t,null),--this.m_jointCount,!o){let t=i.GetContactList();for(;t;)t.other===e&&t.contact.FlagForFiltering(),t=t.next}}CreateParticleSystem(t){if(this.IsLocked())throw new Error;const o=new ui(t,this);return o.m_prev=null,o.m_next=this.m_particleSystemList,this.m_particleSystemList&&(this.m_particleSystemList.m_prev=o),this.m_particleSystemList=o,o}DestroyParticleSystem(t){if(this.IsLocked())throw new Error;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_particleSystemList&&(this.m_particleSystemList=t.m_next)}CalculateReasonableParticleIterations(t){return null===this.m_particleSystemList?1:Qe(this.m_gravity.Length(),function(t){let o=1e37;for(let e=t.GetParticleSystemList();null!==e;e=e.m_next)o=p(o,e.GetRadius());return o}(this),t)}Step(t,o,e,i=this.CalculateReasonableParticleIterations(t)){const s=di.Step_s_stepTimer.Reset();this.m_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_newFixture=!1),this.m_locked=!0;const n=di.Step_s_step;n.dt=t,n.velocityIterations=o,n.positionIterations=e,n.particleIterations=i,n.inv_dt=t>0?1/t:0,n.dtRatio=this.m_inv_dt0*t,n.warmStarting=this.m_warmStarting;const r=di.Step_s_timer.Reset();if(this.m_contactManager.Collide(),this.m_profile.collide=r.GetMilliseconds(),this.m_stepComplete&&n.dt>0){const t=di.Step_s_timer.Reset();for(let t=this.m_particleSystemList;t;t=t.m_next)t.Solve(n);this.Solve(n),this.m_profile.solve=t.GetMilliseconds()}if(this.m_continuousPhysics&&n.dt>0){const t=di.Step_s_timer.Reset();this.SolveTOI(n),this.m_profile.solveTOI=t.GetMilliseconds()}n.dt>0&&(this.m_inv_dt0=n.inv_dt),this.m_clearForces&&this.ClearForces(),this.m_locked=!1,this.m_profile.step=s.GetMilliseconds()}ClearForces(){for(let t=this.m_bodyList;t;t=t.m_next)t.m_force.SetZero(),t.m_torque=0}DrawParticleSystem(t){if(null===this.m_debugDraw)return;const o=t.GetParticleCount();if(o){const e=t.GetRadius(),i=t.GetPositionBuffer();if(t.m_colorBuffer.data){const s=t.GetColorBuffer();this.m_debugDraw.DrawParticles(i,e,s,o)}else this.m_debugDraw.DrawParticles(i,e,null,o)}}DrawDebugData(){if(null===this.m_debugDraw)return;const o=this.m_debugDraw.GetFlags(),e=di.DrawDebugData_s_color.SetRGB(0,0,0);if(o&t.b2DrawFlags.e_shapeBit)for(let o=this.m_bodyList;o;o=o.m_next){const i=o.m_xf;this.m_debugDraw.PushTransform(i);for(let i=o.GetFixtureList();i;i=i.m_next)o.IsActive()?o.GetType()===t.b2BodyType.b2_staticBody?(e.SetRGB(.5,.9,.5),this.DrawShape(i,e)):o.GetType()===t.b2BodyType.b2_kinematicBody?(e.SetRGB(.5,.5,.9),this.DrawShape(i,e)):o.IsAwake()?(e.SetRGB(.9,.7,.7),this.DrawShape(i,e)):(e.SetRGB(.6,.6,.6),this.DrawShape(i,e)):(e.SetRGB(.5,.5,.3),this.DrawShape(i,e));this.m_debugDraw.PopTransform(i)}if(o&t.b2DrawFlags.e_particleBit)for(let t=this.m_particleSystemList;t;t=t.m_next)this.DrawParticleSystem(t);if(o&t.b2DrawFlags.e_jointBit)for(let t=this.m_jointList;t;t=t.m_next)this.DrawJoint(t);if(o&t.b2DrawFlags.e_aabbBit){e.SetRGB(.9,.3,.9);const t=di.DrawDebugData_s_vs;for(let o=this.m_bodyList;o;o=o.m_next)if(o.IsActive())for(let i=o.GetFixtureList();i;i=i.m_next)for(let o=0;o<i.m_proxyCount;++o){const s=i.m_proxies[o].treeNode.aabb;t[0].Set(s.lowerBound.x,s.lowerBound.y),t[1].Set(s.upperBound.x,s.lowerBound.y),t[2].Set(s.upperBound.x,s.upperBound.y),t[3].Set(s.lowerBound.x,s.upperBound.y),this.m_debugDraw.DrawPolygon(t,4,e)}}if(o&t.b2DrawFlags.e_centerOfMassBit)for(let t=this.m_bodyList;t;t=t.m_next){const o=di.DrawDebugData_s_xf;o.q.Copy(t.m_xf.q),o.p.Copy(t.GetWorldCenter()),this.m_debugDraw.DrawTransform(o)}if(o&t.b2DrawFlags.e_controllerBit)for(let t=this.m_controllerList;t;t=t.m_next)t.Draw(this.m_debugDraw)}QueryAABB(t,o,e){if(this.m_contactManager.m_broadPhase.Query(o,o=>{const i=o.userData.fixture;return t?t.ReportFixture(i):!e||e(i)}),t instanceof Le)for(let e=this.m_particleSystemList;e;e=e.m_next)t.ShouldQueryParticleSystem(e)&&e.QueryAABB(t,o)}QueryAllAABB(t,o=[]){return this.QueryAABB(null,t,t=>(o.push(t),!0)),o}QueryPointAABB(t,o,e){if(this.m_contactManager.m_broadPhase.QueryPoint(o,o=>{const i=o.userData.fixture;return t?t.ReportFixture(i):!e||e(i)}),t instanceof Le)for(let e=this.m_particleSystemList;e;e=e.m_next)t.ShouldQueryParticleSystem(e)&&e.QueryPointAABB(t,o)}QueryAllPointAABB(t,o=[]){return this.QueryPointAABB(null,t,t=>(o.push(t),!0)),o}QueryFixtureShape(t,o,e,i,s){const n=di.QueryFixtureShape_s_aabb;if(o.ComputeAABB(n,i,e),this.m_contactManager.m_broadPhase.Query(n,n=>{const r=n.userData,a=r.fixture;if(gt(o,e,a.GetShape(),r.childIndex,i,a.GetBody().GetTransform())){if(t)return t.ReportFixture(a);if(s)return s(a)}return!0}),t instanceof Le)for(let o=this.m_particleSystemList;o;o=o.m_next)t.ShouldQueryParticleSystem(o)&&o.QueryAABB(t,n)}QueryAllFixtureShape(t,o,e,i=[]){return this.QueryFixtureShape(null,t,o,e,t=>(i.push(t),!0)),i}QueryFixturePoint(t,o,e){if(this.m_contactManager.m_broadPhase.QueryPoint(o,i=>{const s=i.userData.fixture;if(s.TestPoint(o)){if(t)return t.ReportFixture(s);if(e)return e(s)}return!0}),t)for(let e=this.m_particleSystemList;e;e=e.m_next)t.ShouldQueryParticleSystem(e)&&e.QueryPointAABB(t,o)}QueryAllFixturePoint(t,o=[]){return this.QueryFixturePoint(null,t,t=>(o.push(t),!0)),o}RayCast(t,o,e,i){const s=di.RayCast_s_input;if(s.maxFraction=1,s.p1.Copy(o),s.p2.Copy(e),this.m_contactManager.m_broadPhase.RayCast(s,(s,n)=>{const r=n.userData,a=r.fixture,m=r.childIndex,p=di.RayCast_s_output;if(a.RayCast(p,s,m)){const s=p.fraction,n=di.RayCast_s_point;if(n.Set((1-s)*o.x+s*e.x,(1-s)*o.y+s*e.y),t)return t.ReportFixture(a,n,p.normal,s);if(i)return i(a,n,p.normal,s)}return s.maxFraction}),t)for(let i=this.m_particleSystemList;i;i=i.m_next)t.ShouldQueryParticleSystem(i)&&i.RayCast(t,o,e)}RayCastOne(t,o){let e=null,i=1;return this.RayCast(null,t,o,(t,o,s,n)=>(n<i&&(i=n,e=t),i)),e}RayCastAll(t,o,e=[]){return this.RayCast(null,t,o,(t,o,i,s)=>(e.push(t),1)),e}GetBodyList(){return this.m_bodyList}GetJointList(){return this.m_jointList}GetParticleSystemList(){return this.m_particleSystemList}GetContactList(){return this.m_contactManager.m_contactList}SetAllowSleeping(t){if(t!==this.m_allowSleep&&(this.m_allowSleep=t,!this.m_allowSleep))for(let t=this.m_bodyList;t;t=t.m_next)t.SetAwake(!0)}GetAllowSleeping(){return this.m_allowSleep}SetWarmStarting(t){this.m_warmStarting=t}GetWarmStarting(){return this.m_warmStarting}SetContinuousPhysics(t){this.m_continuousPhysics=t}GetContinuousPhysics(){return this.m_continuousPhysics}SetSubStepping(t){this.m_subStepping=t}GetSubStepping(){return this.m_subStepping}GetProxyCount(){return this.m_contactManager.m_broadPhase.GetProxyCount()}GetBodyCount(){return this.m_bodyCount}GetJointCount(){return this.m_jointCount}GetContactCount(){return this.m_contactManager.m_contactCount}GetTreeHeight(){return this.m_contactManager.m_broadPhase.GetTreeHeight()}GetTreeBalance(){return this.m_contactManager.m_broadPhase.GetTreeBalance()}GetTreeQuality(){return this.m_contactManager.m_broadPhase.GetTreeQuality()}SetGravity(t,o=!0){if(!S.IsEqualToV(this.m_gravity,t)&&(this.m_gravity.Copy(t),o))for(let t=this.m_bodyList;t;t=t.m_next)t.SetAwake(!0)}GetGravity(){return this.m_gravity}IsLocked(){return this.m_locked}SetAutoClearForces(t){this.m_clearForces=t}GetAutoClearForces(){return this.m_clearForces}ShiftOrigin(t){if(this.IsLocked())throw new Error;for(let o=this.m_bodyList;o;o=o.m_next)o.m_xf.p.SelfSub(t),o.m_sweep.c0.SelfSub(t),o.m_sweep.c.SelfSub(t);for(let o=this.m_jointList;o;o=o.m_next)o.ShiftOrigin(t);this.m_contactManager.m_broadPhase.ShiftOrigin(t)}GetContactManager(){return this.m_contactManager}GetProfile(){return this.m_profile}Dump(o){if(this.m_locked)return;o("const g: b2Vec2 = new b2Vec2(%.15f, %.15f);\n",this.m_gravity.x,this.m_gravity.y),o("this.m_world.SetGravity(g);\n"),o("const bodies: b2Body[] = [];\n"),o("const joints: b2Joint[] = [];\n");let e=0;for(let t=this.m_bodyList;t;t=t.m_next)t.m_islandIndex=e,t.Dump(o),++e;e=0;for(let t=this.m_jointList;t;t=t.m_next)t.m_index=e,++e;for(let e=this.m_jointList;e;e=e.m_next)e.m_type!==t.b2JointType.e_gearJoint&&(o("{\n"),e.Dump(o),o("}\n"));for(let e=this.m_jointList;e;e=e.m_next)e.m_type===t.b2JointType.e_gearJoint&&(o("{\n"),e.Dump(o),o("}\n"))}DrawJoint(o){if(null===this.m_debugDraw)return;const e=o.GetBodyA(),i=o.GetBodyB(),s=e.m_xf,n=i.m_xf,r=s.p,a=n.p,m=o.GetAnchorA(di.DrawJoint_s_p1),p=o.GetAnchorB(di.DrawJoint_s_p2),l=di.DrawJoint_s_color.SetRGB(.5,.8,.8);switch(o.m_type){case t.b2JointType.e_distanceJoint:this.m_debugDraw.DrawSegment(m,p,l);break;case t.b2JointType.e_pulleyJoint:{const t=o,e=t.GetGroundAnchorA(),i=t.GetGroundAnchorB();this.m_debugDraw.DrawSegment(e,m,l),this.m_debugDraw.DrawSegment(i,p,l),this.m_debugDraw.DrawSegment(e,i,l);break}case t.b2JointType.e_mouseJoint:{const t=di.DrawJoint_s_c;t.Set(0,1,0),this.m_debugDraw.DrawPoint(m,4,t),this.m_debugDraw.DrawPoint(p,4,t),t.Set(.8,.8,.8),this.m_debugDraw.DrawSegment(m,p,t);break}default:this.m_debugDraw.DrawSegment(r,m,l),this.m_debugDraw.DrawSegment(m,p,l),this.m_debugDraw.DrawSegment(a,p,l)}}DrawShape(o,e){if(null===this.m_debugDraw)return;const i=o.GetShape();switch(i.m_type){case t.b2ShapeType.e_circleShape:{const t=i,o=t.m_p,s=t.m_radius,n=S.UNITX;this.m_debugDraw.DrawSolidCircle(o,s,n,e);break}case t.b2ShapeType.e_edgeShape:{const t=i,o=t.m_vertex1,s=t.m_vertex2;this.m_debugDraw.DrawSegment(o,s,e);break}case t.b2ShapeType.e_chainShape:{const t=i,o=t.m_count,s=t.m_vertices,n=di.DrawShape_s_ghostColor.SetRGBA(.75*e.r,.75*e.g,.75*e.b,e.a);let r=s[0];if(this.m_debugDraw.DrawPoint(r,4,e),t.m_hasPrevVertex){const o=t.m_prevVertex;this.m_debugDraw.DrawSegment(o,r,n),this.m_debugDraw.DrawCircle(o,.1,n)}for(let t=1;t<o;++t){const o=s[t];this.m_debugDraw.DrawSegment(r,o,e),this.m_debugDraw.DrawPoint(o,4,e),r=o}if(t.m_hasNextVertex){const o=t.m_nextVertex;this.m_debugDraw.DrawSegment(o,r,n),this.m_debugDraw.DrawCircle(o,.1,n)}break}case t.b2ShapeType.e_polygonShape:{const t=i,o=t.m_count,s=t.m_vertices;this.m_debugDraw.DrawSolidPolygon(s,o,e);break}}}Solve(o){for(let t=this.m_bodyList;t;t=t.m_next)t.m_xf0.Copy(t.m_xf);for(let t=this.m_controllerList;t;t=t.m_next)t.Step(o);this.m_profile.solveInit=0,this.m_profile.solveVelocity=0,this.m_profile.solvePosition=0;const e=this.m_island;e.Initialize(this.m_bodyCount,this.m_contactManager.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener);for(let t=this.m_bodyList;t;t=t.m_next)t.m_islandFlag=!1;for(let t=this.m_contactManager.m_contactList;t;t=t.m_next)t.m_islandFlag=!1;for(let t=this.m_jointList;t;t=t.m_next)t.m_islandFlag=!1;const i=this.s_stack;for(let s=this.m_bodyList;s;s=s.m_next){if(s.m_islandFlag)continue;if(!s.IsAwake()||!s.IsActive())continue;if(s.GetType()===t.b2BodyType.b2_staticBody)continue;e.Clear();let n=0;for(i[n++]=s,s.m_islandFlag=!0;n>0;){const o=i[--n];if(!o)throw new Error;if(e.AddBody(o),o.m_awakeFlag=!0,o.GetType()!==t.b2BodyType.b2_staticBody){for(let t=o.m_contactList;t;t=t.next){const o=t.contact;if(o.m_islandFlag)continue;if(!o.IsEnabled()||!o.IsTouching())continue;const s=o.m_fixtureA.m_isSensor,r=o.m_fixtureB.m_isSensor;if(s||r)continue;e.AddContact(o),o.m_islandFlag=!0;const a=t.other;if(!a)throw new Error;a.m_islandFlag||(i[n++]=a,a.m_islandFlag=!0)}for(let t=o.m_jointList;t;t=t.next){if(t.joint.m_islandFlag)continue;const o=t.other;o.IsActive()&&(e.AddJoint(t.joint),t.joint.m_islandFlag=!0,o.m_islandFlag||(i[n++]=o,o.m_islandFlag=!0))}}}const r=new ke;e.Solve(r,o,this.m_gravity,this.m_allowSleep),this.m_profile.solveInit+=r.solveInit,this.m_profile.solveVelocity+=r.solveVelocity,this.m_profile.solvePosition+=r.solvePosition;for(let o=0;o<e.m_bodyCount;++o){const i=e.m_bodies[o];i.GetType()===t.b2BodyType.b2_staticBody&&(i.m_islandFlag=!1)}}for(let t=0;t<i.length&&i[t];++t)i[t]=null;const s=new D;for(let o=this.m_bodyList;o;o=o.m_next)o.m_islandFlag&&o.GetType()!==t.b2BodyType.b2_staticBody&&o.SynchronizeFixtures();this.m_contactManager.FindNewContacts(),this.m_profile.broadphase=s.GetMilliseconds()}SolveTOI(o){const e=this.m_island;if(e.Initialize(64,32,0,null,this.m_contactManager.m_contactListener),this.m_stepComplete){for(let t=this.m_bodyList;t;t=t.m_next)t.m_islandFlag=!1,t.m_sweep.alpha0=0;for(let t=this.m_contactManager.m_contactList;t;t=t.m_next)t.m_toiFlag=!1,t.m_islandFlag=!1,t.m_toiCount=0,t.m_toi=1}for(;;){let i=null,s=1;for(let o=this.m_contactManager.m_contactList;o;o=o.m_next){if(!o.IsEnabled())continue;if(o.m_toiCount>8)continue;let e=1;if(o.m_toiFlag)e=o.m_toi;else{const i=o.GetFixtureA(),s=o.GetFixtureB();if(i.IsSensor()||s.IsSensor())continue;const n=i.GetBody(),r=s.GetBody(),a=n.m_type,m=r.m_type,l=n.IsAwake()&&a!==t.b2BodyType.b2_staticBody,f=r.IsAwake()&&m!==t.b2BodyType.b2_staticBody;if(!l&&!f)continue;const h=n.IsBullet()||a!==t.b2BodyType.b2_dynamicBody,y=r.IsBullet()||m!==t.b2BodyType.b2_dynamicBody;if(!h&&!y)continue;let _=n.m_sweep.alpha0;n.m_sweep.alpha0<r.m_sweep.alpha0?(_=r.m_sweep.alpha0,n.m_sweep.Advance(_)):r.m_sweep.alpha0<n.m_sweep.alpha0&&(_=n.m_sweep.alpha0,r.m_sweep.Advance(_));const c=o.GetChildIndexA(),C=o.GetChildIndexB(),u=di.SolveTOI_s_toi_input;u.proxyA.SetShape(i.GetShape(),c),u.proxyB.SetShape(s.GetShape(),C),u.sweepA.Copy(n.m_sweep),u.sweepB.Copy(r.m_sweep),u.tMax=1;const d=di.SolveTOI_s_toi_output;Zt(d,u);const x=d.t;e=d.state===t.b2TOIOutputState.e_touching?p(_+(1-_)*x,1):1,o.m_toi=e,o.m_toiFlag=!0}e<s&&(i=o,s=e)}if(null===i||.9999<s){this.m_stepComplete=!0;break}const n=i.GetFixtureA(),r=i.GetFixtureB(),a=n.GetBody(),m=r.GetBody(),l=di.SolveTOI_s_backup1.Copy(a.m_sweep),f=di.SolveTOI_s_backup2.Copy(m.m_sweep);if(a.Advance(s),m.Advance(s),i.Update(this.m_contactManager.m_contactListener),i.m_toiFlag=!1,++i.m_toiCount,!i.IsEnabled()||!i.IsTouching()){i.SetEnabled(!1),a.m_sweep.Copy(l),m.m_sweep.Copy(f),a.SynchronizeTransform(),m.SynchronizeTransform();continue}a.SetAwake(!0),m.SetAwake(!0),e.Clear(),e.AddBody(a),e.AddBody(m),e.AddContact(i),a.m_islandFlag=!0,m.m_islandFlag=!0,i.m_islandFlag=!0;for(let o=0;o<2;++o){const i=0===o?a:m;if(i.m_type===t.b2BodyType.b2_dynamicBody)for(let o=i.m_contactList;o&&e.m_bodyCount!==e.m_bodyCapacity&&e.m_contactCount!==e.m_contactCapacity;o=o.next){const n=o.contact;if(n.m_islandFlag)continue;const r=o.other;if(r.m_type===t.b2BodyType.b2_dynamicBody&&!i.IsBullet()&&!r.IsBullet())continue;const a=n.m_fixtureA.m_isSensor,m=n.m_fixtureB.m_isSensor;if(a||m)continue;const p=di.SolveTOI_s_backup.Copy(r.m_sweep);r.m_islandFlag||r.Advance(s),n.Update(this.m_contactManager.m_contactListener),n.IsEnabled()&&n.IsTouching()?(n.m_islandFlag=!0,e.AddContact(n),r.m_islandFlag||(r.m_islandFlag=!0,r.m_type!==t.b2BodyType.b2_staticBody&&r.SetAwake(!0),e.AddBody(r))):(r.m_sweep.Copy(p),r.SynchronizeTransform())}}const h=di.SolveTOI_s_subStep;h.dt=(1-s)*o.dt,h.inv_dt=1/h.dt,h.dtRatio=1,h.positionIterations=20,h.velocityIterations=o.velocityIterations,h.particleIterations=o.particleIterations,h.warmStarting=!1,e.SolveTOI(h,a.m_islandIndex,m.m_islandIndex);for(let o=0;o<e.m_bodyCount;++o){const i=e.m_bodies[o];if(i.m_islandFlag=!1,i.m_type===t.b2BodyType.b2_dynamicBody){i.SynchronizeFixtures();for(let t=i.m_contactList;t;t=t.next)t.contact.m_toiFlag=!1,t.contact.m_islandFlag=!1}}if(this.m_contactManager.FindNewContacts(),this.m_subStepping){this.m_stepComplete=!1;break}}}AddController(t){return t.m_next=this.m_controllerList,t.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=t),this.m_controllerList=t,++this.m_controllerCount,t}RemoveController(t){return t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),this.m_controllerList===t&&(this.m_controllerList=t.m_next),--this.m_controllerCount,t.m_prev=null,t.m_next=null,t}}di.Step_s_step=new ze,di.Step_s_stepTimer=new D,di.Step_s_timer=new D,di.DrawDebugData_s_color=new I(0,0,0),di.DrawDebugData_s_vs=S.MakeArray(4),di.DrawDebugData_s_xf=new M,di.QueryFixtureShape_s_aabb=new _t,di.RayCast_s_input=new ht,di.RayCast_s_output=new yt,di.RayCast_s_point=new S,di.DrawJoint_s_p1=new S,di.DrawJoint_s_p2=new S,di.DrawJoint_s_color=new I(.5,.8,.8),di.DrawJoint_s_c=new I,di.DrawShape_s_ghostColor=new I,di.SolveTOI_s_subStep=new ze,di.SolveTOI_s_backup=new P,di.SolveTOI_s_backup1=new P,di.SolveTOI_s_backup2=new P,di.SolveTOI_s_toi_input=new Ft,di.SolveTOI_s_toi_output=new kt;class xi{constructor(t,o){this.prevBody=null,this.nextBody=null,this.prevController=null,this.nextController=null,this.controller=t,this.body=o}}class gi{constructor(){this.m_bodyList=null,this.m_bodyCount=0,this.m_prev=null,this.m_next=null}GetNext(){return this.m_next}GetPrev(){return this.m_prev}GetBodyList(){return this.m_bodyList}AddBody(t){const o=new xi(this,t);o.nextBody=this.m_bodyList,o.prevBody=null,this.m_bodyList&&(this.m_bodyList.prevBody=o),this.m_bodyList=o,++this.m_bodyCount,o.nextController=t.m_controllerList,o.prevController=null,t.m_controllerList&&(t.m_controllerList.prevController=o),t.m_controllerList=o,++t.m_controllerCount}RemoveBody(t){if(this.m_bodyCount<=0)throw new Error;let o=this.m_bodyList;for(;o&&o.body!==t;)o=o.nextBody;if(null===o)throw new Error;o.prevBody&&(o.prevBody.nextBody=o.nextBody),o.nextBody&&(o.nextBody.prevBody=o.prevBody),this.m_bodyList===o&&(this.m_bodyList=o.nextBody),--this.m_bodyCount,o.nextController&&(o.nextController.prevController=o.prevController),o.prevController&&(o.prevController.nextController=o.nextController),t.m_controllerList===o&&(t.m_controllerList=o.nextController),--t.m_controllerCount}Clear(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body);this.m_bodyCount=0}}class Bi extends gi{constructor(){super(...arguments),this.A=new S(0,0)}Step(t){const o=S.MulSV(t.dt,this.A,Bi.Step_s_dtA);for(let t=this.m_bodyList;t;t=t.nextBody){const e=t.body;e.IsAwake()&&e.SetLinearVelocity(S.AddVV(e.GetLinearVelocity(),o,S.s_t0))}}Draw(t){}}Bi.Step_s_dtA=new S;class Si extends gi{constructor(){super(...arguments),this.G=1,this.invSqr=!0}Step(t){if(this.invSqr)for(let t=this.m_bodyList;t;t=t.nextBody){const o=t.body,e=o.GetWorldCenter(),i=o.GetMass();for(let s=this.m_bodyList;s&&s!==t;s=s.nextBody){const t=s.body,n=t.GetWorldCenter(),r=t.GetMass(),a=n.x-e.x,m=n.y-e.y,p=a*a+m*m;if(p<1e-5)continue;const l=Si.Step_s_f.Set(a,m);l.SelfMul(this.G/p/c(p)*i*r),o.IsAwake()&&o.ApplyForce(l,e),t.IsAwake()&&t.ApplyForce(l.SelfMul(-1),n)}}else for(let t=this.m_bodyList;t;t=t.nextBody){const o=t.body,e=o.GetWorldCenter(),i=o.GetMass();for(let s=this.m_bodyList;s&&s!==t;s=s.nextBody){const t=s.body,n=t.GetWorldCenter(),r=t.GetMass(),a=n.x-e.x,m=n.y-e.y,p=a*a+m*m;if(p<1e-5)continue;const l=Si.Step_s_f.Set(a,m);l.SelfMul(this.G/p*i*r),o.IsAwake()&&o.ApplyForce(l,e),t.IsAwake()&&t.ApplyForce(l.SelfMul(-1),n)}}}Draw(t){}}Si.Step_s_f=new S;class bi extends gi{constructor(){super(...arguments),this.T=new v,this.maxTimestep=0}Step(t){let o=t.dt;if(!(o<=1e-5)){o>this.maxTimestep&&this.maxTimestep>0&&(o=this.maxTimestep);for(let t=this.m_bodyList;t;t=t.nextBody){const e=t.body;if(!e.IsAwake())continue;const i=e.GetWorldVector(v.MulMV(this.T,e.GetLocalVector(e.GetLinearVelocity(),S.s_t0),S.s_t1),bi.Step_s_damping);e.SetLinearVelocity(S.AddVV(e.GetLinearVelocity(),S.MulSV(o,i,S.s_t0),S.s_t1))}}}Draw(t){}SetAxisAligned(t,o){this.T.ex.x=-t,this.T.ex.y=0,this.T.ey.x=0,this.T.ey.y=-o,this.maxTimestep=t>0||o>0?1/l(t,o):0}}bi.Step_s_damping=new S;class Ai{constructor(){this.m_count=0,this.m_ps=[],this.m_p0s=[],this.m_vs=[],this.m_ims=[],this.m_Ls=[],this.m_as=[],this.m_gravity=new S,this.m_damping=0,this.m_k2=1,this.m_k3=.1}GetVertexCount(){return this.m_count}GetVertices(){return this.m_ps}Initialize(t){this.m_count=t.count,this.m_ps=S.MakeArray(this.m_count),this.m_p0s=S.MakeArray(this.m_count),this.m_vs=S.MakeArray(this.m_count),this.m_ims=a(this.m_count);for(let o=0;o<this.m_count;++o){this.m_ps[o].Copy(t.vertices[o]),this.m_p0s[o].Copy(t.vertices[o]),this.m_vs[o].SetZero();const e=t.masses[o];this.m_ims[o]=e>0?1/e:0}const o=this.m_count-1,e=this.m_count-2;this.m_Ls=a(o),this.m_as=a(e);for(let t=0;t<o;++t){const o=this.m_ps[t],e=this.m_ps[t+1];this.m_Ls[t]=S.DistanceVV(o,e)}for(let t=0;t<e;++t){const o=this.m_ps[t],e=this.m_ps[t+1],i=this.m_ps[t+2],s=S.SubVV(e,o,S.s_t0),n=S.SubVV(i,e,S.s_t1),r=S.CrossVV(s,n),a=S.DotVV(s,n);this.m_as[t]=B(r,a)}this.m_gravity.Copy(t.gravity),this.m_damping=t.damping,this.m_k2=t.k2,this.m_k3=t.k3}Step(t,o){if(0===t)return;const e=Math.exp(-t*this.m_damping);for(let o=0;o<this.m_count;++o)this.m_p0s[o].Copy(this.m_ps[o]),this.m_ims[o]>0&&this.m_vs[o].SelfMulAdd(t,this.m_gravity),this.m_vs[o].SelfMul(e),this.m_ps[o].SelfMulAdd(t,this.m_vs[o]);for(let t=0;t<o;++t)this.SolveC2(),this.SolveC3(),this.SolveC2();const i=1/t;for(let t=0;t<this.m_count;++t)S.MulSV(i,S.SubVV(this.m_ps[t],this.m_p0s[t],S.s_t0),this.m_vs[t])}SolveC2(){const t=this.m_count-1;for(let o=0;o<t;++o){const t=this.m_ps[o],e=this.m_ps[o+1],i=S.SubVV(e,t,Ai.s_d),s=i.Normalize(),n=this.m_ims[o],r=this.m_ims[o+1];if(n+r===0)continue;const a=n/(n+r),m=r/(n+r);t.SelfMulSub(this.m_k2*a*(this.m_Ls[o]-s),i),e.SelfMulAdd(this.m_k2*m*(this.m_Ls[o]-s),i)}}SetAngle(t){const o=this.m_count-2;for(let e=0;e<o;++e)this.m_as[e]=t}SolveC3(){const t=this.m_count-2;for(let o=0;o<t;++o){const t=this.m_ps[o],i=this.m_ps[o+1],s=this.m_ps[o+2],n=this.m_ims[o],r=this.m_ims[o+1],a=this.m_ims[o+2],m=S.SubVV(i,t,Ai.s_d1),p=S.SubVV(s,i,Ai.s_d2),l=m.LengthSquared(),f=p.LengthSquared();if(l*f==0)continue;const h=S.CrossVV(m,p),y=S.DotVV(m,p);let _=B(h,y);const c=S.MulSV(-1/l,m.SelfSkew(),Ai.s_Jd1),C=S.MulSV(1/f,p.SelfSkew(),Ai.s_Jd2),u=S.NegV(c,Ai.s_J1),d=S.SubVV(c,C,Ai.s_J2),x=C;let g=n*S.DotVV(u,u)+r*S.DotVV(d,d)+a*S.DotVV(x,x);if(0===g)continue;g=1/g;let b=_-this.m_as[o];for(;b>e;)_-=2*e,b=_-this.m_as[o];for(;b<-e;)_+=2*e,b=_-this.m_as[o];const A=-this.m_k3*g*b;t.SelfMulAdd(n*A,u),i.SelfMulAdd(r*A,d),s.SelfMulAdd(a*A,x)}}Draw(t){const o=new I(.4,.5,.7);for(let e=0;e<this.m_count-1;++e)t.DrawSegment(this.m_ps[e],this.m_ps[e+1],o)}}Ai.s_d=new S,Ai.s_d1=new S,Ai.s_d2=new S,Ai.s_Jd1=new S,Ai.s_Jd2=new S,Ai.s_J1=new S,Ai.s_J2=new S,t.b2Assert=function(t,...o){if(!t)throw new Error(...o)},t.b2Maybe=o,t.b2_maxFloat=1e37,t.b2_epsilon=1e-5,t.b2_epsilon_sq=1e-5*1e-5,t.b2_pi=e,t.b2_maxManifoldPoints=2,t.b2_maxPolygonVertices=8,t.b2_aabbExtension=.1,t.b2_aabbMultiplier=2,t.b2_linearSlop=.008,t.b2_angularSlop=i,t.b2_polygonRadius=.016,t.b2_maxSubSteps=8,t.b2_maxTOIContacts=32,t.b2_velocityThreshold=1,t.b2_maxLinearCorrection=.2,t.b2_maxAngularCorrection=.13962634015955555,t.b2_maxTranslation=2,t.b2_maxTranslationSquared=4,t.b2_maxRotation=1.570796326795,t.b2_maxRotationSquared=2.4674011002726646,t.b2_baumgarte=.2,t.b2_toiBaumgarte=.75,t.b2_invalidParticleIndex=-1,t.b2_maxParticleIndex=2147483647,t.b2_particleStride=.75,t.b2_minParticleWeight=1,t.b2_maxParticlePressure=.25,t.b2_maxParticleForce=.5,t.b2_maxTriadDistance=2,t.b2_maxTriadDistanceSquared=4,t.b2_minParticleSystemBufferCapacity=256,t.b2_barrierCollisionTime=2.5,t.b2_timeToSleep=.5,t.b2_linearSleepTolerance=.01,t.b2_angularSleepTolerance=.03490658503988889,t.b2Alloc=function(t){return null},t.b2Free=function(t){},t.b2Log=function(t,...o){},t.b2Version=s,t.b2_version=n,t.b2_branch="master",t.b2_commit="fbf51801d80fc389d43dc46524520e89043b6faf",t.b2ParseInt=function(t){return parseInt(t,10)},t.b2ParseUInt=function(t){return Math.abs(parseInt(t,10))},t.b2MakeArray=r,t.b2MakeNullArray=function(t){const o=[];for(let e=0;e<t;++e)o.push(null);return o},t.b2MakeNumberArray=a,t.b2_pi_over_180=.017453292519944444,t.b2_180_over_pi=57.29577951307855,t.b2_two_pi=6.28318530718,t.b2Abs=m,t.b2Min=p,t.b2Max=l,t.b2Clamp=f,t.b2Swap=function(t,o){const e=t[0];t[0]=o[0],o[0]=e},t.b2IsValid=h,t.b2Sq=y,t.b2InvSqrt=_,t.b2Sqrt=c,t.b2Pow=C,t.b2DegToRad=function(t){return.017453292519944444*t},t.b2RadToDeg=function(t){return 57.29577951307855*t},t.b2Cos=u,t.b2Sin=d,t.b2Acos=x,t.b2Asin=g,t.b2Atan2=B,t.b2NextPowerOfTwo=function(t){return t|=t>>1&2147483647,t|=t>>2&1073741823,t|=t>>4&268435455,t|=t>>8&16777215,1+(t|=t>>16&65535)},t.b2IsPowerOfTwo=function(t){return t>0&&0==(t&t-1)},t.b2Random=function(){return 2*Math.random()-1},t.b2RandomRange=function(t,o){return(o-t)*Math.random()+t},t.b2Vec2=S,t.b2Vec2_zero=b,t.b2Vec3=A,t.b2Mat22=v,t.b2Mat33=w,t.b2Rot=V,t.b2Transform=M,t.b2Sweep=P,t.b2Color=I,t.b2Draw=class{constructor(){this.m_drawFlags=0}SetFlags(t){this.m_drawFlags=t}GetFlags(){return this.m_drawFlags}AppendFlags(t){this.m_drawFlags|=t}ClearFlags(t){this.m_drawFlags&=~t}},t.b2Timer=D,t.b2Counter=class{constructor(){this.m_count=0,this.m_min_count=0,this.m_max_count=0}GetCount(){return this.m_count}GetMinCount(){return this.m_min_count}GetMaxCount(){return this.m_max_count}ResetCount(){const t=this.m_count;return this.m_count=0,t}ResetMinCount(){this.m_min_count=0}ResetMaxCount(){this.m_max_count=0}Increment(){this.m_count++,this.m_max_count<this.m_count&&(this.m_max_count=this.m_count)}Decrement(){this.m_count--,this.m_min_count>this.m_count&&(this.m_min_count=this.m_count)}},t.b2GrowableStack=T,t.b2BlockAllocator=class{},t.b2StackAllocator=class{},t.b2ContactFeature=rt,t.b2ContactID=at,t.b2ManifoldPoint=mt,t.b2Manifold=pt,t.b2WorldManifold=lt,t.b2GetPointStates=function(o,e,i,s){let n;for(n=0;n<i.pointCount;++n){const e=i.points[n].id.key;o[n]=t.b2PointState.b2_removeState;for(let i=0,r=s.pointCount;i<r;++i)if(s.points[i].id.key===e){o[n]=t.b2PointState.b2_persistState;break}}for(;n<2;++n)o[n]=t.b2PointState.b2_nullState;for(n=0;n<s.pointCount;++n){const o=s.points[n].id.key;e[n]=t.b2PointState.b2_addState;for(let s=0,r=i.pointCount;s<r;++s)if(i.points[s].id.key===o){e[n]=t.b2PointState.b2_persistState;break}}for(;n<2;++n)e[n]=t.b2PointState.b2_nullState},t.b2ClipVertex=ft,t.b2RayCastInput=ht,t.b2RayCastOutput=yt,t.b2AABB=_t,t.b2TestOverlapAABB=ct,t.b2ClipSegmentToLine=Ct,t.b2TestOverlapShape=gt,t.b2DistanceProxy=F,t.b2SimplexCache=L,t.b2DistanceInput=R,t.b2DistanceOutput=k,t.b2ShapeCastInput=class{constructor(){this.proxyA=new F,this.proxyB=new F,this.transformA=new M,this.transformB=new M,this.translationB=new S}},t.b2ShapeCastOutput=class{constructor(){this.point=new S,this.normal=new S,this.lambda=0,this.iterations=0}},t.b2_gjk_reset=function(){t.b2_gjkCalls=0,t.b2_gjkIters=0,t.b2_gjkMaxIters=0},t.b2SimplexVertex=z,t.b2Simplex=q,t.b2Distance=Z,t.b2ShapeCast=function(t,o){t.iterations=0,t.lambda=1,t.normal.SetZero(),t.point.SetZero();const e=o.proxyA,i=o.proxyB,s=l(e.m_radius,.016)+l(i.m_radius,.016),n=o.transformA,r=o.transformB,a=o.translationB,p=H.Set(0,0);let f=0;const h=Q;h.m_count=0;const y=h.m_vertices;let _=e.GetSupport(V.MulTRV(n.q,S.NegV(a,S.s_t1),S.s_t0)),c=M.MulXV(n,e.GetVertex(_),Y),C=i.GetSupport(V.MulTRV(r.q,a,S.s_t0)),u=M.MulXV(r,i.GetVertex(C),K);const d=S.SubVV(c,u,$),x=l(.016,s-.016);let g=0;for(;g<20&&m(d.Length()-x)>.004;){t.iterations+=1,_=e.GetSupport(V.MulTRV(n.q,S.NegV(d,S.s_t1),S.s_t0)),c=M.MulXV(n,e.GetVertex(_),Y),C=i.GetSupport(V.MulTRV(r.q,d,S.s_t0)),u=M.MulXV(r,i.GetVertex(C),K);const o=S.SubVV(c,u,tt);d.Normalize();const s=S.DotVV(d,o),m=S.DotVV(d,a);if(s-x>f*m){if(m<=0)return!1;if(f=(s-x)/m,f>1)return!1;p.Copy(d).SelfNeg(),h.m_count=0}const l=y[h.m_count];switch(l.indexA=C,l.wA.Copy(u).SelfMulAdd(f,a),l.indexB=_,l.wB.Copy(c),l.w.Copy(l.wB).SelfSub(l.wA),l.a=1,h.m_count+=1,h.m_count){case 1:break;case 2:h.Solve2();break;case 3:h.Solve3()}if(3===h.m_count)return!1;h.GetClosestPoint(d),++g}const B=ot,b=et;return h.GetWitnessPoints(B,b),d.LengthSquared()>0&&(p.Copy(d).SelfNeg(),p.Normalize()),t.normal.Copy(p),t.lambda=f,t.iterations=g,!0},t.b2Pair=At,t.b2BroadPhase=vt,t.b2PairLessThan=wt,t.b2TreeNode=St,t.b2DynamicTree=bt,t.b2_toi_reset=function(){t.b2_toiTime=0,t.b2_toiMaxTime=0,t.b2_toiCalls=0,t.b2_toiIters=0,t.b2_toiMaxIters=0,t.b2_toiRootIters=0,t.b2_toiMaxRootIters=0},t.b2TOIInput=Ft,t.b2TOIOutput=kt,t.b2SeparationFunction=zt,t.b2TimeOfImpact=Zt,t.b2CollideCircles=Yt,t.b2CollidePolygonAndCircle=oo,t.b2CollidePolygons=vo,t.b2CollideEdgeAndCircle=Fo,t.b2CollideEdgeAndPolygon=qo,t.b2MassData=Eo,t.b2Shape=Wo,t.b2CircleShape=Zo,t.b2PolygonShape=Ho,t.b2EdgeShape=Qo,t.b2ChainShape=Yo,t.b2Filter=Ko,t.b2FixtureDef=$o,t.b2FixtureProxy=te,t.b2Fixture=oe,t.b2BodyDef=class{constructor(){this.type=t.b2BodyType.b2_staticBody,this.position=new S(0,0),this.angle=0,this.linearVelocity=new S(0,0),this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.active=!0,this.userData=null,this.gravityScale=1}},t.b2Body=ee,t.b2World=di,t.b2DestructionListener=class{SayGoodbyeJoint(t){}SayGoodbyeFixture(t){}SayGoodbyeParticleGroup(t){}SayGoodbyeParticle(t,o){}},t.b2ContactFilter=De,t.b2ContactImpulse=Te,t.b2ContactListener=Fe,t.b2QueryCallback=Le,t.b2RayCastCallback=class{ReportFixture(t,o,e,i){return i}ReportParticle(t,o,e,i,s){return 0}ShouldQueryParticleSystem(t){return!0}},t.b2Island=Ze,t.b2Profile=ke,t.b2TimeStep=ze,t.b2Position=qe,t.b2Velocity=Ee,t.b2SolverData=Je,t.b2ContactManager=Re,t.b2MixFriction=xe,t.b2MixRestitution=ge,t.b2ContactEdge=Be,t.b2Contact=Se,t.b2ContactRegister=Ie,t.b2ContactFactory=Ge,t.g_blockSolve=!1,t.b2VelocityConstraintPoint=je,t.b2ContactVelocityConstraint=Ne,t.b2ContactPositionConstraint=Oe,t.b2ContactSolverDef=Ue,t.b2PositionSolverManifold=Xe,t.b2ContactSolver=We,t.b2CircleContact=be,t.b2PolygonContact=Ae,t.b2PolygonAndCircleContact=ve,t.b2EdgeAndCircleContact=we,t.b2EdgeAndPolygonContact=Ve,t.b2ChainAndCircleContact=Me,t.b2ChainAndPolygonContact=Pe,t.b2Jacobian=class{constructor(){this.linear=new S,this.angularA=0,this.angularB=0}SetZero(){return this.linear.SetZero(),this.angularA=0,this.angularB=0,this}Set(t,o,e){return this.linear.Copy(t),this.angularA=o,this.angularB=e,this}},t.b2JointEdge=ie,t.b2JointDef=se,t.b2Joint=ne,t.b2AreaJointDef=class extends se{constructor(){super(t.b2JointType.e_areaJoint),this.bodies=[],this.frequencyHz=0,this.dampingRatio=0}AddBody(t){this.bodies.push(t),1===this.bodies.length?this.bodyA=t:2===this.bodies.length&&(this.bodyB=t)}},t.b2AreaJoint=me,t.b2DistanceJointDef=re,t.b2DistanceJoint=ae,t.b2FrictionJointDef=class extends se{constructor(){super(t.b2JointType.e_frictionJoint),this.localAnchorA=new S,this.localAnchorB=new S,this.maxForce=0,this.maxTorque=0}Initialize(t,o,e){this.bodyA=t,this.bodyB=o,this.bodyA.GetLocalPoint(e,this.localAnchorA),this.bodyB.GetLocalPoint(e,this.localAnchorB)}},t.b2FrictionJoint=pe,t.b2GearJointDef=class extends se{constructor(){super(t.b2JointType.e_gearJoint),this.ratio=1}},t.b2GearJoint=le,t.b2MotorJointDef=class extends se{constructor(){super(t.b2JointType.e_motorJoint),this.linearOffset=new S(0,0),this.angularOffset=0,this.maxForce=1,this.maxTorque=1,this.correctionFactor=.3}Initialize(t,o){this.bodyA=t,this.bodyB=o,this.bodyA.GetLocalPoint(this.bodyB.GetPosition(),this.linearOffset);const e=this.bodyA.GetAngle(),i=this.bodyB.GetAngle();this.angularOffset=i-e}},t.b2MotorJoint=fe,t.b2MouseJointDef=class extends se{constructor(){super(t.b2JointType.e_mouseJoint),this.target=new S,this.maxForce=0,this.frequencyHz=5,this.dampingRatio=.7}},t.b2MouseJoint=he,t.b2PrismaticJointDef=class extends se{constructor(){super(t.b2JointType.e_prismaticJoint),this.localAnchorA=new S,this.localAnchorB=new S,this.localAxisA=new S(1,0),this.referenceAngle=0,this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0}Initialize(t,o,e,i){this.bodyA=t,this.bodyB=o,this.bodyA.GetLocalPoint(e,this.localAnchorA),this.bodyB.GetLocalPoint(e,this.localAnchorB),this.bodyA.GetLocalVector(i,this.localAxisA),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}},t.b2PrismaticJoint=ye,t.b2_minPulleyLength=2,t.b2PulleyJointDef=class extends se{constructor(){super(t.b2JointType.e_pulleyJoint),this.groundAnchorA=new S(-1,1),this.groundAnchorB=new S(1,1),this.localAnchorA=new S(-1,0),this.localAnchorB=new S(1,0),this.lengthA=0,this.lengthB=0,this.ratio=1,this.collideConnected=!0}Initialize(t,o,e,i,s,n,r){this.bodyA=t,this.bodyB=o,this.groundAnchorA.Copy(e),this.groundAnchorB.Copy(i),this.bodyA.GetLocalPoint(s,this.localAnchorA),this.bodyB.GetLocalPoint(n,this.localAnchorB),this.lengthA=S.DistanceVV(s,e),this.lengthB=S.DistanceVV(n,i),this.ratio=r}},t.b2PulleyJoint=_e,t.b2RevoluteJointDef=class extends se{constructor(){super(t.b2JointType.e_revoluteJoint),this.localAnchorA=new S(0,0),this.localAnchorB=new S(0,0),this.referenceAngle=0,this.enableLimit=!1,this.lowerAngle=0,this.upperAngle=0,this.enableMotor=!1,this.motorSpeed=0,this.maxMotorTorque=0}Initialize(t,o,e){this.bodyA=t,this.bodyB=o,this.bodyA.GetLocalPoint(e,this.localAnchorA),this.bodyB.GetLocalPoint(e,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}},t.b2RevoluteJoint=ce,t.b2RopeJointDef=class extends se{constructor(){super(t.b2JointType.e_ropeJoint),this.localAnchorA=new S(-1,0),this.localAnchorB=new S(1,0),this.maxLength=0}},t.b2RopeJoint=Ce,t.b2WeldJointDef=class extends se{constructor(){super(t.b2JointType.e_weldJoint),this.localAnchorA=new S,this.localAnchorB=new S,this.referenceAngle=0,this.frequencyHz=0,this.dampingRatio=0}Initialize(t,o,e){this.bodyA=t,this.bodyB=o,this.bodyA.GetLocalPoint(e,this.localAnchorA),this.bodyB.GetLocalPoint(e,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}},t.b2WeldJoint=ue,t.b2WheelJointDef=class extends se{constructor(){super(t.b2JointType.e_wheelJoint),this.localAnchorA=new S(0,0),this.localAnchorB=new S(0,0),this.localAxisA=new S(1,0),this.enableMotor=!1,this.maxMotorTorque=0,this.motorSpeed=0,this.frequencyHz=2,this.dampingRatio=.7}Initialize(t,o,e,i){this.bodyA=t,this.bodyB=o,this.bodyA.GetLocalPoint(e,this.localAnchorA),this.bodyB.GetLocalPoint(e,this.localAnchorB),this.bodyA.GetLocalVector(i,this.localAxisA)}},t.b2WheelJoint=de,t.b2ControllerEdge=xi,t.b2Controller=gi,t.b2BuoyancyController=class extends gi{constructor(){super(...arguments),this.normal=new S(0,1),this.offset=0,this.density=0,this.velocity=new S(0,0),this.linearDrag=0,this.angularDrag=0,this.useDensity=!1,this.useWorldGravity=!0,this.gravity=new S(0,0)}Step(t){if(this.m_bodyList){this.useWorldGravity&&this.gravity.Copy(this.m_bodyList.body.GetWorld().GetGravity());for(let t=this.m_bodyList;t;t=t.nextBody){const o=t.body;if(!o.IsAwake())continue;const e=new S,i=new S;let s=0,n=0;for(let t=o.GetFixtureList();t;t=t.m_next){const r=new S,a=t.GetShape().ComputeSubmergedArea(this.normal,this.offset,o.GetTransform(),r);s+=a,e.x+=a*r.x,e.y+=a*r.y;let m=0;m=this.useDensity?t.GetDensity():1,n+=a*m,i.x+=a*r.x*m,i.y+=a*r.y*m}if(e.x/=s,e.y/=s,i.x/=n,i.y/=n,s<1e-5)continue;const r=this.gravity.Clone().SelfNeg();r.SelfMul(this.density*s),o.ApplyForce(r,i);const a=o.GetLinearVelocityFromWorldPoint(e,new S);a.SelfSub(this.velocity),a.SelfMul(-this.linearDrag*s),o.ApplyForce(a,e),o.ApplyTorque(-o.GetInertia()/o.GetMass()*s*o.GetAngularVelocity()*this.angularDrag)}}}Draw(t){const o=100,e=new S,i=new S;e.x=this.normal.x*this.offset+this.normal.y*o,e.y=this.normal.y*this.offset-this.normal.x*o,i.x=this.normal.x*this.offset-this.normal.y*o,i.y=this.normal.y*this.offset+this.normal.x*o;const s=new I(0,0,.8);t.DrawSegment(e,i,s)}},t.b2ConstantAccelController=Bi,t.b2ConstantForceController=class extends gi{constructor(){super(...arguments),this.F=new S(0,0)}Step(t){for(let t=this.m_bodyList;t;t=t.nextBody){const o=t.body;o.IsAwake()&&o.ApplyForce(this.F,o.GetWorldCenter())}}Draw(t){}},t.b2GravityController=Si,t.b2TensorDampingController=bi,t.b2ParticleDef=He,t.b2CalculateParticleIterations=Qe,t.b2ParticleHandle=Ye,t.b2ParticleGroupDef=Ke,t.b2ParticleGroup=$e,t.b2GrowableBuffer=li,t.b2FixtureParticleQueryCallback=fi,t.b2ParticleContact=hi,t.b2ParticleBodyContact=yi,t.b2ParticlePair=_i,t.b2ParticleTriad=ci,t.b2ParticleSystemDef=Ci,t.b2ParticleSystem=ui,t.b2RopeDef=class{constructor(){this.vertices=[],this.count=0,this.masses=[],this.gravity=new S(0,0),this.damping=.1,this.k2=.9,this.k3=.1}},t.b2Rope=Ai,Object.defineProperty(t,"__esModule",{value:!0})}(o)},function(t,o,e){"use strict";e.r(o);var i=e(0);class s extends i.b2Draw{constructor(){super(),this.m_ctx=null;let t=i.b2DrawFlags.e_none;t|=i.b2DrawFlags.e_shapeBit,t|=i.b2DrawFlags.e_jointBit,this.SetFlags(t),console.log("debug draw is enabled")}PushTransform(t){const o=this.m_ctx;o&&(o.save(),o.translate(t.p.x,t.p.y),o.rotate(t.q.GetAngle()))}PopTransform(t){const o=this.m_ctx;o&&o.restore()}DrawPolygon(t,o,e){const i=this.m_ctx;if(i){i.beginPath(),i.moveTo(t[0].x,t[0].y);for(let e=1;e<o;e++)i.lineTo(t[e].x,t[e].y);i.closePath(),i.strokeStyle=e.MakeStyleString(1),i.stroke()}}DrawSolidPolygon(t,o,e){const i=this.m_ctx;if(i){i.beginPath(),i.moveTo(t[0].x,t[0].y);for(let e=1;e<o;e++)i.lineTo(t[e].x,t[e].y);i.closePath(),i.fillStyle=e.MakeStyleString(.5),i.fill(),i.strokeStyle=e.MakeStyleString(1),i.stroke()}}DrawCircle(t,o,e){const s=this.m_ctx;s&&(s.beginPath(),s.arc(t.x,t.y,o,0,2*i.b2_pi,!0),s.strokeStyle=e.MakeStyleString(1),s.stroke())}DrawSolidCircle(t,o,e,s){const n=this.m_ctx;if(n){const r=t.x,a=t.y;n.beginPath(),n.arc(r,a,o,0,2*i.b2_pi,!0),n.moveTo(r,a),n.lineTo(r+e.x*o,a+e.y*o),n.fillStyle=s.MakeStyleString(.5),n.fill(),n.strokeStyle=s.MakeStyleString(1),n.stroke()}}DrawParticles(t,o,e,s){const n=this.m_ctx;if(n)if(null!==e)for(let r=0;r<s;++r){const s=t[r],a=e[r];n.fillStyle=a.MakeStyleString(),n.beginPath(),n.arc(s.x,s.y,o,0,2*i.b2_pi,!0),n.fill()}else{n.fillStyle="rgba(255,255,255,0.5)";for(let e=0;e<s;++e){const s=t[e];n.beginPath(),n.arc(s.x,s.y,o,0,2*i.b2_pi,!0),n.fill()}}}DrawSegment(t,o,e){const i=this.m_ctx;i&&(i.beginPath(),i.moveTo(t.x,t.y),i.lineTo(o.x,o.y),i.strokeStyle=e.MakeStyleString(1),i.stroke())}DrawTransform(t){const o=this.m_ctx;o&&(this.PushTransform(t),o.beginPath(),o.moveTo(0,0),o.lineTo(1,0),o.strokeStyle=i.b2Color.RED.MakeStyleString(1),o.stroke(),o.beginPath(),o.moveTo(0,0),o.lineTo(0,1),o.strokeStyle=i.b2Color.GREEN.MakeStyleString(1),o.stroke(),this.PopTransform(t))}DrawPoint(t,o,e){const i=this.m_ctx;if(i){i.fillStyle=e.MakeStyleString(),o*=n.m_zoom;const s=(o/=n.m_extent)/2;i.fillRect(t.x-s,t.y-s,o,o)}}DrawString(t,o,e){const i=this.m_ctx;if(i){i.save(),i.setTransform(1,0,0,1,0,0),i.font="15px DroidSans";const n=s.DrawString_s_color;i.fillStyle=n.MakeStyleString(),i.fillText(e,t,o),i.restore()}}DrawStringWorld(t,o,e){const r=this.m_ctx;if(r){const a=s.DrawStringWorld_s_p.Set(t,o),m=n.m_center;i.b2Vec2.SubVV(a,m,a);const p=n.m_zoom;i.b2Vec2.MulSV(1/p,a,a);const l=.5*n.m_height/n.m_extent;i.b2Vec2.MulSV(l,a,a),a.y*=-1;const f=s.DrawStringWorld_s_cc.Set(.5*r.canvas.width,.5*r.canvas.height);i.b2Vec2.AddVV(a,f,a),r.save(),r.setTransform(1,0,0,1,0,0),r.font="15px DroidSans";const h=s.DrawStringWorld_s_color;r.fillStyle=h.MakeStyleString(),r.fillText(e,a.x,a.y),r.restore()}}DrawAABB(t,o){const e=this.m_ctx;if(e){e.strokeStyle=o.MakeStyleString();const i=t.lowerBound.x,s=t.lowerBound.y,n=t.upperBound.x-t.lowerBound.x,r=t.upperBound.y-t.lowerBound.y;e.strokeRect(i,s,n,r)}}}s.DrawString_s_color=new i.b2Color(.9,.6,.6),s.DrawStringWorld_s_p=new i.b2Vec2,s.DrawStringWorld_s_cc=new i.b2Vec2,s.DrawStringWorld_s_color=new i.b2Color(.5,.9,.5);const n=new class{constructor(){this.m_center=new i.b2Vec2(0,20),this.m_extent=25,this.m_zoom=1,this.m_width=1280,this.m_height=800}ConvertScreenToWorld(t,o){return this.ConvertElementToWorld(t,o)}ConvertWorldToScreen(t,o){return this.ConvertWorldToElement(t,o)}ConvertViewportToElement(t,o){const e=t.x+.5*this.m_width,i=.5*this.m_height-t.y;return o.Set(e,i)}ConvertElementToViewport(t,o){const e=t.x-.5*this.m_width,i=.5*this.m_height-t.y;return o.Set(e,i)}ConvertProjectionToViewport(t,o){const e=o.Copy(t);return i.b2Vec2.MulSV(1/this.m_zoom,e,e),i.b2Vec2.MulSV(.5*this.m_height/this.m_extent,t,t),e}ConvertViewportToProjection(t,o){const e=o.Copy(t);return i.b2Vec2.MulSV(2*this.m_extent/this.m_height,e,e),i.b2Vec2.MulSV(this.m_zoom,e,e),e}ConvertWorldToProjection(t,o){const e=o.Copy(t);return i.b2Vec2.SubVV(e,this.m_center,e),e}ConvertProjectionToWorld(t,o){const e=o.Copy(t);return i.b2Vec2.AddVV(this.m_center,e,e),e}ConvertElementToWorld(t,o){const e=this.ConvertElementToViewport(t,o),i=this.ConvertViewportToProjection(e,o);return this.ConvertProjectionToWorld(i,o)}ConvertWorldToElement(t,o){const e=this.ConvertWorldToProjection(t,o),i=this.ConvertProjectionToViewport(e,o);return this.ConvertViewportToElement(i,o)}ConvertElementToProjection(t,o){const e=this.ConvertElementToViewport(t,o);return this.ConvertViewportToProjection(e,o)}},r={compressionlevel:0,editorsettings:{export:{format:"json",target:"undrdasea_floor.json"}},height:24,infinite:!1,layers:[{draworder:"topdown",id:5,name:"Vectors",objects:[{height:0,id:1,name:"",polygon:[{x:-5.69697,y:-64.97},{x:186.30303,y:-64.97},{x:282.30303,y:-96.97},{x:346.30303,y:-96.97},{x:282.30303,y:-32.97},{x:186.30303,y:-32.97},{x:-5.69697,y:-32.97}],rotation:0,type:"",visible:!0,width:0,x:5.69697,y:192.97},{height:0,id:2,name:"",polygon:[{x:0,y:0},{x:32,y:-40},{x:160,y:-25.3333},{x:268,y:13.3333},{x:217.333,y:41.3333},{x:133.333,y:60},{x:28,y:37.3333}],rotation:0,type:"",visible:!0,width:0,x:467.03,y:212.97},{height:0,id:4,name:"",polygon:[{x:-.363636,y:-31.272},{x:93.3333,y:-31.636},{x:129.333,y:-22.30267},{x:129.333,y:-.969300000000032},{x:63.636364,y:.727999999999952},{x:-.363636,y:.727999999999952}],rotation:0,type:"",visible:!0,width:0,x:.363636,y:319.636},{height:0,id:6,name:"",polygon:[{x:0,y:0},{x:480,y:0},{x:736,y:-96},{x:832,y:-96},{x:1024,y:-64},{x:1216,y:32},{x:1920,y:-160},{x:2208,y:-160},{x:2816,y:0},{x:3107.03,y:124.97},{x:3264,y:0},{x:3584,y:-128},{x:3808,y:-160},{x:3872,y:-288},{x:3936,y:-352},{x:4e3,y:-352},{x:4288,y:-224},{x:4416,y:-96},{x:4480,y:-32},{x:4576,y:-64},{x:4928,y:-32},{x:5056,y:-128},{x:5248,y:-224},{x:5440,y:-256},{x:5568,y:-96},{x:5696,y:-192},{x:5888,y:-224},{x:6016,y:-224},{x:6176,y:0},{x:6336,y:-32},{x:7392,y:96},{x:7936,y:-32},{x:8128,y:-160},{x:8288,y:-224},{x:8416,y:-352},{x:8512,y:-384},{x:8608,y:-384},{x:8768,y:-288},{x:8928,y:-128},{x:9024,y:32},{x:9280,y:0},{x:9408,y:-32},{x:9536,y:-96},{x:9792,y:-384},{x:9856,y:-416},{x:9952,y:-384},{x:10240,y:-96},{x:10368,y:-32},{x:10592,y:-64},{x:10720,y:-160},{x:10944,y:-288},{x:11072,y:-320},{x:11136,y:-288},{x:11296,y:-96},{x:11424,y:-64},{x:11619,y:92.9697},{x:12128,y:-32},{x:12384,y:32},{x:12608,y:96},{x:13024,y:128},{x:13664,y:96},{x:14016,y:32},{x:14080,y:0},{x:14080,y:160},{x:0,y:160}],rotation:0,type:"",visible:!0,width:0,x:0,y:608},{height:0,id:7,name:"",polygon:[{x:0,y:0},{x:160,y:0},{x:352,y:32},{x:416,y:64},{x:192,y:64},{x:0,y:64}],rotation:0,type:"",visible:!0,width:0,x:0,y:448},{height:0,id:8,name:"",polygon:[{x:0,y:0},{x:192,y:-160},{x:416,y:-224},{x:640,y:-160},{x:1024,y:-128},{x:640,y:64},{x:512,y:128},{x:320,y:128},{x:128,y:96}],rotation:0,type:"",visible:!0,width:0,x:864,y:352},{height:0,id:9,name:"",polygon:[{x:0,y:0},{x:128,y:-96},{x:512,y:-128},{x:768,y:-128},{x:1152,y:-128},{x:1216,y:-96},{x:992,y:0},{x:544,y:128},{x:160,y:64}],rotation:0,type:"",visible:!0,width:0,x:2080,y:256},{height:0,id:10,name:"",polygon:[{x:0,y:0},{x:-64,y:32},{x:512,y:-32},{x:768,y:-96},{x:832,y:-192},{x:768,y:-256},{x:672,y:-288},{x:576,y:-288},{x:256,y:-96}],rotation:0,type:"",visible:!0,width:0,x:2944,y:448},{height:0,id:11,name:"",polygon:[{x:0,y:0},{x:416,y:-64},{x:800,y:-64},{x:960,y:-32},{x:544,y:160},{x:160,y:96}],rotation:0,type:"",visible:!0,width:0,x:4416,y:256},{height:0,id:12,name:"",polygon:[{x:0,y:0},{x:1536,y:0},{x:1472,y:64},{x:1216,y:96},{x:160,y:64}],rotation:0,type:"",visible:!0,width:0,x:6272,y:128},{height:0,id:13,name:"",polygon:[{x:0,y:0},{x:96,y:-32},{x:352,y:-64},{x:736,y:-64},{x:640,y:64},{x:384,y:128},{x:128,y:128}],rotation:0,type:"",visible:!0,width:0,x:8832,y:160},{height:0,id:14,name:"",polygon:[{x:0,y:0},{x:960,y:0},{x:1088,y:32},{x:832,y:64},{x:608,y:64},{x:352,y:160},{x:192,y:224},{x:96,y:192},{x:-128,y:64}],rotation:0,type:"",visible:!0,width:0,x:10336,y:96},{height:0,id:15,name:"",polygon:[{x:0,y:0},{x:224,y:-128},{x:416,y:-192},{x:1408,y:-192},{x:1280,y:-128},{x:1024,y:-64},{x:608,y:0},{x:192,y:32}],rotation:0,type:"",visible:!0,width:0,x:11488,y:320},{height:0,id:16,name:"",polygon:[{x:0,y:0},{x:320,y:-64},{x:544,y:-96},{x:736,y:-32},{x:768,y:0},{x:192,y:0}],rotation:0,type:"",visible:!0,width:0,x:11808,y:480},{height:0,id:17,name:"",polygon:[{x:0,y:0},{x:288,y:160},{x:416,y:224},{x:512,y:192},{x:608,y:96},{x:704,y:128},{x:960,y:128},{x:1440,y:-32},{x:1440,y:-64},{x:992,y:0},{x:608,y:-96},{x:224,y:-64}],rotation:0,type:"",visible:!0,width:0,x:12640,y:352},{height:0,id:18,name:"",polygon:[{x:0,y:0},{x:704,y:-160},{x:800,y:-192},{x:800,y:-128},{x:576,y:-64}],rotation:0,type:"",visible:!0,width:0,x:13280,y:640},{height:0,id:20,name:"",polygon:[{x:0,y:64},{x:-192,y:64},{x:-384,y:32},{x:-256,y:0},{x:-96,y:0},{x:0,y:32}],rotation:180,type:"",visible:!0,width:0,x:13696,y:192}],opacity:1,type:"objectgroup",visible:!0,x:0,y:0},{id:37,layers:[{id:7,image:"images/horizontal.png",name:"Image Layer 1",offsetx:0,offsety:608,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:8,image:"images/horizontal.png",name:"Copy of Image Layer 1",offsetx:0,offsety:704,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:10,image:"images/horizontal.png",name:"Copy of Image Layer 1",offsetx:704,offsety:608,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:9,image:"images/horizontal.png",name:"Copy of Copy of Image Layer 1",offsetx:704,offsety:704,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:12,image:"images/horizontal.png",name:"Copy of Copy of Image Layer 1",offsetx:1408,offsety:608,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:11,image:"images/horizontal.png",name:"Copy of Copy of Copy of Image Layer 1",offsetx:1408,offsety:704,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:14,image:"images/horizontal.png",name:"Copy of Copy of Copy of Image Layer 1",offsetx:2127,offsety:611,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:13,image:"images/horizontal.png",name:"Copy of Copy of Copy of Copy of Image Layer 1",offsetx:2112,offsety:704,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:16,image:"images/horizontal.png",name:"Copy of Copy of Copy of Copy of Image Layer 1",offsetx:3264,offsety:608,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:15,image:"images/horizontal.png",name:"Copy of Copy of Copy of Copy of Copy of Image Layer 1",offsetx:3264,offsety:704,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:18,image:"images/horizontal.png",name:"Copy of Copy of Copy of Copy of Copy of Image Layer 1",offsetx:3983,offsety:609,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:17,image:"images/horizontal.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Image Layer 1",offsetx:3982,offsety:710,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:20,image:"images/horizontal.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Image Layer 1",offsetx:4703,offsety:611,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:19,image:"images/horizontal.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Image Layer 1",offsetx:4702,offsety:712,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:22,image:"images/horizontal.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Image Layer 1",offsetx:5421,offsety:613,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:21,image:"images/horizontal.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Image Layer 1",offsetx:5420,offsety:714,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:24,image:"images/horizontal.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Image Layer 1",offsetx:6140,offsety:632,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:23,image:"images/horizontal.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Image Layer 1",offsetx:6139,offsety:733,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:26,image:"images/horizontal.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Image Layer 1",offsetx:7739,offsety:626,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:25,image:"images/horizontal.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Image Layer 1",offsetx:7738,offsety:727,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:27,image:"images/horizontal.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Image Layer 1",offsetx:8457,offsety:631,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:28,image:"images/horizontal.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Image Layer 1",offsetx:8456,offsety:731,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:30,image:"images/horizontal.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Image Layer 1",offsetx:9176,offsety:632,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:29,image:"images/horizontal.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Image Layer 1",offsetx:9175,offsety:732,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:32,image:"images/horizontal.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Image Layer 1",offsetx:9893,offsety:634,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:31,image:"images/horizontal.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Image Layer 1",offsetx:9892,offsety:734,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:34,image:"images/horizontal.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Image Layer 1",offsetx:10612,offsety:631,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:33,image:"images/horizontal.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Image Layer 1",offsetx:10611,offsety:731,opacity:1,type:"imagelayer",visible:!0,x:0,y:0}],name:"Floor",opacity:1,type:"group",visible:!0,x:0,y:0},{id:100,layers:[{id:67,image:"images/up1.png",name:"up",offsetx:484,offsety:528,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:68,image:"images/up1.png",name:"Copy of up",offsetx:1697,offsety:445,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:69,image:"images/up1.png",name:"Copy of Copy of up",offsetx:1504,offsety:508,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:73,image:"images/up1.png",name:"Copy of Copy of Copy of up",offsetx:2116,offsety:567,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:74,image:"images/up1.png",name:"Copy of Copy of Copy of Copy of up",offsetx:2144,offsety:124,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:75,image:"images/up1.png",name:"Copy of Copy of Copy of Copy of Copy of up",offsetx:1041,offsety:123,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:76,image:"images/up1.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of up",offsetx:3205,offsety:306,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:77,image:"images/up1.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of up",offsetx:3449,offsety:253,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:78,image:"images/up1.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of up",offsetx:3265,offsety:538,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:79,image:"images/up1.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of up",offsetx:3502,offsety:454,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:80,image:"images/up1.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of up",offsetx:3441,offsety:545,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:81,image:"images/up1.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of up",offsetx:4375,offsety:537,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:82,image:"images/up1.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of up",offsetx:4582,offsety:186,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:83,image:"images/up1.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of up",offsetx:4851,offsety:229,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:84,image:"images/up1.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of up",offsetx:5191,offsety:352,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:85,image:"images/up1.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of up",offsetx:5654,offsety:374,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:86,image:"images/up1.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of up",offsetx:6124,offsety:572,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:87,image:"images/up1.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of up",offsetx:7723,offsety:570,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:88,image:"images/up1.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of up",offsetx:7506,offsety:613,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:89,image:"images/up1.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of up",offsetx:7282,offsety:676,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:90,image:"images/up1.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of up",offsetx:8124,offsety:375,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:91,image:"images/up1.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of up",offsetx:9295,offsety:543,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:92,image:"images/up1.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of up",offsetx:10427,offsety:530,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:93,image:"images/up1.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of up",offsetx:11635,offsety:641,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:94,image:"images/up1.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of up",offsetx:11540,offsety:208,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:95,image:"images/up1.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of up",offsetx:11777,offsety:124,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:97,image:"images/up1.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of up",offsetx:12943,offsety:243,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:98,image:"images/up1.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of up",offsetx:13582,offsety:308,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:99,image:"images/up1.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of up",offsetx:13743,offsety:639,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:96,image:"images/up1.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of up",offsetx:12736,offsety:269,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:70,image:"images/up1.png",name:"Copy of Copy of Copy of up",offsetx:1268,offsety:562,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:71,image:"images/up1.png",name:"Copy of Copy of Copy of Copy of up",offsetx:823,offsety:625,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:72,image:"images/up1.png",name:"up",offsetx:823,offsety:625,opacity:1,type:"imagelayer",visible:!0,x:0,y:0}],name:"Up1",opacity:1,type:"group",visible:!0,x:0,y:0},{id:200,layers:[{id:135,image:"images/up2.png",name:"Up2",offsetx:949,offsety:177,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:136,image:"images/up2.png",name:"Copy of Up2",offsetx:876,offsety:225,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:137,image:"images/up2.png",name:"Copy of Copy of Up2",offsetx:1304,offsety:306,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:139,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Up2",offsetx:1572,offsety:194,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:140,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Up2",offsetx:1176,offsety:127,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:141,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:2583,offsety:213,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:142,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:2055,offsety:436,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:143,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:2739,offsety:619,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:144,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:2739,offsety:168,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:145,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:2896,offsety:120,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:146,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:3123,offsety:611,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:147,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:3219,offsety:248,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:148,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:3360,offsety:165,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:149,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:3469,offsety:150,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:150,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:3541,offsety:175,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:151,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:3578,offsety:194,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:152,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:3817,offsety:299,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:153,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:3842,offsety:240,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:154,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:3654,offsety:439,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:155,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:4273,offsety:502,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:156,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:4888,offsety:241,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:157,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:5032,offsety:189,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:158,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:4783,offsety:178,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:159,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:4934,offsety:451,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:160,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:5071,offsety:394,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:161,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:5354,offsety:431,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:162,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:5537,offsety:431,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:163,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:5973,offsety:534,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:164,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:5808,offsety:381,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:165,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:5859,offsety:381,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:166,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:6298,offsety:587,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:167,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:7097,offsety:678,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:168,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:6731,offsety:636,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:169,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:8018,offsety:427,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:170,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:7923,offsety:502,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:171,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:8339,offsety:242,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:172,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:8402,offsety:217,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:173,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:8819,offsety:548,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:174,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:8930,offsety:113,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:175,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:9360,offsety:68,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:176,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:9044,offsety:85,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:177,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:9717,offsety:192,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:178,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:9598,offsety:293,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:179,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:9494,offsety:413,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:180,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:9535,offsety:478,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:181,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:10248,offsety:558,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:182,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:9844,offsety:635,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:183,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:10682,offsety:57,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:184,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:10565,offsety:111,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:185,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:10481,offsety:144,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:186,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:10825,offsety:297,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:187,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:10686,offsety:393,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:188,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:10569,offsety:465,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:189,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:11412,offsety:645,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:190,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:11211,offsety:522,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:191,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:11282,offsety:544,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:192,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:11342,offsety:596,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:193,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:11839,offsety:607,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:194,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:11940,offsety:586,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:195,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:12184,offsety:129,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:196,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:13011,offsety:390,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:197,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:13311,offsety:303,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:198,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:13111,offsety:250,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:199,image:"images/up2.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Up2",offsetx:13935,offsety:609,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:138,image:"images/up2.png",name:"Copy of Copy of Copy of Up2",offsetx:1445,offsety:242,opacity:1,type:"imagelayer",visible:!0,x:0,y:0}],name:"Up2",opacity:1,type:"group",visible:!0,x:0,y:0},{id:201,image:"images/peak.png",name:"Top",offsetx:928,offsety:531,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:202,image:"images/peak.png",name:"Copy of Top",offsetx:667,offsety:487,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:203,image:"images/peak.png",name:"Copy of Copy of Top",offsetx:1046,offsety:220,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:204,image:"images/peak.png",name:"Copy of Copy of Copy of Top",offsetx:941,offsety:292,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:205,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Top",offsetx:1167,offsety:338,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:206,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Top",offsetx:1067,offsety:315,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:207,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:1285,offsety:153,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:208,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:1746,offsety:497,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:209,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:2077,offsety:148,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:210,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:2457,offsety:224,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:211,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:2226,offsety:185,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:212,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:2342,offsety:194,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:213,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:3092,offsety:309,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:214,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:2839,offsety:645,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:215,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:2935,offsety:677,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:216,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:3082,offsety:664,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:217,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:3865,offsety:220,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:218,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:3750,offsety:429,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:219,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:4212,offsety:412,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:220,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:3940,offsety:268,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:221,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:4153,offsety:495,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:222,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:3845,offsety:594,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:223,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:4658,offsety:234,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:224,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:4950,offsety:170,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:225,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:5331,offsety:354,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:226,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:4999,offsety:483,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:227,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:5430,offsety:486,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:228,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:5663,offsety:446,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:229,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:5935,offsety:439,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:230,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:6845,offsety:637,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:231,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:8494,offsety:219,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:232,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:8783,offsety:463,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:233,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:8723,offsety:384,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:234,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:8650,offsety:300,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:235,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:8849,offsety:80,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:236,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:9133,offsety:123,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:237,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:9253,offsety:90,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:238,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:9806,offsety:181,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:239,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:9889,offsety:261,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:240,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:9956,offsety:329,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:241,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:10040,offsety:405,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:242,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:10126,offsety:492,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:243,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:10227,offsety:65,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:244,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:10344,offsety:134,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:245,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:10956,offsety:261,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:246,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:11100,offsety:409,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:247,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:11353,offsety:558,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:248,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:12060,offsety:568,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:249,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:12240,offsety:340,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:250,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:12340,offsety:96,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:251,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:12855,offsety:323,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:252,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:13235,offsety:262,opacity:1,type:"imagelayer",visible:!0,x:0,y:0},{id:253,image:"images/peak.png",name:"Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Copy of Top",offsetx:13430,offsety:319,opacity:1,type:"imagelayer",visible:!0,x:0,y:0}],nextlayerid:254,nextobjectid:22,orientation:"orthogonal",renderorder:"right-up",tiledversion:"1.3.2",tileheight:32,tilesets:[],tilewidth:32,type:"map",version:1.2,width:440};class a{constructor(){this.debugDraw=new s;const t=new i.b2Vec2(0,-10);this.world=new i.b2World(t),this.world.SetAllowSleeping(!0),this.world.SetWarmStarting(!0),this.world.SetDebugDraw(this.debugDraw),this.camera=n,this.camera.m_zoom=12,this.viewport=document.getElementById("viewport"),this.context=this.viewport.getContext("2d"),this.debugDraw.m_ctx=this.context,this.setupBoundaries(),this.addMe()}addMePartAt(t,o){const e=new i.b2CircleShape;e.m_radius=20;const s=new i.b2FixtureDef;s.shape=e,s.density=1,s.friction=.001;const n=new i.b2BodyDef;n.type=i.b2BodyType.b2_dynamicBody,n.position.Set(t,o);const r=this.world.CreateBody(n);return r.CreateFixture(s),r}addMe(){let t=this.addMePartAt(100,200),o=this.addMePartAt(70,200);const e=new i.b2DistanceJointDef;e.Initialize(t,o,t.GetWorldCenter(),o.GetWorldCenter()),this.world.CreateJoint(e),this.me=[o,t]}setupBoundaries(){r.layers.forEach(t=>{t.objects.forEach(t=>{let o=t.polygon[0],e=null;t.polygon.forEach(i=>{e=o,o=i,null!=o&&null!=e&&this.addFixture(o.x+t.x,o.y+t.y,e.x+t.x,e.y+t.y)}),e=t.polygon[0],this.addFixture(o.x+t.x,o.y+t.y,e.x+t.x,e.y+t.y)})})}addFixture(t,o,e,s){const n=new i.b2BodyDef;let r=this.world.CreateBody(n);const a=new i.b2EdgeShape;a.Set(new i.b2Vec2(t,screen.height-o),new i.b2Vec2(e,screen.height-s)),r.CreateFixture(a,0)}tick(){for(var t=0;t<3;t++)this.world.Step(1/m*2,16,6,6),this.me[1].ApplyLinearImpulse({x:3e3,y:0},this.me[1].GetWorldCenter()),this.me.forEach(t=>{let o=t.GetPosition();t.SetPosition({x:o.x%14080,y:o.y})});this.camera.m_center=this.me[0].GetPosition()}draw(){this.context.clearRect(0,0,720,480),this.world.DrawDebugData()}}const m=60;class p{constructor(){this.fps_frames=0,this.time_last=null,this.fps_time=0,this.fps=0,this.world=new a,this.camera=n}loop(t){this.time_last=this.time_last||t;let o=t-this.time_last;this.time_last=t,o>1e3&&(o=1e3),this.fps_time+=o,this.fps_frames++,this.fps_time>=500&&(this.fps=1e3*this.fps_frames/this.fps_time,this.fps_frames=0,this.fps_time=0,document.title=this.fps.toFixed(1).toString()),o>0&&(p.shared().tick(),p.shared().draw())}static shared(){return p.instance||(p.instance=new p),p.instance}boot(){console.log("booting engine from singleton")}tick(){this.world.tick()}draw(){const t=this.world.context;t.clearRect(0,0,t.canvas.width,t.canvas.height),t.save(),t.translate(.5*t.canvas.width,.5*t.canvas.height),t.scale(1,-1);const o=this.world.camera,e=.5*o.m_height/o.m_extent;t.scale(e,e),t.scale(1/o.m_zoom,1/o.m_zoom),t.translate(-o.m_center.x,-o.m_center.y),this.world.draw(),t.restore()}}p.instance=null,window.requestAnimationFrame((function t(o){window.requestAnimationFrame(t),p.shared().loop(o)}))}]);